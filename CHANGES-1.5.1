#	$NetBSD: CHANGES-1.5.1,v 1.1.2.12 2000/12/24 07:59:04 jhawk Exp $

A complete list of changes from NetBSD 1.5 to NetBSD 1.5.1:

File						Revision(s)
----						--------

sys/sys/param.h					patch
sys/conf/osrelease.sh				patch
share/tmac/doc-common				patch

  Mark this as 1.5.1_ALPHA.

sys/dev/ic/an.c					1.1-1.3 + patch (new)
sys/dev/ic/anreg.h				1.1-1.2 (new)
sys/dev/ic/anvar.h				1.1 (new)
sys/dev/pcmcia/if_an_pcmcia.c			1.1-1.2 (new)
sys/dev/DEVNAMES				1.24
sys/conf/files					1.409
sys/dev/pcmcia/files.pcmcia			1.30
sys/arch/i386/conf/GENERIC			1.382
sys/arch/i386/conf/GENERIC_LAPTOP		1.7
sys/arch/i386/conf/INSTALL_LAPTOP		1.7

  Add a driver for an(4), Aironet and Cisco wireless pcmcia cards.

crypto/dist/krb4/lib/krb/tf_util.c		1.2
crypto/dist/krb4/lib/krb/kdc_reply.c		1.2
crypto/dist/krb4/lib/krb/extra.c		1.2

  Remove overwriting of the old ticket file.  Fix buffer overrun.
  Remove obsolete support for environment variables.

libexec/ftpd/cmds.c				1.9
libexec/ftpd/version.h				patch

  Fix a one-byte buffer overrun.

sys/netinet/udp_usrreq.c			1.73-1.74

  Fix multicast inbound packet processing.  Fixes PR#11629.

sys/dev/wscons/wsdisplay.c			1.43

  Make sure to switch consoles synchronously.

sys/arch/powerpc/powerpc/ofw_machdep.c		1.7

  Make memory probing work correctly with the DIMMs in any order.

distrib/atari/miniroot/install.md		1.14

  Add the X11 sets to MDSETS.

distrib/sets/lists/base/obsolete.mi		1.14

  Add /usr/sbin/gifconfig; we now do "ifconfig tunnel".

usr.sbin/dhcp/common/discover.c			1.9-1.10
usr.sbin/dhcp/common/bpf.c			1.7

  Fix multiple problems that caused dhcpd to either spin or not
  respond to queries in a timely fashion.

sys/arch/vax/conf/INSTALL			1.11

  Enable VS4000/90 SCSI controller.

sys/arch/hp300/stand/Makefile.inc		1.11

  Use ``make print-objdir'' to get obj directory correctly.

sys/dev/pci/fms.c				1.8

  Make this build without ``mpu at fms''.

usr.sbin/user/user.c				1.34

  Don't try to create or move directory if only ``-d'' option is
  given; documentation claims ``-m'' is also required.

usr.bin/login/k5login.c				1.17

  Use strlcpy() to copy environment variable into a fixed-length
  buffer.  Fixes PR#11550.

libexec/telnetd/sys_term.c			1.20 via patch

  Fix buffer overflow and environment passing problems, and only
  accept a limites set of environment variables and non-filename
  TERMCAP variables.

sys/arch/mac68k/nubus/nubus.h			1.52

  Add the DrHw Apple 24AC "Boogie" video card.

sys/arch/mac68k/nubus/grf_nubus.c		1.60

  Clear interrupts on the Apple "Boogie" card.

sys/coda/coda_vnops.c				1.21
sys/kern/vfs_subr.c				1.140
sys/kern/vfs_syscalls.c				1.162
sys/miscfs/genfs/genfs_vnops.c			1.20
sys/miscfs/genfs/layer_vnops.c			1.4
sys/miscfs/specfs/spec_vnops.c			1.50
sys/miscfs/syncfs/sync_subr.c			1.6
sys/miscfs/syncfs/sync_vnops.c			1.4
sys/miscfs/union/union_vnops.c			1.48
sys/msdosfs/msdosfs_vfsops.c			1.70
sys/ntfs/ntfs_vnops.c				1.30
sys/ufs/ext2fs/ext2fs_vfsops.c			1.39
sys/ufs/lfs/lfs_vnops.c				1.45
sys/ufs/ffs/ffs_balloc.c			1.22
sys/ufs/ffs/ffs_inode.c				1.37
sys/ufs/ffs/ffs_softdep.c			1.6	
sys/ufs/ffs/ffs_vfsops.c			1.71
sys/ufs/ffs/ffs_vnops.c				1.33,1.34
sys/nfs/nfs_nqlease.c				1.33
sys/nfs/nfs_serv.c				1.58
sys/nfs/nfs.h					1.24
sys/nfs/nfs_bio.c				1.52
sys/nfs/nfs_node.c				1.36
sys/nfs/nfs_subs.c				1.83
sys/nfs/nfs_syscalls.c				1.44,1.45
sys/nfs/nfs_var.h				1.18
sys/nfs/nfs_vnops.c				1.120,1.123
sys/nfs/nfs_vfsops.c				1.96
sys/nfs/nfsnode.h				1.30
sys/nfs/nfsproto.h				1.9
sys/nfs/nfs_socket.c				1.60
sys/nfs/nfs_subs.c				1.85,1.87
sys/kern/vnode_if.src				1.25	
sys/kern/vnode_if.c				regenerate
sys/sys/vnode_if.h				regenerate

  Improve NFS performance, possibly with as much as 100% in
  throughput.  Please note: this implies a kernel interface change,
  VOP_FSYNC gains two arguments.

sys/nfs/nfs_boot.c				1.55
sys/nfs/nfs_socket.c				1.63
sys/kern/uipc_socket.c				1.51
sys/kern/uipc_syscalls.c			1.56
sys/sys/socketvar.h				1.41

  Fix NFS+tcp client hangs on server or network outage.  Again,
  please note that this introduces yet another kernel interface
  change: sobind() gains an argument.

usr.bin/passwd/krb5_passwd.c			1.10

  Don't try to free an uninitialized context; fixes core dump when
  called as ``yppasswd''.

sys/dev/pcmcia/if_ray.c				1.24-1.25

  Add a missing return after freeing an mbuf.
  Add support for 802.11 authentication frames, required to
  interoperate with Aviator Pro cards on Windows.

sys/dev/pci/pccbb.c				1.47,1.49

  Turn off power on shutdown, except on ToPIC (TI 113X) bridges on
  shutdown to avoid hangs on some systems.

distrib/notes/sparc64/hardware			1.6
distrib/notes/sparc64/install			1.5

  Recommend minimum 32MB.  The pciide cdroms work on secondary channel,
  but disks do not.  Also, add ``Install from Solaris'' instructions.

distrib/sparc/ramdisk/dot.profile		1.15

  Look for ``instfs.tgz'' in the $MACHINE subdir on cdrom first.

sys/arch/pmax/pmax/autoconf.c			1.55

  Fix netbooting on the 2100/3100.  Fixes PR#11212.

usr.sbin/pkg_install/add/main.c			1.17
usr.sbin/pkg_install/add/perform.c		1.56
usr.sbin/pkg_install/admin/main.c		1.17
usr.sbin/pkg_install/create/perform.c		1.24
usr.sbin/pkg_install/info/perform.c		1.34
usr.sbin/pkg_install/lib/file.c			1.44-1.45
usr.sbin/pkg_install/lib/ftpio.c		1.28
usr.sbin/pkg_install/lib/str.c			1.24

  Accept ``.tbz'' as an alternative suffix; compress with bzip2 if
  a .tbz suffix is given.  Fix pkg_info to work via ftp, either
  via URL on command line or from PKG_PATH environment variable.

sys/arch/news68k/dev/zs.c			1.5

  Initialize zs chip in zscninit() so that the kernel can use serial
  console even if the PROM uses bitmap console.  Remove some dead
  code.  Use BPS_TO_TCONST() to initialize baudrate.

sys/arch/arm32/pci/pciide_machdep.c		1.3

  Print which IRQ is used for compatibility interrupts.

sys/arch/sun3/sun3/sunmon.c			1.11
sys/arch/sun3/sun3x/machdep.c			1.61

  Make PROM boot command work properly even after halt on 3/80.

sys/lib/libsa/loadfile.c			1.9

  Don't print ``]'' if loading kernel does not have a symbol table.

sys/dev/pci/pciide.c				1.93

  Add support for Intel ICH2 IDE controller.

usr.sbin/mopd/mopd/process.c			1.10

  Make sure dle points to the correct slot.  Fixes PR#11253.

sys/dev/microcode/siop/ncr53cxxx.c		1.3-1.5

  Allow conditional branch like "JUMP foo, IF FALSE" (that the
  driver can later patch).  Bug fixes and syntax checking improvement.

sys/dev/microcode/siop/siop.ss			1.8-1.12
sys/dev/microcode/siop/siop.out			regenerate
sys/dev/ic/siop.c				1.23-1.24,1.28-1.36
sys/dev/ic/siop_common.c			1.7-1.11
sys/dev/ic/siopreg.h				1.7
sys/dev/ic/siopvar.h				1.9-1.13
sys/dev/ic/siopvar_common.h			1.5-1.8
sys/dev/pci/siop_pci_common.c			1.3
sys/dev/pci/siop_pci_common.h			1.2

  Speed improvements to the siop driver, and add tagged queueing
  support.  As a side effect, better handling of some not so common
  phase or message sequences.

distrib/notes/amiga/hardware			1.39

  Nowadays, need to tell people what models didn't have an MMU out
  of the box.

sbin/ping6/ping6.c				1.25

  Validate strdup() error on argument parsing.  Also, use strlcat()
  on complex string manipulation.

usr.sbin/grfconfig/grfconfig.8			1.10

  Document that text console modes need a depth field of 4.

share/man/man8/compat_pecoff.8			1.3-1.6

  Various grammar corrections, markup fixes.  Updates for the
  current status of The PEACE Project.

share/man/man8/Makefile				1.40

  Alias compat_win32.8 and peace.8.

distrib/sets/lists/man/mi			1.288

  Add peace(8) and compat_win32(8).

distrib/x68k/floppies/ramdisk-common/Makefile.inc 1.2

  Change all ocurrences of ``crunchgen'' to ${CRUNCHGEN}.

distrib/x68k/floppies/Makefile			1.7
distrib/x68k/floppies/bootfloppy-common/Makefile.inc 1.16
distrib/x68k/floppies/ramdisk.sysinst/Makefile	1.12 via patch
distrib/x68k/floppies/ramdisk.sysinst/dot.profile 1.7
distrib/x68k/floppies/bootfloppy.generic/Makefile 1.1 (new)
distrib/x68k/floppies/inst/Makefile		1.1 (new)
distrib/x68k/floppies/bootfloppy/Makefile	delete
distrib/x68k/floppies/ramdisk/Makefile		delete
distrib/x68k/floppies/ramdisk/dot.hdprofile	delete
distrib/x68k/floppies/ramdisk/dot.profile	delete
distrib/x68k/floppies/ramdisk/install.tmpl	delete
distrib/x68k/floppies/ramdisk/list		delete
distrib/x68k/floppies/ramdisk/mtree.conf	delete
distrib/x68k/floppies/ramdisk/ramdiskbin.conf	delete
distrib/x68k/floppies/ramdisk/start.tmpl	delete
distrib/x68k/floppies/ramdisk/upgrade.tmpl	delete

  Reorganize installation system by removing the old script based
  installer, provided for 4M systems.  Instead we provide
  ``floppy-root'' 2-floppy installer.

etc/etc.x68k/Makefile.inc			1.9
sys/arch/x68k/conf/INSTALL_SMALL		delete

  We do not use INSTALL_SMALL anymore.

sys/arch/x68k/conf/INSTALL			1.36 via patch

  Adjust the ramdisk size.

distrib/x68k/floppies/bootfloppy.sysinst/Makefile 1.6

  Change the kernel name from netbsdsi(.gz) to netbsd(.gz).

sys/arch/mac68k/obio/grf_obio.c			1.46-1.47

  Map only the register space of the DAFB required to set up the
  video hardware.  Fixes PR#11000.
  Be careful to unmap anything we map in the drivers' match function
  in order to avoid potential future problems.

sys/dev/ic/an.c					patch

  Fix multicast packet reception; handle corresponding ioctl().

sys/kern/vfs_getcwd.c				1.14

  Avoid an infinite loop if VOP_READDIR returned an error.

sys/arch/news68k/include/cpu.h			1.7
sys/arch/news68k/news68k/genassym.cf		1.6
sys/arch/news68k/news68k/locore.s		1.13,1.16

  Allow runtime enabling/disabling of DC_BE and IC_BE bits in %cacr
  and enable them on news1200/1400/1500 (Which have no L2 cache); yields
  a performance improvement. Also correct a typo in a comment.

sys/arch/news68k/include/romcall.h		1.2
sys/arch/news68k/stand/boot/boot.c		1.3
sys/arch/news68k/stand/boot/locore.S		1.3
sys/arch/news68k/stand/bootxx/start.S		1.2
sys/arch/news68k/stand/common/romcalls.S	1.2

  Make sure to return PROM prompt even if loading kernel fails halfway,
  by calling the PROM halt routine upon failure of loadfile().
