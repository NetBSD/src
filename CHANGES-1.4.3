#	$NetBSD: CHANGES-1.4.3,v 1.1.2.20 2000/06/03 15:29:08 he Exp $

A complete list of changes from NetBSD 1.4.2 to NetBSD 1.4.3:

File						Revision(s)
----						--------

sys/conf/osrelease.sh				patch

  Bump visible version number to 1.4.2A, to indicate that we're
  no longer exactly at 1.4.2.

sys/ufs/lfs/lfs_vfsops.c			1.37-1.38

  Prevent lfs_mountroot() from attempting to use a network device
  as root.

sys/arch/sparc/dev/zs.c				patch

  Fix a NULL pointer dereference when a zs device interrupts during
  autoconfiguration of subdevices (keyboard & mouse).

usr.sbin/sup/source/scm.c			1.10

  Improve error message when unable to look up local hostname.

gnu/dist/gcc/config/alpha/alpha.c		1.5

  Change ev5/ev56 L1 cache latency from 2 to 3.

usr.bin/lex/flex.skl				1.13-1.14

  Allow C++ lexers to build.  Fixes PR#8258.

sbin/mknod/mknod.8				1.17

  In the example conf.c path, arch-specific directories now
  live under sys/arch, not directly under sys.

libexec/ld.aout_so/rtld.1			1.9-1.10

  Document LD_PRELOAD and note the security restrictions.
  Fixes PR#9663.  Also some spelling fixes.

distrib/notes/Makefile				patch
distrib/notes/Makefile.inc			patch

  Format HTML with latin1 characters.  Add a "release" target to
  install the formatted release notes.

sys/arch/arm32/conf/CATS			patch

  Add vr(4) and ukphy to config.

lib/libc/sys/intro.2				1.20-1.21

  Note that EFAULT can't be guaranteed in e.g. pipe(2); fixes PR#7720.
  Update the description of errno.  Fixes PR#9496.

etc/etc.i386/MAKEDEV				1.85

  Create wd2 and wd3 device nodes also on the floppy images, to allow
  installation on those drives too.

sys/dev/pci/ncr.c				1.87, 1.96-1.97

  Fix script bug in processing QUEUE FULL response (would always
  trigger an assertion failure), and add Quantum Atlas IV drives
  to the quirk table so that they don't use tagged queueing.
  Fixes problems reported in PR#7694.

distrib/notes/common/sysinst			patch

  Clarify the PCMCIA IRQ allocation workaround.  Fixes PR#9568.

usr.bin/du/du.c					1.15

  Include -r flag in usage message.

sys/arch/alpha/alpha/pmap.c			1.130
sys/arch/i386/i386/pmap.new.c			patch (1.85 pmap.c)
sys/arch/mips/mips/pmap.c			1.88
sys/arch/pc532/pc532/pmap.new.c			patch (1.47 pmap.c)
sys/uvm/uvm.h					1.19
sys/uvm/uvm_page.c				1.32

  Use a more reliable method to determine if uvm_page_init() has
  completed.  This fixes a problem observed on some i386 configs
  (typically with lots of memory) where the kernel page table needs
  to grow during initialization.

gnu/dist/gcc/config/alpha/alpha.c		1.6

  Do not enable CIX on ev6/21264, but add an ev67/21264a switch
  that does.  Fixes kernel built with -mcpu=ev6.

distrib/notes/common/sysinst			patch

  More tweaking of the text explaining the PCICMA workaround.  Now
  includes instructions for patching the kernel binary and for
  configuring the corresponding kernel option.

lib/libarch/m68k/m68k_sync_icache.S		1.3 via patch

  Make libm68k work.

share/man/man4/wscons.4				1.11

  Clarify language, fixes PR#9708.

sys/netinet/ip_output.c				1.73

  Pass M_BCAST and M_MCAST flags to fragments.  Fixes PR#9772.

distrib/notes/common/postinstall		1.6 via patch
distrib/notes/common/postinstall		1.7

  Clarify exactly where pkgsrc.tar.gz should be extraced.
  Fixes PR#9580.  Clarify that /usr/pkgsrc is not the One True
  Location, but merely a convention.

share/man/man4/options.4			1.103-1.104 via patch

  Document PCMCIA IO space conflicts and options.  Note use and
  existance of PCIC_ISA_ALLOC_IOBASE and PCIC_ISA_ALLOC_IOSIZE.
  Re-sort references.

share/man/man4/pcmcia.4				1.15 via patch

  Note PCIC_ISA_ALLOC_IOBASE and PCIC_ISA_ALLOC_IOSIZE.
  Fixes PR#9683.

usr.bin/man/man.c				1.17-1.22
usr.bin/man/config.c				1.10
usr.bin/man/man.1				1.9
usr.bin/man/config.h				1.3
usr.bin/man/man.conf.5				1.6-1.7
usr.bin/man/pathnames.h				1.4

  Pull up various changes from the trunk:
   o fix signal handlers to avoid obscure exit codes
   o clean up after SIGPIPE
   o try TMPDIR env variable, fall back to _PATH_TMP
   o fall back to more if PAGER is set but null
   o recognize _crunch in man.conf
   o use uname(3) to determine MACHINE type
   o man page typos fixed.  Document _crunch.

lib/libpcap/pcap.c				1.8
lib/libpcap/savefile.c				1.6

  Fix pcap_dispatch() timeout handling.  Use snprintf, not sprintf.
  This synchronizes with a more recent LBL libpcap.

sys/arch/i386/conf/HOMEWORLD			patch

  Synchronize with config for the new HOMEWORLD machine.

share/man/man8/man8.i386/boot_console.8		1.5

  Remove text asserting that CONSDEV_AUTO and CONSDEV_COM*KBD imply
  COMCONS_KEYPRESS (they don't).

bin/dd/position.c				1.7-1.8

  Correctly lseek() on non-tape character devices (e.g. disks)
  as the manual page documents.

sys/sys/proc.h					1.88 via patch
sys/kern/kern_subr.c				1.62 via patch
sys/kern/kern_synch.c				1.69 via patch
sys/kern/kern_ktrace.c				1.38-1.39 via patch

  Fix two bugs:
   o A malicious or erroneous program can hog the CPU in uiomove()
   o A ktrace of such a program can hog large amounts of kernel memory
  Fixes SA#2000-005.

distrib/notes/common/main			patch

  Add a (for the time being empty) caveats section for 1.4.3.

lib/libskey/skeylogin.c				1.13 via patch

  In skeyverify(), don't restore priority to 0, but to previous
  priority.  Fixes PR#4891.

sys/uvm/uvm_map.c				1.72

  Undo revision 1.13: don't block interrupts while deactivating
  one pmap and activating another, since these only affect user-
  level mappings which cannot be accessed from interrupt context.
  This fixes Sparc zstty overflows reported in PR#8322, since pmap
  operations are slow on old sun4c sparcs.

gnu/dist/gcc/config/alpha/netbsd.h		1.11

  Pass the appropriate directive to the assembler if an -mcpu=...
  option is given to the compiler.

sys/net/if.c					1.62 via patch

  Fix ifa_ifwithnet() for the netatalk case to properly return the
  best match and not the first match.  Makes netatalk work again
  on networks without AppleTalk routers.  Fixes PR#9957.

sys/dev/pci/if_ti.c				1.6-1.7 via patch

  Fix bug which could result in a panic.  Add a shutdown hook to
  stop the board to avoid memory corruption on reboot.  Use bus_space
  for TIGON 2 chips, so that they will work even if we can't map
  the memory space linearly (e.g. on alpha).

sys/msdosfs/fat.h				1.14

  Correct broken "LP64 fix" introduced in last pullup, and better
  explain sense of MSDOSFSEOF() macro.  Fixes PR#9116, PR#9206 and
  part of PR#8037.

sys/msdosfs/msdosfs_vnops.c			1.96

  Avoid integer overflow preventing reading of files >2GB in size.
  Fixes PR#9046.

sys/dev/isa/pas.c				1.47

  Fix bug related to allocation / deallocation of bus_space region
  if map of SB I/O space failed.  Fixes PR#9992.

sys/netinet/ip.h				1.20-1.21

  Add "__attribute__((__packed__))" to structures used to describe
  on-the-wire data, to prevent egcs from making unwarranted assumptions
  about the alignment of these structures.

sys/kern/kern_subr.c				patch

  Allow this to compile without DIAGNOSTIC defined.

sys/ufs/lfs/lfs_vfsops.c			1.50

  Sanity check the superblock before trying to use it to find the
  alt superblock; sanity check the disk address of the alt superblock
  to avoid deadlocking when trying to read it with the primary
  superblock buffer still busy.  Fixes PR#10001.

lib/libc/arch/i386/sys/syscall.S		1.9
lib/libc/arch/i386/sys/brk.S			1.13
lib/libc/arch/i386/sys/exect.S			1.10
lib/libc/arch/i386/sys/ptrace.S			1.13
lib/libc/arch/i386/sys/sbrk.S			1.11
lib/libc/arch/i386/sys/sigprocmask.S		1.14
lib/libc/arch/i386/sys/sigsuspend.S		1.12

  Repair syscall stubs which were not adapted when the cerror
  interface was changed.

usr.bin/at/at.c					1.14

  Correct wrong variable being tested in env parsing loop.

usr.sbin/bind/lib/Makefile			1.9 via patch
dist/bind/include/port_ipv6.h			patch (new)

  Use a static version of port_ipv6.h instead of generating it.
  The use of the probe script had at least two problems: it probed
  the host headers (could be fixed in another way), and it could
  be problematical in a cross-compile environment.

sys/netinet/ip_input.c				1.112

  Handle large offsets inside very small options correctly.

usr.sbin/wiconfig/Makefile			1.1-1.2 (new)
usr.sbin/wiconfig/wiconfig.8			1.1-1.5 (new)
usr.sbin/wiconfig/wiconfig.c			1.1-1.4 (new)
usr.sbin/Makefile				1.121 via patch
sys/dev/pcmcia/Makefile				1.3
sys/dev/pcmcia/if_wi_ieee.h			1.1-1.4 (new)
sys/dev/pcmcia/if_wireg.h			1.1-1.5 (new)
sys/dev/pcmcia/if_wivar.h			1.1-1.7 (new)
sys/dev/pcmcia/if_wi.c				1.1-1.13,1.15-1.17 via patch
sys/dev/pcmcia/files.pcmcia			1.15
sys/dev/pcmcia/pcmciadevs			1.39
sys/dev/pcmcia/pcmciadevs.h			regenerate
sys/dev/pcmcia/pcmciadevs_data.h		regenerate
sys/net/if_media.h				1.16-1.17,1.19,1.21-1.23
sys/net/if_media.c				1.9
sys/net/if.h					1.46 (partial) via patch
sys/net/if_ieee80211.h				1.1-1.2 (new)
share/man/man4/wi.4				1.1-1.10 via patch
share/man/man4/Makefile				patch
share/man/man4/pcmcia.4				patch
sys/arch/i386/conf/GENERIC			1.252
sys/arch/i386/conf/INSTALL			1.123
distrib/i386/floppies/ramdisk/ramdiskbin.conf	1.16
distrib/i386/floppies/ramdisk/list		1.21
distrib/i386/floppies/ramdisk/Makefile		patch
distrib/sets/lists/man/mi			patch
distrib/sets/lists/base/mi			patch

  Add a driver for ``wi'', Lucent "Orinoco"/Wavelan.

sys/dev/eisa/if_ep_eisa.c			1.22

  Only allocate the I/O space required.  This permits an ISDN4BSD kernel
  with e.g. an AVM Fritz! card to work with an ep0 card in EISA slot 1.
  Fixes PR#5279.

sys/dev/ic/elink3.c				1.80

  Make the 3Com 3C597 Fast Etherlink TX EISA card work.  Fixes PR#7067.

distrib/i386/floppies/bootfloppy-common/Makefile.inc	patch

  Make sure the PCMCIA alloc variables are retained in the symbol
  table of the resulting kernel, thereby allowing them to be tweaked
  as described in the install notes.

libexec/ftpd/ftpd.c				patch

  Back out unnecessary half of revision 1.70 which breaks parsing
  of /etc/ftpchroot.  Fixes SA#2000-006.

usr.sbin/chown/chown.c				1.21

  Deal with user names with `.' in them.  Fixes PR#10043.

sys/netinet/fil.c				1.32

  Fix bug in dealing with large offsets inside very small options.

sys/dev/pci/isp_pci.c				patch
sys/dev/ic/isp.c				patch
sys/dev/ic/isp_inline.h				patch
sys/dev/ic/isp_netbsd.c				patch
sys/dev/ic/isp_netbsd.h				patch
sys/dev/ic/ispmbox.h				patch
sys/dev/ic/ispreg.h				patch
sys/dev/ic/ispvar.h				patch
sys/dev/microcode/isp/asm_pci.h			patch

  Correctly account for F-port vs. F-port (no FLOGI_ACC) topologies.
  Make sure we get a port database entry for the fabric name server.
  Preserve fabric logins if the device didn't change across fabric
  or port database changes, or the device has already logged into
  us (e.g., for target/initiator dual role devices like Veritas
  SANbox). Propagate class 3 service parameter changes where devices
  can change roles.

  Fix all occurrences of setting a sendmarker so that setting it
  for one bus on dual bus cards doesn't wipe a pending sendmarker
  for other busses on the same card.

  Comments added and clarifications made in some of the target mode code.

  Add support for > 12 byte CDBs.  Split out nvram reading into
  per-card functions.  Add proper Ultra2/Ultra3 support.  Upgrade
  firmware.

sys/dev/pci/if_fxpvar.h				patch
sys/dev/pci/if_fxp.c				patch

  Fix the fxp driver so that it works after a warm-boot from windows
  and across an APM suspend/resume or hibernate/resume cycle.  Fixes
  PR#9370, PR#9548, PR#9571 and PR#9573.

sys/dev/isa/i82365_isasubr.c			1.21
sys/arch/i386/conf/INSTALL			patch
distrib/notes/common/main			patch
distrib/notes/common/sysinst			patch

  Revert 12-bit iospace for PCMCIA to 0x400-0xfff.  Mask out a
  superset of the PCMCIA IRQs from GENERIC in INSTALL (5, 7 and
  10).  Rework the text explaining the PCMCIA workarounds; explain
  both the IO space and IRQ workarounds.

sys/dev/ic/smc83c170.c				1.31 via patch

  Use the lower bits of the crc32 for the multicast address filter,
  not the upper bits.  Fixes PR#8268.

sys/dev/pci/pcidevs				1.198
sys/dev/pci/pcidevs_data.h			regenerate
sys/dev/pci/pcidevs.h				regenerate

  Add product IDs for some VIA Technologies devices.

etc/etc.i386/MAKEDEV				1.107

  Create tty03 by default for pcmcia modems.

etc/group					1.7

  Create ``users'' group for the benefit of useradd.

bin/ps/ps.c					1.37

  Only check the terminal size via STDOUT, not STDERR or STDIN.

sbin/dmesg/dmesg.8				1.11

  Mention /var/run/dmesg.boot.

gnu/dist/gcc/config/arm/arm.md			1.5

  Add clobber of the condition code register in negdi2.  Fixes
  PR#9613.

sys/arch/i386/pci/pcib.c			1.26

  Do not handle the VIA Technologies VT82C688A SMBus Controller
  as a PCI/ISA bridge.  Fixes PR#10093.

libexec/getty/ttys.5				1.13

  Fix documentation regarding rtscts/mdmbuf/dtrcts.  Fixes PR#9427.

sbin/mknod/mknod.8				1.18

  Document -F flag.  Fixes PR#9451.

usr.bin/vmstat/vmstat.8				1.17

  Fix typo in manual page.  Fixes PR#10036.

lib/libc/stdio/fopen.3				1.11

  Correct inconsistency between implementation and documentation.
  Fixes PR#6072.

sys/netinet/ip_state.c				patch

  Do not let RST TCP segments create state.

sys/dev/pci/if_fxp.c				patch

  Calibrate the timeouts by using DELAY(1) so their values are less
  machine-dependant. Fixes PR#10141, where spurious timeouts were
  being seen.  Also report the line numbers of the timeouts so it
  can be determined which is being seen.

sbin/newfs/mkfs.c				1.38

  Abort if the number of cylinder group summary area is larger than
  MAXCSBUFS.

usr.bin/gencat/gencat.1				1.1-1.2 (new)
distrib/sets/lists/man/mi			patch

  Add manual page for gencat.

distrib/utils/sysinst/mbr.c			1.22
sbin/fdisk/fdisk.c				1.40
sys/arch/i386/stand/lib/crt/bootsect/start_bootsect.S 1.17

  Fix a booting problem when int13 extensions are used (> 8GB),
  and CHS values in MBRs were written from sysinst or fdisk that
  some BIOSes (Adaptec SCSI BIOS 2.20 in particular) didn't like.

sbin/ldconfig/ldconfig.c			1.28-1.29
libexec/ld.aout_so/shlib.c			1.18 via patch
include/paths.h					1.14

  Enable searching for libraries under /emul/aout, and make sure
  that ELF libraries are not erroneously accepted.

sys/kern/sysv_sem.c				1.37

  Remove existing semaphore system locking mechanism.  This avoids
  giving users a way to wedge processes which use semaphores (NOTE:
  this would only affect processes using semaphores).  Fixes
  SA#2000-004.

etc/inetd.conf					1.29 via patch

  Disable everything except ftpd and telnetd by default.
  Fixes PR#9673.

sys/dev/pci/if_ti.c				patch

  Fix compile error.

sys/miscfs/procfs/procfs_cmdline.c		1.8

  Fix a possible kernel memory leak - if the command line of a
  process was requested after it had started to exit but before it
  became a zombie a page of kernel memory would not be freed.

sys/arch/i386/i386/pmap.new.c			patch
sys/arch/pc532/pc532/pmap.new.c			patch

  When allocating new PT pages during early bootstrap (i.e. before
  pmap_init() has finished), make sure to zero them.

usr.bin/ipcs/ipcs.1				1.9

  Finish an unfinished sentence.

bin/test/test.c		1.21

  Fix operator precedence consistency.  Fixes PR#7015.

bin/test/test.c		1.22
bin/sh/builtins.def	1.15
bin/sh/Makefile		1.50

  Enable test as a shell builtin.  Fixes PR#9847.

sys/arch/amiga/conf/GENERIC			patch
sys/arch/arm32/conf/GENERIC			patch
sys/arch/atari/conf/GENERIC			patch
sys/arch/bebox/conf/GENERIC			patch
sys/arch/hp300/conf/GENERIC			patch
sys/arch/i386/conf/GENERIC			patch
sys/arch/mac68k/conf/GENERIC			patch
sys/arch/macppc/conf/GENERIC			patch
sys/arch/newsmips/conf/GENERIC			patch
sys/arch/next68k/conf/GENERIC			patch
sys/arch/ofppc/conf/GENERIC			patch
sys/arch/pc532/conf/GENERIC			patch
sys/arch/pmax/conf/GENERIC			patch
sys/arch/sparc/conf/GENERIC			patch
sys/arch/sparc64/conf/GENERIC			patch
sys/arch/sun3/conf/GENERIC			patch
sys/arch/vax/conf/GENERIC			patch
sys/arch/x68k/conf/GENERIC			patch
sys/arch/arm32/conf/A7000			patch
sys/arch/sun3/conf/GENERIC3X			patch

  Disable the UNION file system, to avoid a repeat of the 1.4.1
  and 1.4.2 LAST_MINUTE changes.  It is reportedly buggy, and can
  be used by ordinary users to crash the system.

distrib/notes/common/main			patch

  The version of IPF shipped with 1.4.2 was 3.3.6, not 3.3.5.
  Correct the notes correspondingly.

distrib/i386/floppies/bootfloppy-common/Makefile.inc	patch
distrib/i386/floppies/fdset-common/Makefile.inc	patch

  ``Make release'' goes to installation/floppy; use gzip -9.

distrib/macppc/floppies/ramdisk/Makefile	patch

  Don't rely on /etc/disktab, instead construct a disktab on
  the fly based on numbers supplied here.

sys/arch/sparc/conf/INSTALL			patch
distrib/sparc/ramdisk/Makefile			patch

  Use 3240 and not 3528 as miniroot size.

distrib/sparc/bootfs/Makefile			patch

  Don't strip kernel, copy INSTALL kernel to kernel directory
  under ``make release''.

distrib/sparc/bootfs.sysinst/Makefile		patch

  Don't strip kernel, use boot.700000, copy sysinst INSTALL
  kernel to kernel directory under ``make release''.

distrib/sparc/ramdisk/list			patch

  Make the "ramdisk" devices, not the "floppy" devices.

distrib/utils/sysinst/arch/vax/md.h		patch

  Don't offer to install xserver set -- it's not built in
  this version.
