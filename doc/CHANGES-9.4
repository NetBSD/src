# $NetBSD: CHANGES-9.4,v 1.1.2.16 2022/09/16 18:37:48 martin Exp $

A complete list of changes from the NetBSD 9.3 release to the NetBSD 9.4
release:

external/gpl2/groff/tmac/mdoc.local		patched by hand
sys/sys/param.h 				patched by hand
doc/README.files				patched by hand
doc/CHANGES-9.4					added

	Welcome to 9.3_STABLE.
	[martin]

sys/netinet6/nd6.c				(apply patch)

	PR 55680: avoid duplicate free of link layer entries.
	[kim, ticket #1497]

lib/libpthread/pthread.c			1.181 (via patch)

	Fix pthread hangs on startup.
	[riastradh, #1498]

sys/dev/ic/dwc_gmac.c				1.76,1.77

	Fix chip configuration so that stripping of the FCS is
	consistent for all packet types.
	[sekiya, ticket #1499]

sys/dev/raidframe/rf_disks.c			1.93 (patch)
sys/dev/raidframe/rf_driver.c			1.140(patch)
sys/dev/raidframe/rf_netbsdkintf.c		1.408(patch)

	raid(4): reject invalid values for numCol and numSpares.
	Explicitly nul-terminate all strings coming from userland.
	Avoids signed arithmetic in some ioctl commands.
	[mrg, ticket #1500]

sys/kern/uipc_sem.c				1.60

	PR 55509: fix per-uid "semcnt" bookeeping.
	[chs, ticket #1501]

libexec/telnetd/utility.c			1.34

	telnetd(8): fix CVE-2020-10188.
	[hgutch, ticket #1502]

external/cddl/osnet/dist/lib/libzfs/common/libzfs_import.c 1.6,1.7

	Enable zpool(8) to reliably find components on dk(4) wedges.
	[riastradh, ticket #1503]

sys/fs/ptyfs/ptyfs_vnops.c			1.69

	ptyfs: fix buffer overrun.
	[riastradh, ticket #1504]

sys/dev/ic/tpm.c				1.20
sys/dev/isa/tpm_isa.c				1.8

	tpm(4): kernel attach messages cosmetics.
	[riastradh, ticket #1505]

sys/dev/raidframe/rf_netbsdkintf.c		1.409

	raid(4): reject the RAIDFRAME_SET_LAST_UNIT and RAIDFRAME_SHUTDOWN
	ioctls when RAIDframe is not initialized.
	[oster, ticket #1506]

bin/test/test.c					1.45

	PR 56983: fix confusing message in test(1).
	[dholland, ticket #1507]

libexec/telnetd/telnetd.c			1.58 (patch)

	telnetd(8): fix a crash accessing the slc table before initialization.
	[dholland, ticket #1508]

sys/dev/scsipi/sd.c				1.335
sys/dev/scsipi/sdvar.h				1.40

	sd(4): fix buffer over-read leading to garbage appended
	to the device type string and possible information disclosure.
	[mlelstv, ticket #1509]


external/mit/xorg/bin/xdm/Makefile		1.18,1.19
external/mit/xorg/bin/xdm/Makefile.xdm		1.11

	PR 54851: xdm(8): fix the man page generation, and include
	"sbin" directories (and games) in DEF_USER_PATH.
	[nia, ticket #1510]

external/mit/xorg/server/drivers/xf86-video-wsfb/Makefile 1.6

	wsfb(4): disable broken DGA extension for xf86-video-wsfb.
	[rin, ticket #1511]

sys/dev/ata/ata.c				1.163

	wd(4): fix verbose attach messages for ATA controllers w/o UltraDMA
	support.
	[tsutsui, ticket #1512]

sys/arch/m68k/m68k/m68k_trap.c			1.3

	m68k: make a DEBUG kernel compilable.
	[tsutsui, ticket #1513]

distrib/amiga/floppies/inst-common/dot.commonutils 1.9
distrib/amiga/miniroot/dot.profile		1.11
distrib/atari/floppies/common/dot.profile	1.9
distrib/utils/script-installer/dot.commonutils	1.8
distrib/vax/inst-common/dot.commonutils		1.6

	PRs 54835, 54835, 56983: adapt install scripts to the shell
	being compiled without support for depracated test expressions.
	[tsutsui, ticket #1514]

sys/dev/pci/if_wm.c				1.741-1.749,1.753-1.757,
						1.762 via patch
sys/dev/pci/if_wmreg.h				1.126-1.127

	- Fix I219 workaround in wm_flush_desc_rings().
	- Add more statistics counters.
	- To avoid releasing mutex temporally, use new
	  wm_set_mdio_slow_mode_hv_locked().
	- No functional changes:
	  - Turn a locking botch (shouldn't drop lock on error) into a KASSERT
	    in wm_deferred_start_locked().
	  - Remove unneeded header inclusion.
	  - Use __BIT() a little.
	  - Modify comment and debug messages.
	  - Consistency use -1 instead of 1 for some error code.
	  - KNF.
	[msaitoh, ticket #1515]

sys/kern/kern_core.c				1.36

	Fix kauth credential reference leak.
	[christos, ticket #1516]

sys/kern/kern_core.c				1.37

	Avoid a GCC warning.
	[mrg, ticket #1517]

sys/arch/atari/dev/ite.c			1.82
sys/arch/atari/dev/ite_cc.c			1.45
sys/arch/atari/dev/ite_et.c			1.36
sys/arch/atari/dev/itevar.h			1.15

	Add a minimum DEC special graphics character support
	for atari ite(4).
	[tsutsui, ticket #1518]

sys/arch/atari/atari/atari_init.c		1.105
sys/arch/atari/conf/GENERIC.in			1.123
sys/arch/atari/conf/files.atari			1.124
sys/arch/atari/conf/ATARITT			(regen)
sys/arch/atari/conf/FALCON			(regen)
sys/arch/atari/conf/HADES			(regen)
sys/arch/atari/conf/MILAN-ISAIDE		(regen)
sys/arch/atari/conf/MILAN-PCIIDE		(regen)
sys/arch/atari/conf/SMALL030			(regen)

	Improve the Atari ST-RAM reservation to make the old Xserver
	work by default.
	[tsutsui, ticket #1519]

sys/arch/atari/vme/if_le_vme.c			1.32,1.33

	le(4): fix a long-standing "leprobe: cannot map memory-area"
	error during probe.
	[tsutsui, ticket #1520]

sys/arch/atari/conf/MILAN.in			1.30
sys/arch/atari/pci/pci_vga.c			1.19
sys/arch/atari/conf/ATARITT			(regen)
sys/arch/atari/conf/FALCON			(regen)
sys/arch/atari/conf/HADES			(regen)
sys/arch/atari/conf/MILAN-ISAIDE		(regen)
sys/arch/atari/conf/MILAN-PCIIDE		(regen)
sys/arch/atari/conf/SMALL030			(regen)

	Improve VGA console settings for Milan, especially for sysinst.
	[tsutsui, ticket #1521]

usr.bin/netstat/atalk.c		1.18,1.20-1.21
usr.bin/netstat/bpf.c		1.16 via patch
usr.bin/netstat/fast_ipsec.c	1.24
usr.bin/netstat/if.c		1.97-1.99,1.101-1.104 via patch
usr.bin/netstat/inet.c		1.111,1.115-1.116 via patch
usr.bin/netstat/inet6.c		1.74-1.75,1.80-1.81 via patch
usr.bin/netstat/main.c		1.100-1.103
usr.bin/netstat/mbuf.c		1.35
usr.bin/netstat/mroute.c	1.26-1.27
usr.bin/netstat/mroute6.c	1.16
usr.bin/netstat/netstat.h	1.52-1.53
usr.bin/netstat/pfkey.c		1.4-1.5 via patch
usr.bin/netstat/pfsync.c	1.4-1.5 via patch
usr.bin/netstat/route.c		1.86-1.88
usr.bin/netstat/unix.c		1.36-1.37
usr.bin/netstat/vtw.c		1.11,1.13

	- sprintf() -> snprintf(), and adjust a buffer size to avoid any
	  potential for overflow.
	- Fix netstat -rs to print it correctly.
	- Add missing {IP,IP6}_STAT_NOIPSEC to netstat.
	- Don't show any of the completely and utterly undocumented VTW info
	  if the feature isn't enabled.
	- Print oqdrops correctly.
	- Remove Network ATM soft intr queue reporting, we don't have that
	  in the kernel anymore.
	- netstat.1: Add various xrefs present in the body to "See Also".
	- KNF. Style fixes.
	[msaitoh, ticket #1522]

usr.bin/ftp/Makefile                            up to 1.39
usr.bin/ftp/fetch.c                             up to 1.235
usr.bin/ftp/ftp.1                               up to 1.147
usr.bin/ftp/ftp_var.h                           up to 1.86
usr.bin/ftp/main.c                              up to 1.128
usr.bin/ftp/ssl.c                               up to 1.12
usr.bin/ftp/util.c                              up to 1.164
usr.bin/ftp/version.h                           up to 1.94

	ftp(1): PR 57003: Support relative redirects.
	[christos, #1523]

sys/dev/ic/mfireg.h				1.22
sys/dev/pci/mfii.c				1.16-1.22,1.27 via patch
share/man/man4/mfii.4				1.3 via patch

	- Fix wrong access in mfii_start().
	- Add SAS3216,SAS3224,SAS3316 and SAS3324 support.
	- Add CVPM02 BBU support.
	- Use bus_space_write_8() if available.
	- Don't panic on detach if no any sensor device.
	- Add comment. Sort entries. KNF.
	[msaitoh, #1524]

sys/dev/usb/xhci.c				1.154

	Accept USB 3.2 in xhci_id_protocols().
	[msaitoh, ticket #1525]

sys/arch/x86/x86/procfs_machdep.c		1.45

	procfs: on x86 add tdx_guest, brs, hfi, ibt, amx_bf16, amx_tile
	and amx_int8.
	[msaitoh, ticket #1526]

