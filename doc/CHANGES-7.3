# $NetBSD: CHANGES-7.3,v 1.1.2.23 2018/12/10 17:21:21 martin Exp $

A complete list of changes from the NetBSD 7.2 release to the NetBSD 7.3
release:

doc/README.files				patched by hand
gnu/usr.bin/groff/tmac/mdoc.local		patched by hand
sys/sys/param.h					patched by hand

	Welcome to 7.2_STABLE.
	[snj]

sys/arch/x86/include/cacheinfo.h		1.23-1.26
sys/arch/x86/include/cpu.h			1.70
sys/arch/x86/include/specialreg.h		1.91-1.93,1.98,1.100,1.102-1.124,1.126,1.130 via patch
sys/arch/x86/x86/cpu_topology.c			1.10
sys/arch/x86/x86/identcpu.c			1.56-1.57,1.70 via patch
usr.sbin/cpuctl/arch/i386.c			1.71,1.75-1.79,1.81-1.85 via patch

	Add some register definitions for x86:
	  - Add CLWB bit.
	  - Fix a few (unused) MSR values, and add some bit definitions of
	    MSR_EFER from Murray Armfield in PR#42861.
	  - CPUID_CFLUSH bit is not for CFLUSH insn but CLFLUSH insn, so modify
	    comments and snprintb() string.
	  - Define CPUID Fn00000001 %ebx bits and use them.
	    No functional change.
	  - Add Structured Extended Flags Enumeration Leaf's bit definitions:
	    AVX512_{IFMA,VBMI2,VNNI,BITALG,VPOPCNTDQ,4VNNIW,4FMAPS},GFNI&VAES.
	  - Add Turbo Boost Max Technology 3.0 bit.
	  - Add AMD SVM features definitions.
	  - Add Intel cpuid 7 %edx IBRS and STIBP bit definitions.
	  - Fix swapped comments for EFER LME and LMA
	  - Add Intel cpuid 7 %edx bit 29 IA32_ARCH_CAPABILITIES supported bit.
	  - Add MSR_IA32_ARCH_CAPABILITIES definition.
	  - Add IA32_SPEC_CTRL MSR and IA32_PRED_CMD MSR.
	  - Add Intel Deterministic Address Translation Parameter Leaf(0x18)
	    definitions.
	  - s/CLFUSH/CLFLUSH/
	  - Add AMD's Disable Indirect Branch Predictor bit definition.
	  - Add the MSR bits definitions for IBRS, STIBP and IBPB.
	  - Add Intel Fn0000_0006 %eax new bit 14-20 (HWP stuff).
	  - Intel Fn0000_0007 %ecx bit 22 is for both RDPID and IA32_TSC_AUX.
	  - Add AMD's CPUID Fn80000001 %edx MMX and FXSR bit definitions.
	  - Add RDCL_NO and IBRS_ALL.
	  - Add SSBD and RSBA bit definitions.
	  - Add AMD's SSB bit definitions for F15H, F16H and F17H.
	  - Add cpuid 7 edx L1D_FLUSH bit.
	  - Add IA32_ARCH_SKIP_L1DFL_VMENTRY bit.
	  - Add IA32_FLUSH_CMD MSR.
	  - Add yet another Shared L2 TLB (2M/4M pages).
	  - Add 3way and 6way of L2 cache or TLB on AMD CPU.
	  - AMD L3 cache association bitfield is not 8bit but 4bit like others
	    association bitfields.
	  - Sort entries. No functional change.
	  - Modify comment, fix typo in comment and add comment.
	cpuctl(8):
	  - Add detection for Quark X1000, Xeon E5 v4, E7 v4,
	    Core i7-69xx Extreme Edition, Xeon Scalable (Skylake),
	    Xeon Phi [357]200 (Knights Landing), Atom (Goldmont),
	    Atom (Denverton), Future Core (Cannon Lake), Atom (Goldmont Plus),
	    Xeon Phi 7215, 7285 and 7295 (Knights Mill) and
	    7th or 8th gen Core (Kaby Lake, Coffee Lake).
	  - Print Structured Extended Feature leaf Fn0000_0007 %ebx on AMD,too.
	  - Print Fn0000_0007 %ecx on Intel.
	  - Print Intel cpuid 7 %edx.
	  - Parse the TLB info from `cpuid leaf 18H' on Intel processor.
	  - Use aprint_error_dev() for error output.
	[msaitoh, ticket #1636]

sbin/gpt/gpt.c					1.76

	When changing entries skip those that do not match the -L option.
	Should fix PR 53668.
	[mlelstv, ticket #1643]

sys/dev/pci/if_wm.c				1.589

	Fix KASSERT to prevent panic on CNP(Intel 300 series + I219) with
	INTx interrupt (Xen dom0 or pre netbsd-8).
	[msaitoh, ticket #1647]

sys/dev/hpc/hpckbd.c				1.33-1.35

	Fix kernel crash on hpcmips when console is attached.
	[rin, ticket #1638]

usr.bin/find/function.c				1.77

	When calculating the length of the args that can be
	appended in a "find .... -exec something {} +"
	usage, remember to allow for the arg pointers, which
	form part of what is allowed in ARG_MAX.
	[mrg, ticket #1642]

usr.sbin/sysinst/arch/sgimips/md.c		1.5-1.6

	PR port-sgimips/53583: fetch kernel name always before using it.
	Make the struct utsname local to avoid future similar issues.
	Make sure to install a bootloader even on upgrade installation.
	[tsutsui, #1640]

sys/arch/pmax/pmax/dec_3min.c			1.74

	Fix hangup after framebuffers are attached on 3MIN.
	Addresses PR port-pmax/53611
	[tsutsui, #1641]

usr.bin/systat/main.c				1.52 via patch

	Add missing 'b' to the list of options.
	Alpha-sort the option handling.
	[mrg, ticket #1639]

distrib/sgimips/instkernel/Makefile		1.13
sys/arch/sgimips/conf/INSTALL32_IP2x		1.10
sys/arch/sgimips/stand/boot/Makefile		1.20

	Disable misc options to shrink an INSTALL kernel for IP2x.
	Use elf2ecoff(1) rather than objcopy(1) to generat ecoff for
	old machines.
	[tsutsui, ticket #1637]

external/public-domain/tz/dist/CONTRIBUTING     up to 1.1.1.6
external/public-domain/tz/dist/Makefile         up to 1.1.1.22
external/public-domain/tz/dist/NEWS             up to 1.1.1.24
external/public-domain/tz/dist/README           up to 1.1.1.7
external/public-domain/tz/dist/TZDATA_VERSION   up to 1.14
external/public-domain/tz/dist/africa           up to 1.1.1.17
external/public-domain/tz/dist/antarctica       up to 1.1.1.11
external/public-domain/tz/dist/asia             up to 1.1.1.21
external/public-domain/tz/dist/australasia      up to 1.1.1.16
external/public-domain/tz/dist/backward         up to 1.1.1.9
external/public-domain/tz/dist/backzone         up to 1.1.1.15
external/public-domain/tz/dist/etcetera         up to 1.1.1.3
external/public-domain/tz/dist/europe           up to 1.1.1.23
external/public-domain/tz/dist/factory          up to 1.1.1.3
external/public-domain/tz/dist/leap-seconds.list up to 1.1.1.10
external/public-domain/tz/dist/leapseconds      up to 1.1.1.11
external/public-domain/tz/dist/leapseconds.awk  up to 1.1.1.7
external/public-domain/tz/dist/northamerica     up to 1.1.1.21
external/public-domain/tz/dist/pacificnew       up to 1.1.1.2
external/public-domain/tz/dist/southamerica     up to 1.1.1.15
external/public-domain/tz/dist/systemv          up to 1.1.1.2
external/public-domain/tz/dist/theory.html      up to 1.1.1.6
external/public-domain/tz/dist/version          up to 1.1.1.11
external/public-domain/tz/dist/yearistype.sh    up to 1.1.1.2
external/public-domain/tz/dist/ziguard.awk      up to 1.1.1.3
external/public-domain/tz/dist/zishrink.awk     up to 1.1.1.5
external/public-domain/tz/dist/zone.tab         up to 1.1.1.15
external/public-domain/tz/dist/zone1970.tab     up to 1.1.1.17
external/public-domain/tz/dist/zoneinfo2tdf.pl  up to 1.1.1.2
doc/3RDPARTY					(apply patch)

	Updated tzdata to 2018g.
	[kre, ticket #1644]

common/include/prop/prop_array.h		1.15,1.16
common/include/prop/prop_dictionary.h		1.16
common/lib/libprop/prop_copyin_ioctl.9		1.12
common/lib/libprop/prop_kern.c			1.21-1.23 (patch)

	proplib: add sized versions of the copyin ioctls and document them.
	[sborrill, ticket #1645]

sys/net/npf/npf_ctl.c				1.47 (partial, patch)

	Increase copyin buffer size to 4MB to allow larger rulesets
	to be loaded.
	[sborrill, ticket #1646]

sys/dev/mii/inbmphyreg.h			1.11
sys/dev/pci/if_wm.c				1.586-1.588, 1.590-1.596 via patch
sys/dev/pci/if_wmreg.h				1.108

	- rename tu event counter to txunderrun.
	- Try m_defrag() to reduce the number of DMA segment if
	  bus_dmamap_load_mbuf() returned EFBIG. When m_defrag()
	  is called, txqNNdefrag event counter is incremented.
	  If the 2nd try of bus_dmamap_load_mbuf() failed,
	  txqNNtoomanyseg event counter is incremented.
	- Reduce the max number of DMA segments from 256 to 64 (it's
	  the same value as other BSD's (EM_MAX_SCATTER) and more
	  than before if_wm.c rev. 1.75's value (40)) because we do
	  m_defrag() now.
	- 82574 and newer document says the status field has neither EC
	  (Excessive Collision) bit nor LC (Late Collision) bit
	  (reserved), so don't check the bit.
	- Add workaround for DMA hang problem which result in TX device
	  timeout on PCH_LPT with I218. Same as FreeBSD and Linux. This
	  workaround is only for device ID 0x155a, 0x15a2, 0x1559 and 0x15a3.
	- Fix a PCH2 specific bug that wrong PHY register value can be read
	   when boot. Same as FreeBSD and Linux.
	- After writing MDIC register, don't read quickly the same register
	  but do delay(50). Same as other OSes.
	- Add missing wm_gate_hw_phy_config_ich8lan(false) in
	  wm_phy_post_reset() on PCH2. wm_gate_hw_phy_config_ich8lan(true)
	  is called in wm_reset(), so wm_gate_hw_phy_config_ich8lan(false)
	  should be called after reset in wm_phy_post_reset().
	- On PCH2, set the phy config counter to 50msec after (PHY) reset.
	- KNF & Use macro.
	[msaitoh, ticket #1648]

sys/arch/x86/x86/coretemp.c			1.36

	- Detect and set Atom's Tj(max) to 90 if it's not the 45nm
	  D400/D500/N400 series (90 for Diamondville and 100 for Pineview).
	- Reduce diff a little against FreeBSD.
	[msaitoh, ticket #1649]

sys/arch/x86/x86/procfs_machdep.c		1.25

	Fix output of LAPIC ID and Initial APIC ID.
	[msaitoh, ticket #1650]

sys/arch/macppc/stand/ofwboot/ofdev.c		1.27
sys/arch/macppc/stand/ofwboot/version		1.14

	Fix boot failure from installation floppies.
	PR port-macppc/53727.
	[tsutsui, ticket #1651]

sys/compat/netbsd32/netbsd32_socket.c		1.48 (patch)

	Fix a buffer overflow.
	[maxv, ticket #1652]

sys/kern/kern_event.c				1.104

	Fix kernel info leak.
	[maxv, ticket #1653]

usr.sbin/mtree/create.c				1.76

	Avoid null de-reference.
	[sevan, ticket #1654]

libexec/httpd/testsuite/data/.bzremap           up to 1.1
libexec/httpd/testsuite/t12.out                 up to 1.1
libexec/httpd/testsuite/t12.in                  up to 1.1
libexec/httpd/testsuite/t13.out                 up to 1.1
libexec/httpd/testsuite/t13.in                  up to 1.1
libexec/httpd/testsuite/t14.out                 up to 1.1
libexec/httpd/testsuite/t14.in                  up to 1.1
libexec/httpd/testsuite/t15.out                 up to 1.1
libexec/httpd/testsuite/t15.in                  up to 1.1
libexec/httpd/CHANGES                           up to 1.28
libexec/httpd/Makefile                          up to 1.27
libexec/httpd/auth-bozo.c                       up to 1.22
libexec/httpd/bozohttpd.8                       up to 1.74
libexec/httpd/bozohttpd.c                       up to 1.96
libexec/httpd/bozohttpd.h                       up to 1.56
libexec/httpd/cgi-bozo.c                        up to 1.44
libexec/httpd/content-bozo.c                    up to 1.16
libexec/httpd/daemon-bozo.c                     up to 1.19
libexec/httpd/dir-index-bozo.c                  up to 1.28
libexec/httpd/lua-bozo.c                        up to 1.15
libexec/httpd/main.c                            up to 1.21
libexec/httpd/ssl-bozo.c                        up to 1.25
libexec/httpd/tilde-luzah-bozo.c                up to 1.16
libexec/httpd/libbozohttpd/Makefile             up to 1.3
libexec/httpd/lua/bozo.lua                      up to 1.3
libexec/httpd/lua/glue.c                        up to 1.5
libexec/httpd/lua/optparse.lua                  up to 1.2
libexec/httpd/testsuite/Makefile                up to 1.11
libexec/httpd/testsuite/html_cmp                up to 1.6
libexec/httpd/testsuite/t3.out                  up to 1.4
libexec/httpd/testsuite/t5.out                  up to 1.4
libexec/httpd/testsuite/t6.out                  up to 1.4
libexec/httpd/testsuite/test-bigfile            up to 1.5
libexec/httpd/testsuite/test-simple             up to 1.5

	Sync with HEAD as of 2018-11-24. Includes various changes:
	Cosmetic changes to Lua binding in bozohttpd.
	Fix -C scripts execution and document restrictions.
	Add support for remapping requested paths via a .bzredirect file.
	Handle redirections for any protocol, not just http:.
	Fix a denial of service attack against header contents, which
	is now bounded at 16KiB.
	Fix access checks for special files.
	[mrg, ticket #1655]

sys/dev/pci/if_wm.c				1.599

	Fix a bug that i82578 workarounds didn't work correctly.
	[msaitoh, ticket #1656]

sys/net/rtsock.c				1.244 (adapted)

	Fix kernel info leak (2 bytes of padding in struct if_msghdr)
	[maxv, ticket #1657]

sys/kern/kern_exec.c				1.462

	Fix stack info leak.
	[maxv, ticket #1658]

libexec/httpd/CHANGES				1.29,1.30
libexec/httpd/bozohttpd.c			1.97-1.99
libexec/httpd/bozohttpd.h			1.57
libexec/httpd/cgi-bozo.c			1.45
libexec/httpd/main.c				1.22

	Fix -X option parsing and miscelaneous cleanup.
	[mrg, ticket #1659]

sys/kern/kern_time.c				1.192

	Fix kernel info leak.
	[maxv, ticket #1660]

sys/kern/kern_sig.c				1.350

	Fix kernel info leak.
	[maxv, ticket #1661]

sys/arch/amd64/amd64/machdep.c			1.321

	Fix stack info leak.
	[maxv, ticket #1662]

bin/sh/parser.c					1.152 (patch)

	Avoid crash from redirect on null compound command.
	[kre, ticket #1663]

