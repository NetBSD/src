# $NetBSD: CHANGES-5.0.1,v 1.1.2.15 2009/05/27 21:46:08 snj Exp $

A complete list of changes from the NetBSD 5.0 release to the NetBSD 5.0.1
release:

gnu/usr.bin/groff/tmac/mdoc.local		patched by hand
sys/sys/param.h					patched by hand

	Welcome to 5.0.0_PATCH.
	[snj]

sys/kern/uipc_socket.c				1.189

	PR kern/41311: Mutex error: mutex_vector_enter: locking against myself
	[ad, ticket #731]

sys/dev/ic/ncr53c9x.c				1.138

	Add missing braces - patch from Kurt Lidl in PR port-vax/41314.
	[martin, ticket #734]

sys/netinet6/ip6_input.c			1.127

	Add missing paranthesis - from Kurt Lidl in PR port-vax/41316
	[martin, ticket #733]

gnu/dist/binutils/bfd/elf32-vax.c		1.9

	Allocate relocation section using bfd_zalloc() to ensure no garbage
	relocations when not all the entries are used.
	Fixes PR port-vax/39182.
	[mhitch, ticket #738]

sys/ufs/ffs/ffs_alloc.c				1.123 via patch

	Fix random 'filesystem full' messages by trapping a couple of
	32-bit overflow areas missed in rev 1.110 and switching cgbase().
	[sborrill, ticket #726]

usr.sbin/racoonctl/Makefile			1.5 via patch

	Adjust the ADMINPORTDIR to match that of racoon (with which it'll
	want to talk).  Fixes PR 41376.
	[spz, ticket #740]

sys/arch/hp700/include/intr.h			1.14

	Add __insn_barrier after updating cpl in splraise. PR/41369.
	[skrll, ticket #741]

sys/arch/m68k/include/psl.h			1.14

	Add memory clobber to the instructions that change the IPL in the
	status register.  See also kern/38637.
	[mhitch, ticket #743]

sys/netinet/in_pcb.c				patch

	Fix compilation with IPNOPRIVPORTS option.
	[sborrill, ticket #745]

share/man/man8/afterboot.8			1.39

	Fix typo, from Shannon -jj Behrens in PR 41375.
	[dholland, ticket #746]

sys/dist/ipf/netinet/ip_fil_netbsd.c		1.50

	Don't call callout_stop() without callout_init()
	Fixes PR/41364
	[kefren, ticket #748]

sys/arch/sparc/include/math.h			1.5
sys/arch/sparc64/include/math.h			1.7

	merge these two files, makes sparc64 sparc/libc work again.
	only provide __HAVE_LONG_DOUBLE if _LP64.
	[mrg, ticket #750]

sys/arch/amd64/amd64/lock_stubs.S		1.22, 1.23
sys/arch/i386/i386/lock_stubs.S			1.23
sys/arch/x86/include/mutex.h			1.6
sys/arch/x86/x86/patch.c			1.18
sys/kern/kern_rwlock.c				1.30

	Add a workaround for a bug with some Opteron revisions where
	locked operations sometimes do not serve as memory barriers,
	allowing memory references to bleed outside of critical sections.
	[ad, ticket #725]

usr.sbin/postinstall/postinstall		1.95

	Teach postinstall about /etc/dhcpcd.conf.
	[jnemeth, ticket #752]

usr.sbin/postinstall/postinstall		1.97

	Fetch /etc/dhcpcd.conf from the correct place when building the
	system from source.
	[jnemeth, ticket #756]

sys/kern/sys_mqueue.c				1.17

	sys_mq_open: remove broken access flag check.
	Noted by Stathis Kamperis.
	[rmind, ticket #762]

usr.sbin/schedctl/schedctl.c			1.14

	Skip LSIDL and LSZOMB threads when retrieving info.
	[rmind, ticket #763]

sys/arch/sparc/include/psl.h			1.45

	Add memory clobbers to the inline assembler modifying/testing the %psr
	register, to avoid the compiler reordering instructions out of critical
	sections. Should fix PR port-sparc/41372.
	[martin, ticket #764]

share/man/man7/sysctl.7				1.22 via patch

	Document PROC_PID_LIMIT_SBSIZE.  From Greg A. Woods in PR lib/36463.
	Wording is taken from getrlimit(2).
	[snj, ticket #765]

sys/arch/vax/include/mtpr.h			1.21, 1.22

	Add "memory" clobber to mtpr for barrier.  See also kern/38637.
	[mhitch, ticket #767]

dist/ntp/ntpd/ntp_crypto.c			1.15

	Fix CVE-2009-1252: Buffer overflow in ntpd crypto code. A remote
	attacker can send a specially constructed request packet that
	would overflow the sprintf()'ed buffer causing ntpd to crash.
	[dholland, ticket #777]

sys/arch/sparc64/sparc64/vm_machdep.c		1.88

	When preparing the initial trap frame for a new forked lwp,
	explicitly clear condition code. Otherwise we might catch a signal
	(handlers are inherited from the parent) before we ever return to
	userland. The current trapframe is converted into a ucontext and
	after the signal handler returns, the lwp stays in userland and
	directly uses the ucontext to return to the fork call.
	Fixes PR 41302.
	[martin, ticket #774]

sys/kern/sys_mqueue.c				1.18

	- Slightly rework the way permissions are checked. Neither
	mq_receive() nor mq_send() should fail due to permissions.
	- Check for empty message queue name (POSIX does not allow this
	for regular files, and it's weird), check for DTYPE_MQUEUE, fix
	permission check in mq_unlink(), clean up.
	[rmind, ticket #779]

sys/kern/kern_physio.c				1.91

	Remove a race where physio_done() may use memory already
	freed.  Fixes PR kern/39536.
	[hannken, ticket #781]

