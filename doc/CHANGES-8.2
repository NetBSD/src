# $NetBSD: CHANGES-8.2,v 1.1.2.22 2019/08/09 19:22:51 martin Exp $

A complete list of changes from the NetBSD 8.1 release to the NetBSD 8.2
release:

external/gpl2/groff/tmac/mdoc.local		patched by hand
sys/sys/param.h					patched by hand

	Welcome to 8.1_STABLE.
	[snj]

sys/arch/x86/x86/spectre.c			1.29

	Fix boot on old CPUs.
	[maxv, ticket #1279]

sys/arch/amd64/conf/GENERIC			1.528
sys/arch/i386/conf/GENERIC			1.1207
sys/arch/x86/include/autoconf.h			1.6
sys/arch/x86/pci/pci_machdep.c			1.86
sys/arch/x86/x86/consinit.c			1.29
sys/arch/x86/x86/hyperv.c			1.2-1.4
sys/arch/x86/x86/hypervvar.h			1.1
sys/arch/x86/x86/identcpu.c			1.91
sys/arch/x86/x86/x86_autoconf.c			1.78
sys/arch/xen/x86/autoconf.c			1.23
sys/dev/acpi/vmbus_acpi.c			1.2
sys/dev/hyperv/files.hyperv			1.2
sys/dev/hyperv/genfb_vmbus.c			1.1
sys/dev/hyperv/genfb_vmbusvar.h			1.1
sys/dev/hyperv/hvkbd.c				1.1
sys/dev/hyperv/hvkbdvar.h			1.1
sys/dev/hyperv/hyperv_common.c			1.2
sys/dev/hyperv/hypervvar.h			1.2
sys/dev/hyperv/vmbus.c				1.3
sys/dev/hyperv/vmbusvar.h			1.2
sys/dev/wscons/wsconsio.h			1.123

	Add Hyper-V Gen.2 VM framebuffer console support.
	[nonaka, ticket #1280]

libexec/httpd/CHANGES				1.31-1.40
libexec/httpd/Makefile				1.28
libexec/httpd/auth-bozo.c			1.23-1.24
libexec/httpd/bozohttpd.8			1.75-1.79
libexec/httpd/bozohttpd.c			1.100-1.113
libexec/httpd/bozohttpd.h			1.58-1.60
libexec/httpd/cgi-bozo.c			1.46-1.48
libexec/httpd/daemon-bozo.c			1.20-1.21
libexec/httpd/dir-index-bozo.c			1.29-1.32
libexec/httpd/ssl-bozo.c			1.26
libexec/httpd/testsuite/Makefile		1.12-1.13
libexec/httpd/testsuite/t11.out			1.2
libexec/httpd/testsuite/test-bigfile		1.6
libexec/httpd/testsuite/test-simple		1.6

	Don't display special files in the directory index.
	Use html tables for directory index.
	Don't include "index.html" in html headers.
	Fix CGI '+' param and error handling.
	Remove unused parameter to daemon_poll_err().
	Avoid sign extension in % handling
	Fix a few problems pointed out by clang static analyzer.
	Add ssl specific timeout value (30s).---
	Fix handling of bozo_set_timeout() timeouts (and `-T' option parsing).
	Avoid .htpasswd exposure to authenticated users when .htpasswd is
	in the slashdir too.
	Avoid possible NULL dereference when sending a big request that timeout.
	Avoid an assertion failure when using cgihandler (-C option).
	[mrg, ticket #1281}

sys/arch/x86/include/bootinfo.h			1.30

	Increase BOOTINFO_MAXSIZE to 16Kib.
	Some systems require a larger bootinfo size for memory descriptors.
	[nonaka, ticket #1282]

sys/dev/ic/mvsata.c				1.47-1.48

	PR/54205: fix "mvsata:0:0:1: buffer load failed: error=27" failure.
	[tsutsui, ticket #1283]

sys/arch/hp300/hp300/autoconf.c			1.106

	Handle sti(4) graphics at sgc on HP9000/425t properly.
	[tsutsui, ticket #1284]

sys/netinet6/nd6.c				1.255
tests/net/ndp/t_ndp.sh				1.32

	nd6: restore a missing reachability confirmation.
	tests: test state transitions of neighbor caches.
	[ozaki-r, ticket #1285]

sys/dev/hyperv/vmbus.c				1.4

	Zero clear the allocated ring buffer for vmbus_channel.
	[nakayama, ticket #1286]

sys/netipsec/keysock.c				1.69

	Fix locking: it is fine if the lock is already key_so_mtx, this
	can happen in socketpair.
	[maxv, ticket #1287]

sys/netinet6/udp6_usrreq.c			1.147

	Fix the order in udp6_attach: soreserve should be called before
	in6_pcballoc.
	[maxv, ticket #1288]

sys/dev/pci/vioscsi.c				1.21

	Fix use-after-free.
	[maxv, ticket #1289]

xsrc/external/mit/xf86-video-intel/dist/src/intel_list.h 1.2

	Fix sandy bridge crashes by merging changes from xorg-server 1.20
	list.h into this older version.
	[mrg, ticket #1290]

sys/dev/pci/pcidevs				1.1367-1.1380
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen

	- Add other two Intel Core 8G host bridges.
	- Add Intel Xeon E devices.
	- Add some new Intel C620 LPC devices.
	- Add some Intel Xeon Scalable processor's devices.
	- Add some Intel Whisky Lake devices.
	- Add Xeon D XFI.
	- Add "(Hyper-V)" to Intel 0x15a9's description.
	- Add Intel C3000 QSFP devices.
	- Add Some Qlogic devices from OpenBSD.
	- Rename Qlogic 0x3022's name from ISP3022 to ISP4022.
	- Add IDs for SATA controllers VT8237S and VX855
	- Modify some descriptions of Virtio devices from OpenBSD to identify
	  the functions.
	- Add Phison PS5000 and PS5016 NVMe.
	- Add some ServerWorks HT1100 devices from OpenBSD.
	- Remove extra white spaces.
	[msaitoh, ticket #1291]

sys/dev/pci/pci_subr.c				1.211,1.214

	Fix a typo. Print extend capability from 0x25 to 0x29 correctly.
	[msaitoh, ticket #1292]

sys/arch/x86/include/specialreg.h		1.149

	Define some new bits of CPUID Fn8000_0007 %edx AMD
	Advanced Power Management leaf.
	[msaitoh, ticket #1293]

sys/dev/ic/nslm7x.c				1.72
sys/dev/ic/nslm7x.c				1.73
sys/dev/isa/wbsio.c				1.25
sys/dev/isa/wbsioreg.h				1.9

	Use pmf_device_{register,deregister}().
	Identify Nuvoton NCT6798D correctly.
	[msaitoh, ticket #1294]

sys/dev/pci/pci_subr.c				1.213
sys/dev/pci/ppb.c				1.69

	Identify 16GT/s.
	[msaitoh, ticket #1295]

usr.sbin/cpuctl/arch/i386.c			1.91,1.93-1.95,1.100-1.103
						(via patch)

	- Handle NVMM and HAXM's signature.
	- Regard "TCGTCGTCGTCG" as QEMU(TCG).
	- Dump CPUID leaf 0x40000000 if available (for -v option).
	- Add Cascade Lake, Copper Lake.
	- Add Future Xeon (Cannon Lake)
	- Add 06_7DH for another Ice Lake.
	- Add Coffee Lake based Xeon E.
	- White space fix. No functional change.
	[msaitoh, ticket #1296]

sys/dev/usb/usbdevs				1.737-1.741,1.743-1.752,
						1.756-1.759,1.763-1.770
						(via patch)
sys/dev/usb/usbdevs.h				regen
sys/dev/usb/usbdevs_data.h			regen

	- Add yet another moschip serial adapter chip.
	- Add some classic Roland products from Shinichi Doyashiki in
	  PR kern/52385.
	- Add Ralink RT73.
	- Add Wacom Intuos2 A4 and Intuos Art pen tablets.
	- Add ELAN keyboard.
	- Add Sony UWA-BR100 WLAN adapter.
	- Add the TP-LINK TL-WN823N (version 2).
	- Add RT Systems RTS-03 USB to Serial Adapter.
	- Add West Mountain Radio IDs from OpenBSD.
	- Add LAN78xx family (Raspberry Pi 3B+) entries - PR kern/53105.
	- Add Linux Foundation vendor ID, and their root hub device IDs.
	- Apple Bluetooth adapter, as found on the G4 PowerBook FW-800
	  (PowerBook5,2).
	- Add Yubico Yubikey devices.
	- Add Huawei E182.
	- Add the Sierra Wireless MC7304 and EM7455 USB modems.
	- Add SMSC LAN7505 USB 2.0 gigabit ethernet device.
	- Add Panasonic N5HBZ0000055 WiFi device reported by
	  David H. Gutteridge in PR kern/53647.
	- Add Logitech Gamepad F310 and Logitech Dual Action Gamepad.
	- Add D-Link LTE products.
	- Add D-Link DWA-131 rev E "Wireless N300 Nano USB Adapter"
	- Add Microsoft Natural Wireless Mouse 600 from Julian in
	  PR kern/44634.
	- Add Gretag Macbeth/X-Rite Huey device ids.
	- Add HP LP2[24]75w hub.
	- Prefer longer "canonical" names and add some vendors (mainly from
	  FreeBSD r334649).
	- Make whitespace much more consistent.
	- Lowercase hexadecimal number.
	- Update comment.
	[msaitoh, ticket #1297]

sys/dev/pci/if_wm.c				1.633, 1.637-1.641 (via patch)
sys/dev/pci/if_wmreg.h				1.114 (via patch)

	- Use unsigned to avoid undefined behavior.
	- Print ICH/PCH's NVM version.
	- Fix typo in comment. u_int*_t -> uint*_t. Whitespace fix.
	[msaitoh, ticket #1298]

sys/dev/usb/if_athn_usb.c			1.24,1.31-1.34 (via patch)

	- Match BUFFALO CEWL-1 (Sony UWA-BR100 WLAN).
	- Add support for Panasonic N5HBZ0000055, from David H. Gutteridge
	  in PR kern/53647.
	- Resolves build on macppc by renaming imask to intr_mask as imask is
	  defined globally in sys/arch/powerpc/include/intr.h.
	- Use pmf(9).
	- Fix the detach path to prevent panic.
	[msaitoh, ticket #1299]

sys/compat/netbsd32/netbsd32_ioctl.c		1.98,1.99
sys/compat/netbsd32/netbsd32_ioctl.h		1.65

	Add BIOCSRTIMEOUT32 to fix tcpdump for COMPAT_NETBSD32.
	Correct misleading macro argument names.
	[rin, ticket #1054]

sys/arch/x86/pci/if_vmx.c			1.31
sys/arch/x86/pci/if_vmx.c			1.32 (via patch)

	Eliminate IFF_RUNNING checking code from vmxnet3_init_locked().
	Fix vmx(4) MTU setting.
	[knakahara, ticket #1300]

sys/dev/pci/ixgbe/if_sriov.c			1.5-1.6
sys/dev/pci/ixgbe/ix_txrx.c			1.53-1.54
sys/dev/pci/ixgbe/ixgbe_x550.h			1.5
sys/dev/pci/ixgbe/ixgbe.c			1.169-1.170,1.176,1.179,1.181,1.185-1.186,1.188-1.192 via patch
sys/dev/pci/ixgbe/ixgbe.h			1.53,1.55
sys/dev/pci/ixgbe/ixgbe_82599.c			1.21
sys/dev/pci/ixgbe/ixgbe_api.c			1.22-1.23
sys/dev/pci/ixgbe/ixgbe_api.h			1.14-1.15
sys/dev/pci/ixgbe/ixgbe_x550.c			1.14-1.15
sys/dev/pci/ixgbe/ixgbe_common.c		1.23
sys/dev/pci/ixgbe/ixgbe_common.h		1.14
sys/dev/pci/ixgbe/ixgbe_mbx.c			1.11
sys/dev/pci/ixgbe/ixgbe_mbx.h			1.14
sys/dev/pci/ixgbe/ixgbe_netmap.c		1.2
sys/dev/pci/ixgbe/ixgbe_features.h		1.2
sys/dev/pci/ixgbe/ixgbe_netbsd.c		1.9
sys/dev/pci/ixgbe/ixgbe_netbsd.h		1.9-1.10
sys/dev/pci/ixgbe/ixgbe_phy.c			1.18
sys/dev/pci/ixgbe/ixgbe_type.h			1.37,1.39-1.40
sys/dev/pci/ixgbe/ixgbe_vf.c			1.18
sys/dev/pci/ixgbe/ixv.c				1.112-1.114,1.117,1.119 via patch

	Sync ixgbe up to 20190717 except ETHERCAP or ixv's VLAN stuff:
	- Add firmware recovery mode for X550, X550A(Xeon D) and X550EM(C3000).
	- Remove IXGBE_DEV_ID_82599_LS(0x154f) support again.
	- On X550EMU, use ixgbe_identify_sfp_module_X550em() instead of
	  ixgbe_identify_module_generic(). ixgbe_identify_sfp_module_X550em()
	  has extra check (e.g. exclude 1G copper).
	- It's not required to calculate unused queues' statistics.
	- Remove ETHERCAP_VLAN_HWFILTER's definition.
	- Match 82598_BX(0x1508), 82599_KR(0x1517), 82599_SFP_EM(0x1507),
	  X550EM_X_XFI(0x15b0), X550EM_A_QSFP(0x15ca) and
	  X550EM_A_QSFP_N(0x15cc)
	- Add missing XFI support into ixgbe_get_link_capabilities_X550em().
	- Other than IXGBE_VF_RESET should wait ACK, so use
	  ixgbevf_write_msg_read_ack() instead of write_posted() in
	  ixgbe_update_mc_addr_list_vf().
	- When ixv_check_link() failed in the watchdog function, reset the
	  interface.
	- Remove RXCSUM register modification in
	  ixv_initialize_receive_units(). It seems it's not required.
	- Remove some debug printf in ixv_print_debug_info().
	- Calculate vector's bit location correctly when the vector >= 31
	  in ixgbe_allocate_msix().
	- Fix hung queue check when the queue number >= 31.
	- On ENETRESET case, not continue and quit the ifflags_cb() function
	  because if_init() will do the same thing.
	- Fix bugs in unused code.
	- Fix typo in comment.
	- Fix typo in unused code.
	- Whitespace fixes. KNF.
	[msaitoh, ticket #1301]

sys/kern/sys_ptrace_common.c			1.58

	Enhance locking of ptrace_update_lwp.
	Do not switch lwp for PT_SET_SIGINFO.
	[kamil, ticket #1302]

sys/netipsec/key.c				1.264

	Avoid a race condition between SA (sav) manipulations.
	[ozaki-r, ticket #1303]

usr.bin/vmstat/vmstat.c				1.226

	Fix "vmstat -m" numbers running into each other.
	[mrg, ticket #1304]

sys/dev/pckbport/files.pckbport			1.10

	hvkbd requires pckbd_keydesctab in wskbdmap_mfii.c.
	[nakayama, ticket #1305]

crypto/dist/ipsec-tools/src/setkey/parse.y	1.23
crypto/dist/ipsec-tools/src/setkey/token.l	1.23
sys/netipsec/key.c				1.265
tests/net/ipsec/t_ipsec_misc.sh			1.23

	ipsec: fix a regression of the update API.
	tests: add tests for getspi and udpate.
	[ozaki-r, ticket #1306]

sys/netinet6/nd6.c				1.256

	Decrease the reference count before freeing, so that the
	entries actually get free'd.
	[christos, ticket #1307]

sys/dev/pci/if_wpi.c				1.86

	PR kern/54320: put back correct recieve ring allocation size.
	[jakllsch, ticket #1308]

sys/arch/i386/stand/efiboot/Makefile.efiboot	1.15
sys/arch/i386/stand/efiboot/boot.c		1.12,1.13
sys/arch/i386/stand/efiboot/dev_net.c		1.2
sys/arch/i386/stand/efiboot/efiboot.c		1.9,1.10
sys/arch/i386/stand/efiboot/efiboot.h		1.9
sys/arch/i386/stand/efiboot/efimemory.c		1.6-1.8
sys/arch/i386/stand/lib/exec.c			1.73
sys/arch/i386/stand/lib/libi386.h		1.44

	Add tftp support to x86 efiboot.
	Pre-allocate memory for the kernel space at startup.
	Added BTINFO_EFIMEMMAP compaction support to x86 efiboot.
	Sync the output of memmap command to the output of stand/efiboot
	mem command.
	[nonaka, ticket #1309]

sys/dev/usb/usbdevs				1.754-1.755 via patch
sys/dev/usb/usbdevs.h				regen
sys/dev/usb/usbdevs_data.h			regen

	- Add Cinterion
	- Add Sierra Wireless C01SW.
	- Add SMSC USB 2.0 7-Port Hub.
	- Add ZTE MF633 USUPA USB modem, USB MSM installer, ZTE MF112, MF119,
	  MF190, MF228 modem and Softbank 004Z.
	- Add Huawei HWD12, E353, E355, E392, EC156, E3272 / Softbank 203HW
	- Add NetIndex RT-WJ02 and UX312NC.
	- Add Siemens HC28
	[msaitoh, ticket #1310]

sys/dev/pci/agp_intel.c				1.38

	Fix a >15 year old code rework bug, and add a missing "break".
	[msaitoh, ticket #1311]

sys/dev/pci/if_wm.c				1.644,1.645
sys/dev/pci/if_wmreg.h				1.115

	- Avoid undefined behavior while writing RSS redirection table.
	- Don't print debug message in wm_ulp_disable().
	- Fix rnd(9) usage when MSI-X is used to prevent panic.
	- Use better rnd value when INTx or MSI is used.
	[msaitoh, ticket #1312]

sys/dev/pci/ixgbe/ixgbe_type.h			1.41
sys/dev/pci/ixgbe/ixgbe.c			1.194,1.197-1.199 via patch
sys/dev/pci/ixgbe/ixgbe_common.c		1.24
sys/dev/pci/ixgbe/ixv.c				1.121,1.124-1.125

	- Avoid undefined behavior of interrupt vector setting.
	- Avoid undefined behavior of TX/RX queue statistics calculation.
	- Avoid undefined behavior of X550EM's PHY accesses.
	- Avoid undefined behavior of Flow Control Transmit Timer setting.
	- Don't call {ixgbe,ixv}_stop() twice while detaching.
	[msaitoh, ticket #1313]

sys/dev/pci/siside.c				1.38

	Add missing break; after "100NEW" configuration.
	Don't also set "133OLD", since the 100NEW cards don't support 133.
	[msaitoh, ticket #1314]

sys/dev/mii/miidevs				1.145-1.153
sys/dev/mii/miidevs.h				(regen)
sys/dev/mii/miidevs_data.h			(regen)

	- Fix I82578 OUI. This change only affects to MIIVERBOSE.
	- Add Bankspeed Pty and NetExcell's OUI.
	- Add another ASIX OUI and AX88772* devices.
	- Add SMSC(Microchip) LAN911X and LAN75XX.
	- Add Davicom DM9161, DM9161[ABC] and DM9601.
	- Add Amlogix GXL internal PHY.
	- Add Broadcom BCM53125 1000BASE-T switch.
	- Sort xx or yy's OUIs by number. No functional change.
	[msaitoh, ticket #1315]

sys/dev/mii/makphy.c				1.54,1.57-1.60 via patch
sys/dev/mii/makphyvar.h				1.1-1.2
sys/dev/mii/ihphy.c				1.12,1.14 via patch

	- Support Intel I21[01].
	- 88E1000(S) has no page select register, so don't access it.
	  Note that qemu doesn't implement the register and the access fails.
	- Check the result of the ESSR register access because Qemu doesn't
	  implement the register.
	- KNF.
	[msaitoh, ticket #1316]

sys/dev/pci/if_wm.c				1.612,1.646

	- Fix a bug that "ifconfig wmX media none" panics on 8254[23].
	- Avoid undefined behavior in wm_i82543_mii_sendbits().
	[msaitoh, ticket #1317]

sys/net/raw_usrreq.c				1.63,1.64

	PR kern/54419: fix typos (s/m_free/m_freem/).
	[ozaki-r, ticket #1318]

sys/kern/sys_ptrace_common.c			1.57

	Do not release the reflock if we didn't take it in the first place.
	[maxv, ticket #1319]

sys/uvm/uvm_map.c				1.361

	Fix info leak: 'map_attrib' is not used in UVM, and contains
	uninitialized heap garbage. Return zero.
	[maxv, ticket #1320]

sys/fs/tmpfs/tmpfs_mem.c			1.10

	Remove incorrect roundups.
	[maxv, ticket #1321]

sys/fs/cd9660/cd9660_vnops.c			1.55

	Fix info leak: zero out the buffer, because it is not entirely filled.
	[maxv, ticket #1322]

sys/net/bpf.c					1.229

	Fix info leak: use kmem_zalloc to clear uninitialized padding.
	[maxv, ticket #1323]

sys/kern/kern_exec.c				1.469-1.476,1.478 (patch)

	Fix off-by-one and info leak.
	[maxv, ticket #1324]

sys/arch/i386/stand/efiboot/version		1.2

	x86 efiboot: version 1.1.
	[nonaka, ticket #1325]

sys/dev/pci/pcidevs				1.1381-1.1383
sys/dev/pci/pcidevs.h				(regen)
sys/dev/pci/pcidevs_data.h			(regen)

	- Intel C620 Virtual Switch Port for Termal Sensor is not
	  0x37c6 but 0x37c7.
	- Add Some AMD Ryzen 3xxx's devices.
	- Add some AMD devices mainly taken from OpenBSD.
	- Rename some device names for consistency.
	- Use _HDA for HD Audio.
	- Add BCM2711 PCIe Host bridge for RPI4
	[msaitoh, ticket #1326]

sys/dev/pci/piixpm.c				1.53,1.54
sys/dev/pci/piixpmreg.h				1.8

	- Add newer chipset (e.g. X370/X399 and newer) support that the PCI
	  device id is 0x790b
	- SB800 also support 4 ports.
	- SB800's interrupt configuration bit is different from others.
	  Use SB800_SMB_HOSTC's bit 0.
	- Print "polling" correctly when in the attach function.
	- Improve debug printf()'s.
	- Do not bus_space_map devices which are at address 0 (it is
	  uninitialized).
	- Add ServerWorks HT1100 device.
	- Use unique wait channel.
	- Rename PIIXPM_INDIRECTIO_* to SB800_INDIRECTIO_* because those are
	  only for SB800 and newer chipsets.
	- Add the port number to the dmesg output.
	[msaitoh, ticket #1327]

sys/arch/x86/pci/amdsmn.c			1.4-1.6

	Add support for Ryzen 2xxx and 3xxx.
	[msaitoh, ticket #1328]

sys/dev/pci/if_etreg.h				1.2-1.3
sys/dev/pci/if_et.c				1.23,1.25 and 1.26 via patch

	Make et(4) work:
	- Add missing ifioctl_common() for SIOCSIFFLAGS to make if_flags
	  controllable.
	- Enabling TX/RX in et_init() will always fail when cable is not
	  plugged in. If this happens, we delay TX/RX enablement until link is
	  up.
	- Modify flow control stuff a little. It still doesn't work.
	- Avoid undefined behavior when reset the chip.
	- Code cleanup.
	[msaitoh, ticket #1329]

sys/kern/uipc_socket2.c				1.134

	Fix kernel heap info leaks in sys_recvmsg().
	[maxv, ticket #1330]

sys/external/bsd/ipf/netinet/fil.c		1.30

	PR/54443: ipf mistakenly regards UDP packet with checksum field
	0xffff as bad.
	[christos, ticket #1331]

