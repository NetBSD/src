# $NetBSD: CHANGES-7.0,v 1.1.2.10 2014/08/15 13:07:37 martin Exp $

A complete list of changes from the initial NetBSD 7.0 branch on 11 Aug 2014
until the 7.0 release:

doc/CHANGES-7.0					patched by hand
doc/LAST_MINUTE					patched by hand
doc/README.files				patched by hand
gnu/usr.bin/groff/tmac/mdoc.local		patched by hand
sys/sys/param.h					patched by hand

	Welcome to 7.0_BETA!

sys/dev/usb/xhci.c				1.24

	PR/49091: xhci: wrong wMaxPacketSize value

	While this is correct according to the specification only fixed sizes
	are allowed, i.e. 512 for SS, etc. Maybe these should be used?
	[skrll, ticket #3]


sys/kern/kern_rndpool.c				1.7
sys/kern/kern_rndq.c				1.27

	buf is not guaranteed to be aligned; don't *(uint32_t *) it.
	done is not guaranteed to be aligned; don't *(uint32_t *) it.
	Fixes PR kern/49098.
	[riastradh, ticket #4]

external/gpl3/binutils/dist/bfd/ChangeLog	1.6
external/gpl3/binutils/dist/bfd/elflink.c	1.8

	Apply change from upstream to fix PR/48709 - port-alpha/48709: static
	threaded programs crash.

	With this fix the new weak symbol's st_other is not merged in, i.e. NOPV
	is not copied from the libc __libc_thr_init.

	* elflink.c (_bfd_elf_merge_symbol): If merging a new weak
	symbol that will be skipped, we don't have a new definition.
	[skrll, ticket #5]


sys/dev/usb/motg.c				1.7
sys/dev/usb/motg.c				1.8

	Trailing whitespace.

	Make this compile when DIAGNOSTIC isn't defined.
	[skrll, ticket #6]

usr.sbin/postinstall/postinstall		1.177
usr.sbin/postinstall/postinstall		1.178
usr.sbin/postinstall/postinstall		1.179

	Check for and delete ${DEST_DIR}/@RUNDIR@, not /@RUNDIR@.
	Also remove an unnecessary eval in do_dhcpcdrundir and
	fix a typo in the description.

	Quoting fixes in several eval commands.

	In get_makevar, ask make to recursively expand the variable,
	not just print the unexpanded value.  This is done by
	using make -V '${VAR}' instead of make -V 'VAR'.
	[apb, ticket #8]


usr.sbin/postinstall/postinstall		1.176

	FONTCONFIG_DIR not existing does not need to be fixed.
	[apb, ticket #9]

sys/arch/sparc64/sparc64/autoconf.c		1.199

	Match firmware paths for the boot device in Mac style, as used by
	QEMU/OpenBIOS.
	[martin, ticket #2]

sys/arch/sparc/sparc/autoconf.c			1.258

	Add device name mapping for "qfe" (quad hme) cards. PR#49103.
	[martin, ticket #7]

sys/dev/usb/xhci.c				1.25

	Serialise xhci_intr1 calls with sc_intr_lock.  From Takahiro HAYASHI.
	[skrll, ticket #11]

sys/dev/usb/files.usb				1.133
sys/dev/usb/usb.h				1.108

	Add XHCI_DEBUG.
	[skrll, ticket #12]

sys/arch/sparc64/sparc64/locore.s		1.370

	Add missing delay slot in DEBUG kernel.
	[nakayama, ticket #14]

sys/arch/x86/pci/if_vmx.c			1.5

	Set ifflags callback so that the device can enter promiscuous mode.
	[hikaru, ticket #15]

sys/dev/usb/usb.h				1.107

	Define AXEN_DEBUG.  From Takahiro HAYASHI.
	[skrll, ticket #10]

sys/crypto/cprng_fast/cprng_fast.c		1.10
sys/crypto/cprng_fast/cprng_fast.c		1.7
sys/crypto/cprng_fast/cprng_fast.c		1.8
sys/crypto/cprng_fast/cprng_fast.c		1.9

	Access to struct cprng_fast must be consistently at IPL_VM.
	Use percpu_foreach instead of manual iteration.
	Move initial entropy bookkeeping out of the fast path.
	Tweak cprng_fast_buf to use 32-bit unaligned writes if possible.
	[riastradh, ticket #16]

distrib/amd64/cdroms/Makefile.cdrom		1.11
distrib/i386/cdroms/Makefile.cdrom		1.31
distrib/sparc64/cdroms/installcd/Makefile	1.19
distrib/vax/cdroms/installcd/Makefile		1.9

	CD images need libarchive if MKBSDTAR is yes.
	[riastradh, ticket #17]

sys/external/bsd/drm2/include/linux/pci.h	1.8
sys/external/bsd/drm2/ttm/ttm_agp_backend.c	1.2
sys/external/bsd/drm2/ttm/ttm_agp_backend.c	1.3

	Fix shifts & masks in Linux pci_read_config_{word,byte}.
	Use ttm_dma_tt_init in ttm_agp_tt_create so we can use ttm_bus_dma.
	Zero ttm_agp objects on creation.
	[riastradh, ticket #18]

distrib/sets/lists/debug/mi			1.82

	Add tar.debug and cpio.debug to lists for MKBSDTAR=yes MKDEBUG=yes.
	[riastradh, ticket #19]

distrib/sets/lists/modules/md.amd64		1.42

	Add dtrace modules to amd64-xen module set list.  Hi jnemeth!
	[riastradh, ticket #21]

sys/kern/subr_cprng.c				1.25

	Lock cprng->cs_lock around rndsink_request to avoid race with callback.
	[riastradh, ticket #22]

sys/kern/init_main.c				1.459
sys/rump/librump/rumpkern/rump.c		1.309
sys/rump/librump/rumpkern/rump.c		1.310

	Defer cprng_fast_init until CPUs are detected.
	Restore placement of percpu_init in rump_init.
	Probably doesn't matter, but let's avoid needless churn around the
	real bug fix.
	[riastradh, ticket #23]

sys/kern/subr_prf.c				1.155

	avoid calling into time code when cold, and avoid calling nanotime()
	if we're not going to use the result anyway.

	XXX: not necessarily the best fix, but better than crashing *early*
	boot due to too-early nanotime() calls.

	[mrg, ticket #24]

xsrc/external/mit/libdrm/dist/radeon/radeon_bo_gem.c	1.4

	convert an mmap() to drmMap().
	[mrg, ticket #25]

