# $NetBSD: CHANGES-5.3,v 1.1.2.65 2014/08/08 06:58:49 msaitoh Exp $

A complete list of changes from the NetBSD 5.2 release to the NetBSD 5.3
release:

doc/LAST_MINUTE					patched by hand
doc/README.files				patched by hand
gnu/usr.bin/groff/tmac/mdoc.local		patched by hand
sys/sys/param.h					patched by hand

	Welcome to 5.2_STABLE.
	[riz]

sys/fs/smbfs/smbfs_node.c			1.48, 1.49 via patch
sys/fs/smbfs/smbfs_node.h			1.13 via patch
sys/fs/smbfs/smbfs_vnops.c			1.83, 1.84 via patch

	Various fixes for smbfs:

	- Implement NGONE to fix caching issue described in PR kern/25070.
	  Mostly taken from FreeBSD r125637.
	- Revert revision 1.70 of smbfs_vnops.c to fix setattr to opened
	  direcotry.  In case of SMB_CAP_NT_SMBS, NOPEN is set after
	  smbfs_smb_ntcreatex() call.  If NOPEN is set in front, it will
	  immediately return by condition at do_open label.
	- In smbfs_close(), call smbfs_smb_close() and drop NOPEN bit in
	  the case of direcotry.  Otherwise smbfs_rmdir() fails when the
	  directory was opened.
	- Remove redundant vput() before vgone().
	- Avoid unnecessary mutex_exit() in smbfs_node_alloc().
	- Set NGONE bit to from-name vnode to invalidate the smbnode cache.
	[nakayama, ticket #1823]

sys/fs/smbfs/smbfs_smb.c			1.44
sys/fs/smbfs/smbfs_subr.c			1.16
sys/fs/smbfs/smbfs_subr.h			1.21
sys/fs/smbfs/smbfs_vnops.c			1.85
sys/netsmb/smb.h				1.20

	Improve smbfs timestamp handling.
	Don't round timestamp to 2 seconds resolution if the server
	supports the CAP_INFOLEVEL_PASSTHRU capability.
	[nakayama, ticket #1824]

sys/netsmb/smb_iod.c				1.31 - 1.35
sys/netsmb/smb_rq.c				1.32

	Do not call callout_stop() unless the structure was previoulsy
	initialised for a non null timeout.
	Do initialise the callout when fetching a new request structure from
	the pool, not when starting the timer. Likewise, destroy the callout
	when giving back the item to the pool.
	Send data for as long as there is new data available.  Otherwise
	there was a danger of smb_iod_recvall() blocking, hence releasing
	the kernel lock, new data creeping into the queue, and a wakeup
	being missed (well, there's still a race, but since it's theoretical
	enough for me to never have encountered it, I'll rather solve it
	by periodic wakeups).
	defensive programming: wake up iod thread once a second "just in case"
	add comment to previous stating periodic wakeups can be nuked
	once smb is mpsafe.
	[nakayama, ticket #1825]

sys/dev/lockstat.c				1.16

	Fix off by one.
	[msaitoh, ticket #1826]

sys/dev/raidframe/rf_driver.c			1.131

	Fix off by one read.
	[msaitoh, ticket #1827]

sys/external/isc/atheros_hal/dist/ah_eeprom_v14.c		patch

	Fix off by one read.
	[msaitoh, ticket #1828]

sys/compat/netbsd32/netbsd32_fs.c		1.64

	Fix inverted error check.
	[matt, ticket #1829]

sys/dev/usb/ubsa_common.c			1.9

	Fix off by one read error.
	[msaitoh, ticket #1830]

sys/external/bsd/drm/dist/shared-core/i915_suspend.c 1.6

	Fix wrong reference to dev_priv->saveSWF1. It was clearly wrong.
	[msaitoh, ticket #1831]

sbin/sysctl/sysctl.c				1.149 via patch

	Add missing free() in error path.
	[msaitoh, ticket #1832]

usr.bin/netstat/bpf.c				1.11

	Fix memory leak.
	[msaitoh, ticket #1833]

sys/arch/i386/conf/XEN2_DOMU:			patch
sys/arch/amd64/conf/XEN3_DOMU:			patch

	Add drvctl to Xen DOMU kernels
	[sborrill, ticket #1834]

sbin/fsck_ffs/pass1.c				1.50

	Show pass1 SIGINFO output on stderr like other passes, not on stdout.
	[riastradh, ticket #1837]

etc/namedb/root.cache				1.17

	D.ROOT-SERVERS.NET changes IPv4 address.
	[taca, ticket #1839]

gnu/dist/grep/lib/getopt.c			1.2
gnu/dist/grep/lib/regex.c			1.2
gnu/dist/grep/src/ansi2knr.c			1.2
gnu/dist/grep/src/dfa.c				1.3
gnu/dist/grep/src/grep.c			1.14
gnu/dist/grep/src/search.c			1.4

	Change several int variables to size_t, ssize_t, or ptrdiff_t.
	This should fix the bug described in CVE-2012-5667 when an input
	line is so long that its length cannot be stored in an int
	variable.

	[apb, ticket #1838]

lib/librefuse/refuse.c				1.96 via patch

	FUSE seems to allow short writes without errors but PUFFS doesn't. Work
	around this by returning ENOSPC in case of a short write to avoid
	protocol errors. This change is based on problem analysis provided by
	Antti Kantee.
	This fixes PR lib/45129 by myself.
	[tron, ticket #1836]

sys/dev/bluetooth/bthidev.c			1.23, 1.24 via patch
sys/dev/bluetooth/btmagic.c			1.4, 1.5 via patch
usr.sbin/btdevctl/btdevctl.8			1.8 via patch

	when no link-mode is specified, explicitly set a mode of (int)0
	otherwise l2cap_setmode() will fail during connection setup
	for bthidev.c, this fixes a problem with Microsoft Wedge Touch
	mouse (which may not be able to authenticate)
	for btmagic.c, include this fix in case somebody tries that
	related to PR/47286
	[plunky, ticket #1835]

sys/arch/arm/arm32/cpu.c			1.89

	print cpu model string correctly
	[msaitoh, ticket #1841]

sys/dev/pci/pcidevs			1.969 via patch
sys/dev/pci/pcidevs.h			regen
sys/dev/pci/pcidevs_data.h		regen
sys/dev/pci/viaide.c			1.58

	Add VT8237S Integrated SATA Controller support (PR#47452).
	[msaitoh, ticket #1842]

sys/external/bsd/ipf/netinet/ip_fil_netbsd.c	1.4 via patch

	Fix off-by-one read error.
	[msaitoh, ticket #1840]

doc/3RDPARTY					patch
share/zoneinfo/africa				patch
share/zoneinfo/antarctica			patch
share/zoneinfo/asia				patch
share/zoneinfo/australasia			patch
share/zoneinfo/europe				patch
share/zoneinfo/northamerica			patch
share/zoneinfo/southamerica			patch
share/zoneinfo/zone.tab				patch
distrib/sets/lists/base/mi			patch

	Merge tzdata2013a and tzdata2013b from
	ftp://ftp.iana.org/tz/releases/tzdata2013a.tar.gz and
	ftp://ftp.iana.org/tz/releases/tzdata2013b.tar.gz .
	Important changes from tzdata2012j to tzdata2013a:
	 Chile's 2013 rules, and we guess rules for 2014 and later, will be
	 the same as 2012, namely Apr Sun>=23 03:00 UTC to
	 Sep Sun>=2 04:00 UTC.
	 New Zones Asia/Khandyga, Asia/Ust-Nera, Europe/Busingen.
	 Many changes affect historical time stamps before 1940.
	Important changes from tzdata2013a to tzdata2013b:
	 Haiti uses US daylight-saving rules this year, and presumably
	 future years.
	 Paraguay will end DST on March 24 this year.
	 Morocco does not observe DST during Ramadan;
	 try to predict Ramadan in Morocco as best we can. 
	[apb, ticket #1854]

share/zoneinfo/antarctica			patch
share/zoneinfo/asia				patch
share/zoneinfo/australasia			patch
share/zoneinfo/southamerica			patch
share/zoneinfo/zone.tab				patch

	Merge tzdata2013c from
	ftp://ftp.iana.org/tz/releases/tzdata2013c.tar.gz
	[apb, ticket #1860]

sys/dev/pci/pcireg.h			1.69
sys/dev/pci/ppb.c			1.44-1.45

	Support PCI Express 2.0.
	Print version and device/port type information
	[msaitoh, ticket #1844]

distrib/utils/sysinst/menus.mi		1.35, 1.43

	Some v6 dns server are outdated, so replace them with google's
	public servers.
	[msaitoh, ticket #1846]

xsrc/external/mitMesaLib/dist/src/glx/x11/XF86dri.c	patch
xsrc/external/mitlibFS/dist/src/FSOpenServ.c		patch
xsrc/external/mitlibX11/dist/modules/im/ximcp/imLcPrs.c	patch
xsrc/external/mitlibX11/dist/modules/im/ximcp/imTrX.c	patch
xsrc/external/mitlibX11/dist/src/AllCells.c		patch
xsrc/external/mitlibX11/dist/src/Font.c			patch
xsrc/external/mitlibX11/dist/src/FontInfo.c		patch
xsrc/external/mitlibX11/dist/src/FontNames.c		patch
xsrc/external/mitlibX11/dist/src/GetFPath.c		patch
xsrc/external/mitlibX11/dist/src/GetImage.c		patch
xsrc/external/mitlibX11/dist/src/GetMoEv.c		patch
xsrc/external/mitlibX11/dist/src/GetPntMap.c		patch
xsrc/external/mitlibX11/dist/src/GetProp.c		patch
xsrc/external/mitlibX11/dist/src/LiHosts.c		patch
xsrc/external/mitlibX11/dist/src/ListExt.c		patch
xsrc/external/mitlibX11/dist/src/ModMap.c		patch
xsrc/external/mitlibX11/dist/src/Xrm.c			patch
xsrc/external/mitlibX11/dist/src/xcms/cmsColNm.c	patch
xsrc/external/mitlibX11/dist/src/xkb/XKBExtDev.c	patch
xsrc/external/mitlibX11/dist/src/xkb/XKBGeom.c		patch
xsrc/external/mitlibX11/dist/src/xkb/XKBGetMap.c	patch
xsrc/external/mitlibX11/dist/src/xkb/XKBNames.c		patch
xsrc/external/mitlibXcursor/dist/src/file.c		patch
xsrc/external/mitlibXext/dist/src/XEVI.c		patch
xsrc/external/mitlibXext/dist/src/XShape.c		patch
xsrc/external/mitlibXext/dist/src/XSync.c		patch
xsrc/external/mitlibXext/dist/src/Xcup.c		patch
xsrc/external/mitlibXext/dist/src/Xdbe.c		patch
xsrc/external/mitlibXfixes/dist/src/Cursor.c		patch
xsrc/external/mitlibXi/dist/src/XGMotion.c		patch
xsrc/external/mitlibXi/dist/src/XGetBMap.c		patch
xsrc/external/mitlibXi/dist/src/XGetDCtl.c		patch
xsrc/external/mitlibXi/dist/src/XGetDProp.c		patch
xsrc/external/mitlibXi/dist/src/XGetFCtl.c		patch
xsrc/external/mitlibXi/dist/src/XGetProp.c		patch
xsrc/external/mitlibXi/dist/src/XListDev.c		patch
xsrc/external/mitlibXi/dist/src/XQueryDv.c		patch
xsrc/external/mitlibXinerama/dist/src/Xinerama.c	patch
xsrc/external/mitlibXrandr/dist/src/XrrProperty.c	patch
xsrc/external/mitlibXrender/dist/src/Filter.c		patch
xsrc/external/mitlibXrender/dist/src/Xrender.c		patch
xsrc/external/mitlibXres/dist/src/XRes.c		patch
xsrc/external/mitlibXt/dist/src/ResConfig.c		patch
xsrc/external/mitlibXt/dist/src/Selection.c		patch
xsrc/external/mitlibXv/dist/src/Xv.c			patch
xsrc/external/mitlibXvMC/dist/src/XvMC.c		patch
xsrc/external/mitlibXxf86dga/dist/src/XF86DGA2.c	patch
xsrc/external/mitlibXxf86vm/dist/src/XF86VMode.c	patch

	Fix protocol handling issues in X client libraries.
	[mrg, ticket #1865]

external/mit/xorg/lib/fontconfig/src/Makefile		patch
external/mit/xorg/lib/libX11/Makefile.libx11		patch
external/mit/xorg/lib/libXi/Makefile			patch

	Silence gcc 4.1 warnings from ticket #1865.
	[mrg, ticket #1866]

etc/MAKEDEV.tmpl				1.161

	The console major number is not always 0.
	[apb, ticket #1848]

etc/rc.d/wpa_supplicant				1.4

	Make custom "reload" target work. Before this fix it would have tried
	to send a HUP signal to "wpa_supplicant" instead.
	[tron, ticket #1849]

bin/sh/expand.c					1.88
bin/sh/expand.h					1.19

	Fix the expansion of "$(foo-$bar}" so that IFS isn't applied when
	expanding $bar.	Noted by Greg Troxel on tech-userlevel running some
	'git' tests. Should fix PR bin/47361.
	[gdt, ticket #1851]

sys/dev/fss.c					1.84

	Don't crash when running multiple dump -X. PR#47514.
	[gdt, ticket #1853]

sys/arch/amd64/conf/XEN3_DOMU			patch
sys/arch/i386/conf/Attic/XEN2_DOMU		patch

	Add wedge support in DOMU kernels.
	[sborrill, ticket #1858]

sys/dev/pci/if_vioif.c				1.4

	Fix a typo, and remove an unused member.
	This should fix the problem that recent Qemu dies during configuring
	a vioif. Fixes PR#47780.
	[minoura, ticket #1861]

dist/nvi/common/conv.c				1.7 via patch

	Don't truncate files on character conversions without warning
	and a chance for recovery.
	[christos, ticket #1845]

sys/netinet/ip_icmp.c				1.130
sys/netinet/ip_icmp.h				patch

	Add missing codes to ICMP handling.  PR#47693.
	[fair, ticket #1855]

sys/arch/vax/boot/xxboot/start.S		1.5
sys/sys/bootblock.h				1.55
sys/sys/disklabel.h				1.113
usr.sbin/installboot/arch/vax.c			1.14-1.17

	fix VAX bootblocks and installboot for VAX 780 and similar machines
	(booting via VMB.EXE).
	Don't include host's disklabel.h.
	[martin, ticket #1856]

sys/arch/x86/include/mtrr.h			1.5
sys/arch/x86/include/specialreg.h		1.55
sys/arch/x86/x86/mtrr_i686.c			1.25

	Increase MTRR_I686_NVAR_MAX from 8 to 16. Avoids
	"FIXME: more than 8 MTRRs (10)" message on booting Thinkpad W520 and
	similar. While here replace a magic number with MTRR_I686_NVAR_MAX * 2
	[msaitoh, ticket #1847]

sys/dev/pci/if_wm.c			1.201, 1.203-1.204, 1.207-1.212, 1.215,
					1.217-1.218, 1.220-1.223, 1.228,
					1.232-245 via patch
sys/dev/pci/if_wmreg.h			1.40-1.45, 1.47-1.48 via patch
sys/dev/pci/if_wmvar.h			1.11-1.14 via patch
sys/dev/pci/pcidevs			1.1074, 1.1077, 1.1117 via patch
sys/dev/pci/pcidevs.h			regen
sys/dev/pci/pcidevs_data.h		regen
sys/dev/mii/igphyreg.h			1.6 via patch
sys/dev/mii/ihphy.c			1.1-1.2 via patch
sys/dev/mii/ihphyreg.h			1.1 via patch
sys/dev/mii/inbmphyreg.h		1.3 via patch
sys/dev/mii/files.mii			1.47 via patch
sys/dev/mii/miidevs			1.97 and 1.100 via patch
sys/dev/mii/miidevs.h			regen
sys/dev/mii/miidevs_data.h		regen
sys/arch/i386/conf/ALL			1.280 via patch
sys/arch/i386/conf/GENERIC		1.1001 via patch
sys/arch/i386/conf/INSTALL_FLOPPY	1.11 via patch
sys/arch/i386/conf/XEN2_DOM0		patch
sys/arch/amd64/conf/GENERIC		1.293 via patch
sys/arch/amd64/conf/XEN3_DOM0		1.61 via patch
share/man/man4/wm.4			1.21-1.24 via patch

	Apply almost all fixes and improvements from netbsd-6 except for
	the rev. 1.196's iqdrops' change.

	- Add the detach code.
	- Add code for WOL, ASF, IPMI and Intel AMT. WOL is disabled by default
	- Add Yet another workaround for ICH8.
	- 82576 is dual port, so check the FUNCID and increment the
	  MAC address for the 2nd port.
	- Fix the names of 82577L[MC] LAN controllers (for mobile).
	- Fix CTRL_EXT_SWDPIN() and CTRL_EXT_SWDPIO() macros. The bit order
	  of the SW definable pin is not 6543 but 3654!!!
	- Rewrite the code to read MAC address from eeprom.
	- Add 82580 support.
	- 82571 quirk. Only 82571 shares port 0 of EEMNGCTL_CFGDONE.
	- The document says that the TDH register must be set after
	  TCL.EN is set on 82575 and newer devices.
	- Fix some register names. No functional change.
	- Omit U+00AE "REGISTERED SIGN" in a product name due to its
	  non-ASCII nature.
	- Stop wm(4) from needlessly resetting when you add or delete a vlan(4).
	- Fix MAC address check on 8257[156] and 80003 case. Some cards have
	  non 0xffff pointer but those don't use alternative MAC address
	  in reality. So we check whether the broadcast bit is set or not
	  like Intel's e1000 driver.
	  Fixes PR kern/44072 reported by Jean-Yves Moulin.
	- Add PCH2(and 82579) support. Fixes PR#46487
	- Add yet another 82567V support.
	- Add ICH10+HANKSVILL support.
	- Add support Intel I350 Ethernet.
	- Make vlan and all ip/ip6 checksum offload work for the I350.
	- Fix compile error with  WM_DEBUG.
	- Fix a bug that PHY isn't set to low-power mode on PCH and PCH2.
	- Add WM_DEBUG_NVM. If WM_DEBUG_NVM is enabled, dump the FLASH ROM data.
	- Skip 64bit BAR correctly.
	- Fix RAL_TABSIZE for ICH8, 82576, 82580 and I350.
	- Use 82580(and I350) specific PHY read/write functions. Fixes PR#47542.
	- Style fix. Fix typo in comment. Fix comments. Add comments.
	[msaitoh, ticket #1850]

sys/kern/kern_drvctl.c				1.34

	Fix memory leak on the following cases when device attached or detached:
	  - No one open drvctl.
	  - kmem_alloc() failed in devmon_insert().

	[msaitoh, ticket #1859]

share/man/man4/options.4			1.420

	Fix typo
	[msaitoh, ticket #1862]

sys/netinet6/ip6_flow.c				1.21

	Clear mbuf's csum_flags in ip6flow_fastforward(). Fixes PR#47849.
	[msaitoh, ticket #1864]

distrib/sets/lists/man/mi			1.1411
share/man/man4/Makefile				1.593
share/man/man4/gpio.4				1.24
share/man/man4/ptcd.4				1.1, 1.3, 1.4
sys/arch/i386/conf/ALL				1.348
sys/arch/i386/conf/files.i386			1.369
sys/dev/isa/ptcd.c				1.1

	Add ptcd(4), a device driver for the cash drawer port found on
	Protech PS3100 point of sale terminals.  It controls the cash drawer
	using a gpio(4) device that attaches at ptcd0.
	[mbalmer, ticket #1863]

external/bsd/bind/dist/lib/dns/rdata/generic/keydata_65533.c	patch

	Fix for bind CVE-2013-4854.
	[spz, ticket #1871]

usr.bin/netstat/inet.c				1.102-1.03
usr.bin/netstat/inet6.c				1.61-1.62
usr.bin/netstat/main.c				1.86
usr.bin/netstat/netstat.h			1.47

	Don't use -P as a kmem printer, verify that the address points to a
	pcb first!
	Not all pointers are 64bit - use uintptr_t instead of uint64_t.
	[christos, ticket #1868]

usr.bin/mklocale/mklocaledb.c			1.3

	Swap order of _CITRUS_LC_MONETARY_SYM_INT_N_CS_PRECEDES and
	_CITRUS_LC_MONETARY_SYM_INT_P_SEP_BY_SPACE to match data files.
	[joerg, ticket #1869]

sys/dev/pci/if_wm.c			1.246-1.247, 1.249-1.258 via patch
sys/dev/pci/if_wmreg.h			1.51, 1.53 via patch
sys/dev/pci/if_wmvar.h			1.15-1.16 via patch
sys/dev/pci/pcidevs			1.1152-1.1153 via patch
sys/dev/pci/pcidevs.h			regen
sys/dev/pci/pcidevs_data.h		regen

	Add I21[0178] support.
	Fix a bug that wm_attach() may fail on some PCH2 or newer system.
	wm_valid_nvm_bank_detect_ich8lan() misunderstood the NVM's bank
	number. Fixes PR#47878.
	Fix a bug that the check of reset complete fails on Intel 8 series
	with "wm_lan_init_done: lan_init_done failed to complete" message.
	The broken code was used for ICH8, 9... and PCH2.
	The wm_linkintr_gmii() function is called from interrupt. That's
	not tick, so call mii_pollstat() instead of mii_tick().
	Add ECC support for the packet buffer. Only 82571 and I21[78] support
	ECC.
	Fix a bug that wrong semaphore is used in wm_gmii_hv_{read,write}reg.
	Add comments, fix some comments, use macros and remove trailing
	whitespaces.
	[msaitoh, ticket #1867]

doc/3RDPARTY							patch
share/zoneinfo/africa						patch
share/zoneinfo/asia						patch
share/zoneinfo/australasia					patch
share/zoneinfo/europe						patch
share/zoneinfo/iso3166.tab					patch
share/zoneinfo/southamerica					patch
share/zoneinfo/zone.tab						patch

	Import tzdata2013d from
	    ftp://ftp.iana.org/tz/releases/tzdata2013d.tar.gz
	Summary of changes from tzdata2013c to tzdata2013d:
	   Changes affecting current and future time stamps:
	     Morocco's midsummer transitions this year are July 7 and August 10,
	     not July 9 and August 8.  (Thanks to Andrew Paprocki.)

	     Israel now falls back on the last Sunday of October.
	     (Thanks to Ephraim Silverberg.)

	   Changes affecting past time stamps:
	     Specify Jerusalem's location more precisely; this changes the
	     pre-1880 times by 2 s.

	   Changing affecting metadata only:
	     Fix typos in the entries for country codes BQ and SX.

	   Changes affecting documentation and commentary:
	     Deemphasize the significance of national borders.

	     Update the zdump man page.

	     Remove obsolete NOID comment (thanks to Denis Excoffier).

	     Update several URLs and comments in the web pages.

	     Spelling fixes (thanks to Kevin Lyda and Jonathan Leffler).

	     Update URL for CLDR Zone->Tzid table (thanks to Yoshito Umaoka).
	[apb, ticket #1870]

sys/arch/i386/stand/boot/boot2.c		1.59 via patch

	Two changes for the i386 boot loader related to the boot menu which
	can be defined in boot.cfg:

	 * Add a "menu" command which re-displays the menu and initiates
	   the timed countdown
	 * Use any default command defined in boot.cfg as default args
	   if the user runs "boot" with no arguments

	This is useful in circumstances where you e.g. need to interrupt
	the normal boot process to switch to serial console, and where
	simply "boot netbsd" is no longer sufficient (e.g. as with install
	media which needs the miniroot kernel module loaded).
	[he, ticket #1872]

sys/net/bpf.c					1.176 via patch

	Avoid kernel panic caused by setting a very small bpf buffer size.
	Fixes PR/48198 reported by Peter Bex.
	[spz, ticket #1874]

lib/libc/locale/global_locale.c                 patch

	provide consistent and correct data for the C locale.
	[joerg, ticket #1873] 

sys/netinet6/in6.c				1.167 via patch

	Include BRDADDR and NETMASK to the v4 ioctls we ban for v6; from
	FreeBSD.
	[spz, ticket #1876]

xsrc/external/mit/libX11/dist/src/xkb/XKBNames.c	patch
xsrc/external/mit/libX11/dist/src/xkb/XKBGetMap.c	patch

	The size of the arrays is max_key_code + 1. This makes these functions
	consistent with the other checks added for CVE-2013-1997.
	Check the XkbGetNames reply when names->keys was just allocated
	Should fix PR lib/48170.
	[riz, ticket #1877]

etc/ssh/ssh_known_hosts				1.7-1.8

	Update for project hosts whose keys changed.
	[spz, ticket #1878]

sbin/raidctl/raidctl.8				1.65

	Note that NetBSD/amd64 can boot off RAID volumes.
	[tron, ticket #1879]

share/zoneinfo/australasia			1.33

	Merge the Fiji-related change from tzdata2013e.
	This year Fiji will start DST on October 27, not October 20.
	[apb, ticket #1880]

xsrc/external/mit/xorg-server/dist/dix/dixfonts.c	1.2 via patch
xsrc/xfree/xc/programs/Xserver/dix/dixfonts.c		1.4 via patch

	Fix CVE-2013-4396 using a patch from Alan Coopersmith:
	Save a pointer to the passed in closure structure before copying it
	and overwriting the *c pointer to point to our copy instead of the
	original.  If we hit an error, once we free(c), reset c to point to
	the original structure before jumping to the cleanup code that
	references *c.
	[spz, ticket #966]

lib/libpthread/pthread.c			1.137 via patch

	return errno if pthread_create hits the system limit, not just -1
	[riastradh, ticket #1881]

gnu/dist/texinfo/util/texi2dvi			1.10

	Remove trailing whitespace in texi2dvi which confuses sed.
	[riastradh, ticket #1882]

common/lib/libc/sys/cpuset.c			1.16

	_cpuset_create: initialize size argument for sysctl call.
	From PR/43837 by Sandy Snaman.
	[dholland, ticket #1883]

usr.bin/systat/keyboard.c			1.25

	Fix typo that made '?' an erase char instead of DEL as intended.
	[dholland, ticket #1885]

sys/arch/hp700/hp700/autoconf.c			1.51

	Remember to unmap pagezero once we've finished with it.
	[skrll, ticket #1886]

sys/ufs/ffs/ffs_alloc.c				1.144 via patch

	Pull in fix from FreeBSD ffs_alloc.c r121785:
	Consider only cylinder groups with at least 75% of the average
	free space per cylinder group and 75% of the average free
	inodes per cylinder group as candidates for the creation of a
	new directory.  Avoids excessive I/O scanning for a suitable
	cylinder group on relatively full file systems.
	[bad, ticket #1888]

distrib/sets/lists/base/mi			1.1049
distrib/sets/lists/man/mi			1.1449
usr.bin/gzip/Makefile				1.17, 1.18
usr.bin/gzip/zmore				1.4, 1.5
usr.bin/gzip/zmore.1				1.4
 
	 Added zless(1) - comes in the latest version of zmore(1) from OpenBSD
	 [pettai, ticket #1889]

sys/arch/xen/xen/evtchn.c			1.70

	Remove the "evtchn_do_event: handler %p didn't lower ipl %d %d\n"
	printf as analysis shows it actually isn't a bug in the handler,
	but related to spin mutexes. Fixes port-xen/46313
	[bouyer, ticket #1890]

sys/kern/uipc_syscalls.c			1.163

	If the unix socket is closed before accept, the mbuf returned
	by m_get() will have an uninitialized length and contain junk
	from a previous call. Initialize m_len to be 0 to handle this
	case. Fixes PR/47591

sys/netinet6/nd6.c				1.146
usr.sbin/ndp/ndp.c				1.42

	Instead of voodo casts use simple byte pointer arithmetic and memcpy to
	create the "packed" binary format we pass out to userland when querying
	the router/prefix list.
	Simplify code to print the router/prefix list: use memcpy and local
	structs properly aligned on the stack to decode the binary format
	passed by the kernel - instead of (bogusly) assuming the format will
	obey all local alignement requirements.
	[martin, ticket #1892]

distrib/sparc/ramdisk/Makefile				patch
lib/libc/net/getaddrinfo.c				1.106 via patch
lib/libc/net/gethnamaddr.c				1.79-1.82,1.85 via patch
lib/libc/net/getnameinfo.3				1.37-1.40 via patch
lib/libc/net/getnameinfo.c				1.4 via patch
lib/libc/net/hostent.h					1.1, 1.2 via patch
lib/libc/net/sethostent.c				1.17-1.19 via patch

	Make getnameinfo(3) re-entrant (ahem __ypdomain).
	Add not advertised reentrant functions: {get,set,end}hostent_r,
	gethostbyname{,2}_r, gethostbyaddr_r. Make getnameinfo(3) use
	gethostbyaddr_r(3).
	Implement no-check-names.
	[bad, ticket #1887]

etc/ntp.conf					1.16, 1.17, 1.18 via patch
external/bsd/ntp/dist/ntpd/ntp_request.c	patch

	Patch from ntp 4.2.7p404 to prevent an amplifier and DoS attack.
	Add several "restrict" lines to the default ntp.conf and
	improve comments
	[spz, ticket #1895]

distrib/ews4800mips/Makefile			1.3

	Add "cdroms" to the SUBDIR list for src/distrib/ews4800mips.
	Should prevent the iso image from being created in the source tree
	[apb, ticket #1894]

xsrc/external/mit/libXfont/dist/src/bitmap/bdfread.c	patch
xsrc/xfree/xc/lib/font/bitmap/bdfread.c			patch

	Fix CVE-2013-6462: scanf without field width limits can crash
	with huge input data.
	[wiz, ticket #1896]

dist/bind/bin/named/query.c			patch

	a fix by ISC for CVE-2014-0591:
	3693.  [security]  memcpy was incorrectly called with overlapping
			   ranges resulting in malformed names being generated
			   on some platforms.  This could cause INSIST failures
			   when serving NSEC3 signed zones.  [RT #35120]
	[spz, ticket #1897]

lib/libpthread/pthread_cond.c			1.62
lib/libpthread/pthread_mutex.c			1.57, 1.59

	Partial fix for thread deadlock commonly observed with
	named. Also address PR/44756.
	[prlw1, ticket #1898]

sys/kern/kern_verifiedexec.c			1.132

	Reorder code to avoid use-after-free on error.
	[maxv, ticket #1899]

sys/dev/wscons/mra.c				1.6

	Fixes calibration in wscons through the MRA sub-system on
	architectures where sizeof(int) != sizeof(long). This code
	is typically used by drivers for touchscreen devices,
	like uts(4).
	[khorben, ticket #1900]

sys/kern/vfs_syscalls.c				1.478, 1.480 via patch
sys/coda/coda_vfsops.c				1.81
sys/fs/adosfs/advfsops.c			1.70
sys/fs/cd9660/cd9660_vfsops.c			1.84
sys/fs/efs/efs_vfsops.c				1.25
sys/fs/filecorefs/filecore_vfsops.c		1.76
sys/fs/hfs/hfs_vfsops.c				1.31
sys/fs/msdosfs/msdosfs_vfsops.c			1.107
sys/fs/ntfs/ntfs_vfsops.c			1.94
sys/fs/ptyfs/ptyfs_vfsops.c			1.50 via patch
sys/fs/puffs/puffs_vfsops.c			1.110 via patch
sys/fs/smbfs/smbfs_vfsops.c			1.100
sys/fs/sysvbfs/sysvbfs_vfsops.c			1.43
sys/fs/tmpfs/tmpfs_vfsops.c			1.59 via patch
sys/fs/udf/udf_vfsops.c				1.67
sys/fs/union/union_vfsops.c			1.72
sys/fs/unionfs/unionfs_vfsops.c			1.13
sys/kern/vfs_syscalls.c				1.479
sys/miscfs/nullfs/null_vfsops.c			1.88 via patch
sys/miscfs/overlay/overlay_vfsops.c		1.61
sys/miscfs/procfs/procfs_vfsops.c		1.91
sys/miscfs/umapfs/umap_vfsops.c			1.92
sys/nfs/nfs_vfsops.c				1.227
sys/ufs/ext2fs/ext2fs_vfsops.c			1.180
sys/ufs/ffs/ffs_vfsops.c			1.297
sys/ufs/lfs/lfs_vfsops.c			1.321
sys/ufs/mfs/mfs_vfsops.c			1.107

	Due to missing checks in the mount syscall, and a wrong
	assumption on the file systems side, the kernel could allocate
	an unbounded or zero-sized memory buffer, and could dereference
	a NULL pointer when particular arguments are given by a user.
	[maxv, ticket #1901]

src/sys/compat/linux/common/linux_exec_elf32.c	1.91 via patch

	A specially-crafted binary could easily control a kernel array index.
	Add some checks to ensure that nothing will be read outside the
	allocated area. Rewrite the code so that we don't need to allocate
	the whole section. Spotted by several developers, patch from
	chs@/enami@

	[maxv, ticket #1902]

xsrc/external/mit/libXfont/dist/src/fc/fsconvert.c	1.2
xsrc/external/mit/libXfont/dist/src/fc/fserve.c		1.2
xsrc/external/mit/libXfont/dist/src/fontfile/dirfile.c	1.2
xsrc/xfree/xc/lib/font/fc/fsconvert.c			1.5
xsrc/xfree/xc/lib/font/fc/fserve.c			1.5
xsrc/xfree/xc/lib/font/fontfile/dirfile.c		1.5

	Fix multiple vulnerabilities in libXfont:
	- CVE-2014-0209: integer overflow of allocations in font metadata
	  file parsing
	- CVE-2014-0210: unvalidated length fields when parsing xfs protocol
	  replies
	- CVE-2014-0211: integer overflows calculating memory needs for xfs
	  replies
	[spz, ticket #1905]
sys/fs/cd9660/cd9660_node.c			1.31

	PR kern/48787: inode calculation from ISO9660 block offset might get
	truncated to 32bit - force the whole expression to be evaluated
	as ino_t.
	Patch from Thomas Schmitt, with minor modifications
	(and reworded comment).
	[martin, ticket #1904]

doc/3RDPARTY					patch
share/zoneinfo/africa				patch
share/zoneinfo/antarctica			patch
share/zoneinfo/asia				patch
share/zoneinfo/australasia			patch
share/zoneinfo/backward				patch
share/zoneinfo/etcetera				patch
share/zoneinfo/europe				patch
share/zoneinfo/iso3166.tab			patch
share/zoneinfo/leap-seconds.list		patch
share/zoneinfo/leapseconds			patch
share/zoneinfo/leapseconds.awk			patch
share/zoneinfo/northamerica			patch
share/zoneinfo/southamerica			patch
share/zoneinfo/zone.tab				patch
distrib/sets/lists/base/mi			patch

	Update timezone database from tzdata2013d to tzdata2014c.
	This adds a new timezone, Antarctica/Troll, and updates
	many other timezones. The Asia/Riyadh{87,88,89} zones are
	retained for backward compatibility, although they have
	been removed from the upstream distribution.

	[apb, ticket #1906]

share/zoneinfo/Makefile				patch
distrib/sets/lists/base/mi			patch
share/zoneinfo/solar87				delete
share/zoneinfo/solar88				delete
share/zoneinfo/solar89				delete

	Remove the the Asia/Riyadh{87,88,89} timezones, and their
	Mideast/* aliases.  These zones were removed upstream in
	tzdata2013i (December 2013).
	[apb, ticket #1907]

sys/arch/x86/pci/pci_machdep.c			1.61, 1.66 via patch

	Force PCI mode 1 when running under QEMU and Xen HVM domU, to work
	around QEMU bug 897771.
	This should also make it possible to boot NetBSD under versions of KVM
	that have inherited said QEMU bug.  Fixes PR kern/45671 and kern/48770.
	[sborrill, ticket #1903]

crypto/dist/openssl/crypto/bn/bn.h		patch
crypto/dist/openssl/crypto/bn/bn_lib.c		patch
crypto/dist/openssl/crypto/ec/ec2_mult.c	patch
crypto/dist/openssl/ssl/d1_both.c		patch
crypto/dist/openssl/ssl/s3_clnt.c		patch
crypto/dist/openssl/ssl/s3_pkt.c		patch
crypto/dist/openssl/ssl/s3_srvr.c		patch
crypto/dist/openssl/ssl/ssl3.h			patch

	Fixes CVE-2014-0224, CVE-2014-0221, CVE-2014-0195 and CVE-2014-3470.
	[spz, ticket #1908]

sys/compat/freebsd/freebsd_sched.c		1.20-1.21

	Avoid NULL dereference and fix sched param conversion.
	Pointed out by Maxime Villard.
	[maxv, ticket #1909]

libexec/httpd/CHANGES				1.3-1.18
libexec/httpd/Makefile				1.8-1.22 via patch
libexec/httpd/Makefile.boot			1.3-1.6
libexec/httpd/auth-bozo.c			1.5-1.13
libexec/httpd/bozohttpd.8			1.6-1.46
libexec/httpd/bozohttpd.c			1.8,1.12-1.54
libexec/httpd/bozohttpd.h			1.8-1.32
libexec/httpd/cgi-bozo.c			1.11-1.25
libexec/httpd/content-bozo.c			1.4-1.10
libexec/httpd/daemon-bozo.c			1.5-1.16
libexec/httpd/dir-index-bozo.c			1.6-1.19
libexec/httpd/ssl-bozo.c			1.5-1.16
libexec/httpd/tilde-luzah-bozo.c		1.5-1.10
libexec/httpd/lua-bozo.c			1.1-1.9
libexec/httpd/main.c				1.1-1.7
libexec/httpd/netbsd_queue.h			1.1
libexec/httpd/printenv.lua			1.1-1.2
libexec/httpd/debug/Makefile			1.1
libexec/httpd/libbozohttpd/Makefile		1.2
libexec/httpd/libbozohttpd/libbozohttpd.3	1.3
libexec/httpd/libbozohttpd/shlib_version	1.1
libexec/httpd/lua/Makefile			1.1
libexec/httpd/lua/bozo.lua			1.1
libexec/httpd/lua/glue.c			1.1
libexec/httpd/lua/optparse.lua			1.1
libexec/httpd/lua/shlib_version			1.1
libexec/httpd/small/Makefile			1.1-1.2
libexec/httpd/testsuite/Makefile		1.4
libexec/httpd/testsuite/html_cmp		1.4
libexec/httpd/testsuite/t1.in			1.3
libexec/httpd/testsuite/t1.out			1.3
libexec/httpd/testsuite/t10.in			1.1
libexec/httpd/testsuite/t10.out			1.1
libexec/httpd/testsuite/t2.in			1.3
libexec/httpd/testsuite/t2.out			1.3
libexec/httpd/testsuite/t3.in			1.3
libexec/httpd/testsuite/t3.out			1.3
libexec/httpd/testsuite/t4.in			1.3
libexec/httpd/testsuite/t4.out			1.3
libexec/httpd/testsuite/t5.in			1.3
libexec/httpd/testsuite/t5.out			1.3
libexec/httpd/testsuite/t6.in			1.3
libexec/httpd/testsuite/t6.out			1.3
libexec/httpd/testsuite/t7.in			1.3
libexec/httpd/testsuite/t7.out			1.3
libexec/httpd/testsuite/t8.in			1.3
libexec/httpd/testsuite/t8.out			1.3
libexec/httpd/testsuite/t9.in			1.3
libexec/httpd/testsuite/t9.out			1.3
libexec/httpd/testsuite/test-bigfile		1.1
libexec/httpd/testsuite/data/bigfile		1.1
libexec/httpd/testsuite/data/bigfile.partial4000 1.1
libexec/httpd/testsuite/data/bigfile.partial8000 1.1
libexec/httpd/testsuite/data/file		1.3
libexec/httpd/testsuite/data/index.html		1.3

	Update bozohttpd from 20080303+patches to 20140708.
	[mrg, ticket #1913]

sys/kern/sys_module.c				1.15 via patch

	Fix a user-controlled memory allocation.
	[maxv, ticket #1914]

sys/dev/pckbport/wskbdmap_mfii.c		1.25
sys/dev/usb/ukbdmap.c				1.29

	Add a belgian keyboard layout, based on the french keyboard layout.
	Fixes PR install/46871.
	[mbalmer, ticket #1915]

sys/compat/linux/common/linux_socketcall.c	1.44
sys/compat/linux32/common/linux32_socketcall.c	1.9

	If SCARG(uap, what) = 0, copyin() will copy (size_t)-1 bytes, and it's
	not a good idea; but not proven harmful. With the help of njoly@.
	[maxv, ticket #1916]
