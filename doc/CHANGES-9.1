# $NetBSD: CHANGES-9.1,v 1.1.2.7 2020/03/01 12:52:01 martin Exp $

A complete list of changes from the NetBSD 9.0 release to the NetBSD 9.1
release:

external/gpl2/groff/tmac/mdoc.local             patched by hand
sys/sys/param.h                                 patched by hand

        Welcome to 9.0_STABLE.
        [martin]

external/cddl/osnet/dist/uts/common/fs/zfs/zfs_vnops.c 1.57

	zfs_netbsd_setattr: ignore size changes on device nodes.
	[hannken, ticket #709]

external/cddl/osnet/dist/uts/common/fs/zfs/zfs_vnops.c 1.58

	Teach zfs to revoke vnodes the usual way.
	[riastradh, ticket #710]

sys/arch/arm/ti/if_cpsw.c			1.9

	Fix KERNHIST build (and simplify).
	[skrll, ticket #711]

sys/arch/hpcmips/hpcmips/hpcapm_machdep.c	1.6

	Fix spelling in comments.
	[sevan, ticket #712]

lib/libdm/libdm_ioctl.c				1.4

	Do not write temporary files to fixed paths in /tmp.
	[riastradh, ticket #713]

crypto/external/bsd/openssl/dist/crypto/rand/rand_unix.c 1.14

	Open /dev/urandom with O_CLOEXEC to avoid leaking filedescriptors
	into child processes.
	[riastradh, ticket #714]

external/cddl/osnet/dist/cmd/zpool/zpool_vdev.c	1.5

	zpool: The NetBSD specific ioctl needs to include sys/ioctl.h.
	[riastradh, ticket #715]

sys/dev/usb/usbdi.c				1.194

	Fix a race in USB abort, so that a transfer on an interrupt
	pipe whose callback is currently running at the moment the
	pipe is aborted will not be restarted afterward.
	[riastradh, ticket #716]

sys/dev/fdt/dwcmmc_fdt.c			1.11
sys/dev/ic/bwfm.c				1.15-1.18
sys/dev/ic/bwfmreg.h				1.4-1.6
sys/dev/ic/bwfmvar.h				1.4,1.5
sys/dev/ic/dwc_mmc.c				1.21,1.22
sys/dev/ic/dwc_mmc_reg.h			1.8,1.9,1.12,1.13
sys/dev/pcmcia/pcmciareg.h			1.11
sys/dev/sdmmc/if_bwfm_sdio.c			1.4,1.6-1.12
sys/dev/sdmmc/if_bwfm_sdio.h			1.1,1.2
sys/dev/sdmmc/sdhc.c				1.105,1.106
sys/dev/sdmmc/sdmmc.c				1.37,1.39
sys/dev/sdmmc/sdmmc_cis.c			1.6,1.8
sys/dev/sdmmc/sdmmc_io.c			1.15-1.19
sys/dev/sdmmc/sdmmc_ioreg.h			1.4,1.5
sys/dev/sdmmc/sdmmc_mem.c			1.69-1.71
sys/dev/sdmmc/sdmmcdevs				1.5-1.8
sys/dev/sdmmc/sdmmcvar.h			1.31,1.33,1.34
sys/net/if_media.h				1.66
sys/dev/sdmmc/sdmmcdevs.h			(regen)

	Various fixes to make bwfm@sdio work on Pinebook Pro:
	 - Several fixes to SDIO (generic for the dwc driver)
	 - bwfm sdio attachment.
	 - Various bwfm fixes
	 - isplay 802.11 modes beyond 'g'
	 - sdhc voltage setting fixes
	[mrg, ticket #717]

sys/arch/mips/adm5120/dev/ahci.c		1.21
sys/dev/usb/ehci.c				1.274
sys/dev/usb/ohci.c				1.296
sys/dev/usb/uhci.c				1.294
sys/external/bsd/dwc2/dwc2.c			1.72

	Fix a memory leak.
	[skrll, ticket #718]

sys/kern/uipc_socket.c				1.288

	SO_RCVTIMEO: zero out the time value, to prevent uninitialized
	bytes in its padding from leaking to userland.
	[maxv, ticket #720]

sys/arch/arm/arm32/bus_dma.c			1.119,1.120

	Make sure to convey a failure to the calling function.
	[skrll, ticket #721]

sys/arch/i386/stand/efiboot/eficons.c		1.10,1.11

	If the default GOP mode is unavailable, fallback to the first mode
	defined.
	[jmcneill, ticket #723]

xsrc/external/mit/MesaLib/dist/src/mapi/entry_x86-64_tls.h 1.5
xsrc/external/mit/MesaLib/dist/src/mapi/entry_x86_tls.h 1.6

	mesa: sync w/ pkgsrc: don't assume the current gl dispatch table
	points to noop if NULL, instead call the ENTRY_CURRENT_TABLE_GET
	function.
	[tnn, ticket #724]

etc/rc.d/mountall				1.12
external/cddl/osnet/dist/uts/common/fs/zfs/spa_history.c 1.5,1.6
external/cddl/osnet/dist/uts/common/fs/zfs/zfs_vnops.c 1.59-1.61
external/cddl/osnet/sys/kern/misc.c		1.8

	- Make block device nodes with /dev on zfs work.
	- Mount zfs if zfs=YES whether or not /etc/zfs/zpool.cache is there.
	- Mark our changes to zpools as NetBSD, not OpenSolaris.
	[riastradh, ticket #725]

external/gpl3/binutils/dist/bfd/elf.c		1.14

	Fix 'nm /dev/ksyms'.
	[rin, ticket #726]

sys/arch/powerpc/include/db_machdep.h		1.27

	Do not mask out LK bit (bit 31) from M_BCTR, which distinguishes
	bcctr and bcctrl.
	[rin, ticket #727]

sys/arch/powerpc/ibm4xx/dev/com_opb.c		1.23

	Fix a panic during attach of com(4) for powerpc/ibm4xx peripheral.
	[rin, ticket #728]

sys/arch/powerpc/include/intr.h			1.15

	Fix !__HAVE_FAST_SOFTINTS build for debugging.
	[rin, ticket #729]

sys/arch/powerpc/conf/files.powerpc		1.93
sys/arch/powerpc/include/pio.h			1.8
sys/arch/powerpc/pic/intr.c			1.27
sys/arch/powerpc/powerpc/bus_dma.c		1.50
sys/arch/powerpc/powerpc/pio_subr.S		1.17

	Remove redundant "eieio" instructions for powerpc/ibm4xx.
	[rin, ticket #730]

sys/dev/usb/u3g.c				1.40
sys/dev/usb/umodeswitch.c			1.5
sys/dev/usb/usbdevs				1.776
sys/dev/usb/usbdevs.h				(regen)
sys/dev/usb/usbdevs_data.h			(regen)

	Add support for D-Link DWM-157 3G USB modem.
	[manu, ticket #719]

sys/arch/powerpc/ibm4xx/pmap.c			1.77-1.80

	Fix powerpc/ibm4xx bugs:
	- fix NULL dereference; "pap" argument of pmap_extract(9) can be
	  NULL.
	- fix off-by-one error for ctx (ASID).
	- clear ti_ctx when flushing a TLB entry for clarity.
	- in ppc4xx_tlb_find_victim(), mark kernel stack page TLBF_REF
	  instead of TLBF_USED.
	[rin, ticket #731]

sys/uvm/uvm_pglist.c				1.80

	Make this compile again with PGALLOC_VERBOSE.
	[rin, ticket #732]

sys/arch/powerpc/powerpc/fpu.c			1.39
sys/arch/powerpc/powerpc/powerpc_machdep.c	1.77

	Fix panics on machines without FPU.
	[rin, ticket #733]

sys/net/if_bridge.c				1.167,1.168

	bridge(4): disable two noisy debug messages.
	[rin, ticket #734]

sys/arch/powerpc/ibm4xx/trap.c			1.71-1.78

	Various fixes for powerpc/ibm4xx:
	- improve copyin() and copyout()
	- do not try to recovery from data page fault in interrupt context
	- comment out unused functions badaddr() and badaddr_read()
	- cleanup/cosmetic
	[rin, ticket #735]

lib/libpthread/arch/powerpc/pthread_md.h	1.8
sys/arch/powerpc/powerpc/sig_machdep.c		1.47

	Document how the initial MSR for lwps is set.
	Add a KASSERT validating the effective value.
	[rin, ticket #736]

sys/arch/powerpc/powerpc/locore_subr.S		1.60
sys/arch/powerpc/powerpc/trap.c			1.157

	Comment out do_ucas_32(), only user of which, _ucas_32(), is
	commented out since powerpc/trap.c rev 1.156.
	[rin, ticket #737]

usr.sbin/postinstall/postinstall.in		1.15

	PR install/54990: fix the fixup script to follow the URL change in
	/etc/motd (http->https).
	[nakayama, ticket #738]

sys/ufs/ufs/ufs_vnops.c				1.249

	Zero out the padding in 'd_namlen', to prevent info leaks.
	[maxv, ticket #739]

sys/external/bsd/drm2/dist/drm/radeon/radeon_irq_kms.c 1.5

	Take a mutex around mode config logic as the comment advises.
	[riastradh, ticket #740]

sys/compat/common/vfs_syscalls_43.c		1.65

	PR kern/55025: include all of the vfs syscalls in the syscall_package,
	not just oquota.
	[pgoyette, ticket #741]

sys/arch/arm/arm/cpufunc.c			1.176
sys/arch/arm/arm32/armv7_generic_space.c	1.11
sys/arch/arm/arm32/pmap.c			1.388
sys/arch/arm/conf/Makefile.arm			1.54 (via patch)
sys/arch/arm/include/arm32/pmap.h		1.161

	Fix the armv[67] memory attributes for uncached memory.
	Remove workaround for unaligned access faults.
	[skrll, ticket #742]

etc/rc.d/random_seed				1.8

	Allow random seed on zfs.
	[riastradh, ticket #743]

sys/arch/mips/adm5120/dev/ahci.c		1.18-1.20
sys/dev/ic/sl811hs.c				1.103
sys/dev/usb/ehci.c				1.270-1.273
sys/dev/usb/motg.c				1.26-1.33
sys/dev/usb/ohci.c				1.293-1.295
sys/dev/usb/uhci.c				1.289-1.293
sys/dev/usb/usb.c				1.181,1.182
sys/dev/usb/usbdi.c				1.190-1.192
sys/dev/usb/usbdi.h				1.99-1.101
sys/dev/usb/usbdivar.h				1.121,1.122
sys/dev/usb/xhci.c				1.116-1.118
sys/external/bsd/dwc2/dwc2.c			1.67-1.71
sys/external/bsd/dwc2/dwc2var.h			1.7

	Fix various race conditions in USB abort and timeout.
	[riastradh, ticket #744]

sys/dev/usb/umass.c				1.177-1.179

	Abort default pipe too on detach before detaching children.
	Consolidate logic to call the transfer callback.
	Make sure the umass transfer callback is run in error branches.
	[riastradh, ticket #745]

sys/ddb/db_lex.c				1.25

	Fix crash(8) prompt.
	[riastradh, ticket #746]

sys/dev/pci/if_mcx.c				1.11

	mcx(4): use 64-bit PCI DMA if available.
	[thorpej, ticket #747]

sys/dev/pci/ichsmb.c				1.61

	If attach fails, don't panic on detach.
	[riastradh, ticket #748]

sys/external/bsd/drm2/nouveau/nouveau_pci.c	1.25

	List the PCI ID range for new nvidia TU117 and TU116.
	Adjust the check to simply be >= 0x1580, which is the
	first pciid not supported. Fixes PR 54600.
	[mrg, ticket #749]

