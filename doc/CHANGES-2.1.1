#	$NetBSD: CHANGES-2.1.1,v 1.1.2.21 2006/01/09 13:31:06 tron Exp $

A complete list of changes from the NetBSD 2.1 release to the NetBSD 2.1.1
release

File						Revision(s)
----						--------
sys/sys/param.h                                 patch
share/tmac/doc-common                           patch
gnu/usr.bin/groff/tmac/mdoc.local               patch

	Welcome to 2.1.0_STABLE

doc/README.files				patch

	Update for release and new CHANGES file.

sys/netinet6/icmp6.c				1.111

	In icmp6_redirect_output(), sip6 is initialised to point to the
	data area of m0. But m0 may be freed later, so trying to use
	sip6 at the end of this function is wrong. My guess is that
	we want to reference the data area of m (the mbuf about to be
	send) instead at this point.  Fix a panic on Xen (where a data
	area of a mbuf may be unmapped when the mbuf is freed), and
	probably potential data/pool corruption in other cases.
	[bouyer, ticket #5938]

share/man/man4/fast_ipsec.4			1.2-1.3

	Fix Dd argument; new sentence, new line; sort sections;
	typo fixes.
	[jmc, ticket #5946]

distrib/sets/lists/base/md.ibmnws		delete
distrib/sets/lists/base/mi			1.576
distrib/sets/lists/man/md.ibmnws		delete
distrib/sets/lists/man/mi			1.835 via patch
gnu/usr.sbin/Makefile				1.14

	Build ncdcs on everything. Allows better set sharing (and
	we don't exclude other 'system specific' binaries from other
	builds ala sunlabel, etc), and nuke only md man page in existence,
	simplifying man.tgz set sharing.
	[jmc, ticket #5948]

sys/arch/sparc/sparc/cpu.c			1.193

	Compute c_totalsize for split caches correctly: it's max, not sum (and
	we even have that documented in cache.h).  Initialize c_nlines for
	split caches.
	This should fix srmmu cache flush routines for split I/D caches that
	has been broken since cache.c revision 1.79 started using c_nlines.
	[uwe, ticket #5950]

sys/kern/uipc_socket.c				1.112

	Check the argument to SO_LINGER.
	[nathanw, ticket #5939]

sys/kern/kern_exec.c				patch

	Don't clear unconditionally P_SUGID when we exec. Clear it only when
	the real and effective user and group ids match.
	[dan, ticket #5955]

dist/ntp/ntpd/ntpd.c				1.8

	Use group-id from ``gr'' and not ``pw''.
	Fixes security issue addressed by CAN-2005-2496.
	[dan, ticket #5958]

sys/dev/scsipi/scsipi_ioctl.c			1.54

	Don't claim there is a data in or out phase if the datalen is 0
	(userland shouldn't claim it either, but a buggy software shouldn't
	be able to crash the kernel anyway). Should fix port-sparc64/31925
	by Johan A.van Zanten (which should really be kern/31925).
	Analysed and patch tested by Martin Husemann.
	[bouyer, ticket #5961]

distrib/utils/sysinst/util.c			1.137

	Don't redisplay the title messages before displaying sub-menus
	during set selection (eg selecting the X sets).
	libcurses got changed earlier in the year so that the erase (and
	refresh) of the message window caused all the unchanged spaces
	to be redrawn overwriting most of the main set selection window.
	[dsl, ticket #5964]

sys/uvm/uvm_glue.c				1.90

	Remove the assertion in uvm_swapout_threads() about LSONPROC lwps
	not running on the same CPU as the swapper.  l_stat is protected by
	sched_lock, which isn't held here, so we can race with that lwp
	starting to run and see its l_cpu not updated yet, as in PR 31870.
	we check l_stat again in uvm_swapout() while holding sched_lock,
	so the race itself is harmless.
	[bouyer, ticket #5965]

sbin/newfs/mkfs.c				1.92

	don't set fs_maxsymlinklen and fs_old_inodefmt twice,
	we set them correctly the first time.  fixes PR 26995.
	[chs, ticket #5971]

sys/kern/vfs_vnops.c				1.99

	vput() -> vrele(). Vnode is already unlocked.
	With much help from Pavel Cahyna.  PR#32005
	[hannken, ticket #5983]

sys/miscfs/kernfs/kernfs_vnops.c		1.114 via patch

	Fix 64 bit truncation problem allowing to read arbitrary kernel memory.
	[christos, ticket #10155]

sys/nfs/nfs_bio.c				1.136-1.137 via patch

	The problem (kern/31926): under certain conditions, which could be
	reliably reproduced, NFS reads would occasionally return zeroes instead
	of some of the file data, or fail with EINVAL.
	[jld, ticket #8826]

sys/arch/sgimips/stand/sgivol/sgivol.c		1.10

	0 is a success code for ioctl().  Fixes install problem introduced by
	revision 1.9 last November.
	[tsutsui, ticket #10164]

sbin/fdisk/fdisk.c				1.82 via patch

	Fix intuit_translated_geometry() calculation. PR#26917.
	[tsutsui, ticket #10165]

sys/dev/ic/esiop.c				1.34 via patch
sys/dev/ic/esiopvar.h				1.13 via patch
sys/dev/ic/siop.c				1.79 via patch
sys/dev/ic/siopvar.h				1.22 via patch
sys/dev/ic/siopvar_common.h			1.33 via patch
sys/dev/microcode/siop/esiop.ss			1.20 via patch
sys/dev/microcode/siop/esiop.out		regen
sys/dev/microcode/siop/siop.ss			1.20 via patch
sys/dev/microcode/siop/siop.out			regen

	Some drives disconnect after the last data phase without a save
	data pointer message. In such case we would not update resid with
	the proper value (eventually resid would not be updated at all if
	there was only one data phase). To fix this, have the script save
	the offset in the data tables at disconnect time if there was a
	transfer, and use this to compute the resid if the current offset
	is 0.  Problem reported and patch tested by edwin, Roy Bixler and
	YAMAMOTO Takashi.  Fix kern/31990 by YAMAMOTO Takashi.
	[bouyer, ticket #10168]

sys/dev/ic/an.c					1.33 via patch
sys/dev/ic/anvar.h				1.9 via patch

	Fix two bugs: frames were bogusly discarded with the complaint
	"oversize frame."  Also, some an(4) instances (esp. w/ firmware
	version 5+) would not reliably interoperate with some Cisco APs.
	Thanks to Jim Miller for his valuable bug reports and testing, and
	to Dheeraj Reddy for RID-length patches.
	[jnemeth, ticket #10159]

sys/kern/kern_time.c				patch

	Avoid time wrap when setting the system time.
	[christos, ticket #10184]

build.sh					patch

	Clean up environment to avoid side effects on builds.
	[jmc, ticket #10194]

xsrc/xfree/xc/programs/xdm/config/Imakefile	1.6

	Fix the old native XFree86 release build broken by the pullup 978.
	PR#32214

        [tron, ticket #10185]

distrib/notes/mac68k/prep			1.14

	Add text for workaround of sysinst not running newfs etc. PR#29049
	[hubertf, ticket #10198]

sys/dev/ic/aic79xx_osm.c			1.13-1.14
sys/dev/ic/aic7xxx_osm.c			1.19-1.20
sys/dev/ic/aic79xx.c				1.32
sys/dev/ic/aic79xxvar.h				1.20
sys/dev/ic/aic7xxx.c				1.117
sys/dev/ic/aic7xxx_inline.h			1.7
sys/dev/ic/aic7xxxvar.h				1.50

	Don't call alloc_scb() (which can call bus_dmamem_alloc/map) from
	ADAPTER_REQ_RUN_XFER context (which can be interrupt context), defer 
	this to the ADAPTER_REQ_GROW_RESOURCES callback. Fixes a panic in uvm.
	[bouyer, ticket #10177]

sys/kern/kern_sig.c				1.211

	in kpsignal2(), do not try to wake up a cached LWP for SA processes
	in the case where we're sending SIGKILL but all LWPs are not signalable.
	some LWP will wake up soon enough to process the signal, and there may
	not be any LWPs in the cache to wake up anyway.  fixes PR 28886 and
	PR 26771.  also, add a missing "break" pointed out by yamt.
	[chs, ticket #10206]

sys/kern/vfs_subr.c				1.231

	Fix an annoying deadlock involving 3 separate processes.
	[chs, ticket #10207]

sys/fs/union/union_vfsops.c			1.32 via patch

	Change union_unmount() to not play with the fs root vnode explicitly.
	Let it get recycled along with all of the others. This is important
	as if the root vnode has already been reclaimed, then we get a panic
	when we try to vget it.  This addresses PR: kern/31382
	[wrstuden, ticket #10213]

sys/net/if_bridge.c				1.35

	Make sure we initialize all structs to 0.
	[christos, ticket #10219]

