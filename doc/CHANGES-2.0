#	$NetBSD: CHANGES-2.0,v 1.1.2.55 2004/04/07 21:43:48 jmc Exp $

A complete list of changes from the initial NetBSD 2.0 branch on 28 March 2004
until 2.0 release:

File						Revision(s)
----						--------
doc/LAST_MINUTE                                 patched by hand

        Null out in preparation for 2.0

share/tmac/doc-common                           patched by hand
sys/sys/param.h                                 patched by hand

        Update to 2.0_BETA

dist/ipf/tools/ipmon.c				1.3

	Don't create unnecessary ifdefs that are due to character signness in
	different platforms.
	[jmc, ticket #5]

usr.sbin/ipf/Makefile.inc			1.12
usr.sbin/ipf/ipf/Makefile			1.18
usr.sbin/ipf/ipfstat/Makefile			1.17
usr.sbin/ipf/ipftest/Makefile			1.25
usr.sbin/ipf/ipmon/Makefile			1.18
usr.sbin/ipf/ipnat/Makefile			1.20
usr.sbin/ipf/ippool/Makefile			1.4
usr.sbin/ipf/ipresend/Makefile			1.17
usr.sbin/ipf/ipsend/Makefile			1.20
usr.sbin/ipf/iptest/Makefile			1.16
usr.sbin/ipf/libipf/Makefile			1.2

	de-lint makefiles:
	* fix -j N parallel build issues
	* support MAKEVERBOSE
	* move NOxxx= to before <bsd.own.mk>
	* remove unnecessary -ll (except for ipsend)
	* remove unnecessary CPPFLAGS
	* only build libipf.a (we don't need libipf_p.a or libipf_pic.a)
	* fix dependencies upon libipf.a
	[martti, ticket #7]

usr.sbin/ipf/ipsend/Makefile			1.21

	Use iplang_l.l instead of iplang_l.c in SRCS, and tweak appropriately.
	[martti, ticket #8]

usr.bin/gzip/zdiff				1.3
usr.bin/gzip/zmore				1.3

	s/compress/gzip/, our compress is not the backend for gzip.
	[wiz, ticket #9]

sys/sys/param.h					patch by hand

	Note 2.0_BETA in the comments as osrelease.sh picks this up.
	[cube, ticket #11]

gnu/usr.bin/groff/tmac/mdoc.local		patch by hand
	
	This is the correct place to bump the default OS version now
	[wiz, private email]

gnu/lib/libgcc3/Makefile.inc			1.7

	Remove generated sources files "__gcc_bcmp.c", "_bb.c" and "_eprintf.c"
	in "cleandir" target.
	[tron, ticket #10]

distrib/utils/sysinst/msg.mi.fr			1.75

	Some minor fixes in text.
	[bouyer, ticket #12]

games/worms/worms.c				1.15

	Properly handle -d 1000.
	[hubertf, ticket #13]

sys/sys/userret.h				1.4

	Update comment to match reality:  sparc64 uses mi_userret.
	[cl, ticket #14]

sys/arch/powerpc/fpu/fpu_emu.c			1.11

	Make the "cond" variable an unsigned variable. PR#24938
	[simonb, ticket #18]

sys/compat/darwin/darwin_sysctl.c		1.24

	Fix undefined variable.
	[jmc, ticket #15]

share/mk/bsd.files.mk				1.34-1.35

	Include <bsd.sys.mk> because uue files need TOOL_UUDECODE and in the
	USETOOLS=no case this never gets defined.
	Also pull in bsd.obj.mk for something which is just using files to
	install a uuencoded file
	[jmc, ticket #16]

usr.sbin/ipf/ipf/Makefile			1.19
usr.sbin/ipf/ipftest/Makefile			1.26
usr.sbin/ipf/ipmon/Makefile			1.19
usr.sbin/ipf/ipnat/Makefile			1.21
usr.sbin/ipf/ippool/Makefile			1.5
usr.sbin/ipf/ipsend/Makefile			1.22

	Add -I. to CPPFLAGS or else the generated .c files lose.
	[jmc, ticket #19]

distrib/acorn32/stand/BtNetBSD/!BtNetBSD/Banner.uue	delete
distrib/acorn32/stand/BtNetBSD/!BtNetBSD/banner.uue	1.1
distrib/acorn32/stand/Makefile				1.11

	Rename Banner.uue to banner.uue so it doesn't lose on .PATH lookups
	[jmc, ticket #20]

distrib/hp300/miniroot/list			1.12

	Catch up with the removal of gawk, so that the miniroot builds again.
	[he, ticket #24]

usr.bin/gzip/gzip.c				1.30
usr.bin/gzip/unbzip2.c				1.2-1.3

	Patch to convert to using public bz interfaces. PR#24964
	[tron, ticket #21]

usr.bin/gzip/gzip.c				1.31

	Use off_t instead of ssize_t in a few places.
	Fix "gzip -l" in -DSMALL (it wasn't doing a stat(2)).
	[mrg, ticket #22]

sys/uvm/uvm_map.c				1.165

	uvm_map_findspace: don't return unaligned address if alignment is
	specified.
	[yamt, ticket #23]

usr.bin/find/find.1				1.48
usr.bin/find/find.c				1.19

	Do not skip whiteout files returned by fts_read(), which only returns
	them if requested. Patch from PR#5419.
	Mention -type w, which is coded as a synonym for W (whitespace).
	[heas, ticket #25]

usr.bin/calendar/calendars/calendar.birthday	1.16

	Tweak change for Asimov's entry some. Restore reference to
	Russian SFSR, but note that it's now Russia, not part of the USSR.
	[wrstuden, ticket #26]

crypto/dist/kame/racoon/isakmp.c		1.14

	Reject packet with too big isakmp message length field.
	[itojun, ticket #27]

sys/netinet/udp_usrreq.c			1.117-1.118

	Drop packet if IPv6 udp packet does not have checksum (checksum is
	mandatory in IPv6).
	[itojun, ticket #28]

sys/netinet/ip_compat.h				1.36

	Fix panics caused by IPFilter on most platforms.
	[mrg, ticket #32]


usr.sbin/wsmoused/wsmoused.conf.5		1.8

	Fix two typos. PR#22581
	[jmmv, ticket #29]

usr.sbin/apm/apm.8				1.17
usr.sbin/apm/apm.c				1.15

	Add missing m option in SYNOPSIS. 
	Remove duplicate d in getopt(3) call. PR#24971
	[tron, ticket #30]

usr.bin/rlogin/rlogin.c				1.30

	Drop some unnecessary whitespaces from the usage message. PR#24993
	[jmmv, ticket #31]

usr.bin/gzip/gzip.c				1.33-1.34

	Handle files with link count larger than 1 if -f option is used. 
	This is consistent with the old gzip and required by pkgsrc 
	to implement MANZ properly.
	[tron, ticket #33]

sys/netinet/ip_compat.h				1.37

	Only #define COPYIN copyin, et cetera, in the kernel.
	[mrg, ticket #34]

sys/dev/pci/auvia.c				1.37

	Don't allow block sizes < 288 bytes on VT823x chips. PR#22788
	[jmcneill, ticket #36]

sys/kern/kern_sysctl.c				1.170

	Add the standard "is this tree writeable" check to sysctl_describe()
	and a comment to sysctl_destroy() about why the check is slightly
	different there.
	[atatat, ticket #37]

gnu/dist/cvs/src/server.c			1.14

	Correctly fallback into the normal path when SETXID_SUPPORT is defined
	but the binary was the normal one.  Fixes PR#23471.
	[jmc, ticket #35]

sys/netinet/ip_fil_netbsd.c			1.4

	Untangle ioctl copyin/copyout confusion. IP-Filter now actually works
	on sparc64 (and probably everywhere else).
	[martin, ticket #39]

dist/ipf/tools/ipf_y.y				1.2

	ioctl(2) "request" arguments should be ioctlcmd_t, not u_int.
	[martin, ticket #40]

sys/kern/kern_ras.c				1.8-1.9

	ras_install: don't do pool_get(PR_WAITOK) while we're holding a
	             spinlock.
	ras_fork:    don't do PR_WAITOK holding a spinlock.
	[yamt, ticket #41]

usr.sbin/ipf/ipf/Makefile			1.20
usr.sbin/ipf/ipftest/Makefile			1.27
usr.sbin/ipf/ipmon/Makefile			1.20
usr.sbin/ipf/ipnat/Makefile			1.22
usr.sbin/ipf/ippool/Makefile			1.6
usr.sbin/ipf/ipsend/Makefile			1.23

	Simplify `bar.c: bar.y' (et al) rules by moving header dependencies
	which bar.o (not bar.c) needs to DPSRCS, and using {.ALLSRC} in the
	target now that only bar.y is a source.
	[lukem, ticket #42]

sys/dev/pci/pcidevs				1.616
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen

	Correct entry for PCI vendor id 0x11af. It is assigned to Avid 
	Technology Inc. and not to Pro-Log Corporation. PR#25004
	[tron, ticket #38]

sys/kern/kern_sig.c				1.190

	If a signal is the result of trap, only invoke a supplied handler
	if it's not blocked.  Otherwise (it if it blocked or the handler
	is set to SIG_IGN) reset the signal back to its default settings
	so that a coredump can be generated.
	[matt, ticket #43]

sys/arch/macppc/macppc/machdep.c		1.131
sys/arch/powerpc/oea/oea_machdep.c		1.16

	Move to softintr__init to cpu_startup and remove softintr__init call 
	for oea.
	[matt, ticket #44]

sys/dev/ic/i82557.c				1.82

	Be more careful about issuing CU_RESUME in fxp_start()--only doing
	it if we think it's probably necessary.  Then do it again in the
	tx interrupt handler, if we again think it's necessary.  This
	reduces the number of commands we issue the chip.  Prior to this
	change, the i82550 (running without extended feature set, so like
	a '559)  would sometimes fail in fxp_scb_wait() prior to issuing
	another CU_RESUME, resulting in
	        fxp0: WARNING: SCB timed out!
	messages on the console, often followed by device timeouts.
	[briggs, ticket #45]

sys/netinet/fil.c				1.62
sys/netinet/ip_lookup.c				1.2

	A few more ioctl vs. copyin changes, spotted by Bill Studenmund.
	[martin, ticket #46]

sys/arch/i386/stand/misc/Makefile		1.3
sys/arch/i386/stand/misc/pfdisk.doc.uue		1.1
sys/arch/i386/stand/misc/pfdisk.exe.uue		1.1
sys/arch/i386/stand/misc/pfdisk.gze		delete
sys/arch/i386/stand/misc/pfdisk.txt		delete
sys/arch/i386/stand/misc/pfdisktc.zip		delete
sys/arch/i386/stand/misc/pfdisktc.zip.uue	1.1
sys/arch/i386/stand/misc/rawr32.zip		delete
sys/arch/i386/stand/misc/rawr32.zip.uue		1.1
sys/arch/i386/stand/misc/rawr32src.zip		delete
sys/arch/i386/stand/misc/rawr32src.zip.uue	1.1
sys/arch/i386/stand/misc/rawrite.doc.uue	1.1
sys/arch/i386/stand/misc/rawrite.exe.uue	1.1
sys/arch/i386/stand/misc/rawrite.gze		delete
sys/arch/i386/stand/misc/rawrite.txt		delete

	Convert to using UUDECODE_FILES instead of using -kb in the repository.
	[lukem, ticket #47]

sys/dev/mvme/vme_two.c				1.4

	After re-checking the docs in response to a port-mvme68k question,
	don't claim to support D8 local-bus->VMEbus transfers.
	[scw, ticket #49]

usr.bin/fstat/fstat.c				1.66

	Fix fstat core dumps when some process holds a reference in a Linux
	ext2fs filesystem. PR#21301
	[aymeric, ticket #50]

xsrc/xfree/xc/fonts/util/bdftruncate.pl		1.4

	*shudder* install perl scripts... perhaps we shouldn't, but while we
	are, may as well give it a "#! /usr/bin/env perl" so it has a chance
	of working...  unfortunately, this even fixes PR#22578 ;-)
	[tron, ticket #48]

share/man/man4/options.4			1.233-1.234

	Document BEEP_ONHALT{,COUNT,PITCH,PERIOD}.
	[jmmv, ticket #51]

gnu/usr.bin/send-pr/send-pr.sh		1.21-1.22

	use mktemp(1) for safe temp files.
	oops; exit on failure with the previous.
	Fixes PR#21840.
	[reed, ticket #52]

distrib/mvme68k/miniroot/list			1.14

	Adapt to the replacement of gawk with nawk, source accessible as awk.
	[he, ticket #53]

sys/dev/pci/emuxki.c				1.32
sys/dev/pci/joy_pci.c				1.8
sys/dev/pci/pcidevs				1.618
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen

	Added another SB Live! 5.1 soundcard and joystick version
	[martti, ticket #54]

sys/kern/kern_sig.c				1.191-1.193
sys/sys/siginfo.h				1.12

	Replace memset's of ksiginfo_t with KSI_INIT (which is the proper way 
	to initialize ksiginfo_t structures).
	Add the notion of an "empty" ksiginfo_t (one where on signo is filled 
	in).
	Add an initializer for them: KSI_INIT_EMPTY
	Add a predicate for them: KSI_EMPTY_P
	Don't bother storing empty ksiginfo_t's since they have no information.
	Change uses of KSI_INIT to KSI_INIT_EMPTY where no other information 
	other than the signo is being filled in.
	When a process is being traced (debugged) and a catchable signal 
	arrives, make sure to save its ksiginfo_t for eventual delivery.
	This makes debugging SA_SIGINFO signal handlers work.
	[matt, ticket #56]

usr.sbin/ipf/Makefile.inc			1.13
usr.sbin/ipf/ipfstat/Makefile			1.18
usr.sbin/ipf/ipnat/Makefile			1.23
usr.sbin/ipf/ippool/Makefile			1.7

	Move kvm library spec to Makefile.inc, so that it gets specified
	after the ipf library, since the ipf library depends on some functions
	from the kvm library.
	Fixes a build problem observed when building for sun2 (though I
	won't claim understanding why this doesn't show up elsewhere).
	[he, ticket #57]

sys/arch/i386/stand/misc/Makefile		1.5

	Fix uudecoding of object files.
	[groo, ticket #58]

sys/dev/pci/if_bge.c				1.67

	Fix mistaken arguments to bge_set_thresh(); the prior revision would
	pass the bge_softc * to a function expecting the struct ifnet*,
	triggering a panic every time the Rx-mitigation value is changed via
	sysctl.
	[jonathan, ticket #59]

sys/arch/sparc64/dev/pci_machdep.c		1.46

	OF_getprop can get only the first "reg" property with a statically
	allocated buffer, but prom_getprop cannot.
	This should fix a "kernel trap 30: data access exception" when you
	invoke a pcictl(8).
	[nakayama, ticket #60]

dist/dhcp/includes/cf/netbsd.h			1.4

	"gcc -m32 -mcpu=ultrasparc" defines __sparc_v9__, so __sparc64__ is
	more appropriate to indicate a 64-bit environment.
	[nakayama, ticket #61]

sys/arch/macppc/conf/GENERIC			1.173

	Enable "INSECURE" kernel option so that GENERIC kernels are capable of
	running XF4 servers.  while this isn't the best solution, it is the
	only one we have for the forseeable future, and there is long-standing
	precedent in the i386 port.
	[mrg, ticket #64]

sys/arch/i386/i386/identcpu.c			1.11

	- fix i386_intel_brand[]: it was missing a empty reserved entry at 0xD
	  causing Mobile Pentium 4 to be shown as a Mobile Celeron.
	- fix intel_family6_name() for brand=0xB && signature >= 0xF13
	- fix a potential out-of-bounds array reference
	[mrg, ticket #65]

xfree/xc/programs/xdm/config/Imakefile		1.2

	Provide a default tty under NetBSD-amd64, too. PR#25060
	[tron, ticket #63]

etc/rc.d/ipmon					1.11
etc/defaults/rc.conf				1.57

	Move ipmon's "-D" argument from "command_args" to "ipmon_flags" so that
	passing an (optional) filename argument (that must come last) works fine
	from $ipmon_flags. PR#25006
	[mrg, ticket #66]

distrib/sets/lists/xserver/md.sgimips		1.5

	Add mmapw - mmapr is already there.
	[hubertf, ticket #67]

usr.bin/lex/gen.c				1.18

	Typo in debugging output. PR#25065
	[christos, ticket #68]

sys/netinet/tcp_subr.c				1.161

	Invoking tcpcb's get erroneously free'd resulting in to_ticks <= 0 
	assertion.  PR#22551
	[christos, ticket #69]

sys/dev/ic/com.c				1.225

	Fix race condition introduced in rev 1.189; after the change, if there 
	is THRE interrupt occurs between the LSR read and IIR read, we won't 
	see the LSR_TXRDY bit when testing it in the variable 'lsr' and we 
	don't get interrupted again (as the corresponding bit in the IIR is 
	cleared by reading, except for some broken devices). PR#25010
	[enami, ticket #70]

dist/dhcp/includes/cf/netbsd.h			1.5

	Use _LP64 to indicate 64-bit platform.
	[nakayama, ticket #71]

x11/bin/xdm/config/Makefile			1.6
	mirror change in Imakefiles:  provide DEFAULTVT=vt05 for amd64 as well.
	[mrg, ticket #72]

xsrc/xfree/xc/programs/xdm/sessreg.c		1.2
	Add support for utmpx in current (since 1.6C).  OKed by tron.
	[markd, ticket #73]

gnu/dist/gdb/sim/ppc/emul_netbsd.c		1.2
gnu/dist/gdb/sim/ppc/hw_htab.c			1.2
gnu/dist/gdb/sim/ppc/hw_init.c			1.2
gnu/dist/gdb/sim/ppc/hw_register.c		1.2
gnu/dist/gdb/sim/ppc/hw_trace.c			1.2
gnu/dist/gdb/sim/ppc/hw_vm.c			1.2
gnu/dist/gdb/sim/ppc/ppc-instructions		1.2
gnu/dist/gdb/sim/ppc/sim_calls.c		1.2
gnu/usr.bin/gdb53/Makefile			1.3
gnu/usr.bin/gdb53/arch/powerpc/defs.mk		1.3
gnu/usr.bin/gdb53/arch/powerpc/init.c		1.4
gnu/usr.bin/gdb53/gdb/Makefile			1.7
gnu/usr.bin/gdb53/sim/Makefile			0-1.1
gnu/usr.bin/gdb53/sim/arch/powerpc/config.h	0-1.1
gnu/usr.bin/gdb53/sim/arch/powerpc/subdir.mk	0-1.1
gnu/usr.bin/gdb53/sim/ppc/Makefile		0-1.2
gnu/usr.bin/gdb53/sim/ppc/psim/Makefile		0-1.1
gnu/usr.bin/sim/Makefile			1.4-0
gnu/usr.bin/sim/arch/powerpc/config.h		1.1-0
gnu/usr.bin/sim/arch/powerpc/subdir.mk		1.1-0
gnu/usr.bin/sim/ppc/Makefile			1.7-0
gnu/usr.bin/sim/ppc/psim/Makefile		1.2-0

	Restore some functionality that was lost in the gdb5.3 upgrade.
	[mrg, ticket #62]

sys/dev/hpc/hpckbdkeymap.h			1.27

	Give the MobilePro 800 and MobilePro 880 correct keymaps:  fix the
	positioning of the cursor keys to match the keycaps, and make the cmdmap
	work correctly.
	[tv, ticket #74]

sys/arch/hpcmips/conf/Makefile.hpcmips.inc	1.2

	Allow the codegen option to be specified in the config file rather than
	being fixed at -mips2, by setting "makeoptions MIPSFLAGS"

	[tv, ticket #75]

sys/arch/hpcmips/dev/mq200debug.c		1.3

	Allow compilation without MQ200_DEBUG:  mq200_clknames is used outside 
	of debugging-only code.
	[tv, ticket #76]

sys/kern/kern_sysctl.c				1.171

	First caller to set a description on a node sets it.  This allows one
	setup function to set the description, even if the node has been
	instantiated elsewhere.  Or not, depending on the other that the setup
	functions are called.
	[atatat, ticket #77]

share/termcap/termcap.src			1.89

	Move the attribute end escape sequence to the start of the xterm
	initialisation sequence capability. PR#11052
	[jdc, ticket #78]

usr.bin/tput/tput.1				1.13

	Note in the BUGS section that some termcap entries don't have
	reset capabilities, so use init instead. PR#11052

	[jdc, ticket #79]

share/termcap/termcap.src			1.90

	Add termcap entry for Olivetti M10 and compatibles. PR#17739
	[jdc, ticket #80]

sbin/sysctl/sysctl.c				1.87

	Add -d flag to usage message(s).
	[atatat, ticket #81]

usr.bin/gzip/gzip.c				1.32

	Factor out filetype checking code
	[mrg, ticket #82]

usr.bin/gzip/gzip.c				1.35

	Completely rewrite print_ratio(). 
	print_list() was getting the compressed/uncompressed sizes backwards.
	PR#25072
	[mrg, ticket #83]

dist/ipf/tools/ipfstat.c			1.3

	Incorrect conditional -- misplaced ]. PR#25097
	[christos, ticket #84]
