#	$NetBSD: CHANGES-2.0,v 1.1.2.34 2004/04/05 06:36:47 jdc Exp $

A complete list of changes from the initial NetBSD 2.0 branch on 28 March 2004
until 2.0 release:

File						Revision(s)
----						--------
doc/LAST_MINUTE                                 patched by hand

        Null out in preparation for 2.0

share/tmac/doc-common                           patched by hand
sys/sys/param.h                                 patched by hand

        Update to 2.0_BETA

dist/ipf/tools/ipmon.c				1.3

	Don't create unnecessary ifdefs that are due to character signness in
	different platforms.
	[jmc, ticket #5]

usr.sbin/ipf/Makefile.inc			1.12
usr.sbin/ipf/ipf/Makefile			1.18
usr.sbin/ipf/ipfstat/Makefile			1.17
usr.sbin/ipf/ipftest/Makefile			1.25
usr.sbin/ipf/ipmon/Makefile			1.18
usr.sbin/ipf/ipnat/Makefile			1.20
usr.sbin/ipf/ippool/Makefile			1.4
usr.sbin/ipf/ipresend/Makefile			1.17
usr.sbin/ipf/ipsend/Makefile			1.20
usr.sbin/ipf/iptest/Makefile			1.16
usr.sbin/ipf/libipf/Makefile			1.2

	de-lint makefiles:
	* fix -j N parallel build issues
	* support MAKEVERBOSE
	* move NOxxx= to before <bsd.own.mk>
	* remove unnecessary -ll (except for ipsend)
	* remove unnecessary CPPFLAGS
	* only build libipf.a (we don't need libipf_p.a or libipf_pic.a)
	* fix dependencies upon libipf.a
	[martti, ticket #7]

usr.sbin/ipf/ipsend/Makefile			1.21

	Use iplang_l.l instead of iplang_l.c in SRCS, and tweak appropriately.
	[martti, ticket #8]

usr.bin/gzip/zdiff				1.3
usr.bin/gzip/zmore				1.3

	s/compress/gzip/, our compress is not the backend for gzip.
	[wiz, ticket #9]

sys/sys/param.h					patch by hand

	Note 2.0_BETA in the comments as osrelease.sh picks this up.
	[cube, ticket #11]

gnu/usr.bin/groff/tmac/mdoc.local		patch by hand
	
	This is the correct place to bump the default OS version now
	[wiz, private email]

gnu/lib/libgcc3/Makefile.inc			1.7

	Remove generated sources files "__gcc_bcmp.c", "_bb.c" and "_eprintf.c"
	in "cleandir" target.
	[tron, ticket #10]

distrib/utils/sysinst/msg.mi.fr			1.75

	Some minor fixes in text.
	[bouyer, ticket #12]

games/worms/worms.c				1.15

	Properly handle -d 1000.
	[hubertf, ticket #13]

sys/sys/userret.h				1.4

	Update comment to match reality:  sparc64 uses mi_userret.
	[cl, ticket #14]

sys/arch/powerpc/fpu/fpu_emu.c			1.11

	Make the "cond" variable an unsigned variable. PR#24938
	[simonb, ticket #18]

sys/compat/darwin/darwin_sysctl.c		1.24

	Fix undefined variable.
	[jmc, ticket #15]

share/mk/bsd.files.mk				1.34-1.35

	Include <bsd.sys.mk> because uue files need TOOL_UUDECODE and in the
	USETOOLS=no case this never gets defined.
	Also pull in bsd.obj.mk for something which is just using files to
	install a uuencoded file
	[jmc, ticket #16]

usr.sbin/ipf/ipf/Makefile			1.19
usr.sbin/ipf/ipftest/Makefile			1.26
usr.sbin/ipf/ipmon/Makefile			1.19
usr.sbin/ipf/ipnat/Makefile			1.21
usr.sbin/ipf/ippool/Makefile			1.5
usr.sbin/ipf/ipsend/Makefile			1.22

	Add -I. to CPPFLAGS or else the generated .c files lose.
	[jmc, ticket #19]

distrib/acorn32/stand/BtNetBSD/!BtNetBSD/Banner.uue	delete
distrib/acorn32/stand/BtNetBSD/!BtNetBSD/banner.uue	1.1
distrib/acorn32/stand/Makefile				1.11

	Rename Banner.uue to banner.uue so it doesn't lose on .PATH lookups
	[jmc, ticket #20]

distrib/hp300/miniroot/list			1.12

	Catch up with the removal of gawk, so that the miniroot builds again.
	[he, ticket #24]

usr.bin/gzip/gzip.c				1.30
usr.bin/gzip/unbzip2.c				1.2-1.3

	Patch to convert to using public bz interfaces. PR#24964
	[tron, ticket #21]

usr.bin/gzip/gzip.c				1.31

	Use off_t instead of ssize_t in a few places.
	Fix "gzip -l" in -DSMALL (it wasn't doing a stat(2)).
	[mrg, ticket #22]

sys/uvm/uvm_map.c				1.165

	uvm_map_findspace: don't return unaligned address if alignment is
	specified.
	[yamt, ticket #23]

usr.bin/find/find.1				1.48
usr.bin/find/find.c				1.19

	Do not skip whiteout files returned by fts_read(), which only returns
	them if requested. Patch from PR#5419.
	Mention -type w, which is coded as a synonym for W (whitespace).
	[heas, ticket #25]

usr.bin/calendar/calendars/calendar.birthday	1.16

	Tweak change for Asimov's entry some. Restore reference to
	Russian SFSR, but note that it's now Russia, not part of the USSR.
	[wrstuden, ticket #26]

crypto/dist/kame/racoon/isakmp.c		1.14

	Reject packet with too big isakmp message length field.
	[itojun, ticket #27]

sys/netinet/udp_usrreq.c			1.117-1.118

	Drop packet if IPv6 udp packet does not have checksum (checksum is
	mandatory in IPv6).
	[itojun, ticket #28]

sys/netinet/ip_compat.h				1.36

	Fix panics caused by IPFilter on most platforms.
	[mrg, ticket #32]


usr.sbin/wsmoused/wsmoused.conf.5		1.8

	Fix two typos. PR#22581
	[jmmv, ticket #29]

usr.sbin/apm/apm.8				1.17
usr.sbin/apm/apm.c				1.15

	Add missing m option in SYNOPSIS. 
	Remove duplicate d in getopt(3) call. PR#24971
	[tron, ticket #30]

usr.bin/rlogin/rlogin.c				1.30

	Drop some unnecessary whitespaces from the usage message. PR#24993
	[jmmv, ticket #31]

usr.bin/gzip/gzip.c				1.33-1.34

	Handle files with link count larger than 1 if -f option is used. 
	This is consistent with the old gzip and required by pkgsrc 
	to implement MANZ properly.
	[tron, ticket #33]

sys/netinet/ip_compat.h				1.37

	Only #define COPYIN copyin, et cetera, in the kernel.
	[mrg, ticket #34]

sys/dev/pci/auvia.c				1.37

	Don't allow block sizes < 288 bytes on VT823x chips. PR#22788
	[jmcneill, ticket #36]

sys/kern/kern_sysctl.c				1.170

	Add the standard "is this tree writeable" check to sysctl_describe()
	and a comment to sysctl_destroy() about why the check is slightly
	different there.
	[atatat, ticket #37]

gnu/dist/cvs/src/server.c			1.14

	Correctly fallback into the normal path when SETXID_SUPPORT is defined
	but the binary was the normal one.  Fixes PR#23471.
	[jmc, ticket #35]

sys/netinet/ip_fil_netbsd.c			1.4

	Untangle ioctl copyin/copyout confusion. IP-Filter now actually works
	on sparc64 (and probably everywhere else).
	[martin, ticket #39]

dist/ipf/tools/ipf_y.y				1.2

	ioctl(2) "request" arguments should be ioctlcmd_t, not u_int.
	[martin, ticket #40]

sys/kern/kern_ras.c				1.8-1.9

	ras_install: don't do pool_get(PR_WAITOK) while we're holding a
	             spinlock.
	ras_fork:    don't do PR_WAITOK holding a spinlock.
	[yamt, ticket #41]

usr.sbin/ipf/ipf/Makefile			1.20
usr.sbin/ipf/ipftest/Makefile			1.27
usr.sbin/ipf/ipmon/Makefile			1.20
usr.sbin/ipf/ipnat/Makefile			1.22
usr.sbin/ipf/ippool/Makefile			1.6
usr.sbin/ipf/ipsend/Makefile			1.23

	Simplify `bar.c: bar.y' (et al) rules by moving header dependencies
	which bar.o (not bar.c) needs to DPSRCS, and using {.ALLSRC} in the
	target now that only bar.y is a source.
	[lukem, ticket #42]

sys/dev/pci/pcidevs				1.616
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen

	Correct entry for PCI vendor id 0x11af. It is assigned to Avid 
	Technology Inc. and not to Pro-Log Corporation. PR#25004
	[tron, ticket #38]

sys/kern/kern_sig.c				1.190

	If a signal is the result of trap, only invoke a supplied handler
	if it's not blocked.  Otherwise (it if it blocked or the handler
	is set to SIG_IGN) reset the signal back to its default settings
	so that a coredump can be generated.
	[matt, ticket #43]

sys/arch/macppc/macppc/machdep.c		1.131
sys/arch/powerpc/oea/oea_machdep.c		1.16

	Move to softintr__init to cpu_startup and remove softintr__init call 
	for oea.
	[matt, ticket #44]

sys/dev/ic/i82557.c				1.82

	Be more careful about issuing CU_RESUME in fxp_start()--only doing
	it if we think it's probably necessary.  Then do it again in the
	tx interrupt handler, if we again think it's necessary.  This
	reduces the number of commands we issue the chip.  Prior to this
	change, the i82550 (running without extended feature set, so like
	a '559)  would sometimes fail in fxp_scb_wait() prior to issuing
	another CU_RESUME, resulting in
	        fxp0: WARNING: SCB timed out!
	messages on the console, often followed by device timeouts.
	[briggs, ticket #45]

sys/netinet/fil.c				1.62
sys/netinet/ip_lookup.c				1.2

	A few more ioctl vs. copyin changes, spotted by Bill Studenmund.
	[martin, ticket #46]

sys/arch/i386/stand/misc/Makefile		1.3
sys/arch/i386/stand/misc/pfdisk.doc.uue		1.1
sys/arch/i386/stand/misc/pfdisk.exe.uue		1.1
sys/arch/i386/stand/misc/pfdisk.gze		delete
sys/arch/i386/stand/misc/pfdisk.txt		delete
sys/arch/i386/stand/misc/pfdisktc.zip		delete
sys/arch/i386/stand/misc/pfdisktc.zip.uue	1.1
sys/arch/i386/stand/misc/rawr32.zip		delete
sys/arch/i386/stand/misc/rawr32.zip.uue		1.1
sys/arch/i386/stand/misc/rawr32src.zip		delete
sys/arch/i386/stand/misc/rawr32src.zip.uue	1.1
sys/arch/i386/stand/misc/rawrite.doc.uue	1.1
sys/arch/i386/stand/misc/rawrite.exe.uue	1.1
sys/arch/i386/stand/misc/rawrite.gze		delete
sys/arch/i386/stand/misc/rawrite.txt		delete

	Convert to using UUDECODE_FILES instead of using -kb in the repository.
	[lukem, ticket #47]

sys/dev/mvme/vme_two.c				1.4

	After re-checking the docs in response to a port-mvme68k question,
	don't claim to support D8 local-bus->VMEbus transfers.
	[scw, ticket #49]

usr.bin/fstat/fstat.c				1.66

	Fix fstat core dumps when some process holds a reference in a Linux
	ext2fs filesystem.
	[aymeric, ticket #50]

xsrc/xfree/xc/fonts/util/bdftruncate.pl		1.4

	*shudder* install perl scripts... perhaps we shouldn't, but while we
	are, may as well give it a "#! /usr/bin/env perl" so it has a chance
	of working...  unfortunately, this even fixes PR#22578 ;-)
	[tron, ticket #48]

share/man/man4/options.4			1.233-1.234

	Document BEEP_ONHALT{,COUNT,PITCH,PERIOD}.
	[jmmv, ticket #51]

gnu/usr.bin/send-pr/send-pr.sh		1.21-1.22

	use mktemp(1) for safe temp files.
	oops; exit on failure with the previous.
	Fixes PR#21840.
	[reed, ticket #52]
