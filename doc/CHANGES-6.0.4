# $NetBSD: CHANGES-6.0.4,v 1.1.2.7 2013/12/14 19:37:40 bouyer Exp $

A complete list of changes from the NetBSD 6.0.3 release to the NetBSD 6.0.4
release:

doc/README.files				patched by hand
gnu/usr.bin/groff/tmac/mdoc.local		patched by hand
sys/sys/param.h					patched by hand

	Welcome to 6.0.3_PATCH.
	[jdc]

xsrc/external/mit/xorg-server/dist/dix/dixfonts.c	1.2
xsrc/xfree/xc/programs/Xserver/dix/dixfonts.c		1.4

	Fix CVE-2013-4396 using a patch from Alan Coopersmith:
	Save a pointer to the passed in closure structure before copying it
	and overwriting the *c pointer to point to our copy instead of the
	original.  If we hit an error, once we free(c), reset c to point to
	the original structure before jumping to the cleanup code that
	references *c.
	[spz, ticket #966]

sys/arch/x86/pci/pci_machdep.c			1.61 via patch

	Force PCI mode 1 when running under QEMU, to work around
	QEMU bug 897771.
	This should also make it possible to boot NetBSD under versions of KVM
	that have inherited said QEMU bug.  Fixes PR kern/45671.
	[gson, ticket #963]

sys/netinet/tcp_usrreq.c			1.168

	PR/48098: Brian Marcotte: Avoid kernel assertion for embryonic sockets
	that don't have credentials yet.
	[spz, ticket #967]

external/mit/xorg/server/drivers/xf86-video-intel/Makefile 1.11

	Add missing i810_dri.c file to SRCS.
	PR xsrc/48315.
	[martin, ticket #971]

distrib/utils/sysinst/mbr.c			1.92

	Add missing braces, which caused the offset of MBR partition 0 to be
	unintentionally set to 2048 even on small (<=128GB) disks.
	PR/48304.
	[tsutsui, ticket #972]

sys/arch/xen/xen/xbdback_xenbus.c		1.58

	Fix a dom0 panic, or crash with a hypervisor panic, when creating
	some domUs (domUs where the frontend driver doesn't provide a
	"protocol" entry in the xenstore).
	[bouyer, ticket #974]

libexec/ld.elf_so/tls.c				1.9
tests/lib/libc/tls/dso/h_tls_dlopen.c		1.5

	Only initialise TLS space from the PT_TLS segment, if the size is
	positive and the offset has been computed. Fixes PR lib/48324.
	[joerg, ticket #976]

usr.sbin/npf/npfctl/npf_ncgen.c			patch
sys/net/npf/npf_instr.c				patch

	fix the byteorder for port range comparison
	[rmind, ticket #986]

sys/kern/uipc_socket.c				1.220

	PR/48098: Brian Marcotte:
	panic: kernel diagnostic assertion "cred != NULL":
	Fix from Michael van Elst, tcpdrop crashes kernel on
	ebryonic connections.
	[spz, ticket #988]

sys/uvm/uvm_km.c				1.125

	uvm_km_kmem_alloc: don't hardcode kmem_va_arena. This could lead to
	freeing to the wrong vmem arena in case of failed page allocations.
	[para, ticket #989]

sys/arch/sparc64/sparc64/locore.s		1.350

	Increase an interrupt depth only in the case of hardware interrupts,
	and remove the ci_idepth trick in softint_fastintr.
	Fixes the following diagnostic panic reported in port-sparc64.
	  panic: kernel diagnostic assertion "!cpu_intr_p()" failed: file
	  "../../../../kern/subr_xcall.c", line 351
	[nakayama, ticket #994]

sys/kern/uipc_syscalls.c			1.163

	PR/47591: Michael Plass: If the unix socket is closed before accept,
	unp->unp_conn will be NULL in PRU_ACCEPT, as called from
	sys_accept->so_accept. This will cause the usrreq to return with
	no error, leaving the mbuf gotten from m_get() with an uninitialized
	length, containing junk from a previous call. Initialize m_len to
	be 0 to handle this case. 
	[spz, ticket #996]

