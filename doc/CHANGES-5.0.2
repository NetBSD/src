# $NetBSD: CHANGES-5.0.2,v 1.1.2.10 2009/09/05 13:18:33 bouyer Exp $

A complete list of changes from the NetBSD 5.0.1 release to the NetBSD 5.0.2
release:

gnu/usr.bin/groff/tmac/mdoc.local		patched by hand
sys/sys/param.h					patched by hand

	Welcome to 5.0.1_PATCH.
	[snj]

lib/libevent/Makefile				1.6 via patch

	Problems have been observed with GCC 4 and strict-aliasing in
	the libevent code.  Add -fno-strict-aliasing to work around this.
	[tls, ticket #876]

doc/CHANGES					patch
doc/3RDPARTY					patch
external/bsd/dhcpcd/dist/client.c		patch
external/bsd/dhcpcd/dist/config.h		patch
external/bsd/dhcpcd/dist/configure.c		patch
external/bsd/dhcpcd/dist/dhcp.c			patch
external/bsd/dhcpcd/dist/dhcp.h			patch
external/bsd/dhcpcd/dist/dhcpcd-run-hooks.8.in	patch
external/bsd/dhcpcd/dist/dhcpcd.8.in		patch
external/bsd/dhcpcd/dist/dhcpcd.c		patch
external/bsd/dhcpcd/dist/dhcpcd.conf.5.in	patch
external/bsd/dhcpcd/dist/net.c			patch
external/bsd/dhcpcd/dist/net.h			patch
external/bsd/dhcpcd/dist/signals.c		patch

	Update dhcpcd to 4.0.14.
	[roy, ticket #880]

sys/ufs/ufs/ufs_quota.c				1.63, 1.65

	Add missing mutex_destroy() before pool_cache_put(). Prevents
	a "Mutex error: lockdebug_alloc: already initialized" panic.
	[bouyer, ticket #898]

sys/netipsec/ipsec.c				1.46

	Add a missing splx() call. Fixes PR kern/41701.
	[jakllsch, ticket #884]

sys/dev/pci/twa.c				1.32

	Disable completely bogus DIAGNOSTIC check.
	[bouyer, ticket #886]

bin/pax/options.c				1.105
dist/nawk/maketab.c				1.12
dist/nawk/proctab.c				1.11
dist/nawk/proto.h				1.9
dist/nawk/run.c					1.29
usr.bin/ctags/C.c				1.19
usr.bin/ctags/ctags.h				1.9
usr.bin/ctags/fortran.c				1.11
usr.bin/ctags/lisp.c				1.11
usr.bin/ctags/print.c				1.10
usr.bin/ctags/yacc.c				1.12
usr.bin/gencat/gencat.c				1.30

	Rename internal getline() function to get_line() so it does
	not conflict with -current's getline(3) libc function.
	[roy, ticket #885]

sbin/ifconfig/parse.c				1.14

	Both carp.c and vlan.c expect for a keyword with a KW_T_STR-type
	value to put a prop_string_t into the environment, but the
	keyword parser put a prop_data_t into the environment, instead.
	That broke the -vlanif and -carpdev keywords and defied developer
	expectations.  Let's put a prop_string_t into the environment.
	[dyoung, ticket #878]

sbin/ifconfig/vlan.c				1.13

	Don't require a "vlan" argument with "-vlanif".  "ifconfig vlan0
	-vlanif" now works as one would expect.
	[dyoung, ticket #879]

sbin/dkctl/dkctl.8				1.19, 1.20
sbin/dkctl/dkctl.c				1.18

	In dkctl(8), list the partition types addwedge understands, so
	you don't need to utsl to find out what strings to use.  Fixes
	PR 37252

	Make dkctl conform to its man page and print the device name on
	addwedge when the addition was successful (as well as indicating
	success).
	[spz, ticket #887]

sys/dev/if_ndis/if_ndis.c			1.28
sys/dev/if_ndis/if_ndis_pci.c			1.16

	Make ndis actually compile.  Fixes PR/39034.
	[dsl, ticket #888]

sys/kern/kern_resource.c			1.152

	PR/41489: setpriority(2) returns EACCES instead of EPERM.
	Per discussion on the PR's audit trail, put back original checks
	for now.
	[dsl, ticket #893]

lib/libc/sys/semctl.2				1.18
lib/libc/sys/shmctl.2				1.20

	Fix pastos. PR 41605.
	[dholland, ticket #894]

sys/arch/amd64/amd64/trap.c			1.58
sys/arch/hp300/include/cpu.h			1.60
sys/arch/news68k/include/cpu.h			1.34
sys/arch/powerpc/powerpc/trap.c			1.130 via patch

	amd64: T_ASTFLT|T_USER: check for LP_OWEUPC in l_lpflag, not
	l_flag.  Also, flag unset was on p->p_flag.  Luckily, it did
	not corrupt the p_flag, because we don't have LW_ flag matching
	LP_OWEUPC.

	Fix a few more l_pflag and LP_OWEUPC confusions.
	[rmind, ticket #897]

sys/dev/ic/i82365.c				1.108

	Fix pcic kthread creation timing.  Fixes PR kern/41791 and
	PR port-hpcmips/41164.
	[jun, ticket #899]

lib/libc/gdtoa/gdtoaimp.h			1.7

	Change Kmax so we allocate enough freelist entries to handle
	large field numbers.
	[christos, ticket #913]

sys/arch/x86/pci/ichlpcib.c			1.18

	Fix watchdog code:
	- the timer bound constants are in tick, so convert period to
	tick before checking it against the bounds
	- for ICH5 or older, fix code that would have always written a 0
	period to the register.
	[bouyer, ticket #912]

lib/libc/gen/fts.c				1.38

	Avoid possible integer overflow on really deep dirs,
	and subsequent collateral damage.
	Received from OpenBSD via US-CERT as VU #590371.
	[christos, ticket #915]

sys/arch/macppc/dev/pbms.c			1.8

	- Use device_private() (led to immediate crash during attach)
	- While there, fix the aspect ratio of the trackpad on the
	geyser2 model
	[aymeric, ticket #916]

sbin/tunefs/tunefs.c				1.40

	Fix pasto: UFS_WAPBL_FLAGS_CREATE_LOG is "create-log" not
	"clear-log"
	[bouyer, ticket #917]

sys/arch/hpcmips/vr/vr.c			1.54

	Fix PR port-hpcmips/41863, Missing "}".
	[jun, ticket #918]

usr.bin/mixerctl/mixerctl.1			1.24

	Fix markup.
	[joerg, ticket #919]

share/man/man4/bcsp.4				1.4, 1.5
share/man/man4/btuart.4				1.7-1.9

	Fix some small nits and mention how to configure the tty line
	as a bluetooth device
	[plunky, ticket #926]

etc/ssh/ssh_known_hosts				1.5

	Update and add some TNF ssh keys.
	[spz, ticket #930]

lib/libc/stdio/vfwprintf.c			1.16

	If the current locale doesn't define the 'thousands' grouping info
	then use sane defaults (',' every 3 digits).
	Fixes PR/40714
	[dsl, ticket #902]

sbin/fsck_ext2fs/main.c				1.33

	Ignore the "-P" option as intended to make this work with e.g.
	"fsck_flags=3D-pP" in "/etc/rc.conf".
	Patch supplied by Pierre Pronchery in PR bin/41490.
	[tron, ticket #914]

usr.bin/newsyslog/newsyslog.c			1.59

	Reset ziptype on each line. Failure to do this caused any log file to
	be compressed if it was listed after a line using Z or J flag.
	[manu, ticket #925]

usr.bin/netstat/netstat.1			1.52

	Fix typo
	[dholland, ticket #933]

usr.bin/chflags/chflags.1			1.18

	Add some markup to improve clarity.
	[dholland, ticket #934]

sys/dev/acpi/pckbc_acpi.c			1.32

	PR# port-i386/39671: panic while booting with an acpi kernel on a
	790GX board
	If the firmware describes duplicate keyboard controller nodes,
	don't panic when the driver fails to map registers.
	[jmcneill, ticket #939]

