# $NetBSD: CHANGES-8.3,v 1.1.2.22 2020/07/17 15:29:12 martin Exp $

A complete list of changes from the NetBSD 8.2 release to the NetBSD 8.3
release:

external/gpl2/groff/tmac/mdoc.local		patched by hand
sys/sys/param.h					patched by hand

	Welcome to 8.2_STABLE.
	[martin]

sys/dev/ic/spdmem.c				1.31-1.35
sys/dev/ic/spdmemvar.h				1.15,1.16

	- Print DDR3's row and column correctly.  
	- Use fine timebase parameters for time calculation on DDR3. This
	  change makes PC3-XXXX value more precisely on newer DDR3.
	- Calculate DDR3's tRAS correctly.
	- Fix spelling of symmetric. 
	[msaitoh, ticket #1528]

sys/dev/mii/miidevs				1.154, 1.162-1.167
sys/dev/mii/miidevs.h				regen 
sys/dev/mii/miidevs_data.h			regen
sys/dev/mii/atphy.c				1.28 via patch
sys/dev/mii/brgphy.c				1.87 via patch
sys/dev/mii/etphy.c				1.5, 1.6 via patch
sys/dev/mii/rdcphy.c				1.6, 1.8 via patch

	- Add support Broadcom BCM54213PE and some new RDC devices.
	- Rename RDC to xxRDC.
	- Use xxVIA instead of VIA.
	- etphy(4):
	  - Rename ET1011 to ET1011C and add ET1011 support.
	  - Use mii_phy_flowstatus() to reflect flow status from negotiated
	    result.
	- Use static.
	- KNF.
	[msaitoh, ticket #1529]

sys/arch/x86/x86/procfs_machdep.c		1.33-1.36  
sys/arch/x86/x86/tsc.c				1.40
sys/arch/x86/x86/specialreg.h			1.159-1.161
usr.sbin/cpuctl/arch/i386.c			1.109-1.110 via patch

	- Print avx512ifma, cqm_mbm_total, cqm_mbm_local, waitpkg, rdpru,
	  Fast Short Rep Mov(fsrm), AVX512_VP2INTERSECT, SERIALIZE and
	  TSXLDTRK.
	- Rename CPUID Fn8000_0007 %edx bit 8 from "TSC" to "ITSC"
	  (Invariant TSC) to avoid confusion.
	- Print CPUID 0x80000007 %edx on both Intel and AMD.
	- Remove ci_max_ext_cpuid from usr.sbin/cpuctl/arch/i386.c because it's 
	  the same as ci_cpuid_extlevel.
	- Use unsigned to avoid undefined behavior in procfs_getonefeatreg().
	[msaitoh, ticket #1529]

sys/netinet6/nd6_rtr.c				1.148

	PR kern/55091 and PR bin/54997:	fix default route selection.
	[kim, ticket #1531]

sys/dev/wsfb/genfb.c				1.72

	Get genfb's address offset correctly when the value >= 4G.
	[msaitoh, ticket #1532]

sys/arch/macppc/stand/ofwboot/Locore.c		1.34 (via patch)
sys/arch/powerpc/oea/ofw_consinit.c		1.18

	Fix booting with auto-boot == true on some macppc machines.
	[rin, ticket #1533]

lib/libc/sys/fdatasync.2			1.17
sys/kern/vfs_syscalls.c				1.544

	Allow fdatasync on non-writable fds (POSIX conformance fix).
	[gdt, ticket #1534]

sys/compat/ossaudio/ossaudio.c			1.83

	ossaudio: Avoid giving userland uninitialized memory.
	[maxv, ticket #1535]

etc/rc.d/network				1.75
share/man/man5/rc.conf.5			1.172

	Allow rc.conf to setup resolv.conf via resolvconf(8).
	[kim, ticket #1537]

etc/rc.d/network				1.77,1.78 (plus patch)
share/man/man5/ifconfig.if.5			1.19,1.20
usr.sbin/rtsold/rtsold.8			1.37-1.42

	Add an "rtsol" keyword to ifconfig.if for enabling IPv6 RS/RA.
	[kim, ticket #1538]

external/bsd/bind/include/config.h		(apply patch)

	Fix BIND configuration for big-endian hosts.
	This should make DNSSEC work on such hosts as well.
	[he, ticket #1539]

sys/arch/hp300/hp300/machdep.c			1.233

	Fix garbages in dmesg caused by uninitialized variables.
	[tsutsui, ticket #1540]

sys/dev/dkwedge/dk.c				1.98

	PR kern/55026: fix a race condition that could cause a crash
	on last close of a wedge.
	[maya, ticket #1541]

sys/arch/hppa/hppa/trap.c			1.115

	Fix incorrect KASSERT.
	[skrll, ticket #1542]

sys/kern/subr_cprng.c				1.34

	Disable rngtest on output of cprng_strong.
	[riastradh, ticket #1543]

games/fortune/strfile/strfile.c			1.39
games/fortune/unstr/unstr.c			1.15

	Fix potential buffer overflows in fortune tools.
	[nia, ticket #1544]

external/bsd/bind/dist/lib/isc/sha2.c		(apply patch)

	Fix a bug introduced when fixing alingment issues.
	[he, ticket #1545]

bin/rcp/rcp.c					1.50

	In sink(), upon error, avoid multiple replies to the source
	as this would lead to a desynchronization of the protocol and
	further files or directories to be ignored or corrupted.
	[aymeric, ticket #1546]

sys/arch/x86/pci/if_vmx.c			1.60

	Fix wrong logic to make the number of vmx(4) TX/RX queues a power
	of two.
	[yamaguchi, ticket #1547]

sys/kern/kern_time.c				1.204
sys/netinet/igmp.c				1.70

	Fix one byte kernel heap leak.
	Fix uninitialized memory access.
	[christos, ticket #1549]

sys/dev/usb/usb.c				1.187

	PR 55303: do not allow open of /dev/usb if there are no attached
	busses.
	[skrll, ticket #1551]

lib/libterminfo/curterm.c			1.14

	terminfo: test strlcpy result against space free, not string length.
	[roy, ticket #1552]

usr.sbin/bta2dpd/bta2dpd/bta2dpd.c		1.7

	Avoid running of the end of the array if a file cannot be opened.
	[nat, ticket #1553]

sys/arch/powerpc/oea/pmap.c			1.96

	Fix inconsistent KERNEL_LOCK state in pmap for powerpc/oea.
	[rin, ticket #1554]

sys/dev/sysmon/sysmon_envsys.c			1.145

	Do not queue sysmon refresh until the rndsource is attached.
	[riastradh, ticket #1555]

sys/kern/subr_pcu.c				1.22

	Relax KASSERT() in pcu_discard_all() to allow new LWPs to 
	gracefully exit when an error occurs in _lwp_create(2).
	[thorpej, ticket #1556]

sys/arch/mac68k/dev/ams.c			1.23

	Fix inverted Y-axis value passed to wsmouse_input(9).
	[tsutsui, ticket #1557]

sys/dev/usb/if_otus.c				1.45 via patch

	Stricter bounds check for some packet length we get from the usb chip,
	to make sure we do not corrupt kernel memory.
	Pointed out by Ilja Van Sprundel.
	[martin, ticket #1558]

sys/dev/usb/if_run.c				1.41

	Better bounds checking for oversized packets, to avoid kernel memory
	corruption. Pointed out by Ilja Van Sprundel.
	[martin, ticket #1559]

sys/arch/x86/x86/cpu_rng.c			1.16

	Use x86_read_psl/x86_disable_intr/x86_write_psl to defer interrupts.
	This avoids accidently enabling interrupts too early.
	[riastradh, ticket #1560]

usr.sbin/hdaudioctl/graph.c			1.5
usr.sbin/hdaudioctl/hdaudioctl.8		1.7
usr.sbin/hdaudioctl/hdaudioctl.c		1.3,1.4
usr.sbin/hdaudioctl/hdaudioctl.h		1.3

	Add show subcommand that displays the codec configuration in
	human-readable tabulated form.
	[sborrill, ticket #1561]

etc/mtree/special				1.170

	Fix /private/tmp mode to match etc/rc.d/perusertmp.
	[kim, ticket #1562]

sys/dev/acpi/acpi_display.c			1.18

	If possible leave brightness as set by firmware to avoid
	a black screen at boot time.
	[sborrill, ticket #1563]

usr.bin/w/w.c					1.85,1.86

	Fix domain stripping in host field output.
	[kim, ticket #1564]

usr.bin/w/w.c					1.87

	w(1): Fix host field output.
	[kim, ticket #1565]

sys/netinet/tcp_input.c				1.418 (via patch)

	- always set both ip and ip6, otherwise a kernel assertion
	  can be triggered
	- move alignment early so that we do less work
	[christos, ticket #1566]

lib/libcurses/ins_wch.c				1.15
lib/libcurses/ins_wstr.c			1.15
lib/libcurses/insch.c				1.26
lib/libcurses/insstr.c				1.8

	PR 55460: mvwins*(WINDOW *win, ...) functions - call wins* on win,
	not stdscr.
	[uwe, ticket #1567]

external/bsd/nvi/dist/vi/v_txt.c		1.7

	PR bin/55468: fix crash due to out-of-bounds access with Ctrl-W.
	[rin, ticket #1569]

external/bsd/dhcpcd/dist/hooks/01-test		(apply patch)

	Fix dhcpcd test not to require /usr.
	[roy, ticket #1570]

sys/dev/scsipi/scsiconf.c			1.288

	Continue scanning a SCSI bus when a LUN is reported not present.
	[kim, ticket #1571]

sys/dev/pci/vioscsi.c				1.22

	Fix off-by-one SCSI target reporting.
	[kim, ticket #1572]

sys/dev/usb/ualea.c				1.12

	Set up the USB xfer for every transfer, not just once in the attach
	function.
	[simonb, ticket #1573]

lib/libcurses/newwin.c				1.58

	PR 55484: newwin() - fix crash with negative ncols.
	[uwe, ticket #1574]

share/man/man8/man8.x86/boot.8			1.21
sys/arch/i386/stand/boot/boot2.c		1.74

	PR 55490: let the consdev command also set speed.
	[kim, ticket #1575]

sys/compat/common/uipc_syscalls_40.c		1.23
sys/compat/linux/common/linux_socket.c		1.150
sys/compat/linux32/common/linux32_socket.c	1.31
sys/net/if.c					1.479

	ioctl(SIOCGIFCONF): do not accept negative buffer length values.
	[msaitoh, ticket #1576]

