# $NetBSD: CHANGES-8.0,v 1.1.2.9 2017/06/14 04:58:28 snj Exp $

A complete list of changes from the initial NetBSD 8.0 branch on 2017-06-04
until the 8.0 release:

doc/CHANGES-8.0					patched by hand
doc/LAST_MINUTE					patched by hand
doc/README.files				patched by hand
external/gpl2/groff/tmac/mdoc.local		patched by hand
sys/sys/param.h					patched by hand

	Welcome to 8.0_BETA!

src/share/man/man9/fstrans.9			1.25
src/sys/kern/vfs_mount.c			1.66
src/sys/kern/vfs_subr.c				1.468
src/sys/kern/vfs_trans.c			1.46
src/sys/kern/vfs_vnode.c			1.94, 1.95, 1.96
src/sys/kern/vnode_if.c				1.105, 1.106
src/sys/kern/vnode_if.sh			1.65, 1.66
src/sys/kern/vnode_if.src			1.76
src/sys/miscfs/genfs/genfs_io.c			1.69
src/sys/miscfs/genfs/genfs_vnops.c		1.196, 1.197
src/sys/miscfs/genfs/layer_extern.h		1.40
src/sys/miscfs/genfs/layer_vfsops.c		1.51
src/sys/miscfs/genfs/layer_vnops.c		1.67
src/sys/miscfs/nullfs/null_vnops.c		1.42
src/sys/miscfs/overlay/overlay_vnops.c		1.24
src/sys/miscfs/umapfs/umap_vnops.c		1.60
src/sys/rump/include/rump/rumpvnode_if.h	1.29, 1.30
src/sys/rump/librump/rumpkern/emul.c		1.182
src/sys/rump/librump/rumpvfs/rumpvnode_if.c	1.29, 1.30
src/sys/sys/fstrans.h				1.11
src/sys/sys/vnode.h				1.278
src/sys/sys/vnode_if.h				1.100, 1.101
src/sys/sys/vnode_impl.h			1.14, 1.15
src/sys/ufs/lfs/lfs_pages.c			1.12

	Vnode state, lock and fstrans cleanup:
	- Rename vnode state "VS_ACTIVE" to "VS_LOADED" and add synthetic
	  state "VS_ACTIVE" to assert a loaded vnode with usecount > 0.

	- Redo FSTRANS in vnode_if.c and use it for VOP_LOCK and VOP_UNLOCK.

	- Cleanup the genfs lock operations.

	- Make "struct vnode_impl" member "vi_lock" a krwlock_t again.

	- Remove the lock type argument from fstrans_start and
	  fstrans_start_nowait,
	  remove now unused FSTRANS state "FSTRANS_SUSPENDING".
	[hannken, ticket #2]

sys/dev/ic/pl181.c				1.4
sys/dev/sdmmc/sdmmc_mem.c			1.57
sys/dev/sdmmc/sdmmcvar.h			1.24

	Give a hint to controllers in the command flags if we are performing a
	transfer with an SDHC capable card. If the controller needs to adjust
	command args, it can use this hint to understand how it is encoded.

	Re-introduce support for multi-block transfers and split transfers to
	fit within the 65535-byte limit.
	[jmcneill, ticket #3]

sys/arch/evbarm/vexpress/vexpress_start.S	1.5

	Add a 1MB mapping to the MMU init table to cover the FDT blob in
	case the bootloader places it beyond the init mem size.
	[jmcneill, ticket #4]

bin/sh/cd.c					1.48
bin/sh/eval.c					1.141
bin/sh/exec.c					1.48
bin/sh/exec.h					1.25
bin/sh/mail.c					1.17, 1.18
bin/sh/sh.1					1.147

	Clean up CDPATH and MAILPATH processing a little.
	[kre, ticket #5]

sys/dev/hdaudio/hdaudio.c			1.5
sys/dev/pci/hdaudio_pci.c			1.8

	Move the hdaudio_cd out of the hdaudio_pci module and into the
	main hdaudio module.  Rearrange the inter-module dependencies
	accordingly.  PR kern/49836.
	[pgoyette, ticket #6]

bin/sh/expand.c					1.111, 1.112

	Fix an off-by one that broke ~ expansions. PR bin/52272 
	Fix bug affecting arithmetic expansions.
	[kre, ticket #7]

sys/arch/arm/cortex/gic.c			1.22

	Initialise all the SGI/PPI priorities for all CPUs to mask
	the interrupts
	[skrll, ticket #8]

usr.sbin/service/service			1.8

	Only match first instance of name and rcvar in file.
	[sborrill, ticket #9]

sys/arch/mips/mips/pmap_machdep.c		1.20

	Fix the PMAP_NO_PV_UNCACHED pmap_md_vca_add case where the
	pmap_update call would cause problems for pmap_remove_all
	case where the deferred activate should not be done...

	Add a comment about what's going on.
	[skrll, ticket #10]

sys/gdbscripts/cpus				1.2-1.3

	Make cpus MI
	[skrll, ticket #11]

external/bsd/blacklist/bin/blacklistd.conf.5	1.6

	Improve wording.
	[sevan, ticket #12]

sys/arch/arm/fdt/plfb_fdt.c			1.2
sys/arch/arm/vexpress/vexpress_platform.c	1.3
sys/arch/evbarm/conf/VEXPRESS_A15		1.13
sys/arch/evbarm/fdt/fdt_machdep.c		1.5
sys/arch/evbarm/fdt/fdt_machdep.c		1.6
sys/dev/ic/pl050.c				1.2

	Enable using the fb driver as console device on VEXPRESS_A15
	by passing the "console=fb" argument on the kernel cmdline.
	[jmcneill, ticket #13]

sys/dev/sdmmc/ld_sdmmc.c			1.27

	Fix a race between ld_sdmmc_start and ld_sdmmc_dobio that
	could result in tasks getting lost from the task queue.
	[jmcneill, ticket #14]

bin/sh/sh.1					1.148

	Correct option name in description of local command.
	[kre, ticket #15]

distrib/notes/macppc/prep.OPENFIRMWARE		1.19

	Change the deprecation notice about ofwboot.elf to say that
	it may still be required in some cases, as observed by some
	MacMini users.
	[he, ticket #16]

sys/arch/arm/fdt/aaci_fdt.c			1.1
sys/arch/arm/fdt/files.fdt			1.10
sys/arch/evbarm/conf/VEXPRESS_A15		1.14, 1.15
sys/conf/files					1.1174
sys/dev/ic/pl041.c				1.1-1.3
sys/dev/ic/pl041var.h				1.1

	Add driver for ARM PrimeCell Advanced Audio CODEC interface (PL041).
	[jmcneill, ticket #17]

sys/dev/audio.c					1.358

	Retrn error to userland from startp/startr depending on the
	error from trigger/start output/input.
	[nat, ticket #18]

sys/arch/arm/fdt/files.fdt			1.11
sys/arch/arm/fdt/plrtc_fdt.c			1.1
sys/arch/evbarm/conf/VEXPRESS_A15		1.16
sys/conf/files					1.1175
sys/dev/ic/pl031.c				1.1
sys/dev/ic/pl031var.h				1.1

	Add driver for ARM PrimeCell PL031 (RTC) Real Time Clock.
	[jmcneill, ticket #19]

sys/dev/pad/pad.c				1.33-1.35
sys/dev/pad/padvar.h				1.9

	Make rate limiter work in uni/multiprocessor configurations.
	[nat, ticket #20]

sys/dev/pci/if_iwm.c				1.74

	Build fix: comma -> semicolon.
	[nonaka, ticket #21]

sys/arch/mips/mips/mips_machdep.c		1.278
sys/arch/mips/mips/pmap_machdep.c		1.21

	Always use XKPHYS for pool pages on _LP64; otherwise use KSEG0
	Maintain the split of physical memory into the defined freelists,
	but only force pool pages to VM_FREELIST_FIRST512M for non _LP64
	[skrll, ticket #22]

sys/arch/sgimips/conf/INSTALL64_IP2x		1.3

	Align MEMORY_ROOT_DISK_SIZE with INSTALL32_IP2x
	[skrll, ticket #23]

sys/dev/usb/uaudio.c				1.154

	Start as half as many transfers for recording.  This fixes
	recording and playback when uaudio is used in full duplex
	mode.
	[nat, ticket #24]

sys/arch/mips/mips/locore_mips1.S		1.92, 1.93

	Fix tlb_record_asids 2nd arg to match usage - it's a maximum
	asid value and not a mask.
	[skrll, ticket #25]

libexec/ld.elf_so/rtld.c			1.184

	Call _rtld_debug_state before running the global initialisers,
	so give gdb a chance to set break points etc.
	[joerg, ticket #26]

external/bsd/dhcp/dist/relay/dhcrelay.c		1.7

	Fix bug where dhcrelay(8) needed to stay inforeground with -d
	flag in order to service requests.
	[manu, ticket #27]

sys/arch/x86/x86/cpu.c				1.131

	Further reduce the loop counter so that hatching completes
	before the boot processor times us out.
	[pgoyette, ticket #28]

external/gpl3/gcc/dist/gcc/config/vax/builtins.md 1.6

	Fix __builtin_ffs vax code generation. PR port-vax/51761 
	[flxd, ticket #29]

sys/dev/fdt/fdt_intr.c				1.11

	Fix an issue with interrupt controller lookup wrt cascading
	interrupt controllers.
	[jmcneill, ticket #30]

sys/arch/evbarm/fdt/fdt_machdep.c		1.7

	Parse more than one entry from the /memory node's reg property.
	[jmcneill, ticket #31]

external/gpl3/gcc/usr.bin/gcc/arch/mips64el/auto-host.h 1.11
external/gpl3/gcc/usr.bin/gcc/arch/mips64el/configargs.h 1.21

	regen to fix PR toolchain/52142.
	[maya, ticket #32]

