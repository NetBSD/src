.TH CANONICAL 5 
.ad
.fi
.SH NAME
canonical
\-
format of Postfix canonical table
.SH SYNOPSIS
.na
.nf
\fBpostmap /etc/postfix/canonical\fR
.SH DESCRIPTION
.ad
.fi
The optional \fBcanonical\fR table specifies an address mapping for
local and non-local addresses. The mapping is used by the
\fBcleanup\fR(8) daemon.  The address mapping is recursive.

Normally, the \fBcanonical\fR table is specified as a text file
that serves as input to the \fBpostmap\fR(1) command.
The result, an indexed file in \fBdbm\fR or \fBdb\fR format,
is used for fast searching by the mail system. Execute the command
\fBpostmap /etc/postfix/canonical\fR in order to rebuild the indexed
file after changing the text file.

When the table is provided via other means such as NIS, LDAP
or SQL, the same lookups are done as for ordinary indexed files.

Alternatively, the table can be provided as a regular-expression
map where patterns are given as regular expressions. In that case,
the lookups are done in a slightly different way as described below.

The \fBcanonical\fR mapping affects both message header addresses
(i.e. addresses that appear inside messages) and message envelope
addresses (for example, the addresses that are used in SMTP protocol
commands). Think Sendmail rule set \fBS3\fR, if you like.

Typically, one would use the \fBcanonical\fR table to replace login
names by \fIFirstname.Lastname\fR, or to clean up addresses produced
by legacy mail systems.

The \fBcanonical\fR mapping is not to be confused with \fIvirtual
domain\fR support. Use the \fBvirtual\fR(5) map for that purpose.

The \fBcanonical\fR mapping is not to be confused with local aliasing.
Use the \fBaliases\fR(5) map for that purpose.
.SH TABLE FORMAT
.na
.nf
.ad
.fi
The format of the \fBcanonical\fR table is as follows:
.IP "blanks and comments"
Blank lines are ignored, as are lines beginning with `#'.
.IP "leading whitespace"
Lines that begin with whitespace continue the previous line.
.IP "\fIpattern result\fR"
When \fIpattern\fR matches a mail address, replace it by the
corresponding \fIresult\fR.
.PP
With lookups from indexed files such as DB or DBM, or from networked
tables such as NIS, LDAP or SQL, patterns are tried in the order as
listed below:
.IP "\fIuser\fR@\fIdomain address\fR"
\fIuser\fR@\fIdomain\fR is replaced by \fIaddress\fR. This form
has the highest precedence.
.sp
This form useful to clean up addresses produced by legacy mail systems.
It can also be used to produce \fIFirstname.Lastname\fR style
addresses, but see below for a simpler solution.
.IP "\fIuser address\fR"
\fIuser\fR@\fIsite\fR is replaced by \fIaddress\fR when \fIsite\fR is
equal to $\fBmyorigin\fR, when \fIsite\fR is listed in
$\fBmydestination\fR, or when it is listed in $\fBinet_interfaces\fR.
.sp
This form is useful for replacing login names by
\fIFirstname.Lastname\fR.
.IP "@\fIdomain address\fR"
Every address in \fIdomain\fR is replaced by \fIaddress\fR.
This form has the lowest precedence.
.PP
In all the above forms, when \fIaddress\fR has the form
@\fIotherdomain\fR, the result is the same user in \fIotherdomain\fR.
.SH ADDRESS EXTENSION
.na
.nf
.fi
.ad
When table lookup fails, and the address localpart contains the
optional recipient delimiter (e.g., \fIuser+foo\fR@\fIdomain\fR), the
search is repeated for the unextended address (e.g.
\fIuser\fR@\fIdomain\fR), and the unmatched extension is propagated
to the result of table lookup. The matching order is:
\fIuser+foo\fR@\fIdomain\fR, \fIuser\fR@\fIdomain\fR,
\fIuser+foo\fR, \fIuser\fR, and @\fIdomain\fR.
.SH REGULAR EXPRESSION TABLES
.na
.nf
.ad
.fi
This section describes how the table lookups change when the table
is given in the form of regular expressions. For a description of
regular expression lookup table syntax, see \fBregexp_table\fR(5)
or \fBpcre_table\fR(5).

Each pattern is a regular expression that is applied to the entire
address being looked up. Thus, \fIuser@domain\fR mail addresses are not
broken up into their \fIuser\fR and \fI@domain\fR constituent parts,
nor is \fIuser+foo\fR broken up into \fIuser\fR and \fIfoo\fR.

Patterns are applied in the order as specified in the table, until a
pattern is found that matches the search string.

Results are the same as with normal indexed file lookups, with
the additional feature that parenthesized substrings from the
pattern can be interpolated as \fB$1\fR, \fB$2\fR and so on.
.SH BUGS
.ad
.fi
The table format does not understand quoting conventions.
.SH CONFIGURATION PARAMETERS
.na
.nf
.ad
.fi
The following \fBmain.cf\fR parameters are especially relevant to
this topic. See the Postfix \fBmain.cf\fR file for syntax details
and for default values. Use the \fBpostfix reload\fR command after
a configuration change.
.IP \fBcanonical_maps\fR
List of canonical mapping tables.
.IP \fBrecipient_canonical_maps\fR
Address mapping lookup table for envelope and header recipient
addresses.
.IP \fBsender_canonical_maps\fR
Address mapping lookup table for envelope and header sender
addresses.
.PP
Other parameters of interest:
.IP \fBinet_interfaces\fR
The network interface addresses that this system receives mail on.
.IP \fBmasquerade_domains\fR
List of domains that hide their subdomain structure.
.IP \fBmasquerade_exceptions\fR
List of user names that are not subject to address masquerading.
.IP \fBmydestination\fR
List of domains that this mail system considers local.
.IP \fBmyorigin\fR
The domain that is appended to locally-posted mail.
.IP \fBowner_request_special\fR
Give special treatment to \fBowner-\fIxxx\fR and \fIxxx\fB-request\fR
addresses.
.SH SEE ALSO
.na
.nf
cleanup(8) canonicalize and enqueue mail
postmap(1) create mapping table
virtual(5) virtual domain mapping
pcre_table(5) format of PCRE tables
regexp_table(5) format of POSIX regular expression tables
.SH LICENSE
.na
.nf
.ad
.fi
The Secure Mailer license must be distributed with this software.
.SH AUTHOR(S)
.na
.nf
Wietse Venema
IBM T.J. Watson Research
P.O. Box 704
Yorktown Heights, NY 10598, USA
