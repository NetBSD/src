<html> <head> </head> <body> <pre>
CLEANUP(8)                                             CLEANUP(8)

<b>NAME</b>
       cleanup - canonicalize and enqueue Postfix message

<b>SYNOPSIS</b>
       <b>cleanup</b> [generic Postfix daemon options]

<b>DESCRIPTION</b>
       The <b>cleanup</b> daemon processes inbound mail, inserts it into
       the <b>incoming</b> mail queue, and informs the queue manager  of
       its arrival.

       The <b>cleanup</b> daemon always performs the following transfor-
       mations:

       <b>o</b>      Insert missing message  headers:  (<b>Resent-</b>)  <b>From:</b>,
              <b>To:</b>, <b>Message-Id:</b>, and <b>Date:</b>.

       <b>o</b>      Extract envelope recipient addresses from (<b>Resent-</b>)
              <b>To:</b>, <b>Cc:</b> and <b>Bcc:</b> message headers when  no  recipi-
              ents are specified in the message envelope.

       <b>o</b>      Transform  envelope  and  header  addresses  to the
              standard <i>user@fully-qualified-domain</i> form  that  is
              expected  by  other Postfix programs.  This task is
              delegated to the <a href="trivial-rewrite.8.html"><b>trivial-rewrite</b>(8)</a> daemon.

       <b>o</b>      Eliminate duplicate envelope recipient addresses.

       The following address transformations are optional:

       <b>o</b>      Optionally,  rewrite  all   envelope   and   header
              addresses  according  to  the mappings specified in
              the <a href="canonical.5.html"><b>canonical</b>(5)</a> lookup tables.

       <b>o</b>      Optionally, masquerade  envelope  sender  addresses
              and  message  header  addresses (i.e. strip host or
              domain information below all domains listed in  the
              <b>masquerade</b><i>_</i><b>domains</b> parameter, except for user names
              listed  in  <b>masquerade</b><i>_</i><b>exceptions</b>).   By   default,
              address   masquerading  does  not  affect  envelope
              recipients.

       <b>o</b>      Optionally, expand envelope recipients according to
              information  found in the <a href="virtual.5.html"><b>virtual</b>(5)</a> lookup tables.

       The <b>cleanup</b> daemon performs sanity checks on  the  content
       of  each  message.  When it finds a problem, by default it
       returns a diagnostic status to the client, and  leaves  it
       up  to the client to deal with the problem. Alternatively,
       the client can request the <b>cleanup</b> daemon  to  bounce  the
       message back to the sender in case of trouble.

<b>STANDARDS</b>
       <a href="http://www.faqs.org/rfcs/rfc822.html">RFC 822</a> (ARPA Internet Text Messages)
       <a href="http://www.faqs.org/rfcs/rfc2045.html">RFC 2045</a> (MIME: Format of Internet Message Bodies)
       <a href="http://www.faqs.org/rfcs/rfc2046.html">RFC 2046</a> (MIME: Media Types)

<b>DIAGNOSTICS</b>
       Problems and transactions are logged to <b>syslogd</b>(8).

<b>BUGS</b>
       Table-driven  rewriting  rules  make it hard to express <b>if</b>
       <b>then</b> <b>else</b> and other logical relationships.

<b>CONFIGURATION</b> <b>PARAMETERS</b>
       The following <b>main.cf</b> parameters are  especially  relevant
       to  this  program. See the Postfix <b>main.cf</b> file for syntax
       details and for default values.  Use  the  <b>postfix</b>  <b>reload</b>
       command after a configuration change.

<b>Content</b> <b>filtering</b>
       <b>body</b><i>_</i><b>checks</b>
              Lookup tables with content filters for message body
              lines.  These filters see physical lines one  at  a
              time, in chunks of at most line_length_limit bytes.

       <b>body</b><i>_</i><b>checks</b><i>_</i><b>size</b><i>_</i><b>limit</b>
              The amount of content per message body segment that
              is subjected to <b>$body</b><i>_</i><b>checks</b> filtering.

       <b>header</b><i>_</i><b>checks</b>

       <b>mime</b><i>_</i><b>header</b><i>_</i><b>checks</b> (default: <b>$header</b><i>_</i><b>checks</b>)

       <b>nested</b><i>_</i><b>header</b><i>_</i><b>checks</b> (default: <b>$header</b><i>_</i><b>checks</b>)
              Lookup  tables  with  content  filters  for message
              header lines: respectively, these  are  applied  to
              the  primary  message  headers  (not including MIME
              headers), to the MIME headers anywhere in the  mes-
              sage,  and  to the initial headers of attached mes-
              sages.  These filters see logical headers one at  a
              time, including headers that span multiple lines.

<b>MIME</b> <b>Processing</b>
       <b>disable</b><i>_</i><b>mime</b><i>_</i><b>input</b><i>_</i><b>processing</b>
              While  receiving, give no special treatment to <b>Con-</b>
              <b>tent-Type:</b> message headers; all text after the ini-
              tial  message  headers  is considered to be part of
              the message body.

       <b>mime</b><i>_</i><b>boundary</b><i>_</i><b>length</b><i>_</i><b>limit</b>
              The amount of space that will be allocated for MIME
              multipart  boundary  strings. The MIME processor is
              unable to distinguish between boundary strings that
              do   not   differ   in   the   first   <b>$mime</b><i>_</i><b>bound-</b>
              <b>ary</b><i>_</i><b>length</b><i>_</i><b>limit</b> characters.

       <b>mime</b><i>_</i><b>nesting</b><i>_</i><b>limit</b>
              The maximal nesting level of  multipart  mail  that
              the  MIME processor can handle. Refuse mail that is
              nested deeper.

       <b>strict</b><i>_</i><b>8bitmime</b>
              Turn on both <b>strict</b><i>_</i><b>7bit</b><i>_</i><b>headers</b>  and  <b>strict</b><i>_</i><b>8bit-</b>
              <b>mime</b><i>_</i><b>body</b>.

       <b>strict</b><i>_</i><b>7bit</b><i>_</i><b>headers</b>
              Reject  mail  with  8-bit  text in message headers.
              This blocks mail from poorly written  applications.

       <b>strict</b><i>_</i><b>8bitmime</b><i>_</i><b>body</b>
              Reject  mail with 8-bit text in content that claims
              to be 7-bit, or in content  that  has  no  explicit
              content  encoding  information.   This  blocks mail
              from poorly written mail  software.  Unfortunately,
              this  also  breaks majordomo approval requests when
              the included  request  contains  valid  8-bit  MIME
              mail,  and  it  breaks bounces from mailers that do
              not properly encapsulate 8-bit content  (for  exam-
              ple,  bounces  from  qmail  or from old versions of
              Postfix).

       <b>strict</b><i>_</i><b>mime</b><i>_</i><b>encoding</b><i>_</i><b>domain</b>
              Reject mail with invalid <b>Content-Transfer-Encoding:</b>
              information  for  message/*  or  multipart/*.  This
              blocks mail from poorly written software.

<b>Miscellaneous</b>
       <b>always</b><i>_</i><b>bcc</b>
              Address to send a copy of each message that  enters
              the system.

       <b>hopcount</b><i>_</i><b>limit</b>
              Limit the number of <b>Received:</b> message headers.

       <b>undisclosed</b><i>_</i><b>recipients</b><i>_</i><b>header</b>
              The header line that is inserted when no recipients
              were specified in (Resent-)To: or (Resent-)Cc: mes-
              sage headers.

<b>Address</b> <b>transformations</b>
       <b>empty</b><i>_</i><b>address</b><i>_</i><b>recipient</b>
              The  destination  for  undeliverable  mail from &lt;&gt;.
              This substitution is done before all other  address
              rewriting.

       <b>canonical</b><i>_</i><b>maps</b>
              Address mapping lookup table for sender and recipi-
              ent addresses in envelopes and headers.

       <b>recipient</b><i>_</i><b>canonical</b><i>_</i><b>maps</b>
              Address  mapping  lookup  table  for  envelope  and
              header recipient addresses.

       <b>sender</b><i>_</i><b>canonical</b><i>_</i><b>maps</b>
              Address  mapping  lookup  table  for  envelope  and
              header sender addresses.

       <b>masquerade</b><i>_</i><b>classes</b>
              List of address classes  subject  to  masquerading:
              zero  or  more of <b>envelope</b><i>_</i><b>sender</b>, <b>envelope</b><i>_</i><b>recipi-</b>
              <b>ent</b>, <b>header</b><i>_</i><b>sender</b>, <b>header</b><i>_</i><b>recipient</b>.

       <b>masquerade</b><i>_</i><b>domains</b>
              List of domains that hide  their  subdomain  struc-
              ture.

       <b>masquerade</b><i>_</i><b>exceptions</b>
              List  of user names that are not subject to address
              masquerading.

       <b>virtual</b><i>_</i><b>alias</b><i>_</i><b>maps</b>
              Address mapping lookup table for envelope recipient
              addresses.

<b>Resource</b> <b>controls</b>
       <b>duplicate</b><i>_</i><b>filter</b><i>_</i><b>limit</b>
              Limits  the  number of envelope recipients that are
              remembered.

       <b>header</b><i>_</i><b>address</b><i>_</i><b>token</b><i>_</i><b>limit</b>
              Limits the number of address tokens used to process
              a message header.

       <b>header</b><i>_</i><b>size</b><i>_</i><b>limit</b>
              Limits  the amount of memory in bytes used to store
              a message header.

       <b>in</b><i>_</i><b>flow</b><i>_</i><b>delay</b>
              Amount of time to pause before accepting a message,
              when  the  message arrival rate exceeds the message
              delivery rate.

       <b>extract</b><i>_</i><b>recipient</b><i>_</i><b>limit</b>
              Limit the amount of recipients extracted from  mes-
              sage headers.

<b>SEE</b> <b>ALSO</b>
       <a href="canonical.5.html">canonical(5)</a> canonical address lookup table format
       <a href="qmgr.8.html">qmgr(8)</a> queue manager daemon
       syslogd(8) system logging
       <a href="trivial-rewrite.8.html">trivial-rewrite(8)</a> address rewriting
       <a href="virtual.5.html">virtual(5)</a> virtual alias lookup table format

<b>FILES</b>
       /etc/postfix/canonical*, canonical mapping table
       /etc/postfix/virtual*, virtual mapping table

<b>LICENSE</b>
       The  Secure  Mailer  license must be distributed with this
       software.

<b>AUTHOR(S)</b>
       Wietse Venema
       IBM T.J. Watson Research
       P.O. Box 704
       Yorktown Heights, NY 10598, USA

                                                       CLEANUP(8)
</pre> </body> </html>
