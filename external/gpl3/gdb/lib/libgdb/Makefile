#	$NetBSD: Makefile,v 1.19.2.1 2018/05/21 04:35:53 pgoyette Exp $

NOCTF=
HOSTPROG_CXX=   1

.include <bsd.own.mk>

.include "../Makefile.inc"

LIBISPRIVATE=	yes
LIB=		gdb
GDBARCHDIR=	${.CURDIR}/arch/${GDB_MACHINE_ARCH}

.include "${GDBARCHDIR}/defs.mk"

SRCS=		${G_LIBGDB_OBS:.o=.c}
GCPPFLAGS=	${G_INTERNAL_CFLAGS}
CPPFLAGS+=	-I${.CURDIR} \
		-I${GDBARCHDIR} \
		-I${DIST}/gdb \
		-I${DIST}/gdb/config \
		-I${DIST}/gdb/common \
		-I${DIST}/gdb/gnulib/import \
		-I${DIST}/include/opcode \
		-I${DIST}/libdecnumber \
		-I${DIST} \
		-I${.CURDIR}/../libbfd/arch/${GDB_MACHINE_ARCH} \
		-I${.CURDIR}/../libdecnumber/arch/${GDB_MACHINE_ARCH} \
		-I${DIST}/bfd \
		-I${DIST}/include \
		-Dsighandler_t=sig_t \
		-DTARGET_SYSTEM_ROOT=\"\" \
		-DTARGET_SYSTEM_ROOT_RELOCATABLE=0 \
		-DBINDIR=\"${BINDIR}\" \
		${GCPPFLAGS:M-D*}

# XXX inf-ptrace.c has some bogus (PTRACE_TYPE_ARG3) casts, but in 
# code that's never exercised on NetBSD.
CPPFLAGS.inf-ptrace.c=	-Wno-error

# XXX: I should fix these...
CPPFLAGS.i386-nbsd-tdep.c+= -Wno-narrowing
CPPFLAGS.arm-get-next-pcs.c+= -Wno-narrowing
CPPFLAGS.mips-tdep.c+= -Wno-narrowing
CPPFLAGS.sh-nbsd-tdep.c+= -Wno-narrowing
CPPFLAGS.ppc-nbsd-tdep.c+= -Wno-narrowing
CPPFLAGS.alpha-nbsd-tdep.c+= -Wno-narrowing
CPPFLAGS.alpha-tdep.c+= -Wno-narrowing
CPPFLAGS.rs6000-tdep.c+= -Wno-narrowing
CPPFLAGS.hppa-nbsd-tdep.c+= -Wno-narrowing

CWARNFLAGS.clang+=	-Wno-switch

.include "../../Makefile.inc"
.include <bsd.lib.mk>

# Force c++
CWARNFLAGS.clang+=	-Wno-deprecated
HOST_CC:=		${HOST_CXX}
CC:=			${CXX}
CFLAGS:=		${CXXFLAGS} -std=gnu++11 -Wno-error=stack-protector

.PATH: ${DIST}/gdb ${DIST}/gdb/arch ${DIST}/gdb/mi ${DIST}/gdb/cli  \
    ${DIST}/gdb/tui ${DIST}/gdb/python ${DIST}/gdb/common ${DIST}/gdb/target \
    ${DIST}/gdb/nat ${DIST}/gdb/guile ${DIST}/gdb/compile ${DIST}/gdb/doc \
    ${GDBARCHDIR}

#

ada-exp.c: ada-lex.c

.if ${MACHINE} == "amiga"
COPTS.dwarf2-frame.c+=-O1
.endif

# These are generated by implicit rules and are not easy to generate
CLEANDIRFILES+= \
	ada-exp.c ada-lex.c \
	c-exp.c \
	d-exp.c \
	cp-name-parser.c \
	f-exp.c \
	go-exp.c \
	jv-exp.c \
	m2-exp.c \
	p-exp.c \
	rust-exp.c
