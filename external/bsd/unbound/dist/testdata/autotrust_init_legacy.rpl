; config options
server:
	target-fetch-policy: "0 0 0 0 0"
	log-time-ascii: yes
	fake-sha1: yes
	trust-anchor-signaling: no
stub-zone:
	name: "."
	stub-addr: 193.0.14.129         # K.ROOT-SERVERS.NET.
AUTOTRUST_FILE example.com
bg.	3600	IN	DNSKEY	257 3 5 AwEAAdSkAKz985k77l1wsGJJb0ITOjJnYNW7viMGMu6gxn+k94g+JBnVK3ic6vgtpgApKZXLPF/1IYtBxc6Xd+EtrJ9QMhCOhDK5enHYwmWoo/P4zSu1RIDDsi2xge7HQt3rzGiZB6L3CWm1gmLIYoYUKmpq2QttVtTcziEmP+MbO/WVvJsQYDMFb/eszILyPRB76kSmSz56k+lHl6BWwv4LUchKWNf8s0pJsI357FVqdXaqjES6PqbNeymPW6rvMRSRFFp7KGLrizPJjsMfBIvyXkya5Gx4Y81wPqoRbW74efgD5bXsPCwitI/WayJ5h99VL8VtH4Ed0/b7F/H0CqFUohAipZkwLyimagxcWPem0WvGRXy/o/XHr/n1aG9D4SVUrGFQZsUk+PztJdYhLw2zNTgmIW+/RGUzowyhkmqD4CC+cn7BgXJTAig3REQ6GSfmEbQk8mDwhmIKw/GOLNiUL9EIGmZintg/zdzU4fb8Wn+4oBtOBFmzrw1uWEgDtsmLpVZcJPnvrIOE+lVnist1b4mTz7OSFApcOquwpTaMxsaSu9cufbN0jpBzslhSwaUyWXNruxAypuIlOXWt6yPAJ+u6pZ7db7APj5XY5Pff16/zWTfC2xI5OpFsn2vuEsi816lknDwfi6vYihx10VBwlcfUus0cuZ+SxUGj9fHq3+TX ;{id = 64693 (ksk), size = 4096b} ;;state=2 ;;count=0 ;;lastchange=1253688984 ;;Wed Sep 23 06:56:24 2009
AUTOTRUST_END
CONFIG_END

SCENARIO_BEGIN Test autotrust in unbound with legacy autotrust file

; K-ROOT
RANGE_BEGIN 0 100
	ADDRESS 193.0.14.129
ENTRY_BEGIN
MATCH opcode qname qtype
ADJUST copy_id copy_query
REPLY QR AA
SECTION QUESTION
. IN NS
SECTION ANSWER
. IN NS k.root-servers.net.
SECTION ADDITIONAL
k.root-servers.net IN A 193.0.14.129
ENTRY_END

ENTRY_BEGIN
MATCH opcode subdomain
ADJUST copy_id copy_query
REPLY QR
SECTION QUESTION
bg. IN NS
SECTION AUTHORITY
bg. IN NS a.gtld-servers.net.
SECTION ADDITIONAL
a.gtld-servers.net. IN A 192.5.6.30
ENTRY_END
RANGE_END

; a.gtld-servers.net.
RANGE_BEGIN 0 100
	ADDRESS 192.5.6.30
ENTRY_BEGIN
MATCH opcode qtype qname
ADJUST copy_id copy_query
REPLY QR AA
SECTION QUESTION
bg. IN DNSKEY
SECTION ANSWER
bg.			3600	IN	DNSKEY	257 3 5 AwEAAdSkAKz985k77l1wsGJJb0ITOjJnYNW7viMGMu6gxn+k94g+JBnV K3ic6vgtpgApKZXLPF/1IYtBxc6Xd+EtrJ9QMhCOhDK5enHYwmWoo/P4 zSu1RIDDsi2xge7HQt3rzGiZB6L3CWm1gmLIYoYUKmpq2QttVtTcziEm P+MbO/WVvJsQYDMFb/eszILyPRB76kSmSz56k+lHl6BWwv4LUchKWNf8 s0pJsI357FVqdXaqjES6PqbNeymPW6rvMRSRFFp7KGLrizPJjsMfBIvy Xkya5Gx4Y81wPqoRbW74efgD5bXsPCwitI/WayJ5h99VL8VtH4Ed0/b7 F/H0CqFUohAipZkwLyimagxcWPem0WvGRXy/o/XHr/n1aG9D4SVUrGFQ ZsUk+PztJdYhLw2zNTgmIW+/RGUzowyhkmqD4CC+cn7BgXJTAig3REQ6 GSfmEbQk8mDwhmIKw/GOLNiUL9EIGmZintg/zdzU4fb8Wn+4oBtOBFmz rw1uWEgDtsmLpVZcJPnvrIOE+lVnist1b4mTz7OSFApcOquwpTaMxsaS u9cufbN0jpBzslhSwaUyWXNruxAypuIlOXWt6yPAJ+u6pZ7db7APj5XY 5Pff16/zWTfC2xI5OpFsn2vuEsi816lknDwfi6vYihx10VBwlcfUus0c uZ+SxUGj9fHq3+TX
bg.			3600	IN	DNSKEY	256 3 5 AwEAAcgZKgxv/GlzYF/7ExO7fd4M23oC4z5vZa9A5kjiHDhK3fWbX7Zb 6i3Do668AVo2OVPJkhLHgueRkvON6G1AuKnNPr/aqYkswHp5RK4+bDz4 MYIgNxTHxVnmR0xY3K63xDinP1MP4bXfo8qoJDgYM25zQg4yZ5etrH+k l/fPK0Tr
bg.			3600	IN	DNSKEY	256 3 5 AwEAAduUF9stPDvXkFznyZ/lL1CPJWHhmHqFv7zZHKtpd0YdoRSxJlT/ KtlEX5TFXOwiaodc5VPTPsUmkoIJ8XW+v9ocjzIPbKErSvQ1HsRNxjFR mUgnRGUeD7rlqGqwheEMlXD57IYAm5Vfs4RPp+zyp1PYVwDtamGPmWny 1xdOwiXF
bg.			3600	IN	DNSKEY	257 3 5 AwEAAblV90SQjp4rI9ZLQs3pwcvkmlEt0OogfuI5cm4l+b3fHGA3YtVU Tz8j6SzpMQR/psx5KzFzqIJc8YRdLJSFhiBaLxDYPltcjFSie71Ln2U0 +PPn5NHqUzCYTysLtRG0sl8FHmFGEY4OmkevpDZCX9sscDdt0MfiVwoN 23Ni3nHuSrGewgr0RI4nBrcrBWII7oAfhyZ9XKWmlZpRM8aNHA6hijix ZsSzTNYAfr9r+s/lpiDG2ybiju1H6sKhL/jY02UdMTFiLFdRZ6yuOzxw FXWQE/d7cSe5dSCYMU5EmD2Qy0nbGG0YSD9e0iehw01Fr70HfIV9uNXM zqHrrTyajMtlft/z9aUug5qIVxFSczNSRCyJedcJU+9OZUMj90yXQLeG 2soa6QOfAUyYZLs9OgOIKoE0c7hQRIicPM5bK0ycUM3NTcIYUzDV8zZZ Fo0xaM1QEIMdXz4kCfFS6V4lUleufTCDTI0CkTq9g14ia464HFXb4WKD 6eHl0hvnXAviPAqrma0K1iX9efjxiDumyAIJlm/plBL39CMuX/ENyER8 XXqv9aXAAcdlN2EYsbejGJ262SjvGIMzEVoUKd9UqrnSe44w/2+lzL6a WYqFz6njejH6rbzcof2MoEt1QC47G80gZzFk/tn1mMIKKMbQyvMy7+6K HaTKSHnJCXr27klR
bg.			3600	IN	RRSIG	DNSKEY 5 1 3600 20091023110015 20090923110015 12576 bg. n73VW50NVGhJYvXUjuobebUFYS3NiVkYoZ9oW+lKtbp4AUQHf7HfIxKk aOesl1EeXMI+IcAIyMkmJQDVPBEpf5WhWarGVthAxOXradSSYKI0Nvuf 4cXoig8tM1n2qScNWlEwQTdNxZl5bQND61ZSPWWTpA3bt4iu8lWqXxFB O2g=
bg.			3600	IN	RRSIG	DNSKEY 5 1 3600 20091023110015 20090923110015 46846 bg. O4eZhJMy+A8aJL63rK04fFeDrn/CLLkuXW+NePdcuyDEaHwX0UwvuNxy V8aGQNtp+YJCfVzc4Qw9lrTCg+qS4o8qDtj4/p27HHtQ4+owLM2gi1pS Ek9/Ct8FabsuBAR+f4/SCVtf75+QT7kfNzJqN1/o6GU8W9/CILGzD52f kHxqpW8k0pPUrZ4r5UkpUiZTFoLe8lkSN30Dlc84dFOH8myuoDbiwH5B GjdrR8xwe5e2+wnsAkzcwN0+7ND1mIGCjebrdnfyCV3eMDzrDu2ZH8Bt swPShC+8VbnGcEmNfGycaIvwFJO89zQ0YBPbfiX07n+2mDIcfvHpq0cD iL0As6rbvEq9tmePkHrggN1DuuxZWInhfmUCOZK62F33rxefJv/VmM5T C45fvAh5RzetMhuRHq6Upxcma1hqlY7hz3PfQTHl0cPNI3ZnJOrfg5pe 04Tlu7KfVdSuhsS71+I8dotokCMdocoft9kPyQxfSln4/eoSPTYa/oaL pUJJfjdTS2XkgVL5zm8aC33273hzz82eLuHNc78x0Gac+QLknNJMwylx OYXn27o53TufSb8fkh4M3IiU53qY6IhCTQqEFwqiANodvQaOV6nrs4+D jRKbdviwxM7Tt2SQ3Z3d64kuD6T23C9FdovSGpRG5SHALcTdd8O9pUyk /mPoNBWKOuw=
bg.			3600	IN	RRSIG	DNSKEY 5 1 3600 20091023110015 20090923110015 64693 bg. DVh3tlQ6LnQ4HC5G9DFPszU8OmKDKBPIbp4DIKt/TbKWRpbMLfwzBUwR EHr6qkrdwKyUgo59JoDeeb0cXCFooxtIhZMLv2ntlPTPTp+4jEoi/t9P KhqTS2r3Ptbj3wVypdRwi45wChro0XW+ZNmbh/BRSo8eKJVZcor9rj5b soPwfPVvKe+iQ18PWxTXE4FLDv3wQ1/5EpqaAbOjvvCnuOCMUYotjvZt GwDcAx98mPLY42zQfc+EoN9qnlEfsu9zZOVgQQDgvb+yTbyLaP9yRp13 PIf3jQ4IPMAtL9ONGokd1Jl6v0hXIVTlMoF0EGgtcDiE2KZ64hhtY+t9 Z8sraETJxxdTeX/E81+9I3cBL1VVAT9Fe9nzfXd1sP0FKjaVcIzJnsZ4 lBVZE0iDA2ZaMVeaH8z/38eMHIhn+J2ZiMwz/5b/ueHFfiAjFedbSQrR ALOSggmFd2v6uh8X4osM9Gxg8Q3fDhqGjSkEQIc/VdEMQbh2yU0o+X8q 5r13WkEmS0pKJhvPXocpRWdqfKb2QwnswU6pxbuBuwUd1i087YkTSl/R QREOZNgtfw2qpwv6Lm3q5DT5igF0G78OS3L58aSm0nHxQx9WsCE19/pe 66o1hH3Umx1Q/B7Zt4ZD0R9YE1w20qUcb9HmZumt0LJWtIgTrOuW+6SE WgGvpjXrHS8=
ENTRY_END
RANGE_END

; set date/time to wed sep 23.
STEP 5 TIME_PASSES EVAL ${1253688984 + 7200 + 10800}
STEP 6 TRAFFIC   ; do the probe
STEP 7 ASSIGN t0 = ${time}
STEP 8 ASSIGN probe0 = ${range 3200 ${timeout} 3600}

; the auto probing should have been done now.
STEP 11 CHECK_AUTOTRUST example.com
FILE_BEGIN
; autotrust trust anchor file
;;id: bg. 1
;;last_queried: ${$t0} ;;${ctime $t0}
;;last_success: ${$t0} ;;${ctime $t0}
;;next_probe_time: ${$t0+$probe0} ;;${ctime $t0+$probe0}
;;query_failed: 0
;;query_interval: 3600
;;retry_time: 3600
bg.	3600	IN	DNSKEY	257 3 5 AwEAAblV90SQjp4rI9ZLQs3pwcvkmlEt0OogfuI5cm4l+b3fHGA3YtVUTz8j6SzpMQR/psx5KzFzqIJc8YRdLJSFhiBaLxDYPltcjFSie71Ln2U0+PPn5NHqUzCYTysLtRG0sl8FHmFGEY4OmkevpDZCX9sscDdt0MfiVwoN23Ni3nHuSrGewgr0RI4nBrcrBWII7oAfhyZ9XKWmlZpRM8aNHA6hijixZsSzTNYAfr9r+s/lpiDG2ybiju1H6sKhL/jY02UdMTFiLFdRZ6yuOzxwFXWQE/d7cSe5dSCYMU5EmD2Qy0nbGG0YSD9e0iehw01Fr70HfIV9uNXMzqHrrTyajMtlft/z9aUug5qIVxFSczNSRCyJedcJU+9OZUMj90yXQLeG2soa6QOfAUyYZLs9OgOIKoE0c7hQRIicPM5bK0ycUM3NTcIYUzDV8zZZFo0xaM1QEIMdXz4kCfFS6V4lUleufTCDTI0CkTq9g14ia464HFXb4WKD6eHl0hvnXAviPAqrma0K1iX9efjxiDumyAIJlm/plBL39CMuX/ENyER8XXqv9aXAAcdlN2EYsbejGJ262SjvGIMzEVoUKd9UqrnSe44w/2+lzL6aWYqFz6njejH6rbzcof2MoEt1QC47G80gZzFk/tn1mMIKKMbQyvMy7+6KHaTKSHnJCXr27klR ;{id = 46846 (ksk), size = 4096b} ;;state=1 [ ADDPEND ] ;;count=1 ;;lastchange=${$t0} ;;${ctime $t0}
bg.	3600	IN	DNSKEY	257 3 5 AwEAAdSkAKz985k77l1wsGJJb0ITOjJnYNW7viMGMu6gxn+k94g+JBnVK3ic6vgtpgApKZXLPF/1IYtBxc6Xd+EtrJ9QMhCOhDK5enHYwmWoo/P4zSu1RIDDsi2xge7HQt3rzGiZB6L3CWm1gmLIYoYUKmpq2QttVtTcziEmP+MbO/WVvJsQYDMFb/eszILyPRB76kSmSz56k+lHl6BWwv4LUchKWNf8s0pJsI357FVqdXaqjES6PqbNeymPW6rvMRSRFFp7KGLrizPJjsMfBIvyXkya5Gx4Y81wPqoRbW74efgD5bXsPCwitI/WayJ5h99VL8VtH4Ed0/b7F/H0CqFUohAipZkwLyimagxcWPem0WvGRXy/o/XHr/n1aG9D4SVUrGFQZsUk+PztJdYhLw2zNTgmIW+/RGUzowyhkmqD4CC+cn7BgXJTAig3REQ6GSfmEbQk8mDwhmIKw/GOLNiUL9EIGmZintg/zdzU4fb8Wn+4oBtOBFmzrw1uWEgDtsmLpVZcJPnvrIOE+lVnist1b4mTz7OSFApcOquwpTaMxsaSu9cufbN0jpBzslhSwaUyWXNruxAypuIlOXWt6yPAJ+u6pZ7db7APj5XY5Pff16/zWTfC2xI5OpFsn2vuEsi816lknDwfi6vYihx10VBwlcfUus0cuZ+SxUGj9fHq3+TX ;{id = 64693 (ksk), size = 4096b} ;;state=2 [  VALID  ] ;;count=0 ;;lastchange=1253688984 ;;Wed Sep 23 06:56:24 2009
FILE_END

SCENARIO_END
