# Copyright (C) 2012-2014, 2016, 2017  Internet Systems Consortium, Inc. ("ISC")
#
# Permission to use, copy, modify, and/or distribute this software for any
# purpose with or without fee is hereby granted, provided that the above
# copyright notice and this permission notice appear in all copies.
#
# THE SOFTWARE IS PROVIDED "AS IS" AND ISC DISCLAIMS ALL WARRANTIES WITH
# REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
# AND FITNESS.  IN NO EVENT SHALL ISC BE LIABLE FOR ANY SPECIAL, DIRECT,
# INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
# LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE
# OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
# PERFORMANCE OF THIS SOFTWARE.

srcdir =	@srcdir@
VPATH =		@srcdir@
top_srcdir =	@top_srcdir@

@BIND9_MAKE_INCLUDES@

PYTHON	=	@PYTHON@

SUBDIRS	=	isc

TARGETS =	dnssec-checkds dnssec-coverage
PYSRCS =	dnssec-checkds.py dnssec-coverage.py

MANPAGES =	dnssec-checkds.8 dnssec-coverage.8
HTMLPAGES =	dnssec-checkds.html dnssec-coverage.html
MANOBJS =	${MANPAGES} ${HTMLPAGES}

@BIND9_MAKE_RULES@

dnssec-checkds: dnssec-checkds.py
	cp -f dnssec-checkds.py dnssec-checkds
	chmod +x dnssec-checkds

dnssec-coverage: dnssec-coverage.py
	cp -f dnssec-coverage.py dnssec-coverage
	chmod +x dnssec-coverage

doc man:: ${MANOBJS}

docclean manclean maintainer-clean::
	rm -f ${MANOBJS}

installdirs:
	$(SHELL) ${top_srcdir}/mkinstalldirs ${DESTDIR}${sbindir}
	$(SHELL) ${top_srcdir}/mkinstalldirs ${DESTDIR}${mandir}/man8

install:: ${TARGETS} installdirs
	${INSTALL_SCRIPT} dnssec-checkds ${DESTDIR}${sbindir}
	${INSTALL_SCRIPT} dnssec-coverage ${DESTDIR}${sbindir}
	${INSTALL_DATA} ${srcdir}/dnssec-checkds.8 ${DESTDIR}${mandir}/man8
	${INSTALL_DATA} ${srcdir}/dnssec-coverage.8 ${DESTDIR}${mandir}/man8
	if test -n "${PYTHON}" ; then \
		if test -n "${DESTDIR}" ; then \
			${PYTHON} ${srcdir}/setup.py install --root=${DESTDIR} --prefix=${prefix} @PYTHON_INSTALL_LIB@ ; \
		else \
			${PYTHON} ${srcdir}/setup.py install --prefix=${prefix} @PYTHON_INSTALL_LIB@ ; \
		fi ; \
		rm -rf build ; \
	fi

uninstall::
	rm -f ${DESTDIR}${mandir}/man8/dnssec-coverage.8
	rm -f ${DESTDIR}${mandir}/man8/dnssec-checkds.8
	rm -f ${DESTDIR}${sbindir}/dnssec-coverage
	rm -f ${DESTDIR}${sbindir}/dnssec-checkds
	# only manually uninstall for the python package itself

clean distclean::
	rm -f ${TARGETS}
	rm -rf build

distclean::
	rm -f dnssec-checkds.py dnssec-coverage.py
