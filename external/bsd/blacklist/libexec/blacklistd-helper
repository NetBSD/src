#!/bin/sh
echo "run $@" 1>&2
set -x
# $1 command
# $2 rulename
# $3 protocol
# $4 address
# $5 mask
# $6 proto
# $7 id

case "$1" in
add)
	# GRR!
#	case $4 in
#	*:*)
#		case $5 in
#		128)	addr=$4;;
#		*)	addr=$4/$5;;
#		esac;;
#	*)
#		case $5 in
#		32)	addr=$4;;
#		*)	addr=$4/$5;;
#		esac;;
#	esac
	exec /sbin/npfctl rule $2 add block in final proto $3 from $4/$5 to any port $6
	;;
rem)
	exec /sbin/npfctl rule $2 rem-id $7
	;;
flush)
	exec /sbin/npfctl rule $2 flush
	;;
*)
	echo "$0: Unknown command '$1'" 1>&2
	exit 1
	;;
esac
