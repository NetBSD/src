#	$NetBSD: CHANGES-1.4.2,v 1.1.2.83 1999/11/27 16:22:56 he Exp $

A complete list of changes from NetBSD 1.4.1 to NetBSD 1.4.2:

File						Revision(s)
----						--------

bin/pax/tar.c					1.15

  Add the ability to read V7 tar archives which use USTAR-style
  directories.  Addresses PR#8220.

sbin/newfs_msdos/newfs_msdos.c			1.4

  After determining the size of a file being used as an msdosfs image, seek
  back to its start so subsequent writes go to the right places.

lib/libkvm/kvm_file.c				1.14

  Fix kvm_getfiles() so that it works properly on kernel core dumps.

usr.bin/netstat/unix.c				1.18

  Report error returns from kvm_getfiles() more correctly.

sys/lib/libsa/ufs.c				1.26

  Fix a problem that could cause files' seek pointers to be incorrect
  after being opened.

usr.sbin/mbrlabel/mbrlabel.c			1.4-1.5

  Correct usage message and make the MBR examination code function
  properly on architectures which enforce strict alignment.

usr.bin/tail/extern.h				1.4
usr.bin/tail/forward.c				1.16
usr.bin/tail/read.c				1.7
usr.bin/tail/reverse.c				1.11

  Avoid incorrectly-repeated error messages.

sys/msdosfs/denode.h				1.31
sys/msdosfs/fat.h				1.13
sys/msdosfs/msdosfs_fat.c			1.31
sys/msdosfs/msdosfs_vnops.c			1.83

  Fix LP64 problems which made the MS-DOS file system unusable on
  NetBSD/alpha as reported in PR#8037 and several other problems
  encountered while researching it (NFS exporting and printf
  formats).

usr.bin/find/extern.h				1.12
usr.bin/find/find.h				1.12
usr.bin/find/find.1				1.22-1.23
usr.bin/find/function.c				1.31
usr.bin/find/option.c				1.13

  Implement -regex and -iregex primaries which behave similarly (but
  not identically) to the GNU find primaries of the same names.  (The
  differences are caused by differences in the Basic Regular
  Expression implementations.)

distrib/sets/lists/comp/md.arm32		1.25

  Add "usr/include/machine/devmap.h" so that the X server can be built.

sys/dev/rnd.c					patch

  A more consistent branch-specific fix for the data extraction locking
  bug previously fixed.

lib/libc/sys/connect.2				1.14

  Explain how to get status information for non-blocking connects,
  fixing PR#8208.

sys/dev/eisa/eisadevs				1.16
sys/dev/eisa/eisadevs.h				regenerate
sys/dev/eisa/eisadevs_data.h			regenerate
sys/dev/eisa/if_ep_eisa.c			1.21

  Recognize a 3Com 3c509 Combo configured in EISA mode, fixing PR#8234.

usr.sbin/pkg_install/Makefile.inc		1.6-1.10
usr.sbin/pkg_install/add/add.h			1.4
usr.sbin/pkg_install/add/extract.c		1.17-1.20
usr.sbin/pkg_install/add/futil.c		1.7-1.8
usr.sbin/pkg_install/add/main.c			1.10-1.12
usr.sbin/pkg_install/add/perform.c		1.30,1.32-1.39
usr.sbin/pkg_install/add/pkg_add.1		1.16
usr.sbin/pkg_install/admin/main.c		1.4-1.8
usr.sbin/pkg_install/create/create.h		1.12
usr.sbin/pkg_install/create/main.c		1.14
usr.sbin/pkg_install/create/perform.c		1.18-1.19
usr.sbin/pkg_install/create/pkg_create.1	1.17-1.18
usr.sbin/pkg_install/create/pl.c		1.12-1.16
usr.sbin/pkg_install/delete/delete.h		1.5-1.6
usr.sbin/pkg_install/delete/main.c		1.12-1.13
usr.sbin/pkg_install/delete/perform.c		1.24-1.28
usr.sbin/pkg_install/delete/pkg_delete.1	1.13-1.14
usr.sbin/pkg_install/info/info.h		1.10-1.11
usr.sbin/pkg_install/info/main.c		1.17-1.18
usr.sbin/pkg_install/info/perform.c		1.24-1.28
usr.sbin/pkg_install/info/show.c		1.13-1.16
usr.sbin/pkg_install/info/pkg_info.1		1.18
usr.sbin/pkg_install/lib/exec.c			1.6
usr.sbin/pkg_install/lib/file.c			1.28-1.32
usr.sbin/pkg_install/lib/global.c		1.6
usr.sbin/pkg_install/lib/lib.h			1.22-1.26
usr.sbin/pkg_install/lib/lpkg.c			1.2
usr.sbin/pkg_install/lib/pen.c			1.16
usr.sbin/pkg_install/lib/pkgdb.c		1.4
usr.sbin/pkg_install/lib/plist.c		1.19-1.22
usr.sbin/pkg_install/lib/str.c			1.16-1.17

  Update in-tree pkg tools:

  o Pass & use BINDIR instead of hardcoding /usr/sbin.
  o Adapt this to work better on Solaris.
  o Treat absolute paths in PLIST properly, i.e. do not allow them
    at all.
  o Clean up URL handling.
  o Fix conflict checking for package names with hyphens in their name
    by using "pkg-[0-9]*" instead of "pkg-*" for detecting conflicting
    packages.
  o Document PKG_TMPDIR environment variable.
  o De-linting and some code cleanup.
  o @srcdir was renamed to @src a long time ago (fixing PR#7555).
  o Message files in binary packages are not displayed with more(1).
  o Allow specifying a package name without a version.
  o Call deinstall-script again after files are removed, with
    POST-DEINSTALL argument.
  o Disable annoying "key not present" warning.
  o Fix error checking when creating directory for pkgdb.
  o Bring closer to /usr/share/misc/style with the aid of indent(1).
  o Provide full pathnames for chgrp and chown, fixing PR#8250.
  o Hide test for URLlength()>0 behind a macro (IS_URL()).
  o Handle symlinks to directories correctly in "check" and "rebuild"
    targets.
  o More work to run the DEINSTALL script a second time.
  o Some code documentation.

sys/net/if.c					1.51

  Fix a problem in ifa_ifwithnet() for netatalk, making atalkd
  work in more configurations.

sys/netinet/ip_proxy.c				1.18

  Check the protocol before forwarding to proxy module.  Fixes
  PR#7831.

gnu/usr.bin/tar/gnu.c				1.5
gnu/usr.bin/tar/list.c				1.6

  Cast off_t to size_t when passing arguments to functions expecting
  a size_t.  This fixes errors due to memory corruption when
  extracting archives with gtar style long file names on big endian
  machines.  Fixes PR#8229.

doc/tmac/doc-common				1.32

  Mark Ap as callable, fixes formatting of a few man pages.

sys/dev/ata/ata_wdc.c				1.20
sys/dev/ic/wdc.c				1.69-1.70
sys/dev/scsipi/atapi_wdc.c			patch

  Add some debug printfs, change timeout handling to be more efficient
  and less error-prone, and fix the "lockup after lost interrupt"
  problem some users have been reporting.  Also a mostly-stylistic
  change guarding tsleep() with a while() loop, and a retry if PIO
  mode < 3 fails.

share/mk/bsd.man.mk				1.46

  Use -Tascii for pre-generated man pages, avoiding nroff character
  set dependence on LESSCHARSET (!), fixing PR#4522.

etc/mtree/special				1.23-1.24

  Change to match the permissions set on install, and fix for
  nonexistent group name.

share/zoneinfo/africa				1.1.1.10
share/zoneinfo/antarctica			1.1.1.6
share/zoneinfo/asia				1.1.1.9
share/zoneinfo/australasia			1.1.1.9
share/zoneinfo/europe				1.1.1.9
share/zoneinfo/leapseconds			1.1.1.4
share/zoneinfo/northamerica			1.1.1.10
share/zoneinfo/southamerica			1.1.1.9

  Update to tzdata1999e.

sys/miscfs/fdesc/fdesc_vnops.c			1.51-1.53
sys/miscfs/kernfs/kernfs_vnops.c		1.66-1.67
sys/miscfs/procfs/procfs_vnops.c		1.66-1.68

  Protect {fdesc,kernfs,procfs}_readdir against directory seeks
  with bogus offsets.

etc/rc						1.129

  Fix denial-of-service attack involving vi preserve.

usr.bin/su/su.c					1.35

  Fix memory corruption problem.

etc/etc.x68k/MAKEDEV				1.21

  Since we now use Xwrapper to start the X server, we can restrict
  non-root access to grf, mouse and kbd, closing a security hole.

sys/dev/pci/pcidevs				1.137
sys/dev/pci/pcidevs.h				regenerate
sys/dev/pci/pcidevs_data.h			regenerate
sys/dev/pci/if_ex_pci.c				1.7

  Recognize 3c905C-TX card.

sys/msdosfs/msdosfs_vnops.c			1.86

  Do not permit writing to read-only mounted msdosfs file system,
  fixing PR#7619.

sys/sys/fcntl.h					1.17
sys/kern/vfs_vnops.c				1.38
sys/kern/kern_sig.c				1.93

  Don't allow coredump to follow symlinks, this has security 
  implications.

sys/ufs/lfs/lfs_alloc.c				1.23
sys/ufs/lfs/lfs_segment.c			1.28

  Fix a printf format bug that gives compiler warnings/errors on 
  64-bit platforms, fixing PR#8241.

lib/libc/gen/__fts13.c				1.16-1.25

  Fix various bug in fts(3), preventing a buffer overflow on a very
  deep tree, and a silent trucation of the path when fts_pathlen 
  overflows.  Also, make this compile on Linux.

sbin/newfs_lfs/lfs.c				1.5

  Refuse to create a file system with too few segments, which
  would prevent the cleaner from working, fixing PR#7623.

sbin/mount_ados/mount_ados.c			1.9
sbin/mount_cd9660/mount_cd9660.c		1.8
sbin/mount_fdesc/mount_fdesc.c			1.10
sbin/mount_filecore/mount_filecore.c		1.2
sbin/mount_kernfs/mount_kernfs.c		1.11
sbin/mount_lfs/mount_lfs.c			1.8
sbin/mount_msdos/mount_msdos.c			1.20
sbin/mount_nfs/mount_nfs.c			1.23
sbin/mount_null/mount_null.c			1.6
sbin/mount_procfs/mount_procfs.c		1.10
sbin/mount_umap/mount_umap.c			1.9
sbin/mount_union/mount_union.c			1.6

  Regularize error reporting of mount_* commands for failure of
  mount(2) to the form "mount_xxx: dev on dir: reason for failure"
  (as opposed to the old "mount_xxx: : reason for failure").
  This is related to PR#7592, but not a complete fix for that PR.

distrib/sets/lists/xbase/mi			1.14-1.16
distrib/sets/lists/xcomp/mi			1.7-1.8
distrib/sets/lists/xserver/md.arm32		1.5-1.7
distrib/sets/lists/xserver/md.atari		1.4-1.5
distrib/sets/lists/xserver/md.i386		1.10-1.11
distrib/sets/lists/xserver/md.vax		1.3 (new)

  Various changes to sync these files with xsrc.  Specifically:
   o Update for XFree86 3.3.4
   o Update for XFree86 3.3.5
   o Add Vax X11 server
   o RCS Id policy conformance

distrib/sets/makeflist				1.16

  Cope with #-comments in distrib set files.

etc/security					1.40

  Don't try to grab disklabels from CDs.

sys/nfs/nfs_subs.c				1.71

  Don't truncate minor numbers > 255 on a NFS client.

sys/arch/i386/i386/locore.s			1.212

  Make kernels configured without npx link again, fixing PR#8262.

sbin/disklabel/interact.c			1.10

  'Label disk?' prompt should check for 'Y' as well as 'y'.

sys/dev/isa/files.isa				1.89

  The nca driver mistakenly detects an i82585tx as its hardware.
  Move the nca driver probe after the iy probe (which is more
  friendly to other hardware).

share/mk/bsd.doc.mk				1.43
share/mk/bsd.files.mk				1.10
share/mk/bsd.kmod.mk				1.32
share/mk/bsd.lib.mk				1.157
share/mk/bsd.man.mk				1.48
share/mk/bsd.nls.mk				1.19
share/mk/bsd.prog.mk				1.103

  Allow natural use of multiple "make" targets within the main tree
  without setting BUILD in /etc/mk.conf, or anywhere else.
  Particularly, permit "make all install" and "make file install"
  (where file is installed by "make install"). Behavior with BUILD
  set is unchanged.  Fixes PR#8313 and PR#3894.

sys/dev/ic/i82586.c				1.24

  Remove a spurious printf() from the interrupt handler which got
  triggered when sharing the interrupt level with other devices.

gnu/dist/gdb/config/arm/tm-armnbsd.h		1.5

  Make single-stepping over conditional instructions work on the
  ARM32, fixing PR#7565 and possibly PR#8156.

sys/dev/ic/clmpccreg.h				1.2
sys/dev/ic/clmpccvar.h				1.3
sys/dev/ic/clmpcc.c				1.6

  Fix panics seen by some people during mvme167 installation.

distrib/utils/sysinst/arch/mac68k/md.c		1.12

  Insert a leading slash in device name used in md_pre_disklabel(),
  fixing PR#8384.

sys/arch/arm32/podulebus/if_ie.c		patch

  Fix Berkeley Packet Filter support, fixing PR#8343.

sys/dev/ic/smc91cxx.c				1.18-1.19

  Avoid multicast packet loopback from itself during promiscuous mode.
  This makes the driver behave as IFF_SIMPLEX interface in all cases.

sys/dev/ic/elinkxl.c				1.14
sys/dev/ic/elinkxlreg.h				1.2

  Select the right tranceiver type when configuring the driver,
  and change the timing for the MII code a bit.  Fixes the problem
  reported in PR#8363 with the MII not being reported
  correctly.

sys/dev/pci/ncr.c				1.81

  Make the ncr driver work with more than 5 devices on the same
  bus.  Fixes PR#6347.

sys/dev/pci/ncr.c				1.82

  Make driver build with Tekram EEPROM support enabled.
  Fixes PR#8141.

sys/dev/pci/ncr.c				1.83

  Zero out DMA memory regions to avoid use of uninitialized
  memory (and resulting "COMMAND FAILED" errors) on systems
  which don't clear memory on boot.

sys/dev/wscons/wsemul_vt100_keys.c		1.3

  Map the Home and End keys as xterm does.

sys/arch/i386/conf/DISKLESS			1.67

  Update device name ed* -> we*, fixing PR#7503 and PR#8020.

lib/libc/arch/arm32/Makefile.inc		1.7
lib/libc/arch/arm32/gen/divsi3.S		1.3-1.4
sys/lib/libkern/arch/arm32/divsi3.S		1.3-1.6

  If the highest bit of the dividend is set, care must be taken when
  shifting the divisor.  Fixes PR#7760.  Also, arrange for this file
  to be copied to libkern via libc's copy-to-libkern target.

usr.sbin/amd/AUTHORS				1.1.1.7
usr.sbin/amd/Makefile				1.9-1.12
usr.sbin/amd/amd/am_ops.c			1.9
usr.sbin/amd/amd/amd.c				1.12
usr.sbin/amd/amd/amfs_auto.c			1.1.1.3
usr.sbin/amd/amd/amfs_program.c			1.1.1.3
usr.sbin/amd/amd/amfs_toplvl.c			1.1.1.3
usr.sbin/amd/amd/amq_subr.c			1.11
usr.sbin/amd/amd/amq_svc.c			1.8
usr.sbin/amd/amd/conf.c				1.7
usr.sbin/amd/amd/conf_parse.y			1.6
usr.sbin/amd/amd/info_hesiod.c			1.1.1.2
usr.sbin/amd/amd/info_nis.c			1.14
usr.sbin/amd/amd/map.c				1.12
usr.sbin/amd/amd/mapc.c				1.12
usr.sbin/amd/amd/nfs_prot_svc.c			1.8
usr.sbin/amd/amd/nfs_start.c			1.10
usr.sbin/amd/amd/ops_cdfs.c			1.8
usr.sbin/amd/amd/ops_nfs.c			1.8
usr.sbin/amd/amd/opts.c				1.9
usr.sbin/amd/amd2netbsd				1.20-1.22
usr.sbin/amd/amq/amq.c				1.13
usr.sbin/amd/doc/Makefile			1.6-1.7
usr.sbin/amd/doc/am-utils.info			deleted
usr.sbin/amd/doc/am-utils.info-1		deleted
usr.sbin/amd/doc/am-utils.info-2		deleted
usr.sbin/amd/doc/am-utils.info-3		deleted
usr.sbin/amd/doc/am-utils.info-4		deleted
usr.sbin/amd/doc/am-utils.info-5		deleted
usr.sbin/amd/doc/am-utils.info-6		deleted
usr.sbin/amd/doc/am-utils.texi			1.1.1.6
usr.sbin/amd/doc/hlfsd.ps			1.1.1.3
usr.sbin/amd/doc/version.texi			1.1.1.6
usr.sbin/amd/fixmount/fixmount.c		1.7
usr.sbin/amd/fsinfo/fsi_gram.y			1.8
usr.sbin/amd/fsinfo/fsinfo.c			1.11
usr.sbin/amd/hlfsd/hlfsd.c			1.8
usr.sbin/amd/include/am_compat.h		1.1.1.5
usr.sbin/amd/include/am_defs.h			1.10
usr.sbin/amd/include/am_utils.h			1.8
usr.sbin/amd/include/amd.h			1.7
usr.sbin/amd/include/amu_nfs_prot.h		1.7
usr.sbin/amd/include/config.h			1.15
usr.sbin/amd/libamu/mkconf			1.1.1.2
usr.sbin/amd/libamu/mount_fs.c			1.1.1.7
usr.sbin/amd/libamu/tranputil.c			1.1.1.7
usr.sbin/amd/libamu/wire.c			1.1.1.5
usr.sbin/amd/libamu/xutil.c			1.4
usr.sbin/amd/mk-amd-map/mk-amd-map.c		1.11
usr.sbin/amd/pawd/pawd.c			1.1.1.3
usr.sbin/amd/wire-test/wire-test.c		1.5

  Upgrade amd(8) and related software to fix expoitable stack overflows
  in amq(8), as reported in BUGTRAQ and elsewhere.

usr.sbin/config/sem.c				1.23

  Fix the (English) grammar in a couple of places.

distrib/sets/lists/base/mi			1.122
usr.bin/Makefile				1.107
usr.bin/mktemp/Makefile				1.1-1.2 (new)
usr.bin/mktemp/mktemp.1				1.1-1.3 (new)
usr.bin/mktemp/mktemp.c				1.1-1.2 (new)

  Add mktemp(1), a utility to make temporary files for shell scripts.

sys/kern/uipc_socket2.c				1.31-1.33

  Compact mbuf clusters, to help prevent mbuf cluster exhaustion when
  receiving lots of small packets.  This costs some performance (the
  compaction copies data), but adds a lot of stability to many systems.

sys/dev/pci/if_vr.c				1.26

  Fix packet reception in promiscuous mode: compare the Ethernet
  destination address against our station address if it's not a
  multicast packet.  Fixes a redirect storm problem.

sys/arch/alpha/conf/Makefile.alpha		1.53
sys/arch/amiga/conf/Makefile.amiga		1.82

  Be more efficient when linking kernels with debugging symbols.  (Don't
  copy them just to strip them, use strip -o.)

usr.bin/col/col.c				1.11

  Fix incorrect option string used in call to getopt(3).  Fixes PR#8475.

gnu/dist/gprof/gprof.1				1.2

  Remove references to nonexistent manual pages and replace them with
  up-to-date references where appropriate.

share/man/man8/compat_ultrix.8			1.9

  Fix typo in roff macro name.

bin/df/df.c					1.32

  Fix an overflow when using df(1) on a big partition's raw device,
  where the number of available blocks would be displayed incorrectly.

usr.bin/join/join.c				1.16

  Fix incorrect array size in a call to memset(), and avoid a possible
  segmentation fault in a call to memmove().  Fixes PR#8184.

sys/dev/raidframe/rf_netbsdkintf.c		1.20
sys/dev/raidframe/rf_raid.h			1.6
sys/dev/raidframe/rf_states.c			1.7

  Add a more reasonable throttling mechanism to the RAIDframe code.
  Increases write performance, and helps prevent the I/O routines from
  using too much kernel memory.

sys/sys/disklabel_mbr.h				1.4

  Correct NTFS partition type.

usr.sbin/mbrlabel/mbrlabel.c			1.6
sys/sys/disklabel_mbr.h				1.5

  Correct handling of extended partitions within extended partitions, and
  add support for Linux extended partitions.

include/db.h					1.17

  Fix P_{16,32}_SWAP() macros to avoid unaligned 16 and 32 bit
  memory accesses.  This fixes a problem seen on arm32 when trying
  to use the db(3) functions to access a BIG_ENDIAN btree.

usr.bin/systat/extern.h				1.8-1.9
usr.bin/systat/fetch.c				1.5
usr.bin/systat/main.c				1.16
usr.bin/systat/netstat.c			1.11
usr.bin/systat/pigs.c				1.14

  LP64 and type sanity fixes, with visible effects of enabling echo
  on commands and correct cursor placement after update.

usr.bin/systat/cmds.c				1.10
usr.bin/systat/keyboard.c			1.6

  Do not downcase input, which prevented "ignore X11" in the
  "netstat" display from working.  Fixes PR#7655.

sys/dev/raidframe/rf_layout.c			1.4

  Do not continue the configuration process if sectorsPerStripeUnit is
  not larger than 0.

sys/dev/raidframe/rf_driver.c			1.12

  rf_UnconfigureVnodes() needs to be called in the DO_RAID_FAIL macro.

sys/dev/raidframe/rf_netbsdkintf.c		1.21

  splbio()/splx() protect some reconstruction code to avoid
  potentially bad interatctions with the pool code.

sys/dev/raidframe/rf_parityscan.c		1.5

  Do not allow rebuilding parity on a degraded RAID set.  Also, don't
  allow parity rewriting on a RAID 0 set, as that makes no sense.

usr.bin/audio/common/audio.c			1.9

  Fix an off-by-one error in the error message array.

usr.bin/audio/record/record.c			1.6
usr.bin/audio/play/audioplay.1			1.5
usr.bin/audio/play/play.c			1.11

  If not specified on the command line, attempt to fall back
  to the environment variables AUDIODEVICE (for -d) and
  AUDIOCTLDEVICE (for -C) before falling back to _PATH_* constants.

usr.bin/audio/record/record.c			1.7-1.8

  Fix audiorecord(1)'s "-t" option so that it actually works.

usr.bin/audio/record/audiorecord.1		1.6-1.7

  Document AUDIODEVICE and AUDIOCTLDEVICE environment variables
  and the -t option.

share/man/man7/environ.7			1.8

  Document the AUDIODEVICE and AUDIOCTLDEVICE environment variables.

usr.bin/audio/play/play.c			1.13

  Honor the "-f" flag even if we appear to recognize a broken Sun audio
  file, and fix an error message on little-endian hosts.

usr.sbin/mopd/common/dl.c			1.4

  In a program request packet during the second and third stage of an
  Ultrix/mips MOP boot, the "software" packet is 256 bytes - bump the
  size of the program array (maximum for the VAX must only be 16 bytes).

sys/dev/raidframe/rf_netbsdkintf.c		1.24

  Don't allow reconstructs, copybacks, or forced failures of components if
  using a RAID 0, since RAID 0 can't handle those sorts of things.

sys/dev/raidframe/rf_parityscan.c		1.6

  Don't panic the system just because there is a problem verifying
  the parity.

sys/dev/raidframe/rf_reconstruct.c		1.6

  Clean up reconstruction accounting a bit.  While it worked before, it
  was slightly broken in the case where the RAID set did not support
  reconstruction.

sys/dev/raidframe/rf_netbsdkintf.c		1.26

  Correct and/or improve detection of bogus row/column values passed
  in via ioctls.

sys/dev/raidframe/rf_reconmap.c			1.6

  Fix an 'off-by-one' error in a RF_ASSERT which meant that a reconstruct
  would panic in the case where the stripe width was 1 block.

usr.sbin/nfsd/nfsd.c				1.31
usr.sbin/nfds/nfsd.8				1.10-1.11

  Serve UDP requests by default if neither UDP nor TCP is specified,
  as already documented in the man page.  Fixes PR#7358.

libexec/ftpd/ftpd.c				1.70

  Avoid segmentation fault if there is an empty line in /etc/ftpusers,
  fixing PR#8504.

sys/arch/amiga/dev/sbic.c			1.36

  Make this compile with options DEBUG.

sys/dev/pci/if_tireg.h				1.1 (new)
sys/dev/pci/ti_fw.h				1.1 (new)
sys/dev/pci/ti_fw2.h				1.1 (new)
sys/dev/pci/if_ti.c				patch (new)
sys/dev/pci/files.pci				1.62 via patch
sys/dev/pci/pcidevs				1.150 via patch
sys/dev/pci/pcidevs_data.h			regenerate
sys/dev/pci/pcidevs.h				regenerate

  Add a driver for Alteon Gigabit Ethernet cards.

sys/nfs/nfs_boot.c				1.51-1.52

  Mount diskless root with "noconn" option to allow easier use of
  multi-homed servers.  Also, wait a while between bringing up
  interface and using it, to allow drivers to establish link settings.

libexec/ftpd/ftpcmd.y				1.39

  Don't use an undefined C expression, fixing PR#8534.

gnu/dist/bfd/targets.c				1.10

  Fix calculation of size of bfd_target_vector, which was incorrect and
  would cause some bfd-using programs (e.g. ar) to crash.  Fixes PR#8200
  and PR#8573.

usr.bin/rwho/rwho.c				1.12

  Use full hostnames when sorting rwho database entries.  Fixes PR#8401.

usr.bin/id/id.c					1.15

  Fix inconsistent format between `id' and `id userid'.  Fixes PR#8706.

bin/sh/jobs.c					1.32

  Allow the tty interrupt character (e.g. ^C) to interrupt loops run
  in an interactive shell again.

distrib/sets/lists/base/mi			1.129
distrib/sets/lists/misc/mi			1.22
etc/mtree/NetBSD.dist				1.92
usr.sbin/dhcp/server/Makefile			1.5

  Install an example dhcpd.conf into /usr/share/examples/dhcp
  to provide an example of how to setup a dhcp server.

sys/arch/i386/conf/GENERIC			1.262, 1.264 via patch
distrib/notes/i386/hardware			1.56

  Remove "nca* at isa?" from i386 GENERIC kernel.  Its probe function
  gives false positives and steps on other hardware.  Fixes PR#8361.

usr.sbin/quot/quot.c				1.15-1.16

  Fix integer overflows with file systems >=2GB.

sys/nfs/nfs_nqlease.c				1.30

  Fix an odd corner case if you use nfsv3 and nqnfs at the same time:
  v3 changes the error-case behavior of the nfsm_reply macro, but the
  caller keeps going and in this case you end up calling vput(NULL).

sys/net/route.c					1.28

  Avoid duplicate free() calls if a route's gateway points to itself,
  by marking a route down (~RTF_UP) _after_ calling RTFREE on its
  gateway.  Partial fix for PR#4561 and PR#4827 (the looped route can
  still occur, but it won't cause a panic).

sys/net/pfil.c					1.9

  Fix panic()s in pfil_list_remove() when running "ipf -D" a second
  time with a DIAGNOSTIC kernel.

sys/arch/arm32/arm32/db_machdep.c		1.14
sys/coda/coda_subr.c				1.7
sys/coda/coda_vnops.c				1.13
sys/kern/vfs_subr.c				1.111-1.112
sys/sys/vnode.h					1.65
sys/ufs/lfs/lfs_segment.c			1.31
sys/ufs/mfs/mfs_vnops.c				1.18
usr.sbin/pstat/pstat.c				1.46

  Fix potential overflow of v_usecount and v_writecount (and panics
  resulting from this) by widening them to `long'.  Mostly affects
  systems where maxvnodes>=32768.

lib/libntp/systime.c				1.4-1.6

  Fix an LP64 bug that would cause NTP to report "previous time
  adjustment did not complete" on NetBSD/alpha.  Fixes PR#7602.

usr.sbin/xntp/xntpd/ntp_proto.c			1.6

  Improve calculation of 'tick' used in the precision estimate.

usr.sbin/xntp/xntpd/ntp_peer.c			1.5

  Don't start all peers simultaneously if using DNS names in ntp.conf.

sys/kern/kern_clock.c				1.50

  If using kernel NTP PLL, initialize "fixtick" to a reasonable
  approximation of reality if machine-dependent code doesn't.  This
  allows a NetBSD/alpha kernel (where hz=1024) with "options NTP" to
  synch up quite nicely (as opposed to having an frequency error of
  ~560ppm, which is outside the capture range of the PLL).

sys/arch/alpha/alpha/clock.c			1.26

  Patch time_precision so we report a realistic NTP "precision"
  value to userland.

libexec/lfs_cleanerd/library.c			1.13-1.14

  Remove incorrect partial-segment timestamp optimization from
  lfs_segmapv which would cause continuous cleaning and eventual
  panics with "no clean segments."  Don't complain if fstat() fails
  on the Ifile when the file system has been unmounted (avoids
  expected errors every time an LFS is unmounted).

usr.sbin/tcpdump/Makefile			1.16
usr.sbin/tcpdump/interface.h			1.10
usr.sbin/tcpdump/print-tcp.c			1.15
usr.sbin/tcpdump/tcpdump.c			1.12 via patch
usr.sbin/tcpdump/tcpdump.8			1.10-1.11 via patch
usr.sbin/tcpdump/print-ascii.c			1.1 (new)
usr.sbin/tcpdump/print-telnet.c			1.1 (new)

  Add telnet option printing and hex/ascii dumps to tcpdump.

bin/ps/print.c					1.44
usr.sbin/ac/ac.c				1.9
usr.bin/systat/ps.c				1.6
usr.bin/w/w.c					1.32

  Make various utilities skip "dty" as well as "tty" on terminals,
  so that the actually used tty is visiable instead of just 'dt'.

sys/kern/kern_synch.c				1.66

  Correct use of `wrong' clock for %cpu calculation.  (This is not
  a functional change at present because all clock frequencies are
  the same.)

sys/netinet/ip_input.c				1.93
sys/netinet/ip_flow.c				1.14

  Multicast storm prevention: don't attempt to forward link-level
  multicast packets which contain ip unicast packets; these packets
  would only be generated from misconfigured/buggy systems.

sys/adosfs/advfsops.c				1.37-1.38
sys/coda/coda_vnops.c				1.14
sys/filecorefs/filecore_vfsops.c		1.8
sys/isofs/cd9660/cd9660_vfsops.c		1.40
sys/miscfs/specfs/spec_vnops.c			1.44
sys/miscfs/union/union_subr.c			1.36
sys/msdosfs/msdosfs_vfsops.c			1.63
sys/ufs/ext2fs/ext2fs_vfsops.c			1.28
sys/ufs/ffs/ffs_vfsops.c			1.53
sys/ufs/lfs/lfs_vfsops.c			1.39
sys/uvm/uvm_swap.c				1.29

  In spec_close(), call the device's close routine with the vnode
  unlocked if the call might block. Force a non-blocking close if
  VXLOCK is set.  This eliminates a potential deadlock situation, and
  should eliminate the dirty buffers on reboot issue.

etc/rc.conf					1.59

  Add "-f /var/db/ntp.drift" to default xntpd parameters to make it
  more likely the clock frequency error learned by NTP will be
  retained across reboots.

sys/dev/wscons/wsdisplay.c			1.31
sys/dev/wscons/wsdisplay_compat_usl.c		1.10
sys/dev/wscons/wsdisplayvar.h			1.13

  Enable VT-switching ioctls on ttyEcfg, which allows Linux X servers
  to work when properly configured (with symlink /emul/linux/dev/tty0
  -> /dev/ttyEcfg).

sys/arch/macppc/include/disklabel.h		1.4
sys/arch/macppc/macppc/disksubr.c		1.5

  Add support for reading MacOS-partitioned disks. Stolen from the mac68k
  port, but modified in that macppc searches for netbsd-partitioned
  disks before MacOS partitioned disks, since installboot generates a
  fake MacOS partition table which isn't the one we want to use.

sys/arch/macppc/include/vmparam.h		1.9
sys/arch/macppc/include/param.h			1.5-1.6

  Fix "panic: startup: cannot allocate VM for buffers" right after
  copyright message when RAM > approx. 128MB.
  Move kernel segment base to 0xf00000, some Power Macintosh 9500s
  won't boot witht he old value.

sys/arch/powerpc/powerpc/pmap.c			1.24

  Make sure we only use addresses inside the available memory region
  in pmap_bootstrap.

distrib/notes/pmax/install			1.21

  Include the root-path in the booptab and dhcpd.conf examples.

distrib/utils/sysinst/arch/pmax/md.c		1.34

  During a custom partition layout, don't create an empty /usr
  partition that newfs fails on if / and swap take up the entire disk.

distrib/pmax/Makefile.inc			1.2
distrib/pmax/instkernel/Makefile		1.5-1.11
distrib/pmax/ramdisk/Makefile			1.4-1.9
etc/etc.pmax/Makefile.inc			1.4-1.5

  Bring pmax release building machinery up-to-date.

sbin/ldconfig/ldconfig.c			1.23-1.25

  Do not handle a missing /etc/ld.so.conf as a fatal error,
  and plug a file descriptor leak.

sys/arch/i386/conf/GENERIC			1.255
sys/dev/pci/files.pci				1.57
sys/dev/pci/pcidevs				patch
sys/dev/pci/pcidevs_data.h			regenerate
sys/dev/pci/pcidevs.h				regenerate
sys/dev/pci/if_rl.c				1.2 + patch (new)
sys/dev/pci/if_rlreg.h				1.1 (new)

  Add a driver for Realtek Ethernet cards.

sys/kern/kern_time.c				1.41

  If time delta is larger than thresh, use 10* adjustment factor.
  Make this work for negative deltas too.  Fixes PR#8589.

sys/dev/scsipi/scsiconf.c			1.129-1.130

  Add quirks for Toshiba XM-3401TA SCSI CD-ROM and CDU-561 CD-ROM,
  fixing PR#7438 and PR#8608.

lib/libc/net/inet_pton.c			1.10

  Fix IPv6 parsing for the benefit of BIND.

gnu/usr.bin/ld/ld/lib.c				1.20

  Don't abuse alloca() for allocating string sections which can
  easily have a size of several megabytes, exceeding the hard stack
  limit on some ports.  Fixes PR#8547.

sys/dev/ic/wdc.c				1.76

  The WDCF_IRQ_WAIT flag was erroneously cleared when an earlier
  interrupt not for this IDE channel controller was received.
  Fixes the "missing untimeout" problems and PR#8639.

sys/uvm/uvm_device.c				1.17

  Bugfix for device mmap fault handler, fixes serious performance
  problem with alpha X server.

sys/ufs/lfs/lfs_bio.c				1.12

  Fix LFS buffer starvation under degenerate access patterns.

distrib/notes/pmax/install			1.22

  The netboot kernel is called "install.ecoff", not "install".

sys/arch/i386/conf/INSTALL			patch

  Add "rl" and "vr" PCI Ethernet device drivers.  Remove EXEC_ELF32
  and "en at pci" to make install kernel still fit in 1.44MB.  ATM-
  only machines should be rare, and will need to borrow an ethernet
  card for installation or use a custom install floppy.

sys/arch/i386/conf/GENERIC			patch

  Add "rl" PCI Ethernet device driver.

sys/dev/cons.c					1.33

  Catch a console configuration error.  Instead of jumping through
  cdevsw indexed on major(NODEV), call panic, fixing PR#8690.

share/man/man5/passwd.5				1.13

  Document what an & in the GECOS field does, fixing PR#8655.

usr.sbin/pppd/pppd/pppd.8			1.26

  Document the callback option, fixing PR#8550.

share/man/man4/audio.4				1.29

  Add missing "that" in AUDIO_WSEEK description, fixing PR#8664.

sys/arch/hp300/dev/scsi				1.26

  Print vendor/product/rev also for SCSI-3 devices.

distrib/utils/sysinst/net.c			1.55

  Do not mislead users by inserting "lookup files bind" in
  /etc/resolv.conf; after we converted to nsswitch this is
  handled elsewhere.

distrib/notes/pmax/install			1.22

  Note that the netboot kernel is called "install.ecoff", not "install".

gnu/usr.bin/send-pr/send-pr.man			1.5

  Document the files and environment variables used by send-pr to fill in
  defaults for problem reports, in the FILES and ENVIRONMENT sections
  of the manual page, respectively.  Fixes PR#1889.

gnu/usr.bin/send-pr/fields.texi			1.3
gnu/usr.bin/send-pr/send-pr.sh			1.18
gnu/usr.bin/send-pr/send-pr.texi		1.3

  Change the example values of the Confidential field from "yes | no" to
  "no | yes" so that "yes" will be less likely to be used accidentally.

sys/nfs/nfs_socket.c				1.51
sys/nfs/nfs_vfsops.c				1.84
sys/nfs/nfsmount.h				1.18

  Avoid a panic when forcibly unmounting a hung NFS mount, e.g. at
  reboot.

usr.bin/fmt/fmt.c				1.10-1.11

  Process lines longer than BUFSIZ characters correctly.

lib/libc/net/inet_pton.c			1.13

  Check for invalid digits in number components.  Fixes PR#8314.

sys/arch/arm32/arm32/copystr.S			1.11-1.13

  Fix problems in copy{,in,out}str() with zero-length buffers.

sys/dev/ccd.c					1.64

  Fix a dobule-biodone() panic when ccd component buffers have errors.

sys/arch/m68k/include/psl.h			1.3

  Provide multiple inclusion protection.

sys/msdosfs/msdosfs_vnops.c			1.88

  Set iovec offset correctly in msdosfs_readdir() so that some long
  filename entries won't be ignored when the contents of the directory
  don't fit in the user buffer all at once.  Fixes PR#4492.

sys/arch/sparc/sparc/locore.s			1.126

  Fix several panics in copy{in,out,}str().

sys/arch/i386/isa/pms.c				1.43

  Disable a diagnostic printout ("opmsprobe: command error" if no mouse
  is connected) which is often misunderstood to be an error message.

sys/ufs/lfs/lfs_vnops.c				1.29-1.30

  Check for cross-device rename before setting up dirop markers in
  lfs_rename.  Addresses PR#8577.

bin/ps/extern.h					1.14
bin/ps/print.c					1.45-1.46
bin/ps/procfs_ops.c				1.5-1.7
bin/ps/ps.c					1.29-1.31

  When using the procfs for extracting process information, extract process
  start time, arguments, and session leadership status.  Also, fall back to
  procfs when kvm_openfiles() completely fails (e.g. when /dev/mem is not
  readable).  Fixes PR#7772.

gnu/dist/gcc/combine.c				1.2-1.3 via patch

  Fix a misoptimization by disabling the optimization in certain cases.

etc/etc.mac68k/MAKEDEV				1.44
sys/arch/mac68k/conf/GENERIC			1.90
sys/arch/mac68k/mac68k/conf.c			1.53 via patch

  Add Coda support to NetBSD/mac68k.

libexec/lfs_cleanerd/clean.h			1.8

  Fix arithmetic overflow which had prevented cleaning of segments
  above the first 2GB of the file system.

sys/dev/raidframe/rf_dagutils.c			1.5

  Do not trust the parity disk for read balancing in a RAID 1 set
  if we know that the parity might not be up-to-date (and if we
  have a choice in the matter).

sys/arch/i386/i386/apmcall.s			1.6

  Make a standard kernel usable on IBM laptops (and possibly others).
  Some machines require interrupts enabled at suspend-time in order
  to avoid a hang at resume.  Fixes PR#6279.

sys/nfs/nfs_socket.c				1.52-1.53

  Fix overzealous DIAGNOSTIC check in nfs_disconnect() and
  don't try to copy a possibly freed mbuf.  Fixes PR#8249, PR#8288
  and PR#8766.

distrib/i386/floppies/Makefile			1.10
distrib/i386/floppies/bootfloppy-common/Makefile.inc	1.19
distrib/i386/floppies/fdset-common/Makefile.inc	1.7
distrib/i386/floppies/ramdisk/Makefile		1.18
etc/etc.i386/Makefile.inc			1.13

  Improve automation for "make release", so that boot images are
  automatically built and installed in RELEASEDIR.

usr.bin/audio/play/play.c			1.15-1.16 via patch

  Do not treat failure to open a file as a fatal error, fixing
  PR#8748.  Change two GNU C statements to valid ANSI C.

usr.bin/audio/record/record.c			1.9

  Do not indicate success in the exit status if usage instructions
  had to be printed.

lib/libc/sys/Makefile.inc			1.97 via patch
lib/libposix/sys/Makefile.inc			1.11

  Do call graph profiling for system calls.  Fixes PR#4976.

usr.bin/top/machine/m_netbsd13.c		1.9

  Add trailing "," to memory names, making output easier to read.

lib/libc/locale/_def_time.c			1.6

  Make the output in the C/POSIX locale conform to XSH5 and C99,
  so that single digits are not preceded by 0 but by a space.

usr.sbin/pkg_install/add/main.c			1.13

  Do not crash if realpath() fails, which can happen if current
  directory is no longer valid.

usr.sbin/apmd/apmd.c				1.12

  Avoid excessive printing of power status.

usr.sbin/mtree/Makefile				1.14
usr.sbin/mtree/code.c				1.1-1.4 (new)
usr.sbin/mtree/create.c				1.24
usr.sbin/mtree/extern.h				1.6
usr.sbin/mtree/mtree.8				1.12
usr.sbin/mtree/spec.c				1.17

  Make mtree able to properly encode file names with `funny' albeit
  legal characters (`#', ` ', binary characters), fixing PR#5006 and
  PR#7663.

share/man/man8/compat_osf1.8			1.1 (new)

  Provide minimal documentation for the Alpha OSF/1 aka Tru64 compat
  environment.

lib/libc/net/inet_pton.c			1.14

  Do proper overflow checking of IPv4 addresses, fixing PR#8314.

usr.sbin/mountd/mountd.c			1.58 via patch

  Avoid spurious inaccessibility of exported file systems while
  mountd is restarted or told to reload the exports file, fixing
  PR#8791.

usr.sbin/rwhod/rwhod.c				1.16

  Fix possible Denial-of-Service attack triggered by sending short
  packets to rwhod.

usr.sbin/iostat/iostat.c			1.18

  Truncate device names at 7, not at 3 chars (so raid0 et al comes
  out ok).

sys/arch/mac68k/dev/zs.c			1.32

  Allow rates higher than 57600, fixing PR#8070

sys/arch/alpha/pci/sio.c			1.27

  Add support for the PCI<->ISA bridge in the DS10, allowing it to
  boot.

lib/libc/gen/vis.c				1.14

  Make vis work again for chars > 0177 in VIS_OCTAL mode.  Fixes
  PR#8802.

usr.sbin/ypserv/ypinit/Makefile.yp		1.9

  Sort maps before makedbm. Can speed up large maps over tenfold.

sys/arch/mac68k/dev/adb.c			1.28,1.30-1.32 via patch
sys/arch/mac68k/dev/adb_direct.c	 	1.26-1.33 via patch
sys/arch/mac68k/dev/adbsys.c	 		1.41-1.42
sys/arch/mac68k/dev/aed.c	 		1.8
sys/arch/mac68k/dev/ite.c	 		1.52
sys/arch/mac68k/dev/pm_direct.c	 		1.10

  Clean up the ADB driver, and eliminate duplicate keystrokes under
  heavy load, fixing PR#7870.

sys/dev/ic/aic7xxx.c				1.36

  Add a brief delay after resetting the chip before checking to see
  if it's done.  Trying to talk to the chip while it is unresponsive
  can cause a "machine check" on some platforms/busses.

sys/dev/ic/clmpcc.c				1.8

  Fix a problem with changing baud rate to > 9600, and a problem
  with setting the Rx FIFO threshold register.

regress/sys/kern/getcwd/getcwd.c		1.4-1.5

  Compensate for fix to PR#7761 (kernel now clips overly large
  length), and add another test.

sbin/fdisk/fdisk.8				1.20

  Fix typo and clean up usage of commas a little.

usr.sbin/mountd/mountd.c			1.56

  Reorder arguments to error message so the message actually makes
  sense.

distrib/sets/lists/man/mi			1.152 via patch, 1.158

  Add am-utils.info and mktemp(1).

sys/arch/atari/atari/genassym.cf		1.13
sys/arch/atari/atari/locore.s			1.64
sys/arch/atari/atari/trap.c			1.45
sys/arch/mvme68k/mvme68k/genassym.cf		1.15
sys/arch/mvme68k/mvme68k/locore.s		1.56
sys/arch/mvme68k/mvme68k/trap.c			1.33
sys/arch/x68k/x68k/genassym.cf			1.11
sys/arch/x68k/x68k/locore.s			patch (part of 1.51)
sys/arch/x68k/x68k/trap.c			1.34

  Fix the problem where single-step tracing of a trap instruction
  makes the system fall into kernel debugger.

sys/dev/scsipi/scsiconf.c			1.123

  Add SCSI quirk for UMAX Astra 1220S scanner: skip LUN check,
  fixes PR#7991.

usr.bin/vi/ex/ex_tag.c				1.10

  Fix vi to handle tags files with relative paths in them.

share/man/man8/man8.pmax/boot.8			1.6

  Fix minor typo - missing `)'.

sys/kern/kern_exec.c				1.104

  Add explicit instruction and data cache flush on machines which
  needs it when installing the signal trampoline code.  This makes
  regress/sys/kern/sigtramp work on M68060 processors.

sys/arch/amiga/amiga/sys_machdep.c		1.26
sys/arch/atari/atari/sys_machdep.c		1.21
sys/arch/hp300/hp300/sys_machdep.c		1.27
sys/arch/mvme68k/mvme68k/sys_machdep.c		1.19
sys/arch/next68k/next68k/sys_machdep.c		1.9
sys/arch/x68k/x68k/sys_machdep.c		1.18

  Fix i-cache/d-cache synchronization for M68040 cpus (see M68040
  UM p.4-10).  Makes regress/sys/kern/sigtramp work even on M68040.

usr.sbin/pkg_install/lib/file.c			1.33

  Do not preserve uids or permissions of checked-out files (MTREE,
  DEINSTALL, INSTALL) into binary package tar files.  Does not
  affect files installed by the package itself.

sys/arch/alpha/alpha/pmap.c			1.116

  Fix bugs in pmap_protect():
   o do not overrun eva by L1SEG_SIZE - PAGE_SIZE.
   o do not advance sva twice for each valid l3 or l2 page.

etc/Makefile					1.122,1.126 via patch
distrib/sets/lists/etc/mi			1.38

  Create and install $DESTDIR/etc/aliases.db, using
  $DESTDIR/etc/sendmail.cf, so that sendmail works "out of the
  box".
