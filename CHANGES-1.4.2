#	$NetBSD: CHANGES-1.4.2,v 1.1.2.42 1999/09/27 03:16:12 cgd Exp $

A complete list of changes from NetBSD 1.4.1 to NetBSD 1.4.2:

File						Revision(s)
----						--------

bin/pax/tar.c					1.15

  Add the ability to read V7 tar archives which use USTAR-style
  directories.  Addresses PR#8220.

sbin/newfs_msdos/newfs_msdos.c			1.4

  After determining the size of a file being used as an msdosfs image, seek
  back to its start so subsequent writes go to the right places.

lib/libkvm/kvm_file.c				1.14

  Fix kvm_getfiles() so that it works properly on kernel core dumps.

usr.bin/netstat/unix.c				1.18

  Report error returns from kvm_getfiles() more correctly.

sys/lib/libsa/ufs.c				1.26

  Fix a problem that could cause files' seek pointers to be incorrect
  after being opened.

usr.sbin/mbrlabel/mbrlabel.c			1.4-1.5

  Correct usage message and make the MBR examination code function
  properly on architectures which enforce strict alignment.

usr.bin/tail/extern.h				1.4
usr.bin/tail/forward.c				1.16
usr.bin/tail/read.c				1.7
usr.bin/tail/reverse.c				1.11

  Avoid incorrectly-repeated error messages.

sys/msdosfs/denode.h				1.31
sys/msdosfs/fat.h				1.13
sys/msdosfs/msdosfs_fat.c			1.31
sys/msdosfs/msdosfs_vnops.c			1.83

  Fix LP64 problems which made the MS-DOS file system unusable on
  NetBSD/alpha as reported in PR#8037 and several other problems
  encountered while researching it (NFS exporting and printf
  formats).

usr.bin/find/extern.h				1.12
usr.bin/find/find.h				1.12
usr.bin/find/find.1				1.22-1.23
usr.bin/find/function.c				1.31
usr.bin/find/option.c				1.13

  Implement -regex and -iregex primaries which behave similarly (but
  not identically) to the GNU find primaries of the same names.  (The
  differences are caused by differences in the Basic Regular
  Expression implementations.)

distrib/sets/lists/comp/md.arm32		1.25

  Add "usr/include/machine/devmap.h" so that the X server can be built.

sys/dev/rnd.c					patch

  A more consistent branch-specific fix for the data extraction locking
  bug previously fixed.

lib/libc/sys/connect.2				1.14

  Explain how to get status information for non-blocking connects,
  fixing PR#8208.

sys/dev/eisa/eisadevs				1.16
sys/dev/eisa/eisadevs.h				regenerate
sys/dev/eisa/eisadevs_data.h			regenerate
sys/dev/eisa/if_ep_eisa.c			1.21

  Recognize a 3Com 3c509 Combo configured in EISA mode, fixing PR#8234.

usr.sbin/pkg_install/Makefile.inc		1.6-1.10
usr.sbin/pkg_install/add/add.h			1.4
usr.sbin/pkg_install/add/extract.c		1.17-1.20
usr.sbin/pkg_install/add/futil.c		1.7-1.8
usr.sbin/pkg_install/add/main.c			1.10-1.12
usr.sbin/pkg_install/add/perform.c		1.30,1.32-1.39
usr.sbin/pkg_install/add/pkg_add.1		1.16
usr.sbin/pkg_install/admin/main.c		1.4-1.8
usr.sbin/pkg_install/create/create.h		1.12
usr.sbin/pkg_install/create/main.c		1.14
usr.sbin/pkg_install/create/perform.c		1.18-1.19
usr.sbin/pkg_install/create/pkg_create.1	1.17-1.18
usr.sbin/pkg_install/create/pl.c		1.12-1.16
usr.sbin/pkg_install/delete/delete.h		1.5-1.6
usr.sbin/pkg_install/delete/main.c		1.12-1.13
usr.sbin/pkg_install/delete/perform.c		1.24-1.28
usr.sbin/pkg_install/delete/pkg_delete.1	1.13-1.14
usr.sbin/pkg_install/info/info.h		1.10-1.11
usr.sbin/pkg_install/info/main.c		1.17-1.18
usr.sbin/pkg_install/info/perform.c		1.24-1.28
usr.sbin/pkg_install/info/show.c		1.13-1.16
usr.sbin/pkg_install/info/pkg_info.1		1.18
usr.sbin/pkg_install/lib/exec.c			1.6
usr.sbin/pkg_install/lib/file.c			1.28-1.32
usr.sbin/pkg_install/lib/global.c		1.6
usr.sbin/pkg_install/lib/lib.h			1.22-1.26
usr.sbin/pkg_install/lib/lpkg.c			1.2
usr.sbin/pkg_install/lib/pen.c			1.16
usr.sbin/pkg_install/lib/pkgdb.c		1.4
usr.sbin/pkg_install/lib/plist.c		1.19-1.22
usr.sbin/pkg_install/lib/str.c			1.16-1.17

  Update in-tree pkg tools:

  o Pass & use BINDIR instead of hardcoding /usr/sbin.
  o Adapt this to work better on Solaris.
  o Treat absolute paths in PLIST properly, i.e. do not allow them
    at all.
  o Clean up URL handling.
  o Fix conflict checking for package names with hyphens in their name
    by using "pkg-[0-9]*" instead of "pkg-*" for detecting conflicting
    packages.
  o Document PKG_TMPDIR environment variable.
  o De-linting and some code cleanup.
  o @srcdir was renamed to @src a long time ago (fixing PR#7555).
  o Message files in binary packages are not displayed with more(1).
  o Allow specifying a package name without a version.
  o Call deinstall-script again after files are removed, with
    POST-DEINSTALL argument.
  o Disable annoying "key not present" warning.
  o Fix error checking when creating directory for pkgdb.
  o Bring closer to /usr/share/misc/style with the aid of indent(1).
  o Provide full pathnames for chgrp and chown, fixing PR#8250.
  o Hide test for URLlength()>0 behind a macro (IS_URL()).
  o Handle symlinks to directories correctly in "check" and "rebuild"
    targets.
  o More work to run the DEINSTALL script a second time.
  o Some code documentation.

sys/net/if.c					1.51

  Fix a problem in ifa_ifwithnet() for netatalk, making atalkd
  work in more configurations.

sys/netinet/ip_proxy.c				1.18

  Check the protocol before forwarding to proxy module.  Fixes
  PR#7831.

gnu/usr.bin/tar/gnu.c				1.5
gnu/usr.bin/tar/list.c				1.6

  Cast off_t to size_t when passing arguments to functions expecting
  a size_t.  This fixes errors due to memory corruption when
  extracting archives with gtar style long file names on big endian
  machines.  Fixes PR#8229.

doc/tmac/doc-common				1.32

  Mark Ap as callable, fixes formatting of a few man pages.

sys/dev/ata/ata_wdc.c				1.20
sys/dev/ic/wdc.c				1.69-1.70
sys/dev/scsipi/atapi_wdc.c			patch

  Add some debug printfs, change timeout handling to be more efficient
  and less error-prone, and fix the "lockup after lost interrupt"
  problem some users have been reporting.  Also a mostly-stylistic
  change guarding tsleep() with a while() loop, and a retry if PIO
  mode < 3 fails.

share/mk/bsd.man.mk				1.46

  Use -Tascii for pre-generated man pages, avoiding nroff character
  set dependence on LESSCHARSET (!), fixing PR#4522.

etc/mtree/special				1.23-1.24

  Change to match the permissions set on install, and fix for
  nonexistent group name.

share/zoneinfo/africa				1.1.1.10
share/zoneinfo/antarctica			1.1.1.6
share/zoneinfo/asia				1.1.1.9
share/zoneinfo/australasia			1.1.1.9
share/zoneinfo/europe				1.1.1.9
share/zoneinfo/leapseconds			1.1.1.4
share/zoneinfo/northamerica			1.1.1.10
share/zoneinfo/southamerica			1.1.1.9

  Update to tzdata1999e.

sys/miscfs/fdesc/fdesc_vnops.c			1.51-1.53
sys/miscfs/kernfs/kernfs_vnops.c		1.66-1.67
sys/miscfs/procfs/procfs_vnops.c		1.66-1.68

  Protect {fdesc,kernfs,procfs}_readdir against directory seeks
  with bogus offsets.

etc/rc						1.129

  Fix denial-of-service attack involving vi preserve.

usr.bin/su/su.c					1.35

  Fix memory corruption problem.

etc/etc.x68k/MAKEDEV				1.21

  Since we now use Xwrapper to start the X server, we can restrict
  non-root access to grf, mouse and kbd, closing a security hole.

sys/dev/pci/pcidevs				1.137
sys/dev/pci/pcidevs.h				regenerate
sys/dev/pci/pcidevs_data.h			regenerate
sys/dev/pci/if_ex_pci.c				1.7

  Recognize 3c905C-TX card.

sys/msdosfs/msdosfs_vnops.c			1.86

  Do not permit writing to read-only mounted msdosfs file system,
  fixing PR#7619.

sys/sys/fcntl.h					1.17
sys/kern/vfs_vnops.c				1.38
sys/kern/kern_sig.c				1.93

  Don't allow coredump to follow symlinks, this has security 
  implications.

sys/ufs/lfs/lfs_alloc.c				1.23
sys/ufs/lfs/lfs_segment.c			1.28

  Fix a printf format bug that gives compiler warnings/errors on 
  64-bit platforms, fixing PR#8241.

lib/libc/gen/__fts13.c				1.16-1.25

  Fix various bug in fts(3), preventing a buffer overflow on a very
  deep tree, and a silent trucation of the path when fts_pathlen 
  overflows.  Also, make this compile on Linux.

sbin/newfs_lfs/lfs.c				1.5

  Refuse to create a file system with too few segments, which
  would prevent the cleaner from working, fixing PR#7623.

sbin/mount_ados/mount_ados.c			1.9
sbin/mount_cd9660/mount_cd9660.c		1.8
sbin/mount_fdesc/mount_fdesc.c			1.10
sbin/mount_filecore/mount_filecore.c		1.2
sbin/mount_kernfs/mount_kernfs.c		1.11
sbin/mount_lfs/mount_lfs.c			1.8
sbin/mount_msdos/mount_msdos.c			1.20
sbin/mount_nfs/mount_nfs.c			1.23
sbin/mount_null/mount_null.c			1.6
sbin/mount_procfs/mount_procfs.c		1.10
sbin/mount_umap/mount_umap.c			1.9
sbin/mount_union/mount_union.c			1.6

  Regularize error reporting of mount_* commands for failure of
  mount(2) to the form "mount_xxx: dev on dir: reason for failure"
  (as opposed to the old "mount_xxx: : reason for failure").
  This is related to PR#7592, but not a complete fix for that PR.

distrib/sets/lists/xbase/mi			1.14-1.16
distrib/sets/lists/xcomp/mi			1.7-1.8
distrib/sets/lists/xserver/md.arm32		1.5-1.7
distrib/sets/lists/xserver/md.atari		1.4-1.5
distrib/sets/lists/xserver/md.i386		1.10-1.11
distrib/sets/lists/xserver/md.vax		1.3 (new)

  Various changes to sync these files with xsrc.  Specifically:
   o Update for XFree86 3.3.4
   o Update for XFree86 3.3.5
   o Add Vax X11 server
   o RCS Id policy conformance

distrib/sets/makeflist				1.16

  Cope with #-comments in distrib set files.

etc/security					1.40

  Don't try to grab disklabels from CDs.

sys/nfs/nfs_subs.c				1.71

  Don't truncate minor numbers > 255 on a NFS client.

sys/arch/i386/i386/locore.s			1.212

  Make kernels configured without npx link again, fixing PR#8262.

sbin/disklabel/interact.c			1.10

  'Label disk?' prompt should check for 'Y' as well as 'y'.

sys/dev/isa/files.isa				1.89

  The nca driver mistakenly detects an i82585tx as its hardware.
  Move the nca driver probe after the iy probe (which is more
  friendly to other hardware).

share/mk/bsd.doc.mk				1.43
share/mk/bsd.files.mk				1.10
share/mk/bsd.kmod.mk				1.32
share/mk/bsd.lib.mk				1.157
share/mk/bsd.man.mk				1.48
share/mk/bsd.nls.mk				1.19
share/mk/bsd.prog.mk				1.103

  Allow natural use of multiple "make" targets within the main tree
  without setting BUILD in /etc/mk.conf, or anywhere else.
  Particularly, permit "make all install" and "make file install"
  (where file is installed by "make install"). Behavior with BUILD
  set is unchanged.  Fixes PR#8313 and PR#3894.

sys/dev/ic/i82586.c				1.24

  Remove a spurious printf() from the interrupt handler which got
  triggered when sharing the interrupt level with other devices.

gnu/dist/gdb/config/arm/tm-armnbsd.h		1.5

  Make single-stepping over conditional instructions work on the
  ARM32, fixing PR#7565 and possibly PR#8156.

sys/dev/ic/clmpccreg.h				1.2
sys/dev/ic/clmpccvar.h				1.3
sys/dev/ic/clmpcc.c				1.6

  Fix panics seen by some people during mvme167 installation.

distrib/utils/sysinst/arch/mac68k/md.c		1.12

  Insert a leading slash in device name used in md_pre_disklabel(),
  fixing PR#8384.

sys/arch/arm32/podulebus/if_ie.c		patch

  Fix Berkeley Packet Filter support, fixing PR#8343.

sys/dev/ic/smc91cxx.c				1.18-1.19

  Avoid multicast packet loopback from itself during promiscuous mode.
  This makes the driver behave as IFF_SIMPLEX interface in all cases.

sys/dev/ic/elinkxl.c				1.14
sys/dev/ic/elinkxlreg.h				1.2

  Select the right tranceiver type when configuring the driver,
  and change the timing for the MII code a bit.  Fixes the problem
  reported in PR#8363 with the MII not being reported
  correctly.

sys/dev/pci/ncr.c				1.81

  Make the ncr driver work with more than 5 devices on the same
  bus.  Fixes PR#6347.

sys/dev/pci/ncr.c				1.82

  Make driver build with Tekram EEPROM support enabled.
  Fixes PR#8141.

sys/dev/pci/ncr.c				1.83

  Zero out DMA memory regions to avoid use of uninitialized
  memory (and resulting "COMMAND FAILED" errors) on systems
  which don't clear memory on boot.

sys/dev/wscons/wsemul_vt100_keys.c		1.3

  Map the Home and End keys as xterm does.

sys/arch/i386/conf/DISKLESS			1.67

  Update device name ed* -> we*, fixing PR#7503 and PR#8020.

lib/libc/arch/arm32/Makefile.inc		1.7
lib/libc/arch/arm32/gen/divsi3.S		1.3-1.4
sys/lib/libkern/arch/arm32/divsi3.S		1.3-1.6

  If the highest bit of the dividend is set, care must be taken when
  shifting the divisor.  Fixes PR#7760.  Also, arrange for this file
  to be copied to libkern via libc's copy-to-libkern target.

usr.sbin/amd/AUTHORS				1.1.1.7
usr.sbin/amd/Makefile				1.9-1.12
usr.sbin/amd/amd/am_ops.c			1.9
usr.sbin/amd/amd/amd.c				1.12
usr.sbin/amd/amd/amfs_auto.c			1.1.1.3
usr.sbin/amd/amd/amfs_program.c			1.1.1.3
usr.sbin/amd/amd/amfs_toplvl.c			1.1.1.3
usr.sbin/amd/amd/amq_subr.c			1.11
usr.sbin/amd/amd/amq_svc.c			1.8
usr.sbin/amd/amd/conf.c				1.7
usr.sbin/amd/amd/conf_parse.y			1.6
usr.sbin/amd/amd/info_hesiod.c			1.1.1.2
usr.sbin/amd/amd/info_nis.c			1.14
usr.sbin/amd/amd/map.c				1.12
usr.sbin/amd/amd/mapc.c				1.12
usr.sbin/amd/amd/nfs_prot_svc.c			1.8
usr.sbin/amd/amd/nfs_start.c			1.10
usr.sbin/amd/amd/ops_cdfs.c			1.8
usr.sbin/amd/amd/ops_nfs.c			1.8
usr.sbin/amd/amd/opts.c				1.9
usr.sbin/amd/amd2netbsd				1.20-1.22
usr.sbin/amd/amq/amq.c				1.13
usr.sbin/amd/doc/Makefile			1.6-1.7
usr.sbin/amd/doc/am-utils.info			deleted
usr.sbin/amd/doc/am-utils.info-1		deleted
usr.sbin/amd/doc/am-utils.info-2		deleted
usr.sbin/amd/doc/am-utils.info-3		deleted
usr.sbin/amd/doc/am-utils.info-4		deleted
usr.sbin/amd/doc/am-utils.info-5		deleted
usr.sbin/amd/doc/am-utils.info-6		deleted
usr.sbin/amd/doc/am-utils.texi			1.1.1.6
usr.sbin/amd/doc/hlfsd.ps			1.1.1.3
usr.sbin/amd/doc/version.texi			1.1.1.6
usr.sbin/amd/fixmount/fixmount.c		1.7
usr.sbin/amd/fsinfo/fsi_gram.y			1.8
usr.sbin/amd/fsinfo/fsinfo.c			1.11
usr.sbin/amd/hlfsd/hlfsd.c			1.8
usr.sbin/amd/include/am_compat.h		1.1.1.5
usr.sbin/amd/include/am_defs.h			1.10
usr.sbin/amd/include/am_utils.h			1.8
usr.sbin/amd/include/amd.h			1.7
usr.sbin/amd/include/amu_nfs_prot.h		1.7
usr.sbin/amd/include/config.h			1.15
usr.sbin/amd/libamu/mkconf			1.1.1.2
usr.sbin/amd/libamu/mount_fs.c			1.1.1.7
usr.sbin/amd/libamu/tranputil.c			1.1.1.7
usr.sbin/amd/libamu/wire.c			1.1.1.5
usr.sbin/amd/libamu/xutil.c			1.4
usr.sbin/amd/mk-amd-map/mk-amd-map.c		1.11
usr.sbin/amd/pawd/pawd.c			1.1.1.3
usr.sbin/amd/wire-test/wire-test.c		1.5

  Upgrade amd(8) and related software to fix expoitable stack overflows
  in amq(8), as reported in BUGTRAQ and elsewhere.

usr.sbin/config/sem.c				1.23

  Fix the (English) grammar in a couple of places.

distrib/sets/lists/base/mi			1.122
usr.bin/Makefile				1.107
usr.bin/mktemp/Makefile				1.1-1.2 (new)
usr.bin/mktemp/mktemp.1				1.1-1.3 (new)
usr.bin/mktemp/mktemp.c				1.1-1.2 (new)

  Add mktemp(1), a utility to make temporary files for shell scripts.

sys/kern/uipc_socket2.c				1.31-1.33

  Compact mbuf clusters, to help prevent mbuf cluster exhaustion when
  receiving lots of small packets.  This costs some performance (the
  compaction copies data), but adds a lot of stability to many systems.

sys/dev/pci/if_vr.c				1.26

  Fix packet reception in promiscuous mode: compare the Ethernet
  destination address against our station address if it's not a
  multicast packet.  Fixes a redirect storm problem.

sys/arch/alpha/conf/Makefile.alpha		1.53
sys/arch/amiga/conf/Makefile.amiga		1.82

  Be more efficient when linking kernels with debugging symbols.  (Don't
  copy them just to strip them, use strip -o.)

usr.bin/col/col.c				1.11

  Fix incorrect option string used in call to getopt(3).  Fixes PR#8475.

gnu/dist/gprof/gprof.1				1.2

  Remove references to nonexistent manual pages and replace them with
  up-to-date references where appropriate.

share/man/man8/compat_ultrix.8			1.9

  Fix typo in roff macro name.

bin/df/df.c					1.32

  Fix an overflow when using df(1) on a big partition's raw device,
  where the number of available blocks would be displayed incorrectly.

usr.bin/join/join.c				1.16

  Fix incorrect array size in a call to memset(), and avoid a possible
  segmentation fault in a call to memmove().  Fixes PR#8184.

sys/dev/raidframe/rf_netbsdkintf.c		1.20
sys/dev/raidframe/rf_raid.h			1.6
sys/dev/raidframe/rf_states.c			1.7

  Add a more reasonable throttling mechanism to the RAIDframe code.
  Increases write performance, and helps prevent the I/O routines from
  using too much kernel memory.

sys/sys/disklabel_mbr.h				1.4

  Correct NTFS partition type.

usr.sbin/mbrlabel/mbrlabel.c			1.6
sys/sys/disklabel_mbr.h				1.5

  Correct handling of extended partitions within extended partitions, and
  add support for Linux extended partitions.

include/db.h					1.17

  Fix P_{16,32}_SWAP() macros to avoid unaligned 16 and 32 bit
  memory accesses.  This fixes a problem seen on arm32 when trying
  to use the db(3) functions to access a BIG_ENDIAN btree.

usr.bin/systat/extern.h				1.8-1.9
usr.bin/systat/fetch.c				1.5
usr.bin/systat/main.c				1.16
usr.bin/systat/netstat.c			1.11
usr.bin/systat/pigs.c				1.14

  LP64 and type sanity fixes, with visible effects of enabling echo
  on commands and correct cursor placement after update.

usr.bin/systat/cmds.c				1.10
usr.bin/systat/keyboard.c			1.6

  Do not downcase input, which prevented "ignore X11" in the
  "netstat" display from working.  Fixes PR#7655.
