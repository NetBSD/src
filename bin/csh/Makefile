#	$NetBSD: Makefile,v 1.22 2003/07/29 01:34:16 lukem Exp $
#	@(#)Makefile	8.1 (Berkeley) 5/31/93
#
# C Shell with process control; VM/UNIX VAX Makefile
# Bill Joy UC Berkeley; Jim Kulp IIASA, Austria
#
# To profile, put -DPROF in DFLAGS and -pg in COPTS, and recompile.

.include <bsd.own.mk>

PROG=	csh
DFLAGS=-DBUILTIN -DFILEC -DNLS -DSHORT_STRINGS
CPPFLAGS+=-I${.CURDIR} -I. ${DFLAGS}
SRCS=	alloc.c char.c const.c csh.c dir.c dol.c err.c exec.c exp.c file.c \
	func.c glob.c hist.c init.c lex.c misc.c parse.c printf.c proc.c \
	sem.c set.c str.c strpct.c time.c
.PATH:	${NETBSDSRCDIR}/usr.bin/printf

MLINKS=	csh.1 limit.1 csh.1 alias.1 csh.1 bg.1 csh.1 dirs.1 csh.1 fg.1 \
	csh.1 foreach.1 csh.1 history.1 csh.1 jobs.1 csh.1 popd.1 \
	csh.1 pushd.1 csh.1 rehash.1 csh.1 repeat.1 csh.1 suspend.1 \
	csh.1 stop.1 csh.1 source.1
CLEANFILES+=errnum.h const.h

const.h: errnum.h

errnum.h: err.c
	@rm -f ${.TARGET}
	@echo '/* Do not edit this file, make creates it. */' > ${.TARGET}
	@echo '#ifndef _h_sh_errnum' >> ${.TARGET}
	@echo '#define _h_sh_errnum' >> ${.TARGET}
	egrep 'ERR_' ${.ALLSRC} | egrep '^#define' >> ${.TARGET}
	@echo '#endif /* _h_sh_errnum */' >> ${.TARGET}

const.h: const.c
	@rm -f ${.TARGET}
	@echo '/* Do not edit this file, make creates it. */' > ${.TARGET}
	${CC} -E ${CPPFLAGS} ${.ALLSRC} | egrep 'Char STR' | \
	    sed -e 's/Char \([a-zA-Z0-9_]*\)\(.*\)/extern Char \1[];/' | \
	    sort >> ${.TARGET}

alloc.o const.o csh.o dir.o dol.o err.o exec.o exp.o file.o func.o glob.o \
    hist.o init.o lex.o misc.o parse.o proc.o sem.o set.o str.o time.o: const.h

.if make(install)
SUBDIR+=USD.doc
.endif

.include <bsd.prog.mk>
.include <bsd.subdir.mk>

${DEPENDSRCS} alloc.o: const.h errnum.h 
