#	$NetBSD: files.drmkms,v 1.7 2014/07/16 20:59:57 riastradh Exp $

include "external/bsd/drm2/linux/files.drmkms_linux"

# i2c code is not separated out, but it is marked so that it could be
# if we wanted.  Not clear that this provides as much advantage as
# separating out PCI code, which will be necessary for, e.g., PCIless
# ARM SoC graphics drivers.
define	drmkms_i2c: drmkms_linux

define	drmkms: drmkms_linux, drmkms_i2c

defflag		opt_drmkms.h	DRMKMS_DEBUG
makeoptions 	drmkms	CPPFLAGS+="-I$S/external/bsd/drm2/include"
makeoptions	drmkms_ttm	CPPFLAGS+="-I$S/external/bsd/drm2/include/drm"
makeoptions 	drmkms	CPPFLAGS+="-I$S/external/bsd/drm2/dist"
makeoptions 	drmkms	CPPFLAGS+="-I$S/external/bsd/drm2/dist/include"
makeoptions 	drmkms	CPPFLAGS+="-I$S/external/bsd/drm2/dist/include/drm"
makeoptions 	drmkms	CPPFLAGS+="-I$S/external/bsd/drm2/dist/uapi"
makeoptions 	drmkms	CPPFLAGS+="-I$S/external/bsd/common/include"

makeoptions 	drmkms 	"CWARNFLAGS.drm_crtc.c"+="-Wno-shadow"
makeoptions 	drmkms 	"CWARNFLAGS.drm_crtc.c"+="-Wno-missing-field-initializers"
makeoptions 	drmkms 	"CWARNFLAGS.drm_edid.c"+="-Wno-shadow"

# XXX Should probably be in a header file.  opt_drmkms.h?
makeoptions	drmkms	CPPFLAGS+="-D__KERNEL__"

file	external/bsd/drm2/dist/drm/drm_auth.c		drmkms
file	external/bsd/drm2/dist/drm/drm_buffer.c		drmkms
file	external/bsd/drm2/dist/drm/drm_bufs.c		drmkms
file	external/bsd/drm2/drm/drm_cache.c		drmkms
file	external/bsd/drm2/dist/drm/drm_context.c	drmkms
file	external/bsd/drm2/dist/drm/drm_crtc.c		drmkms
file	external/bsd/drm2/dist/drm/drm_crtc_helper.c	drmkms
file	external/bsd/drm2/dist/drm/drm_dma.c		drmkms
file	external/bsd/drm2/dist/drm/drm_dp_helper.c	drmkms_i2c
file	external/bsd/drm2/drm/drm_drv.c			drmkms
file	external/bsd/drm2/dist/drm/drm_edid.c		drmkms_i2c
#file	external/bsd/drm2/dist/drm/drm_encoder_slave.c	drmkms_i2c
file	external/bsd/drm2/dist/drm/drm_fb_helper.c	drmkms
file	external/bsd/drm2/dist/drm/drm_flip_work.c	drmkms
file	external/bsd/drm2/drm/drm_fops.c		drmkms
file	external/bsd/drm2/dist/drm/drm_gem.c		drmkms
file	external/bsd/drm2/dist/drm/drm_global.c		drmkms
file	external/bsd/drm2/dist/drm/drm_hashtab.c	drmkms
#file	external/bsd/drm2/dist/drm/drm_info.c		drmkms
#file	external/bsd/drm2/dist/drm/drm_ioc32.c		drmkms
file	external/bsd/drm2/dist/drm/drm_ioctl.c		drmkms
file	external/bsd/drm2/dist/drm/drm_irq.c		drmkms
file	external/bsd/drm2/drm/drm_lock.c		drmkms
file	external/bsd/drm2/drm/drm_memory.c		drmkms
file	external/bsd/drm2/dist/drm/drm_mm.c		drmkms
file	external/bsd/drm2/dist/drm/drm_modes.c		drmkms
file	external/bsd/drm2/dist/drm/drm_plane_helper.c	drmkms
#file	external/bsd/drm2/dist/drm/drm_platform.c	drmkms
#file	external/bsd/drm2/dist/drm/drm_prime.c		drmkms
file	external/bsd/drm2/dist/drm/drm_probe_helper.c	drmkms
file	external/bsd/drm2/dist/drm/drm_rect.c		drmkms
file	external/bsd/drm2/drm/drm_scatter.c		drmkms
file	external/bsd/drm2/dist/drm/drm_stub.c		drmkms
file	external/bsd/drm2/drm/drm_sysfs.c		drmkms
file	external/bsd/drm2/drm/drm_vm.c			drmkms
file	external/bsd/drm2/drm/drm_vma_manager.c		drmkms

file	external/bsd/drm2/drm/drm_gem_vm.c		drmkms
file	external/bsd/drm2/drm/drm_module.c		drmkms

# TTM, the texture and tiling manager.

define	drmkms_ttm: drmkms

file	external/bsd/drm2/ttm/ttm_agp_backend.c			drmkms_ttm
file	external/bsd/drm2/dist/drm/ttm/ttm_memory.c		drmkms_ttm
file	external/bsd/drm2/dist/drm/ttm/ttm_tt.c			drmkms_ttm
file	external/bsd/drm2/dist/drm/ttm/ttm_bo.c			drmkms_ttm
file	external/bsd/drm2/dist/drm/ttm/ttm_bo_util.c		drmkms_ttm
file	external/bsd/drm2/ttm/ttm_bo_vm.c			drmkms_ttm
# Linux module goo.
#file	external/bsd/drm2/dist/drm/ttm/ttm_module.c		drmkms_ttm
# Used only by vmwgfx.  Needs porting for rcu -> pserialize.
#file	external/bsd/drm2/dist/drm/ttm/ttm_object.c		drmkms_ttm
# Used only by vmwgfx.  Needs porting.  Does silly things like SIGKILL.
#file	external/bsd/drm2/dist/drm/ttm/ttm_lock.c		drmkms_ttm
file	external/bsd/drm2/dist/drm/ttm/ttm_execbuf_util.c	drmkms_ttm
# Replaced locally by ttm_bus_dma.c.
#file	external/bsd/drm2/dist/drm/ttm/ttm_page_alloc.c		drmkms_ttm
file	external/bsd/drm2/dist/drm/ttm/ttm_bo_manager.c		drmkms_ttm
# Replaced locally by ttm_bus_dma.c.
#file	external/bsd/drm2/dist/drm/ttm/ttm_page_alloc_dma.c	drmkms_ttm

file	external/bsd/drm2/ttm/ttm_bus_dma.c			drmkms_ttm
