.\"	$NetBSD: install,v 1.17 2001/07/24 17:30:55 nra Exp $
.\"
.\" Copyright (c) 1999, 2000 The NetBSD Foundation, Inc.
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"        This product includes software developed by the NetBSD
.\"        Foundation, Inc. and its contributors.
.\" 4. Neither the name of The NetBSD Foundation nor the names of its
.\"    contributors may be used to endorse or promote products derived
.\"    from this software without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE NETBSD FOUNDATION, INC. AND CONTRIBUTORS
.\" ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
.\" TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
.\" PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE FOUNDATION OR CONTRIBUTORS
.\" BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
.\" CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
.\" SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
.\" INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
.\" CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
.\" ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
.\" POSSIBILITY OF SUCH DAMAGE.
.\"
Installing
.Nx
is a relatively complex process, but, if you have
this document in hand and are careful to read and remember the
information which is presented to you by the install program, it
shouldn't be too much trouble.
.Pp
Before you begin, you must have already prepared your hard disk as
detailed in the section on preparing your system for install.
.Pp
The following is a walk-through of the steps necessary to get
.Nx
installed on your hard disk.  If you wish to stop the installation,
you may press
.Key CONTROL-C
at any prompt, but if you do, you'll have to
begin again from scratch.
.(enum
Booting the miniroot
First you need to get yourself into
.Nx .
This can be
done in a couple ways, both of which currently require
.Tn GEMDOS .
You need either the bootfloppy provided in the
distribution or you can copy the
.Ic loadbsd.ttp
program and
kernel to a boot floppy disk (1.44 MB needed) or put them on a
.Tn TOS
partition.  Select the loadbsd program and it will
ask for parameters, supply:
.Sq Ic "-b netbsd"
(or whatever name
you copied the kernel to).  You can, of course, also run it
from the shell command-line in
.Tn MiNT :
.Pp
.Dl Ic "loadbsd -b a:/netbsd"
.Pp
You should see the screen clear and some information about
your system as the kernel configures the hardware.  Then
you will be prompted for a root device.  At this time remove the
.Tn GEMDOS
kernel boot floppy from the drive if present and insert the
.Nx
install floppy 1.  Now type
.Sq Ic md0a
to tell the
kernel to load the install file system into RAMdisk. While
While the kernel is loading, it will show a
.Sq \&.
for each
track loaded. After loading 80 tracks, it will ask you
to insert the next floppy. At this time, insert the
.Nx
install floppy 2 and press any key. The kernel continuous
loading another 40 tracks before it continues to boot.
.(Note
If you are using 1.44 MB floppies, you should select
.Sq Ic md1a
instead of
.Sq Ic md0a .
.Note)
.Pp
The system should continue to boot.  For now ignore WARNING:
messages about bad dates in clocks. Eventually you will be
be asked to enter the pathname of the shell, just press
.Key RETURN .
After a short while, you will be asked to select
the type of your keyboard. After you have entered a valid
response here, the system asks you if you want to install
or upgrade your system. Since you are reading the
.Em install
section,
.Sq Ic i
would be the proper response here...
.It
Entering the installer
The installer starts with a nice welcome message. Read this
message carefully, it also informs you of the risks involved
in continuing! If you still want to go on, type
.Sq Ic y .
The
installer now continues by trying to figure out your disk
configuration.  When it is done, you will be prompted to select
a root device from the list of disks it has found.
.It
Select your root device
You should know at this point that the disks are
.Em not
numbered according to their SCSI-ID! The
.Nx
kernel numbers the SCSI
drives (and other devices on the SCSI bus) sequentially as it
finds them. The drive with the lowest SCSI-ID will be called
.Li sd0 ,
the next one
.Li sd1 ,
etc.
Where you end up after the selection of the root disk depends on
the contents of your disk. If it is already partitioned using AHDI,
start reading at item 4a, if this disk has no AHDI partitioning
but is blank or used by another non-AHDI system, start at item 4b.
.Pp
.Em You are now at the point of no return!
The programs in section
4 will modify your harddisk. Type
.Key Control-C
.Em now
if you don't
want this.
.It
Setting AHDI partition ID's on your root disk
.Pq using Ic ahdilabel
Because
.Nx
imposes a special ordering in disk partitions it
uses for
.Pa /
(root) and swap. And because it wants to guard you against
an unwanted demolition of partitions used by other systems, you
have to tell it what partitions it is allowed to use. You have
to mark the partition you want to use as swap
.Li NBS
or
.Li SWP
and the other partitions as
.Li NBD .
Note that all the changes
you make to the ID's are reversable as long as you remember the
original value.
As of
.Nx 1.5
.Ic ahdilabel
is capable of creating or changing an AHDI compatible partioning on the disk!
In the partition-ID editor, the partitions are shown in the order
that AHDI created them. When you leave this editor and continue
at item 4b, your changes to the ID's do have consequences to the
partition order! They will show up as follows:
.Pp
.(tag d\ (and\ up)
.It a
\- the first NBD partition
.It b
\- the first NBS partition
.It d (and up)
\- the rest of the partitions in AHDI order
.tag)
.It
Labeling your root disk (using edlabel)
You are now allowed to change the partitioning of your disk. If
your disk is already partitioned with AHDI,
.Em don't
change anything
unless you are absolutely sure what you are doing!
If you are labeling an empty SCSI disk, you can make life easy for
yourself by selecting
.Dq standardize geometry .
This allows you to
select a
.Dq sectors per track
and
.Dq tracks/cylinder
value and have
the (fictious) SCSI geometry changed accordingly. So if you select
64 sect/track and 32 tracks/cylinder, each cylinder is exactly
1 MB in size. Well, go ahead and don't forget to save your work
before you quit!
.(Note
to make sure that
.Nx
can create/mount file systems on
the partitions you defined, make sure the
.Dq type
is entered correctly:
.Pp
.(tag 4.2BSD -compact
.It Li 4.2BSD
\- file systems created by
.Nx
.It Li MSDOS
\- file systems shared with
.Tn GEM
.tag)
.Note)
.It
Label additional disks
Now that your root disk is labeled, you are given the opportunity
to label any of the other disks in your system. The procedure is
the same as with your root disk.
.It
Setup the fstab
Since all disks you want to use with
.Nx
are properly labeled,
it is time to tell the installer which partition will be associated
with the different file systems. As mentioned above, it is wise to
make at least a separate
.Pa /
(root) and
.Pa /usr
file system. Depending on
what you are planning to do with your system, you might also consider
to make a separate
.Pa /var ,
.Pa /local
or
.Pa /home .
When you tell the installer that all of your file systems are specified
correctly, it starts creating them for you.
.It
Configure your network
Currently none of the kernels supplied in the distribution has
network support builtin. If you compiled your own kernel, network
configuration mostly works. [ Due to space limitations, some
of the network commands are not present on the install floppy ]
.It
Edit the fstab - again....
Since the network configuration might have lead to additional (nfs)
file system entries, you get another chance to modify your fstab.
.It
Installing the distribution sets
You are finally at the point where some real data will be put on
your freshly-made file systems. Select the device type you whish
to install from and off you go....
Some notes:
.(bullet
If you want to install from tape, please read the section
about how to create such a tape.
The tape device name will be
.Li nrst0
for the first tape drive,
.Li nrst1
for the second, etc.
.It
Install at least the base and etc sets.
.It
If you have to specify a path relative to the mount-point and
you need the mount-point itself, enter
.Sq \&. .
.It
For previous
.Nx
users:  If you want to install from a
.Tn GEMDOS
file system, you don't need to rename the distribution
sets as you may have done in previous versions of
.Nx .
.bullet)
.It
Timezone selection and device-node building
The isn't much to say about this. Just select the timezone you
are in. The installer will make the correct setup on your root
file system
.Pq Pa / .
After the timezone-link is installed, the installer
will proceed by creating the device nodes on your root file system under
.Pa /dev .
Be patient, this will take a while...
.It
Installing the kernel
Because the kernel didn't fit on the install-disks, the installer
asks you about the disk your kernel is on. You can specify the
floppy with disk
.Li fd0 ,
and partition
.Sq Li b
for 720 KB disks and partition
.Sq Li c
for 1.44 MB disks, or one of the hard disk partitions.
.It
Installing the bootstrap
Finally, the installer ask you if you want to install the bootblock
code on your root disk. This is a matter of personal choice and can
also be done from a running
.Nx
system. See the
.Xr installboot 8
manual page about how to do this.
.It
You did it!
Congratulations, you just installed
.Nx
successfully! If you
also installed a bootblock, you only have to reboot your Atari to
enter your freshly build system. If you didn't, get back to section
1 (How to boot the miniroot). Just substitute
.Li md0a
by your
.Nx
root disk.
.enum)
.Ss2 Some extra remarks
If you don't want to use the bootloader. You could use the following
setup:
.(bullet
Reserve a small
.Tn GEMDOS
partition of about 4 MB. This is
enough to put in a few kernels. Put the netbsd kernel
into this partition. Also, edit your
.Pa /etc/fstab
to always
mount this partition, say as
.Pa /kernels .
Now make a symlink
from
.Pa /netbsd
to
.Pa /kernels/netbsd .
This scheme is particularly handy when you want to make your
own kernel. When compilation is finished, you just copy
your kernel to
.Pa /kernels/netbsd
and reboot. It's wise to make sure there is
.Em always
a
.Sq known to work
kernel image present.
.bullet)
