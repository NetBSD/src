.\"	$NetBSD: sysinst,v 1.88.2.2 2008/02/06 01:57:32 jnemeth Exp $
.\"
.\" Copyright (c) 1999-2004 The NetBSD Foundation, Inc.
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"        This product includes software developed by the NetBSD
.\"        Foundation, Inc. and its contributors.
.\" 4. Neither the name of The NetBSD Foundation nor the names of its
.\"    contributors may be used to endorse or promote products derived
.\"    from this software without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE NETBSD FOUNDATION, INC. AND CONTRIBUTORS
.\" ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
.\" TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
.\" PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE FOUNDATION OR CONTRIBUTORS
.\" BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
.\" CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
.\" SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
.\" INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
.\" CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
.\" ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
.\" POSSIBILITY OF SUCH DAMAGE.
.\"
.
.
.
.\" Define strings for partition references:
.\"	\*[part_raw]	`raw' partition (usually `c' or `d')
.\"	\*[part_free]	first "free" partition (usually part_raw+1)
.\"	\*[part_usr]	default "/usr" partition (usually part_free)
.\"	\*[part_max]	last partition (usually `h' or `p')
.
.ds part_raw c
.ds part_free d
.ds part_usr d
.ds part_max h
.if \n[arc]:\n[bebox]:\n[cobalt]:\n[hpcarm]:\n[hpcmips]:\n[i386]:\
\n[sbmips]:\n[sh3eb]:\n[sh3el]:\n[x86_64] \{\
.  ds part_raw d
.  ds part_free e
.  ds part_usr e
.\}
.if \n[sgimips] \{\
.  ds part_free e
.  ds part_usr e
.\}
.if \n[amiga]:\n[amigappc]:\n[arc]:\n[atari]:\n[cobalt]:\n[evbmips]:\
\n[evbppc]:\n[hp700]:\n[hpcmips]:\n[i386]:\n[macppc]:\n[ofppc]:\
\n[playstation2]:\n[sandpoint]:\n[sbmips]:\n[sgimips]:\n[x86_64] \{\
.  ds part_max p
.\}
.if \n[acorn26]:\n[acorn32]:\n[cats]:\n[evbarm]:\n[evbppc]:\n[ews4800mips]:\
\n[sandpoint]:\n[shark] \{\
.  ds part_usr e
.\}
.if \n[macppc]:\n[news68k]:\n[newsmips]:\n[sparc]:\n[sparc64] \{\
.  ds part_usr g
.\}
.
.
.Ss2 Running the sysinst installation program
.(enum
.To 2 Introduction
.Em Introduction
.Pp
Using
.Ic sysinst ,
installing
.Nx
is a relatively easy process.
You still should read this document and have it in hand when doing the
installation process.
This document tries to be a good guideline for the installation and as such
covers many details for the sake of completeness.
Do not let this discourage you; the install program is not hard
to use.
.
.if !\n[acorn26]:\n[acorn32]:\n[atari]:\n[ews4800mips]:\n[hp700]:\n[mac68k]:\n[macppc]:\n[mvme68k]:\n[news68k]:\n[newsmips]:\n[pmax]:\n[sgimips]:\n[sparc]:\n[sparc64]:\n[x68k] \{\
.It
.To 2 "Possible hardware problems"
.Em Possible hardware problems
.Pp
Should you encounter hardware problems during installation, try
rebooting after unplugging removable devices you don't need for
installation.
Non-removable devices can be disabled with
.Ic userconf
(use
.Ic boot
.Fl c
to enter it).
.\} \" !\n[acorn26]:\n[acorn32]:\n[atari]:\n[ews4800mips]:\n[hp700]:\n[mac68k]\:[macppc]:\n[mvme68k]:\n[news68k]:\n[newsmips]:\n[pmax]:\n[sgimips]:\n[sparc]:\n[sparc64]:\n[x68k]
.if \n[mac68k] \{\
.It
.To 2 "Possible hardware-specific issues"
.Em Possible hardware-specific issues
.(bullet
.Em SCSI driver problems
.Pp
The SCSI driver used in the kernel on many older Macintosh systems is, by
default, the ncrscsi driver.
It contains a recognized but as yet unfixed bug that affects some
disk drive/controller combinations, usually Quantum disks.
Under heavy load these systems may hang or corrupt
the file system; or, you may experience frequent
.Em Segmentation fault
and
.Em Illegal instruction
errors that may or may not be consistently repeatable.
This latter condition is particularly prevalent on systems with
minimal RAM installed.
.Pp
If either of these problems occur on your system you are advised to use the
SBC variants of the Kernel and Installation Kernel.
However, be aware that this issue does not affect
e.g. Centris or Quadra systems.
.Pp
.It 
.Em The 68LC040 processor
.Pp
.Nx
has known but unresolved problems running on the 68LC040 processor, the
variant of the 68040 that does not contain the floating point unit (FPU).
The kernel is thus forced to emulate the missing operations in software.
Unfortunately the 68LC040 processor has a design problem that causes
the emulation to fail intermittently.
We hope to provide a solution for this issue in a future
.Nx
release.
.Pp
Software emulation of floating point operations is
not a problem on the 68020 and 68030 processors.
.bullet)
.\} \" \n[mac68k]
.It
.To 2 General
.Em General
.Pp
The following is a walk-through of the steps you will take while
getting
.Nx
installed on your hard disk.
.Ic sysinst
is a menu driven
installation system that allows for some freedom in doing the
installation.
Sometimes, questions will be asked and in many cases
the default answer will be displayed in brackets
.Pq Dq \&[\ ]
after the question.
If you wish to stop the installation, you may press
.Key CONTROL-C
at any time, but if you do, you'll have to begin the installation
process again from scratch by running the
.Pa /sysinst
program from the command prompt.
It is not necessary to reboot.
.It
.To 2 "Quick install"
.Em Quick install
.Pp
First, let's describe a quick install.
The other sections of this document go into the installation procedure in more
detail, but you may find that you do not need this.
If you want detailed instructions, skip to the next section.
This section describes a basic installation, using a CD-ROM install as
an example.
.Pp
.(bullet
What you need.
.(bullet
The distribution sets (in this example, they are on CD).
.if !\n[pmax]:\n[sgimips]:\n[sparc64] \{\
.It
.ie \n[alpha] Three floppy disks.
.el \{\
.ie \n[ews4800mips] Two floppy disks.
.el \{\
.ie \n[hp700] \{\
The
.Pa netinstall.lif
volume on a netboot server as described above.
.\}
.el \{\
.ie \n[i386] Two 1.44 MB 3.5" floppy disks if the CD is not bootable or if you cannot boot from CD.
.el \{\
.ie \n[mac68k] The Mac OS Booter application and an Installation Kernel
.el \{\
.ie \n[acorn26]:\n[cats]:\n[evbppc]:\n[macppc]:\n[sparc] \{\
Some form of bootable media, described above.
.\}
.el \{\
.ie \n[atari] \{\
A floppy disk containing a suitable boot.fs and a floppy with the
sysinst.fs image.
See the "prepare" section about obtaining those.
.\}
.el One 1.44 MB 3.5" floppy.
.\}\}\}\}\}\}
.\} \" !\n[pmax]:\n[sgimips]:\n[sparc64]
.if \n[i386] \{\
.It
A PC with a 386 or newer processor.
.\} \" \n[i386]
.if \n[mac68k] \{\
.It
A Macintosh with a 68020 and MMU, 68030 or 68RC040 processor.
An FPU is not required but will be used if present
(but see the note above regarding the 68LC040).
.\}
.It
A CD-ROM drive
.ie \n[acorn26]:\n[atari]:\n[alpha]:\n[cats]:\n[evbppc]:\n[i386]:\n[macppc]:\n[sparc64] (SCSI or ATAPI),
.el (SCSI),
a hard disk and a minimum of
.if \n[acorn26] 8 MB
.if \n[alpha] 32 MB
.if \n[atari] 4 MB (TT030/Falcon) or 16 MB (Hades/Milan)
.if \n[cats] 8 MB
.if \n[ews4800mips] 16 MB
.if \n[hp700] 32 MB
.if \n[i386] 4 MB
.if \n[mac68k] 8 MB
.if \n[macppc] 16 MB
.if \n[mvme68k] 4 MB
.if \n[news68k] 4 MB
.if \n[newsmips] 16 MB
.if \n[pmax] 8 MB
.if \n[sparc] 4 MB
.if \n[sparc64] 16 MB
.if \n[sgimips] 16 MB
of memory installed.
.It
The hard disk should have at least
.if \n[acorn26] 200
.if \n[alpha] 200
.if \n[atari] 120
.if \n[cats] 200
.if \n[ews4800mips] 200
.if \n[hp700] 200
.if \n[i386] 200
.if \n[mac68k] 120
.if \n[macppc] 200
.if \n[mvme68k] 100
.if \n[news68k] 100
.if \n[newsmips] 200
.if \n[pmax] 200
.if \n[sparc] 200
.if \n[sparc64] 200
.if \n[sgimips] 200
+
.Em n
megabytes of
space free, where
.Em n
is the number of megabytes of
main memory in your system.
If you wish to install the X Window System as well, you will need at least
120 MB more.
.bullet)
.if \n[alpha]:\n[ews4800mips]:\n[i386]:\n[news68k]:\n[newsmips] \{\
.It
Creating the boot floppies.
You can create the floppies needed for installation
under
.Tn MS-DOS
or
.Tn Windows .
Supposing your 1.44 MB floppy
drive is drive A:, and your CD is drive E: do the
following from an
.Tn MS-DOS
command prompt:
.Pp
.Dl Ic "e:"
.Dl Ic "cd \eNetBSD-\*V\ei386\einstallation\emisc"
.Dl Ic "rawrite"
.Pp
When asked for a source filename, answer
.if \n[ews4800mips]:\n[i386]:\n[newsmips] \{\
.Dl Pa \&..\efloppy\eboot1.fs
for the first diskette and
.Dl Pa \&..\efloppy\eboot2.fs
for the second diskette.
.\}
.if \n[alpha] .Dl Em \&(...alpha installation root) Ns Pa \efloppy\edisk1of3
.if \n[news68k] .Dl Pa \eNetBSD-\*V\e\*M\einstallation\efloppy\eboot.fs
.Pp
When asked for a destination drive answer
.Sq Ic a .
.It
To create a bootfloppy under
.Nx
or other
.Ul
system, you would type something like:
.Pp
.Dl # Ic "dd if=.../boot1.fs of=/dev/rfd0a bs=18k"
.Pp
.\} \" \n[alpha]:\n[ews4800mips]:\n[i386]:\n[news68k]:\n[newsmips]
.if \n[mac68k] \{\
.It
The NetBSD Boot Tools folder.
.(bullet
Create a Folder on your Mac OS disk for the
.Nx*M
components.
.It
Copy the Booter application into the newly created Folder.
Expand the file if necessary to create the Mac OS executable.
.It
Copy the Installation Kernels into the newly created Folder.
It is not necessary to
.Ic gunzip
compressed kernel files.
.It
Single-click on the Booter application icon then select the "Get Info"
from the File Menu list.
Increase the memory allocation for the Booter to as much as possible
for your system.
Having a large number of fonts, extensions or sounds installed on your system
can cause memory exhaustion problems for the Booter if you don't do this.
Also, the extra memory is needed by the Booter to expand compressed
kernels while booting.
.bullet)
.\}
.It
The Quick Installation
.(bullet
.ie \n[acorn26]:\n[atari]:\n[cats]:\n[evbppc]:\n[hp700]:\n[macppc]:\n[pmax]:\n[sgimips]:\n[sparc]:\n[sparc64] \{\
Boot the system as described above.
You should be at the
.Ic sysinst
main menu.
.\}
.el \{\
.ie \n[mac68k] \{\
Double-click on the Booter application icon to start executing it.
From the
.Ic Options
pull-down menu, select
.Ic Monitors ,
then select
.Ic Change Monitor Depth
and make sure B\*&W is highlighted.
Close the window using the
.Ic Close
button.
.It
From the
.Ic Options
pull-down menu select
.Ic Boot Options .
This will bring
up an option panel.
Set the
.Ic Auto-set GMT Bias
checkbox in the lower left and then select the
.Ic Boot from Mac OS
option at the top of the window.
The
.Ic Set
button on the right will become active.
Use it to locate and
select the Installation Kernel file appropriate for your hardware.
This will be either
.Pa netbsd-INSTALL.gz
or
.Pa netbsd-INSTALLSBC.gz .
Close the window using the
.Ic Close
button.
.It
From the
.Ic Options
pull-down menu select the
.Ic Boot Now ,
or use the Apple-B (Command-B) key combination to start the
.Nx
boot process.
Do not move the mouse while the boot operation is in
progress as this may leave the keyboard locked to
.Nx .
.Pp
The main menu will be displayed.
.\} \" \n[mac68k]
.el \{\
Insert the first boot floppy you just created.
.ie \n[i386] Restart
.el Boot
the computer.
.if \n[alpha] \{\
Type
.Pp
.Dl \&\*>\*>\*> Ic "B DVA0"
.Pp
.\}
.if \n[ews4800mips] \{\
Change boot device to floppy on the PROM menu which is invoked by
pressing ESC key right after hardware checks, and boot the computer again.
.\}
.if \n[i386] When prompted, insert the second boot floppy.
.if \n[news68k] \{\
Type
.Pp
.Dl \&NEWS\*> Ic "bo fh"
.Pp
.\}
.if \n[newsmips] \{\
Type
.Pp
.Dl \&\*> Ic "bo fd" (in case of NWS-5000)
.Pp
or
.Pp
.Dl \&\*> Ic "bo fh" (in case of NWS-3xxx)
.Pp
.\}
After language selection, the main menu will be displayed.
.\}\}
.(disp
.if t .ne 10
. cs \n(.f 22
.\" )   - appease vi showmatch
  .***********************************************.
                                                  *\h'|0'  * NetBSD-\*V Install System
  *                                               *
  *\*[Gt]a: Install NetBSD to hard disk                *
  * b: Upgrade NetBSD on a hard disk              *
  * c: Re-install sets or install additional sets *
  * d: Reboot the computer                        *
  * e: Utility menu                               *
  * x: Exit Install System                        *
  .***********************************************.
. cs \n(.f
.\" )   - appease vi showmatch
.disp)
.It
If you wish, you can configure some network settings
immediately by choosing the
.Me Utility menu
and then
.Me Configure network .
It isn't actually required at this point, but
it may be more convenient.
Go back to the main menu.
.It
Choose
.if !\n[macppc] .Me install .
.if \n[macppc] \{\
.Me "Utility menu" No then Me "Run /bin/sh"
for Open Firmware 3 systems.  You'll need to create the 
.Nx
filesystem(s) and an
.Pa fstab .
Now exit the shell, return to the main menu, and choose
.Me "Re-install" .
.Pp
Choose
.Me install
for Open Firmware 1.0.5, 1.1.22, 2.0.x, and 2.4 systems.
.\}
.It
You will be guided through some steps regarding the
setup of your disk, and the selection of distributed components
to install.
When in doubt, refer to the rest of this document for details.
.if \n[atari] \{\
WARNING: If you want your disk to retain an AHDI compatible partitioning,
make sure to use the 'existing' disk layout.
.\}
.if \n[sparc64] \{\
.Pp
WARNING: If you are installing onto a disk which you want to use with 
.Tn Solaris ,
stop here.  You will need to perform a manual installation as 
.Ic sysinst
overwrites the
.Tn Solaris
partition table.  See the section on
.Sx "Manual Installation of NetBSD using Solaris"
.\}
.It
After your disk has been prepared, choose
.ie \n[sgimips] \{\
.Me Unmounted file system
as the medium.
The CD-ROM device is usually cd0 and the partition
.Sq a
.Pq i.e. cd0a .
.\}
.el \{\
.Me CD-ROM
as the medium.
The default values for the path and device should be ok.
.\}
.It
After all the files have been unpacked, go back to
the main menu and select
.ie \n[mac68k]:\n[macppc]:\n[pmax]:\n[sgimips]:\n[sparc]:\n[sparc64] \{\
.Me reboot.
.\}
.el \{\
.Me reboot ,
after you have removed the bootfloppy from the drive.
.\}
.It
.if \n[macppc]:\n[sparc64] \{\
Once the system reaches the Open Firmware prompt, you will need to type
the correct command to boot from your hard drive.
.\}
.if \n[sparc] \{\
Once the system reaches the PROM prompt, you will need to type the correct
command to boot from your hard drive.
.\}
.if \n[sgimips] \{\
Once the system reaches the PROM prompt, you will need to modify your
PROM environment settings for SystemPartition, OSLoadPartition, OSLoader,
OSLoadFilename and OSLoadOptions and then boot the hard drive.
.\}
.Nx
will now boot.
If you haven't already done so in
.Ic sysinst ,
you should log in as
.Li root ,
and set a password for that account.
You are also advised to edit the file
.Pa /etc/rc.conf
to match your system needs.
.It
Your installation is now complete.
.It
For configuring the X window system, if installed, see the files in
.Pa /usr/X11R6/lib/X11/doc .
.if !\n[macppc] \{\
Further information can be found on
.Lk http://www.xfree86.org/ .
.\}
.if \n[macppc] \{\
Further information can be found on
.Lk http://www.NetBSD.org/ports/macppc/x11.html
.\}
.bullet)
.bullet)
.It
.To 2 "Booting NetBSD"
.Em Booting NetBSD
.
.ie \n[mac68k] \{\
.Pp
Prior to attempting to boot
.Nx*M
verify that all the following are done:
.(bullet
Enable 32-bit addressing in the Memory Control Panel [1].
.It
Disable all forms of virtual memory (the Memory Control Panel, RAM Doubler,
or other software-based memory enhancement products).
.It
Place the system in B\*&W Mode (1-bit color or grayscale) as shown in the
Monitors Control Panel or in the Monitors options dialog of the Booter.
You may choose to have the Booter do this for you automatically by selecting
the appropriate check box and radio button in the
.Ic Monitors
dialog on the
.Ic Options
menu.
.bullet)
.Pp
It is probably best to boot your machine with all extensions turned off [1].
You can do this by booting into Mac OS with the
.Key SHIFT
key held down.
You may have to restart your Macintosh for changes to take effect before
proceeding.
.(tag [1]
.It [1]
If your version of the Memory control panel does not have a 32-bit
addressing mode radio button, this means that your system is already
32-bit clean and is running in 32-bit addressing mode by default.
If the Booter complains that your are not in 32-bit mode, it may be necessary
for you to press the "Use Defaults" button in the Memory control panel to
restore 32-bit addressing.
You should probably reboot after doing so.
If you have an older II-class system (including the II, IIx, IIcx,
and SE/30), it is necessary to install Connectix's MODE32 to work around
ROM issues which prevent you from enabling 32-bit addressing.
Please see the
.Nx*M
FAQ at
.Lk http://www.NetBSD.org/ports/mac68k/faq/
for more information.
.tag)
.Pp
Double-click on the
.Nx*M
Booter icon to start the application.
Select
.Ic Booting
from the
.Ic Options
menu.
Select the Kernel Location to be from Mac OS with the filename
corresponding to the name of the Installation Kernel you are using.
Typically this will be netbsd-INSTALL.gz.
.Pp
If you haven't already put your Macintosh into B\*&W mode, select the
.Ic Monitor Options
from the
.Ic Options
menu and check the box for B\*&W mode.
.Pp
Try booting
.Nx
by selecting
.Ic Boot Now
from the
.Ic Options
menu.
.Pp
If the system does not come up, send mail to
.Mt port-mac68k@NetBSD.org
describing your software, your hardware, and as complete a description of
the problem as you can.
As an alternative, try using the Traditional
method of installation described in the next section.
.\} \" \n[mac68k]
.el \{\
.ie \n[acorn26]:\n[cats]:\n[evbppc]:\n[macppc]:\n[pmax]:\n[sgimips]:\n[sparc]:\n[sparc64] \{\
.Pp
You may want to read the
boot messages, to notice your disk's name and capacity.
Its name will be something like
.Li sd0
.if \n[acorn26]:\n[cats]:\n[evbppc]:\n[macppc]:\n[sparc64] \{\
or
.Li wd0
.\}
and the geometry will be
printed on a line that begins with its name.
As mentioned above, you may need your disk's geometry when creating
.Nx Ns 's
partitions.
You will also need to know the name, to tell
.Ic sysinst
on which disk
to install.
The most important thing to know is that
.if \n[acorn26]:\n[cats]:\n[evbppc]:\n[macppc]:\n[sparc64] \{\
.Li wd0
is
.Nx Ns 's
name for your first IDE disk,
.Li wd1
the second, etc.
.\}
.Li sd0
is your first SCSI disk,
.Li sd1
the second, etc.
.\}
.el \{\
.
.
.Pp
.ie \n[atari] \{\
Boot the system as described in the "Booting the installer" section above.
.\}
.el \{\
Boot your machine.
The boot loader will start, and will print a countdown and begin booting.
.Pp
If the boot loader messages do not appear in a reasonable
amount of time, you either have a bad boot floppy or a
hardware problem.
Try writing the install floppy image to
a different disk, and using that.
.\}
.if \n[i386] \{\
.Pp
If that doesn't work, try booting after disabling your CPU's
internal and external caches (if any).
If it still doesn't work,
.Nx
probably can't be run on your hardware.
This can probably be considered a bug, so you might want to report it.
If you do, please include as many details about your system
configuration as you can.
.\}
.Pp
It will take a while to load the kernel
.ie !\n[mac68k] \{\
from the floppy,
.\}
.el ,
probably around a minute or so, then, the kernel boot messages
will be displayed.
This may take a little while also, as
.Nx
will be probing your system to discover which hardware devices are
installed.
.if \n[atari]:\n[i386] \{\
You may want to read the
boot messages, to notice your disk's name and geometry.
Its name will be something like
.Li sd0
or
.Li wd0
and the geometry will be
printed on a line that begins with its name.
As mentioned above, you may need your disk's geometry when creating
.Nx Ns 's
partitions.
You will also need to know the name, to tell
.Ic sysinst
on which disk
to install.
.\}
The most important thing to know is that
.Li wd0
is
.Nx Ns 's
name for your first IDE disk,
.Li wd1
the second, etc.
.Li sd0
is your first SCSI disk,
.Li sd1
the second, etc.
.Pp
.if !\n[atari]:\n[mac68k] \{\
Note that once the system has finished booting, you need not
leave the floppy in the disk drive.
.\}
.\}\}
.Pp
Once
.Nx
has booted and printed all the boot messages,
you will be presented with a welcome message and a main menu.
It will also include instructions for using the menus.
.It
.To 2 "Network configuration"
.Em Network configuration
.Pp
If you will not use network operation during the installation,
but you do want your machine to be configured for networking once
it is installed, you should first go to the
.Me Utility menu ,
and select the
.Me Configure network
option.
If you only want to temporarily
use networking during the installation, you can specify these
parameters later.
If you are not using the Domain Name System (DNS),
you can give an empty response in reply to answers relating to
this.
.if \n[mac68k] \{\
.It
.To 2 "Preparing a disk for Mac OS and NetBSD"
.Em "Preparing a disk for"
.Tn Mac OS
.Em and NetBSD
.Pp
.Ic sysinst
can manipulate the Apple Disk Partition Map allowing you to partition
your disk for use with
.Nx .
It does not support resizing existing
.Tn Mac OS
HFS disk partitions.
If there is insufficient Free space on the disk to support an installation of
.Nx
you will need to backup, repartition and restore your existing
.Tn Mac OS
partitions before proceeding.
You may choose to use a Traditional method of creating disk partitions for
.Nx 
if you wish.
They can still be used by
.Ic sysinst
for a
.Nx
installation.
.\} \" \n[mac68k]
.if \n[macppc] \{\
.It
.To 2 "Preparing a disk for Open Firmware 3 systems"
.Em "Preparing a disk which will be used for Open Firmware 3 systems"
.Pp
Skip this step if you are installing
.Nx
on an Open Firmware 1 or 2 system.
.Pp
Go to the
.Me "Utility Menu" ,
and select the
.Me "Run /bin/sh"
option which will give you a shell prompt.
From this shell prompt, you will do some of the steps that the normal
install procedure runs automatically.
Unfortunately, at the moment, our install tools
aren't smart enough to deal with drives with Apple Partition Maps
and will overwrite important information describing your partitions.
.Pp
You may need to type one of the following commands to get your delete key
to work properly, depending on your keyboard:
.Dl # Ic "stty erase '^h'"
.Dl # Ic "stty erase '^?'"
.Pp
Type the following command (replacing
.Pa wd0
with the name of your destination hard drive):
.Dl # Ic "disklabel wd0"
.Pp
This will print out the partition info that was generated by 
.Ic pdisk ,
Drive Setup, or Disk Utility.  Note that, as discussed above in the
.Sx Partitioning your hard drive for NetBSD
section, your
.Em "A/UX Root"
typically is the first partition
.Pq Em a
and your
.Em "A/UX Swap"
typically is the second partition
.Pq Em b .
You may also find that your
.Em "A/UX User"
partition is the seventh partition
.Pq Em g .
For example:
.(disp
.Dl # Ic "disklabel wd0"
[...]
#        size   offset     fstype   [fsize bsize cpg/sgs]
  a:   426613   837432     4.2BSD        0     0     0   # (Cyl. 1622*- 2449*)
  b:   204800   632632       swap                        # (Cyl. 1226*- 1622*)
  c:  2134305        0     unused        0     0         # (Cyl.    0 - 4136*)
  d:   426616     1216        HFS                        # (Cyl.    2*- 829*)
  e:   204800   427832        HFS                        # (Cyl.  829*- 1226*)
  f:       21  2134284    unknown                        # (Cyl. 4136*- 4136*)
  g:   870239  1264045     4.2BSD        0     0     0   # (Cyl. 2449*- 4136*)
disklabel: boot block size 0
disklabel: super block size 0
.disp)
.Pp
Now, you need to create file systems on the partitions that
.Nx
will be using.
.Pp
.Em "Do not modify any partitions labeled"
.Pa HFS ,
.Pa UFS ,
.Em or
.Pa unknown .
The partitions you will be using have their
.Pa fstype
listed as
.Pa 4.2BSD .
.Pp
Run the
.Ic newfs
command on the
.Pa 4.2BSD
partitions:
.(disp
.Dl # Ic "newfs /dev/wd0a"
newfs: /dev/wd0a: not a character-special device
Warning: 120 sector(s) in last cylinder unallocated
/dev/wd0a:      426612 sectors in 827 cylinders of 4 tracks, 129 sectors
        208.3MB in 52 cyl groups (16 c/g, 4.03MB/g, 1024 i/g)
super-block backups (for fsck -b #) at:
     32,   8432,  16832,  25232,  33056,  41456,  49856,  58256,  66080,
  74480,  82880,  91280,  99104, 107504, 115904, 124304, 132128, 140528,
 148928, 157328, 165152, 173552, 181952, 190352, 198176, 206576, 214976,
 223376, 231200, 239600, 248000, 256400, 264224, 272624, 281024, 289424,
 297248, 305648, 314048, 322448, 330272, 338672, 347072, 355472, 363296,
 371696, 380096, 388496, 396320, 404720, 413120, 421520,
newfs: ioctl (WDINFO): Invalid argument
newfs: /dev/wd0a: can't rewrite disk label
.disp)
You can ignore the
.Pa Sq "not a character-special device" ,
.Pa Sq "sector(s) in last cylinder unallocated" ,
.Pa Sq "ioctl (WDINFO): Invalid argument" ,
and
.Pa Sq "can't rewrite disk label"
warnings.
.Pp
Now you need to mount your destination root partition:
.Dl # Ic "mount /dev/wd0a /mnt"
.Pp
Make an
.Pa fstab
file for your new system (right now, you only really need to include
.Pa / ,
.Pa /usr ,
and
.Pa swap ) ,
for example:
.Dl # Ic "mkdir /mnt/etc"
.Dl # Ic "cat \*> /mnt/etc/fstab"
.Dl "/dev/wd0a / ffs rw 1 1"
.Dl "/dev/wd0b none swap sw 0 0"
.Dl "/dev/wd0g /usr ffs rw 1 2"
.Pp
If you mess up while typing, you can press
.Key CONTROL-U
to erase everything on the current line, or
.Key CONTROL-C
to cancel the file creation, so you can start over.
.Key CONTROL-D
finishes and writes the file to disk.
.Pp
Great, now create the mountpoints for the file systems you listed in the
.Pa fstab :
.Dl # Ic "mkdir /mnt/usr"
.Pp
Clean up and return to
.Ic sysinst :
.Dl # Ic "cd /"
.Dl # Ic "umount /mnt"
.Dl # Ic exit
.\} \" \n[macppc]
.It
.To 2 "Installation drive selection and parameters"
.Em Installation drive selection and parameters
.Pp
To start the
.if \n[macppc] \{\
installation onto a dedicated
.Nx
drive (Open Firmware 1 or 2),
.\}
.if !\n[macppc] installation,
select
.Me Install NetBSD to hard disk
from the main menu.
.if \n[mac68k] \{\
To start the installation, select the menu option in install
.Nx
from the main menu.
.\}
.if \n[macppc] \{\
To start the installation onto a drive with an Apple Partition Map (Open 
Firmware 3), select
.Me Re-install sets or install additional sets
from the main menu.
.\}
.Pp
The first thing is to identify the disk on which you want to
install
.Nx .
.Ic sysinst
will report a list of disks it finds
and ask you for your selection.
Depending on how many disks are found, you may get a different message.
You should see disk names like
.ie \n[pmax] \{\
.Li rz0
or
.Li rz1
.\}
.el \{\
.if \n[acorn26]:\n[alpha]:\n[cats]:\n[i386]:\n[mac68k]:\n[macppc]:\n[sparc64] \{\
.Li wd0 ,
.Li wd1 ,
.\}
.Li sd0
or
.Li sd1 .
.if \n[i386] \{\
.Pp
.Ic sysinst
next tries to figure out the real and BIOS geometry
of your disk.
It will present you with the values it found,
if any, and will give you a chance to change them.
.\}
.if \n[mac68k] \{\
.Pp
.Ic sysinst
next tries to figure out how the selected volume has been partitioned.
It does this by reading the Apple Disk Partition Map from the disk.
If the disk does not have a Partition Map,
.Ic sysinst
will give you the option of writing one, but doing so will not make
the disk a Mac OS bootable volume.
You will have the option of creating HFS partitions that may be
subsequently initialized and used under Mac OS though.
.\}
.Pp
.if \n[i386] \{\
Next, depending on whether you are using a
.Li wd Ns Ar X
or
.Li sd Ns Ar X
disk,
you will either be asked for the type of disk
.Pq Li wd Ns Ar X
you are
using or you will be asked if you want to specify a fake geometry
for your SCSI disk
.Pq Li sd Ns Ar X .
The types of disk are
.Tn IDE, ST-506
or
.Tn ESDI .
If you're installing on an
.Tn ST-506
or
.Tn ESDI
drive, you'll be asked if your disk supports automatic sector forwarding.
If you are
.Em sure
that it does, reply affirmatively.
Otherwise, the install program will automatically reserve space for
bad144 tables.
.\}
.if \n[macppc] \{\
If
.Ic sysinst
reports
.Dl "I can not find any hard disk for use by NetBSD"
or the drive you wish to install onto is missing, then you should look at
the FAQ entry
.Lk http://www.NetBSD.org/ports/macppc/faq.html#nodisk
.\}
.\}
.It
.To 2 "Partitioning the disk"
.Em Partitioning the disk
.if \n[atari] \{\
.(bullet
Preparing a disk which will be used for
.Tn GEM
and
.Nx .
.Pp
You will be prompted if you want an AHDI compatible partitioning on your disk.
If you are installing
.Nx
on a dedicated drive, just answer 'no' and skip to the next section.
.Pp
If you answer 'yes', the
.Ic ahdilabel
program is started.
You can now change the AHDI partition ID's on your root disk.
Because NetBSD imposes a special ordering in disk partitions it uses
for / (root) and swap.
Also, because it wants to guard you against an unwanted
demolition of partitions used by other systems, you have to tell it what
partitions it is allowed to use.
You have to mark the partition you want to use as swap SWP or
(deprecated!) NBS and the other partitions as NBD.
Note that all the changes you make to the ID's are reversible as long as
you remember the original value.
ahdilabel is capable of creating or changing an
AHDI compatible partitioning on the disk, and
in the partition-ID editor, the partitions are shown in the order that AHDI
created them.
When you leave this editor and continue with
.Ic sysinst,
your changes to the ID's do have consequences to the partition order!
They will show up as follows:
.(tag 13n -offset indent
.It Li a
the first NBD partition
.It Li b
the first SWP (or NBS) partition
.It Li d (and up)
the rest of the partitions in AHDI order
.tag)
.bullet)
.\} \" \n[atari]
.if \n[macppc] \{\
.Pp
You can skip a few steps, down to
.Em Sq "Getting the distribution sets" ,
if you are installing onto a drive with an Apple Partition Map (Open 
Firmware 3), i.e. you selected
.Me "Re-install sets or install additional sets"
from the main menu.
.\} \" \n[macppc]
.if \n[sgimips] \{\
.(bullet
Please note that shared installs of 
.Tn IRIX
and 
.Nx
on the same drive have not been tested, and as such may cause problems 
or may not work.  It is
.Em strongly
recommended that all data is backed before attempting such installs.
.bullet)
.\} \" \n[sgimips]
.if !\n[atari]:\n[macppc]:\n[sgimips] \{\
.(bullet
Which portion of the disk to use.
.Pp
You will be asked if you want to use the entire disk or
only part of the disk.
If you decide to use the entire disk for
.Nx ,
it will be checked if there are already other
systems present on the disk, and you will be asked to confirm
whether you want to overwrite these.
.if \n[mac68k] \{\
.It
Definition of the NetBSD disklabel.
.Pp
The Apple Disk Partition Map is used to create an in-core map of the
disk called the disklabel.
A minimum of two NetBSD partitions will be required,
one for root and one for swap.
Up to eight partitions may be used by NetBSD.
Up to 32 partitions may exist on the disk which
can be any combination of Mac OS HFS, Free, Scratch and
.Nx
partitions, although only the first eight which meet the needs of
.Nx
will be seen and mapped to the
.Nx
disklabel.
.Pp
Some partitions in the disklabel have a fixed purpose.
Partition 'a' is always the root partition, 'b' is the swap partition
and 'c' is the entire disk.
Partitions 'd' through 'h' are available for other use.
Traditionally, 'g' is the partition mounted on the /usr directory, but
this is historical practice, not a fixed value.
.It
Editing the
.Nx
Disklabel (and the underlying Apple Disk Partition Map).
.Pp
You will be presented with the current layout of the disk as seen by
.Nx ,
and given a change to change it.
(Even though
.Nx
can only use the first eight qualified partitions, all partitions
found on the disk will be displayed.)
The partitions found on the disk will be shown in the top section of
the display.
Each will be identified with the name assigned by
.Nx ,
the current size, offset, type, use and mount point.
The partition currently being modified will be highlighted in inverse video.
The bottom part of the display will list the operations which may be
performed on the selected (highlighted) partition.
The options are:
.(bullet
Select next partition
.Pp
This highlights the next partition in the upper display list and makes it
the current one selected for manipulation.
.It
Change selected partition
.Pp
This changes the type assigned to the partition.
A partition may be assigned for use as a
.Nx
Root, SWAP, Usr, or Root&Usr; it may be assigned for use as a Mac OS HFS
partition; a Scratch (for later reassignment); or a Free partition.
Free partitions which are physically adjacent to each other will be collapsed
into a single Free partition.
.It
Set mount point for partition
.Pp
This designates the
.Nx
file system mount point for the partition, and gets transferred into
the /etc/fstab definition so
.Nx
knows where to mount the file system on subsequent boots.
The option only applies to
.Nx
Root, Usr, Root&Usr or Mac OS HFS partitions, although currently HFS access
is not supported without optional software components.
A common set of predefined mount points (/usr, /home, /var, /tmp or None)
will be presented to you to assist you in defining the most commonly used,
but you may enter you own names if you choose.
Selecting "None" will clear the mount point name and keep the partition
from being defined in the resulting
.Pa /etc/fstab
file.
.It
Split selected partition
.Pp
This option divides the selected partition into two separate partitions
if there is space available in the Disk Partition Map.
You will be prompted for the size of the first segment and the remaining
portion will be allocated to the second segment.
The first segment will be designated as a Scratch type, and the second
will be designated as a Free type.
To clear a split, or remerge two adjacent partitions into a
single one, change both to be Free types.
.Ic sysinst
will merge them and update the display.
.Pp
This is the primary option used to partition the disk since it allows
you to sub-divide the selected partition into two partitions.
Changing the types associated with the resulting two parts, or splitting the
second part further sub-divides the original partition.
.It
Page Up, Page Down
.Pp
These entries allow you to scroll the upper display if more than
eight partitions currently exist on the disk.
.It
Fix selected partition
.Pp
This option reviews the partition's size and starting address and fixes
the values if they overlap any adjacent partition.
This is primarily a debugging option and shouldn't be necessary during a
normal installation.
However, some 3rd party disk formatters have been known to create
bogus entries in the Apple Disk Partition Map, and this option can aid
is repairing these entries.
.It
Exit
.Pp
This option completes the disk partitioning and returns you to the
previous installation menu.
At that point you will be given one last opportunity to bail out before
committing the changes to the Disk Partition Map recorded on the disk.
.bullet)
.Pp
.It
Recommended approach to partitioning
.Pp
The simplest method of approaching disk partitioning with
.Ic sysinst
is to convert everything that can be used for
.Nx
into a Free type partition.
This will allow
.Ic sysinst
to collapse and merge all the available space.
Then cycle through the Select, Split, Select, Change, and Set Mount Point
options for each of the
.Nx
partitions that are desired.
Since
.Nx*M
has a very specific
mount order for partitions during system boot, it is best to create your
.Nx
partitions in the following order:  Root, SWAP, Usr where the partitions
will be mounted in order on 'a', 'b', 'g', 'd', 'e', 'f', and 'h'.
.Pp
At least one Root or Root&Usr is required, and a SWAP partition is
highly desirable.
As a general rule you will need twice as much swap
space as you have RAM, more if you plan on running X, Web applications
or doing heavy development in a multi-user environment.
The Root partition, if it is separate from your Usr, usually requires about
24 MB.
.Pp
If multiple Root partitions are defined, the second is usually
mounted on /altusr by default.
.Nx*M
automatically mounts all
Root partitions after the first as Usr type partitions.
However, it is best to be very specific about mount points and partition
type and use.
.\} \" \n[mac68k]
.bullet)
.if \n[i386] \{\
.Pp
If you want to use the entire disk for
.Nx ,
you can skip
the following section and go to
.Em "Editing the NetBSD disklabel" .
.It
.Em "Editing the Master Boot Record"
.Pp
First, you will be prompted to specify the units of size
that you want to express the sizes of the partitions in.
You can either pick megabytes, cylinders or sectors.
.Pp
After this, you will be presented with the current values
stored in the MBR, and will be given the opportunity to
change, create or delete partitions.
For each partition you can set the type, the start and the size.
Setting the type to
.Ic unused
will delete a partition.
You can also mark a partition as active, meaning that this is
the one that the BIOS will start from at boot time.
.Pp
Be sure to mark the partition you want to boot from as active!
.Pp
After you are done editing the MBR, a sanity check
will be done, checking for partitions that overlap.
Depending on the BIOS capabilities of your machine and the
parameters of the
.Nx
partition you have specified, you
may also be asked if you want to install newer bootcode in your MBR.
If you have multiple operating systems on the
disk that you are installing on, you will also be given
the option to install a bootselector, that will allow you
to pick the operating system to start up when your computer
is (re-)started.
.Pp
If everything is ok, you can go on to the next step,
editing the
.Nx
disklabel.
.Pp
.\} \" \n[i386]
.\} \" !\n[atari]:\n[macppc]:\n[sgimips]
.
.if !\n[mac68k] \{\
.It
.Em Editing the NetBSD disklabel
.Pp
The partition table of the
.Nx
part of a disk is called a
.Em disklabel .
.if \n[macppc] \{\
In actuality,
.Nx*M
uses an Apple Partition Map.
The installer creates something like a real
Apple Partition Map, but it is not compatible with
.Tn Mac OS 
or Open Firmware,
which is one of the reasons why you cannot use this installer to partition
a disk that can be used with
.Tn Mac OS
or Open Firmware 3 systems.
.Pp
.\}
.if \n[sparc] \{\
.Nx
disklabels on \*M are compatible with the boot ROMs, and with
.Tn SunOS
and
.Tn Solaris .
.\}
There are 4 layouts for the
.Nx
part of the disk that you can pick from:
.Ic Standard, Standard with X, Custom
and
.Ic Use Existing .
The first two use a set of default values (that you can change)
suitable for a normal installation, possibly including X.
With the
.Ic Custom
option you can specify everything yourself.
The last option uses the partition info already present on the disk.
.Pp
.if \n[atari] \{\
If you want to use
.Nx
on an AHDI partitioned disk, you will have to use:
.Ic Use Existing .
.Pp
.\}
You will be presented with the current layout of the
.Nx
disklabel, and given a chance to change it.
For each partition, you can set the type, offset and size,
block and fragment size, and the mount point.
The type that
.Nx
uses for normal file storage is called
.Sy 4.2BSD .
A swap partition has a special type called
.Sy swap .
.
.if \n[i386] \{\
You can also specify a partition as type
.Sy MSDOS .
This is useful if you share the disk with
.Tn MS-DOS
or
.Tn Windows ;
.Nx
is able to access the files on these partitions.
You can use the values from the MBR for the
.Tn MS-DOS
part of the disk to specify the partition of type
.Sy MSDOS
(you don't have to do this now, you can always re-edit
the disklabel to add this once you have installed
.Nx ,
or use
.Xr mbrlabel 8
to help you updating your disklabel with data from the MBR).
.Pp
.\}
.
Some partitions in the disklabel have a fixed purpose.
.(tag 6n -offset indent
.It Li a
Root partition
.Pq Pa /
.It Li b
Swap partition.
.It Li c
The
.Nx
portion of the disk.
.if !'c'\*[part_raw]' \{\
.It Li \*[part_raw]
The entire disk.
.\}
.if \n[sgimips] \{\
.It Li d
The SGI volume header (boot partition)
.\}
.It Li \*[part_free]-\*[part_max]
Available for other use.
Traditionally,
.Li \*[part_usr]
is the partition mounted on
.Pa /usr ,
but this is historical practice and not a fixed value.
.tag)
.\} \" !\n[mac68k]
.
.Pp
You will then be asked to name your disk's disklabel.
The default response will be ok for most purposes.
If you choose to name it something different, make sure the name
is a single word and contains no special characters.
You don't need to remember this name.
.\}
.Pp
.It
.To 2 "Preparing your hard disk"
.Em Preparing your hard disk
.Pp
.Em "You are now at the point of no return".
.ie \n[atari] \{\
Apart from the changes you made with
.Ic ahdilabel
nothing has been modified on your disk yet.
If you confirm that you want to install
.Nx ,
the partitions now assigned to
.Nx
will be actually written to.
.\}
.el \{\
Nothing has been
written to your disk yet, but if you confirm that you want to
install
.Nx ,
your hard drive will be modified.
.\}
If you are sure you want to proceed, enter
.Li yes
at the prompt.
.Pp
The install program will now label your disk and make the file
systems you specified.
The file systems will be initialized to contain
.Nx
bootstrapping binaries and configuration files.
You will see messages on your screen from the various
.Nx
disk preparation tools that are running.
There should be no errors in this section of the installation.
If there are, restart from the beginning of the installation process.
Otherwise, you can continue the installation program
after pressing the return key.
.if \n[macppc] \{\
.Pp
.(Note
The bootstrapping code installed in this step will
.Em not
boot a machine with Open Firmware 3.
You will still need to have
.Pa ofwboot.xcf
on an HFS or HFS+ partition.
.Note)
.\}
.It
.To 2 "Getting the distribution sets"
.Em Getting the distribution sets
.Pp
The
.Nx
distribution consists of a number of
.Em sets ,
that come in the form of gzipped tarfiles.
A few sets must be installed for a working system, others are optional.
At this point of the installation, you will be presented with a menu
which enables you to choose from one of the following methods
of installing the sets.
Some of these methods will first load the sets on your hard disk,
others will extract the sets directly.
.Pp
For all these methods, the first step is making the sets
available for extraction, and then do the actual installation.
The sets can be made available in a few different ways.
The following sections describe each of those methods.
After reading the one about the method you will be using, you
can continue to the section labeled
.Sq Extracting the distribution sets .
.It
.To 2 "Installation using ftp"
.Em Installation using ftp
.Pp
To be able to install using ftp, you first need to configure
your network setup, if you haven't already at the start of
the install procedure.
.Ic sysinst
will do this for you, asking you
if you want to use DHCP, and if not
to provide data like IP address, hostname, etc.
If you do not have name service set up for the machine that you
are installing on, you can just press
.Key RETURN
in answer to these questions, and DNS will not be used.
.Pp
You will also be asked to specify the host that you want
to transfer the sets from, the directory on that host,
the account name and password used to log into that
host using ftp, and optionally a proxy server to use.
If you did not set up DNS when answering
the questions to configure networking, you will need to
specify an IP address instead of a hostname for the ftp
server.
.Pp
.Ic sysinst
will proceed to transfer all the default set files
from the remote site to your hard disk.
.It
.To 2 "Installation using NFS"
.Em Installation using NFS
.Pp
To be able to install using NFS, you first need to configure
your network setup, if you haven't already at the start of
the install procedure.
.Ic sysinst
will do this for you, asking you
if you want to use DHCP, and if not
to provide data like IP address, hostname, etc.
If you do not have name service set up for the machine that you
are installing on, you can just press
.Key RETURN
in answer to these questions, and DNS will not be used.
.Pp
You will also be asked to specify the host that you want
to transfer the sets from, and the directory on that host
that the files are in.
This directory should be mountable by the machine you are installing on,
i.e. correctly exported to your machine.
.Pp
If you did not set up DNS when answering the questions to
configure networking, you will need to specify an IP address
instead of a hostname for the NFS server.
.It
.To 2 "Installation from CD-ROM"
.Em Installation from CD-ROM
.Pp
When installing from a CD-ROM, you will be asked to specify
the device name for your CD-ROM player
.Pq usually Li cd0 ,
and the directory name on the CD-ROM where the distribution files are.
.Pp
.Ic sysinst
will then check if the files are indeed available
in the specified location, and proceed to the actual
extraction of the sets.
.if \n[i386] \{\
.It
.To 2 "Installation from a floppy set"
.Em Installation from a floppy set
.Pp
Because the installation sets are too big to fit on one floppy,
the floppies are expected to be filled with the split set
files.
The floppies are expected to be in
.Tn MS-DOS
format.
You will be asked for a directory where the sets should be reassembled.
Then you will be prompted to insert the floppies containing the split sets.
This process will continue until all the sets have been loaded from floppy.
.\}
.if \n[mac68k] \{\
.It
.To 2 "Installation from Mac OS file systems"
.Em Installation from Mac OS file systems
.Pp
.Nx*M
does not currently have in-kernel support for
.Tn Mac OS
HFS/HFS+ or AppleShare filesystems.
.Ic sysinst
therefore can not access the file sets if they are on these filesystems.
.\}
.It
.To 2 "Installation from an unmounted file system"
.Em Installation from an unmounted file system
.Pp
In order to install from a local file system, you will
need to specify the device that the file system resides
on
.ie \n[pmax] .Pq for example Li rz1e
.el .Pq for example Li sd1e
the type of the file system,
and the directory on the specified file system where the sets are located.
.Ic sysinst
will then check if it
can indeed access the sets at that location.
.if \n[sgimips] \{\
.Pp
If this is a CD-ROM installation, the device used will be the name for your
CD-ROM player with partition letter 'a'
.Pq usually cd0a .
.\}
.if \n[macppc] \{\
Remember,
.Nx*M
doesn't grok HFS or HFS+ partitions
.\}
.It
.To 2 "Installation from a local directory"
.Em Installation from a local directory
.Pp
This option assumes that you have already done some preparation
yourself.
The sets should be located in a directory on a
file system that is already accessible.
.Ic sysinst
will ask you
for the name of this directory.
.It
.To 2 "Extracting the distribution sets"
.Em Extracting the distribution sets
.Pp
After the install sets containing the
.Nx
distribution
have been made available, you can either extract all the
sets (a full installation), or only extract sets that
you have selected.
In the latter case, you will be shown the currently selected sets,
and given the opportunity to select the sets you want.
Some sets always need to be installed
.Po Sy kern, base,
and
.Sy etc
.Pc
they will not be shown in this selection menu.
.Pp
Before extraction begins, you can elect to watch the files being
extracted; the name of each file that is extracted will be shown.
This can slow down the installation process considerably, especially
on machines with slow graphics consoles or serial consoles.
Alternatively, you will be asked if you wish to have a progress bar.
This is the preferred option as it shows progress without significantly
slowing down the installation process.
.Pp
.ie \n[macppc] \{\
If you are installing using the
.Me "Re-install sets or install additional sets"
option, then you will need to create the device nodes in
.Pa /dev ,
otherwise,
.\}
.el After all the files have been extracted,
all the necessary device node files will be created.
If you have already configured networking, you will be asked if you want to
use this configuration for normal operation.
If so, these values will be installed in the network configuration files.
The next menu will allow you to select the time zone that you're in,
to make sure your clock has the right offset from UTC.
Finally you will be asked to select a password encryption algorithm
and can then set a password for the "root" account, to prevent
the machine coming up without access restrictions.
.if \n[macppc] \{\
.It
.To 2 "Making the device nodes"
.Em Making the device nodes
.Pp
If you are installing using the
.Me "Re-install sets or install additional sets"
option, then you will need to create the device nodes in
.Pa /dev
now.
Otherwise, skip this step.
.Pp
Go to the main installation menu, and select
.Me "Utility menu"
and then select the
.Me "Run /bin/sh"
option, which will give you a shell prompt.
You may need to type one of the following commands to get your delete key
to work properly, depending on your keyboard:
.Dl # Ic "stty erase '^h'"
.Dl # Ic "stty erase '^?'"
.Pp
Type the following command (replacing
.Pa wd0a
with the partition name of your destination root partition):
Now you need to mount your destination root partition:
.Dl # Ic "mount /dev/wd0a /mnt"
.Dl # Ic "cd /mnt/dev"
.Dl # Ic "sh MAKEDEV all"
.Dl # Ic "cd /"
.Dl # Ic "umount /mnt"
.Dl # Ic "exit"
.\}
.if \n[sparc64] \{\
.It
.To 2 "Ensure you have the correct kernel installed"
.Em "Ensure you have the correct kernel installed"
.Pp
If you are installing from the 32-bit sparc distribution set, make sure
that you installed the correct kernel.  The \*M installation tools do not 
by default copy the correct 32-bit kernel.  Unless you prepared ahead of 
time by renaming the
.Pa kern-GENERIC_SUN4U.tgz
to
.Pa kern-GENERIC.tgz
then you will need to follow the next few instructions.
.Pp
Go to the main installation menu, and select
.Me "Utility menu"
and then select the
.Me "Run /bin/sh"
option, which will give you a shell prompt.
You may need to type one of the following commands to get your delete key
to work properly, depending on your keyboard:
.Dl # Ic "stty erase '^h'"
.Dl # Ic "stty erase '^?'"
.Pp
Type the following command (replacing
.Pa wd0a
with the partition name of your destination root partition):
.Dl # Ic "mount /dev/wd0a /mnt"
.Dl # Ic "cd /mnt"
Now you ned to mount the location of your distribution sets:
.Dl # Ic "mount /dev/cd0a /mnt2"
.Dl # Ic "tar xpzvf /mnt2/sparc/binary/kernel/kern-GENERIC_SUN4U.tgz"
.Dl # Ic "umount /mnt"
.Dl # Ic "umount /mnt2"
.Dl # Ic "exit"
.\}
.It
.To 2 "Finalizing your installation"
.Em Finalizing your installation
.Pp
Congratulations, you have successfully installed
.Nx
\*V.
.if \n[cats] \{\
.Pp
To finalize the installation of
.Nx*M
certain parameters on the Cyclone firmware need to changed.
The reason is that the Cyclone firmware is unable to boot anything other
than an a.out format kernels.
.Pp
Kernels created on a
.Nx*M
\*V system are natively ELF and converted to a.out.
This conversion process loses the symbol information used for,
amongst other things, kernel memory grovelers such as vmstat.
The workaround to the problem is to provide both the native ELF kernel
(with all the symbol information) and the a.out kernel.
These are available as /netbsd and /netbsd.aout respectively.
As the a.out format kernel is not named in such a way that the
Cyclone firmware will automatically find it the following command
should be issued as the firmware prompt.
.Pp
.Dl boot> Ic "set boot wd0:/netbsd.aout"
.Pp
.\}
.if !\n[macppc] \{\
You can now reboot the machine, and boot
.Nx
from hard disk.
.\} \" !\n[macppc]
.enum)
