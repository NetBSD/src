#! /bin/sh
#	$NetBSD: buildmake.sh.in,v 1.9 2018/01/15 19:52:54 uwe Exp $
#
# buildmake.sh.in - Autoconf-processed shell script for building make(1).
#

: ${NETBSDSRCDIR:=@srcdir@/../..}

: ${HOST_CC="@CC@"}
: ${HOST_CFLAGS="@CPPFLAGS@ @CFLAGS@"}
: ${HOST_LDFLAGS="@LDFLAGS@ @LIBS@"}
: ${runcmd=""}

docmd () {
	echo "$1"
	$1 || exit 1
}

MKSRCDIR=${NETBSDSRCDIR}/usr.bin/make
HOST_CFLAGS="${HOST_CFLAGS} -D_PATH_DEFSYSPATH=\"${NETBSDSRCDIR}/share/mk\""

for f in $MKSRCDIR/*.c $MKSRCDIR/lst.lib/*.c; do
	docmd "${HOST_CC} ${HOST_CFLAGS} @DEFS@ -c $f"
done

docmd "${HOST_CC} ${HOST_CFLAGS} -o ${_TOOL_PREFIX:-nb}make *.o ${HOST_LDFLAGS}"
