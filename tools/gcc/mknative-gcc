#!/bin/sh
#	$NetBSD: mknative-gcc,v 1.41 2009/11/30 14:34:17 uebayasi Exp $
#
# Shell script for generating all the constants needed for a native
# platform build of src/gnu/dist/gcc.
#

# initialise

_TMPDIR=$2
_TOP=$3
_PLATFORM=$4
_VPATH=`grep VPATH ${_TMPDIR}/Makefile | sed 's,^.*=[ 	]*,,'`
_GNU_DIST=`cd ${_VPATH}; pwd`

. $_TOP/tools/gcc/mknative.common

##### gnu/lib/crtstuff #####

get_crtstuff () {
	_subdir="$1"
	mkdir -p $_TOP/gnu/lib/$_subdir/arch

	getvars gcc/Makefile \
		INCLUDES CRTSTUFF_CFLAGS CRTSTUFF_T_CFLAGS \
		tm_defines xm_file xm_defines \
		| write_mk gnu/lib/$_subdir/arch/$MACHINE_ARCH.mk
}

##### gnu/lib/libg2c #####

get_libg2c () {
	mkdir -p $_TOP/gnu/lib/libg2c3/arch/$MACHINE_ARCH

	write_c gnu/lib/libg2c3/arch/$MACHINE_ARCH/config.h <$_TMPDIR/$_PLATFORM/libf2c/libU77/config.h
	write_c gnu/lib/libg2c3/arch/$MACHINE_ARCH/g2c.h <$_TMPDIR/$_PLATFORM/libf2c/g2c.h

	{
		getvars $_PLATFORM/libf2c/Makefile \
			F2CEXT
		getvars $_PLATFORM/libf2c/libF77/Makefile \
			ALL_CFLAGS OBJS
		getvars $_PLATFORM/libf2c/libI77/Makefile \
			ALL_CFLAGS OBJS | sed 's,=,+=,'
		getvars $_PLATFORM/libf2c/libU77/Makefile \
			ALL_CFLAGS OBJS | sed 's,=,+=,'
	} | write_mk gnu/lib/libg2c3/arch/$MACHINE_ARCH/defs.mk
}

##### gnu/lib/libgcc #####

get_libgcc_list_funcs_asm () {
	getvars gcc/Makefile LIB1ASMFUNCS | {
		# print newline separated list
		sed -e '
			s,^.*=,,
			s, *$,,
			s,  *, ,g
			s, ,\
,g'
	} | {
		# print foo and foo_s
		sed -ne '
			/./ {
				p
				s,$,_s,
				p
			}
		'
	} | sort
}

get_libgcc_list_funcs_lib () {
	local _lib=$1
	local _lib_prefix=${_lib%.*}
	local _lib_suffix=${_lib#*.}

	sed -ne '
		/^\.\/'${_lib_prefix}'\.'${_lib_suffix}': .*\.o$/ {
			s,^.*/,,
			s,\.o$,,
			p
		}
	' build/gcc/libgcc.mk | sort
}

get_libgcc_list_objs_libs () {
	cat build/gcc/libgcc.mk | \
	egrep '^\.\/(libgcc_s\.so|libgcc\.a|libgcc_eh\.a|libgcov\.a): (libgcc_s|libgcc|libgcc_eh|libgcov)\/.*\.o$' | \
	sed -e '
		s,^\.\/,,
		s,: .*/,	,
		s,^\(.*\)	\(.*\)$,\2	\1,
	' | sort
}

get_libgcc_list_objs_srcs () {
	if [ -e $_TOP/${libgcc_db_funcs}.S ]; then
		cut -f1 $_TOP/${libgcc_db_objs_libs} | sed -e 's,\.o$,,' | \
		comm -23 /dev/stdin $_TOP/${libgcc_db_funcs}.S | \
		sed -e 's,\(.*\),\1.o	\1.c,'

		cut -f1 $_TOP/${libgcc_db_objs_libs} | sed -e 's,\.o$,,' | \
		comm -12 /dev/stdin $_TOP/${libgcc_db_funcs}.S | \
		sed -e 's,\(.*\),\1.o	\1.S,'
	else
		cut -f1 $_TOP/${libgcc_db_objs_libs} | sed -e 's,\.o$,,' | \
		sed -e 's,\(.*\),\1.o	\1.c,'
	fi | sort
}

get_libgcc_list_objs_tmplsrcs () {
	grep 'GCC_FOR_TARGET.*\.o$' build/gcc/libgcc.mk | \
	sed -ne '
		s,^.* -c \([^ ]*\).* -o .*/\([^ ]*\.o\)$,\2	\1,
		# basename
		/\$/ { s,\$.*/,,; }
		/\// { s,\/.*/,,; }
		p
	' | sort
}

get_libgcc_list_objs_xflags () {
	local _flags=$1

	grep 'GCC_FOR_TARGET.*\.o$' build/gcc/libgcc.mk | \
	sed -n '
		x
	:loop
		g
		s/^\(.*\) \(-['${_flags}'][^ ][^ ]*\) \(.*\) \(-o .*\)\/\(.*\.o\)$/\5	\2/p
		g
		s/^\(.*\) \(-['${_flags}'][^ ][^ ]*\) \(.*\) \(-o .*\)\/\(.*\.o\)$/\1 \3 \4\/\5/
		h
		t loop
	' | sort
}

get_libgcc_list_objs_cppflags () {
	get_libgcc_list_objs_xflags D
}

get_libgcc_list_objs_copts () {
	get_libgcc_list_objs_xflags fmx
}

get_libgcc_list_tmplsrcs () {
	local _lib=$1
	local _tmplallsrcs=$( mktemp /tmp/mknative-gcc._tmplallsrcs.XXXXXX )

	touch $_TOP/${libgcc_db_tmplsrcs}.tmplsrcs.${_lib%.*}
	touch $_TOP/${libgcc_db_tmplsrcs}.tmplfpsrcs.${_lib%.*}
	touch $_TOP/${libgcc_db_tmplsrcs}.tmplasmsrcs.${_lib%.*}

	# all files
	local _lib_prefix=${_lib%.*}
	local _lib_suffix=${_lib#*.}
	join $_TOP/$libgcc_db_objs_libs $_TOP/$libgcc_db_objs_tmplsrcs | \
	grep ${_lib_prefix}'\.'${_lib_suffix} | cut -d' ' -f 3 | sort -u > \
	$_tmplallsrcs

	# TMPLFPSRCS = [fdp]p-bit.c
	grep '[fdt]p-bit\.c' <$_tmplallsrcs | sort -u | \
	writefile ${libgcc_db_tmplsrcs}.tmplfpsrcs.${_lib%.*}

	# TMPLASMSRCS = $(LIB1ASMSRC)
	grep '\$(LIB1ASMSRC)' <$_tmplallsrcs | sort -u | \
	writefile ${libgcc_db_tmplsrcs}.tmplasmsrcs.${_lib%.*}

	# TMPLSRCS is anything else; exclude TMPLFPSRCS and TMPLASMSRCS
	cat $_tmplallsrcs | \
	comm -23 /dev/stdin $_TOP/${libgcc_db_tmplsrcs}.tmplfpsrcs.${_lib%.*} | \
	comm -23 /dev/stdin $_TOP/${libgcc_db_tmplsrcs}.tmplasmsrcs.${_lib%.*} | \
	writefile ${libgcc_db_tmplsrcs}.tmplsrcs.${_lib%.*}

	rm -f $_tmplallsrcs
}

get_libgcc_new_analyze () {
	mkdir -p $_TOP/${_machine_arch_subdir}

	touch $_TOP/${libgcc_db_funcs}.S
	get_libgcc_list_funcs_asm | \
	writefile ${libgcc_db_funcs}.S

	for _lib in libgcc_s.so libgcc.a libgcc_eh.a libgcov.a; do
		touch $_TOP/${libgcc_db_funcs}.${_lib%.*}
		get_libgcc_list_funcs_lib $_lib | \
		writefile ${libgcc_db_funcs}.${_lib%.*}
	done

	get_libgcc_list_objs_libs | writefile ${libgcc_db_objs_libs}
	get_libgcc_list_objs_srcs | writefile ${libgcc_db_objs_srcs}
	get_libgcc_list_objs_tmplsrcs | writefile ${libgcc_db_objs_tmplsrcs}
	get_libgcc_list_objs_cppflags | writefile ${libgcc_db_objs_cppflags}
	get_libgcc_list_objs_copts | writefile ${libgcc_db_objs_copts}

	for _lib in libgcc_s.so libgcc.a libgcc_eh.a libgcov.a; do
		get_libgcc_list_tmplsrcs $_lib
	done
}

#####

get_libgcc_gen_tmplsrcs_tmplsrcs () {
	local _lib=$1

	printf '\n'
	printf 'TMPLSRCS.%s = \\\n' $_lib
	sed -e 's,^,	,; s,$, \\,' $_TOP/${libgcc_db_tmplsrcs}.tmplsrcs.${_lib%.*}
}

get_libgcc_gen_tmplsrcs_tmplfpsrcs () {
	local _lib=$1

	printf '\n'
	printf 'TMPLFPSRCS.%s = \\\n' $_lib
	sed -e 's,^,	,; s,$, \\,' $_TOP/${libgcc_db_tmplsrcs}.tmplfpsrcs.${_lib%.*}
}

get_libgcc_gen_tmplsrcs_tmplasmsrcs () {
	local _lib=$1

	printf '\n'
	printf 'TMPLASMSRCS.%s = \\\n' $_lib
	sed -e 's,^,	,; s,$, \\,' $_TOP/${libgcc_db_tmplsrcs}.tmplasmsrcs.${_lib%.*} | \
	sed -e 's,LIB1ASMSRC,G_&,'
}

get_libgcc_gen_srcs () {
	local _lib=$1

	printf '\n'
	printf 'SRCS.%s = \\\n' $_lib
	if [ -e $_TOP/${libgcc_db_funcs}.S ]; then
		comm -23 $_TOP/${libgcc_db_funcs}.${_lib%.*} $_TOP/${libgcc_db_funcs}.S | \
		sed -e 's,$,.c,; s,^,tmp_,'
		comm -12 $_TOP/${libgcc_db_funcs}.${_lib%.*} $_TOP/${libgcc_db_funcs}.S | \
		sed -e 's,$,.S,; s,^,tmp_,'
	else
		cat $_TOP/${libgcc_db_funcs}.${_lib%.*} | \
		sed -e 's,$,.c,; s,^,tmp_,'
	fi | sort | \
	sed -e 's,^,	,; s,$, \\,'
}

_lookup_objs () {
	local _obj=$1; local _key=$2

	eval grep \^$_obj\\\	 \$_TOP/\${libgcc_db_objs_${_key}} | cut -f2
}

get_libgcc_gen_srcs_tmplsrcs () {
	cut -f1 $_TOP/${libgcc_db_objs_libs} | \
	while read _obj; do
		printf 'SRCS.tmp_%s=%s\n' \
			"$( _lookup_objs $_obj srcs )" \
			"$( _lookup_objs $_obj tmplsrcs )"
	done | \
	sed -e 's,\$(\(.*\)),${G_\1},'
}

get_libgcc_gen_srcs_cppflags () {
	cut -f1 $_TOP/${libgcc_db_objs_libs} | \
	while read _obj; do
		printf '_CPPFLAGS.tmp_%s=%s\n' \
			"$( _lookup_objs $_obj srcs )" \
			"$( _lookup_objs $_obj cppflags | xargs )"
	done
}

get_libgcc_gen_srcs_copts () {
	cut -f1 $_TOP/${libgcc_db_objs_libs} | \
	while read _obj; do
		printf 'COPTS.tmp_%s=%s\n' \
			"$( _lookup_objs $_obj srcs )" \
			"$( _lookup_objs $_obj copts | xargs )"
	done
}

get_libgcc_new_generate () {
	for _lib in libgcc_s.so libgcc.a libgcc_eh.a libgcov.a; do
		for _tmpl in tmplsrcs tmplfpsrcs tmplasmsrcs; do
			eval get_libgcc_gen_tmplsrcs_${_tmpl} $_lib | \
			write_mk ${libgcc_libs_mk}.${_lib%.*}.tmplsrcs.${_tmpl}.mk
		done

		get_libgcc_gen_srcs $_lib | \
		write_mk ${libgcc_libs_mk}.${_lib%.*}.srcs.mk
	done

	for _arg in tmplsrcs cppflags copts; do
		eval get_libgcc_gen_srcs_${_arg} | \
		eval writefile \$libgcc_srcs_mk_${_arg}
	done
}

#####

get_libgcc_new () {
	_subdir="$1"

	# List of generated files.

	_machine_arch_subdir=gnu/lib/lib$_subdir/arch${_archsubdir}/$MACHINE_ARCH

	libgcc_db_funcs=${_machine_arch_subdir}/funcs
	libgcc_db_tmplsrcs=${_machine_arch_subdir}/tmplsrcs
	libgcc_db_objs_libs=${_machine_arch_subdir}/objs.libs
	libgcc_db_objs_srcs=${_machine_arch_subdir}/objs.srcs
	libgcc_db_objs_tmplsrcs=${_machine_arch_subdir}/objs.tmplsrcs
	libgcc_db_objs_cppflags=${_machine_arch_subdir}/objs.cppflags
	libgcc_db_objs_copts=${_machine_arch_subdir}/objs.copts

	get_libgcc_new_analyze

	libgcc_libs_mk=${_machine_arch_subdir}/libs
	libgcc_srcs_mk=${_machine_arch_subdir}/srcs.mk
	libgcc_srcs_mk_tmplsrcs=${_machine_arch_subdir}/srcs.tmplsrcs.mk
	libgcc_srcs_mk_cppflags=${_machine_arch_subdir}/srcs.cppflags.mk
	libgcc_srcs_mk_copts=${_machine_arch_subdir}/srcs.copts.mk

	get_libgcc_new_generate
}

get_libgcc () {
	_subdir="$1"
	mkdir -p $_TOP/gnu/lib/lib$_subdir/arch

	case "$_subdir" in
	gcc3)
		_extravars="USE_COLLECT2 LIB2FUNCS_1 LIB2FUNCS_2 xm_file"
		_archsubdir=""
		;;
	gcc4)
		_extravars="COLLECT2 UNWIND_H xm_include_list"
		_archsubdir=""
		;;
	esac

	# DPBIT, FPBIT only used on mn10[23]00, we don't need them.
	# XXX we should probably grab everything Just In Case for
	# the future.
	{
		getvars gcc/Makefile \
			INCLUDES LIB2ADD LIB2ADDEH \
			LIB1ASMFUNCS LIB1ASMSRC \
			LIB2_DIVMOD_FUNCS LIB2FUNCS_ST \
			LIBGCC2_CFLAGS \
			SHLIB_MKMAP SHLIB_MKMAP_OPTS \
			SHLIB_MAPFILES SHLIB_NM_FLAGS \
			EXTRA_HEADERS xm_defines \
			tm_defines ${_extravars}
	} | write_mk gnu/lib/lib$_subdir/arch${_archsubdir}/$MACHINE_ARCH.mk

	# Generate new style files.
	if [ -n "${MKNATIVE_LIBGCC_NEW}" ]; then
		get_libgcc_new $_subdir
	fi
}

##### gnu/lib/libgcov #####

get_libgcov () {
	_subdir="$1"

	mkdir -p $_TOP/gnu/lib/lib$_subdir/libgcov/arch/$MACHINE_ARCH

	{
		getvars gcc/Makefile \
			LIBGCOV
	} | write_mk gnu/lib/lib$_subdir/libgcov/arch/$MACHINE_ARCH/defs.mk

	write_c gnu/lib/lib$_subdir/libgcov/arch/$MACHINE_ARCH/gcov-iov.h \
	   <$_TMPDIR/gcc/gcov-iov.h

}

##### gnu/usr.bin/gcc[34]/libiberty #####

get_gcc_libiberty () {
	_subdir="$1"
	mkdir -p $_TOP/gnu/usr.bin/$_subdir/libiberty/arch/$MACHINE_ARCH

	getvars libiberty/Makefile \
		ALLOCA EXTRA_OFILES LIBOBJS REQUIRED_OFILES \
		| write_mk gnu/usr.bin/$_subdir/libiberty/defs.mk

	write_c gnu/usr.bin/$_subdir/libiberty/arch/$MACHINE_ARCH/config.h \
		<$_TMPDIR/libiberty/config.h
}

##### gnu/lib/libobjc #####

get_libobjc () {
	case "$1" in
	*4)
		_subdir="$1/arch/$MACHINE_ARCH"
		_options="ALL_OPT_FILES"
		_unwind="UNWIND_H"
		;;
	*)
		_subdir="$1"
		_options=""
		_unwind=""
		;;
	esac

	mkdir -p $_TOP/gnu/lib/$_subdir

	{
		if [ -n "$_options" ]; then
			getvars gcc/Makefile $_options
		fi
		getvars $_PLATFORM/libobjc/Makefile \
			ALL_CFLAGS INCLUDES OBJS OBJC_H \
			| sed "s,$_GNU_DIST,\${GNUHOSTDIST},g"
		if [ -n "$_unwind" ]; then
			getvars gcc/Makefile $_unwind
		fi
	} | write_mk gnu/lib/$_subdir/defs.mk

	write_c gnu/lib/$_subdir/config.h \
		<$_TMPDIR/$_PLATFORM/libobjc/config.h
}

##### gnu/lib/libstdc++-v3 #####

get_libstdcxx_v3 () {
	_subdir="$1"
	mkdir -p $_TOP/gnu/lib/$_subdir/arch/$MACHINE_ARCH

	case ${_subdir} in
	*4)
		_src_CC_files="atomicity_file CCODECVT_CC CCOLLATE_CC CCTYPE_CC CMESSAGES_CC CMONEY_CC CNUMERIC_CC CTIME_CC CLOCALE_CC BASIC_FILE_CC"
		_headers1="host_headers debug_headers tr1_headers c_compatibility_headers_extra"
		_headers2="thread_host_headers host_headers_extra"
		_build_headers="c++allocator.h c++config.h cxxabi_tweaks.h gthr-default.h gthr-posix.h gthr-single.h gthr-tpf.h gthr.h"
		_unwind="UNWIND_H"
		;;
	*)
		_src_CC_files=""
		_headers1="target_headers"
		_headers2="thread_target_headers target_headers_extra"
		_build_headers="c++config.h gthr-default.h gthr-posix.h gthr-single.h gthr.h"
		_unwind=""
		;;
	esac

	# build files
	for h in $_build_headers; do
		write_c gnu/lib/$_subdir/arch/$MACHINE_ARCH/$h \
			<$_TMPDIR/$_PLATFORM/libstdc++-v3/include/$_PLATFORM/bits/$h
	done

	write_c gnu/lib/$_subdir/arch/$MACHINE_ARCH/config.h \
		<$_TMPDIR/$_PLATFORM/libstdc++-v3/config.h

	{
		# libmath
		getvars $_PLATFORM/libstdc++-v3/libmath/Makefile \
			libmath_la_SOURCES libmath_la_LIBADD

		# libsupc++
		getvars $_PLATFORM/libstdc++-v3/libsupc++/Makefile \
			sources | sed 's/^G_sources=/G_LIBSUPCXX_SOURCES=/'
		getvars $_PLATFORM/libstdc++-v3/libsupc++/Makefile \
			c_sources | sed 's/^G_c_sources=/G_LIBSUPCXX_C_SOURCES=/'

		# src
		getvars $_PLATFORM/libstdc++-v3/src/Makefile \
			sources $_src_CC_files SECTION_FLAGS | sed 's/^G_sources=/G_SRC_SOURCES=/'

		# include
		getvars $_PLATFORM/libstdc++-v3/include/Makefile \
			c_base_headers_rename std_headers_rename
		getvars $_PLATFORM/libstdc++-v3/include/Makefile \
			bits_headers backward_headers ext_headers c_base_headers_extra \
			$_headers1 | sed -e 's#/[^ 	][^ 	]*/##g' -e 's/\${GNUHOSTDIST}//g'
		getvars $_PLATFORM/libstdc++-v3/include/Makefile \
			$_headers2 | sed -e 's#\./[^ 	][^ 	]*/##g' -e 's/\${GNUHOSTDIST}//g'

		if [ -n "$_unwind" ]; then
			getvars gcc/Makefile $_unwind
		fi
	} | write_mk gnu/lib/$_subdir/arch/$MACHINE_ARCH/defs.mk
}

##### gnu/usr.bin/gcc3 #####

get_gcc () {
	_subdir="$1"
	mkdir -p $_TOP/gnu/usr.bin/$_subdir/arch/$MACHINE_ARCH
	case ${_subdir} in
	gcc4)
		mkdir -p $_TOP/gnu/usr.bin/$_subdir/libcpp/arch/$MACHINE_ARCH
		_buildname="BUILD_"
		_libcppsubdir=""
		_extravars="TM_H ALL_OPT_FILES"
		_hconfig_h=""
		_extravars2="tm_file_list build_xm_include_list"
		_extravars3="tm_p_include_list"
		
		;;
	*)
		_buildname="HOST_"
		_libcppsubdir="gcc/"
		_extravars=""
		_hconfig_h="HCONFIG_H"
		_extravars2=""
		_extravars3=""
		;;
	esac

	{
		getvars gcc/Makefile \
			${_buildname}EARLY_SUPPORT ${_buildname}ERRORS ${_buildname}PRINT \
			${_buildname}RTL ${_buildname}SUPPORT ${_buildname}VARRAY | \
		    sed -e 's#build/errors.o#build-errors.o#g' \
			-e 's#build/print-rtl.o#build-print-rtl.o#g' \
			-e 's#build/rtl.o#build-rtl.o#g' \
			-e 's#build/varray.o#build-varray.o#g' \
			-e 's#build/ggc-none.o#build-ggc-none.o#g' \
			-e 's#build/##g'
		getvars gcc/Makefile \
			ALL_CFLAGS ALL_CPPFLAGS C_AND_OBJC_OBJS C_OBJS CCCP_OBJS \
			GCOV_OBJS PROTO_OBJS ${_extravars1} \
			INCLUDES md_file OBJC_OBJS OBJS out_file version \
			BUILD_PREFIX RTL_H TREE_H ${_hconfig_h} BASIC_BLOCK_H GCC_H \
			GTFILES_SRCDIR GTFILES_FILES_FILES GTFILES_FILES_LANGS \
			GTFILES GTFILES_LANG_DIR_NAMES \
			tm_defines host_xm_file host_xm_defines tm_p_file \
			target_cpu_default ${_extravars} ${_extravars2} \
			lang_specs_files ${_extravars3}
		getvars gcc/Makefile \
			LIB2ADDEHDEP | sed 's/unwind.inc//'
		getvars gcc/Makefile \
			CXX_OBJS CXX_C_OBJS | sed 's/cp\///g'
		getvars gcc/Makefile \
			F77_OBJS | sed 's/f\///g'
		case ${_subdir} in
		gcc4)
			getvars libcpp/Makefile \
				libcpp_a_OBJS
			;;
		gcc3)
			getvars gcc/Makefile \
				LIBCPP_OBJS LIBCPP_H
			;;
		esac
		getvars gcc/Makefile \
			ENABLE_SHARED
		case ${_subdir} in
		gcc4)
			echo G_SHLIB_LINK="$CC -shared"
			echo G_SHLIB_MULTILIB=.
			;;
		gcc3)
			getvars gcc/Makefile \
				SHLIB_LINK SHLIB_MULTILIB
			;;
		esac
	} | write_mk gnu/usr.bin/$_subdir/arch/$MACHINE_ARCH/defs.mk

	case "$_subdir" in
	gcc3)
		hfiles='auto-host configargs cs-hconfig gencheck hconfig gthr-default'
		;;
	gcc4)
		write_c gnu/usr.bin/$_subdir/libcpp/arch/$MACHINE_ARCH/config.h <$_TMPDIR/libcpp/config.h
		hfiles='auto-host configargs gencheck gthr-default tm bconfig config multilib'
		;;
	esac
	for f in $hfiles; do
		write_c gnu/usr.bin/$_subdir/arch/$MACHINE_ARCH/$f.h <$_TMPDIR/gcc/$f.h
	done
}

##### main #####

case "$1" in
# .mk and .h files for libgcc bootstrap (from host build)
libgcc)
	get_libgcc gcc3
	get_crtstuff crtstuff3
	exit 0
	;;

libgcc4)
	get_libgcc gcc4
	get_crtstuff crtstuff4
	exit 0
	;;

# gcc files
gcc4)
	get_gcc gcc4
	get_libgcc gcc4
	get_libgcov gcc4
	get_crtstuff crtstuff4
	get_gcc_libiberty gcc4
	get_libobjc libobjc4
	get_libstdcxx_v3 libstdc++-v3_4
	exit 0
	;;

gcc3)
	get_gcc gcc3
	get_libg2c
	get_libgcc gcc3
	get_crtstuff crtstuff3
	get_gcc_libiberty gcc3
	get_libobjc libobjc3
	get_libstdcxx_v3 libstdc++-v3
	exit 0
	;;

*)	echo invalid arguments; exit 1;;
esac
